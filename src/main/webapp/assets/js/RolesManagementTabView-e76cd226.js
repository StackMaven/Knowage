import{d as E,ad as S,l as _,n as L,_ as T,r as i,o as k,h as z,w as n,f as t,g as C,t as d,D,a5 as V,c as m,a as r,G as x,B as M,C as N,A as R,v as P,u as U,s as B}from"./index-1e676509.js";import{K as O,u as I,c as G}from"./KnValidatonMessages-ebe48c72.js";import{s as F}from"./checkbox.esm-fa6c8259.js";import{s as K}from"./inputswitch.esm-80317a38.js";const Y=[{category:"documentExecutionMenu",dbname:"SEE_NOTES",fieldName:"ableToSeeNotes",label:"viewNotes",visible:!1},{category:"documentExecutionMenu",dbname:"SEE_METADATA",fieldName:"ableToSeeMetadata",label:"viewMeta",visible:!1},{category:"documentExecutionMenu",dbname:"SAVE_METADATA",fieldName:"ableToSaveMetadata",label:"saveMeta",visible:!1},{category:"menuConfiguration",dbname:"MANAGE_GLOSSARY_BUSINESS",fieldName:"ableToManageGlossaryBusiness",label:"manageGlossaryBusiness",visible:!1},{category:"menuConfiguration",dbname:"MANAGE_GLOSSARY_TECHNICAL",fieldName:"ableToManageGlossaryTechnical",label:"manageGlossaryTechnical",visible:!1},{category:"menuConfiguration",dbname:"MANAGE_CALENDAR",fieldName:"ableToManageCalendar",label:"manageCalendar",visible:!1},{category:"documentExecutionMenu",dbname:"SEE_SNAPSHOTS",fieldName:"ableToSeeSnapshots",label:"viewScheduledExecution",visible:!1},{category:"documentExecutionMenu",dbname:"RUN_SNAPSHOTS",fieldName:"ableToRunSnapshots",label:"runSnapshot",visible:!1}],W=[{category:"documentExecutionMenu",dbname:"SAVE_INTO_FOLDER",fieldName:"ableToSaveIntoPersonalFolder",label:"managers.rolesManagement.authorizations.saveIntoWorkspace",visible:!1},{category:"documentExecutionMenu",dbname:"SAVE_SUBOBJECTS",fieldName:"ableToSaveSubobjects",label:"managers.rolesManagement.authorizations.saveOlapView",visible:!1},{category:"documentExecutionMenu",dbname:"SEE_METADATA",fieldName:"ableToSeeMetadata",label:"managers.rolesManagement.authorizations.viewMeta",visible:!1},{category:"documentExecutionMenu",dbname:"SAVE_METADATA",fieldName:"ableToSaveMetadata",label:"managers.rolesManagement.authorizations.saveMeta",visible:!1},{category:"documentExecutionMenu",dbname:"SEE_VIEWPOINTS",fieldName:"ableToSeeViewpoints",label:"managers.rolesManagement.authorizations.viewSavedParameters",visible:!1},{category:"documentExecutionMenu",dbname:"SEE_SNAPSHOTS",fieldName:"ableToSeeSnapshots",label:"managers.rolesManagement.authorizations.viewScheduledExecution",visible:!1},{category:"documentExecutionMenu",dbname:"RUN_SNAPSHOTS",fieldName:"ableToRunSnapshots",label:"managers.rolesManagement.authorizations.runScheduledExecution",visible:!1},{category:"documentExecutionMenu",dbname:"SEND_MAIL",fieldName:"ableToSendMail",label:"managers.rolesManagement.authorizations.sendMail",visible:!1},{category:"documentExecutionMenu",dbname:"ENABLE_TO_RATE",fieldName:"ableToEnableRate",label:"managers.rolesManagement.authorizations.rateDocuments",visible:!1},{category:"documentExecutionMenu",dbname:"SEE_NOTES",fieldName:"ableToSeeNotes",label:"managers.rolesManagement.authorizations.viewNotes",visible:!1},{category:"documentExecutionMenu",dbname:"ENABLE_TO_PRINT",fieldName:"ableToEnablePrint",label:"managers.rolesManagement.authorizations.printDocuments",visible:!1},{category:"documentExecutionMenu",dbname:"ENABLE_TO_COPY_AND_EMBED",fieldName:"ableToEnableCopyAndEmbed",label:"managers.rolesManagement.authorizations.copyAndEmbed",visible:!1},{category:"menuConfiguration",dbname:"SEE_DOCUMENT_BROWSER",fieldName:"ableToSeeDocumentBrowser",label:"managers.rolesManagement.authorizations.viewDocBrowser",visible:!1},{category:"menuConfiguration",dbname:"SEE_MY_WORKSPACE",fieldName:"ableToSeeMyWorkspace",label:"managers.rolesManagement.authorizations.viewMyWorkspace",visible:!1},{category:"menuConfiguration",dbname:"FUNCTIONS_CATALOG_USAGE",fieldName:"ableToUseFunctionsCatalog",label:"managers.rolesManagement.authorizations.functionsCatalogUsage",visible:!1},{category:"menuConfiguration",dbname:"MANAGE_USERS",fieldName:"ableToManageUsers",label:"managers.rolesManagement.authorizations.manageUsers",visible:!1},{category:"menuConfiguration",dbname:"MANAGE_KPI_VALUE",fieldName:"ableToManageKpiValue",label:"managers.rolesManagement.authorizations.manageKpiValue",visible:!1},{category:"menuConfiguration",dbname:"MANAGE_INTERNATIONALIZATION",fieldName:"ableToManageInternationalization",label:"managers.rolesManagement.authorizations.manageInternationalization",visible:!1},{category:"menuConfiguration",dbname:"MANAGE_GLOSSARY_BUSINESS",fieldName:"ableToManageGlossaryBusiness",label:"managers.rolesManagement.authorizations.manageGlossaryBusiness",visible:!1},{category:"menuConfiguration",dbname:"MANAGE_GLOSSARY_TECHNICAL",fieldName:"ableToManageGlossaryTechnical",label:"managers.rolesManagement.authorizations.manageGlossaryTechnical",visible:!1},{category:"menuConfiguration",dbname:"MANAGE_CALENDAR",fieldName:"ableToManageCalendar",label:"managers.rolesManagement.authorizations.manageCalendar",visible:!1},{category:"myWorskpace",dbname:"SEE_MY_DATA",fieldName:"ableToSeeMyData",label:"managers.rolesManagement.authorizations.viewMyData",visible:!1},{category:"myWorskpace",dbname:"CREATE_DOCUMENTS",fieldName:"ableToCreateDocuments",label:"managers.rolesManagement.authorizations.createDocuments",visible:!1},{category:"myWorskpace",dbname:"CREATE_SELF_SERVICE_COCKPIT",fieldName:"ableToCreateSelfServiceCockpit",label:"managers.rolesManagement.authorizations.createSelfSelviceCockpit",visible:!1},{category:"myWorskpace",dbname:"CREATE_SELF_SERVICE_GEOREPORT",fieldName:"ableToCreateSelfServiceGeoreport",label:"managers.rolesManagement.authorizations.createSelfSelviceGeoreport",visible:!1},{category:"myWorskpace",dbname:"CREATE_SELF_SERVICE_KPI",fieldName:"ableToCreateSelfServiceKpi",label:"managers.rolesManagement.authorizations.createSelfSelviceKpi",visible:!1},{category:"myWorskpace",dbname:"BUILD_QBE_QUERY",fieldName:"ableToBuildQbeQuery",label:"managers.rolesManagement.authorizations.buildQbe",visible:!1},{category:"myWorskpace",dbname:"ENABLE_DATASET_PERSISTENCE",fieldName:"ableToEnableDatasetPersistence",label:"managers.rolesManagement.authorizations.datasetPersistence",visible:!1},{category:"myWorskpace",dbname:"ENABLE_FEDERATED_DATASET",fieldName:"ableToEnableFederatedDataset",label:"managers.rolesManagement.authorizations.federatedDataset",visible:!1},{category:"SEE",dbname:"SEE_SUBOBJECTS",fieldName:"ableToSeeSubobjects",label:"managers.rolesManagement.authorizations.seeSubobj",visible:!1},{category:"SAVE",dbname:"SAVE_REMEMBER_ME",fieldName:"ableToSaveRememberMe",label:"managers.rolesManagement.authorizations.saveRemember",visible:!1},{category:"ITEMS",dbname:"SEE_FAVOURITES",fieldName:"ableToSeeFavourites",label:"managers.rolesManagement.authorizations.seeFavourites",visible:!1},{category:"ITEMS",dbname:"SEE_TODO_LIST",fieldName:"ableToSeeToDoList",label:"managers.rolesManagement.authorizations.seeToDoList",visible:!1},{category:"EXPORT",dbname:"DO_MASSIVE_EXPORT",fieldName:"ableToDoMassiveExport",label:"managers.rolesManagement.authorizations.doMassiveExport",visible:!1},{category:"ITEMS",dbname:"SEE_SUBSCRIPTIONS",fieldName:"ableToSeeSubscriptions",label:"managers.rolesManagement.authorizations.seeSubscriptions",visible:!1},{category:"ITEMS",dbname:"CREATE_SOCIAL_ANALYSIS",fieldName:"ableToCreateSocialAnalysis",label:"managers.rolesManagement.authorizations.createSocialAnalysis",visible:!1},{category:"ITEMS",dbname:"VIEW_SOCIAL_ANALYSIS",fieldName:"ableToViewSocialAnalysis",label:"managers.rolesManagement.authorizations.viewSocialAnalysis",visible:!1},{category:"ITEMS",dbname:"HIERARCHIES_MANAGEMENT",fieldName:"ableToHierarchiesManagement",label:"managers.rolesManagement.authorizations.hierarchiesManagement",visible:!1},{category:"cockpitWidgets",dbname:"EDIT_PYTHON_SCRIPTS",fieldName:"ableToEditPythonScripts",label:"managers.rolesManagement.authorizations.editPythonScripts",visible:!1},{category:"cockpitWidgets",dbname:"CREATE_CUSTOM_CHART",fieldName:"ableToCreateCustomChart",label:"managers.rolesManagement.authorizations.createCustomChart",visible:!1}],Q={style:{"margin-bottom":"2em",width:"100%"}},j=[{categoryName:"documentExecutionMenu",name:"document execution menu"},{categoryName:"menuConfiguration",name:"menu configuration"},{categoryName:"myWorskpace",name:"my workspace"},{categoryName:"cockpitWidgets",name:"cockpit widgets"}],X={header:{style:{display:"flex","flex-direction":"column"}},style:{width:"50%"}},H={ableToBuildQbeQuery:!0,ableToCreateDocuments:!0,ableToCreateSelfServiceCockpit:!0,ableToCreateSelfServiceGeoreport:!0,ableToCreateSelfServiceKpi:!0,ableToEnableDatasetPersistence:!0,ableToEnableFederatedDataset:!0,ableToSaveIntoPersonalFolder:!0,ableToSaveSubobjects:!0,ableToSeeDocumentBrowser:!0,ableToSeeMyData:!0,ableToSeeMyWorkspace:!0,ableToSeeViewpoints:!0,ableToSendMail:!0},q={insert:{toastTitle:"common.toast.createTitle"},success:"common.toast.success",update:{toastTitle:"common.toast.updateTitle"}};var A={EEAuthorizations:Y,authorizations:W,card:Q,categories:j,column:X,newRoleDefaultValues:H,operation:q};const J={style:{height:"100%","margin-bottom":"2em",width:"100%"}},Z={header:{style:{"text-transform":"capitalize"}}};var ee={card:J,column:Z};const ae=E({name:"domain-category-tab",components:{Card:S,Column:_,DataTable:L},props:{title:String,categoryList:Array,selected:Array},emits:["changed"],data(){return{domainCategoryTabDescriptor:ee,selectedCategories:[]}},watch:{selected(){this.selectedCategories=this.selected}},created(){this.selectedCategories=this.selected},methods:{setDirty(){this.$emit("changed",this.selectedCategories)},onSelectAll(e){this.selectedCategories=e.data,this.$emit("changed",this.selectedCategories)},onUnselectAll(){this.selectedCategories=[],this.$emit("changed",this.selectedCategories)}}});function te(e,a,l,v,h,f){const c=i("Toolbar"),b=i("Column"),u=i("DataTable"),p=i("Card");return k(),z(p,{class:"domainCard",style:{height:"calc(100vh - 75px)"}},{header:n(()=>[t(c,{class:"kn-toolbar kn-toolbar--secondary"},{start:n(()=>[C(d(e.title),1)]),_:1})]),content:n(()=>[t(u,{value:e.categoryList,selection:e.selectedCategories,"onUpdate:selection":a[0]||(a[0]=s=>e.selectedCategories=s),class:"p-datatable-sm kn-table",dataKey:"categoryId",paginator:!0,rows:20,responsiveLayout:"stack",breakpoint:"960px",scrollable:!0,scrollHeight:"flex",onRowSelect:e.setDirty,onRowUnselect:e.setDirty,onRowSelectAll:e.onSelectAll,onRowUnselectAll:e.onUnselectAll,"data-test":"data-table"},{empty:n(()=>[C(d(e.$t("common.info.noDataFound")),1)]),default:n(()=>[t(b,{class:"kn-column-checkbox",selectionMode:"multiple",dataKey:"categoryId"}),t(b,{field:"categoryName",header:e.$t("common.name"),style:D(e.domainCategoryTabDescriptor.column.header.style)},null,8,["header","style"])]),_:1},8,["value","selection","onRowSelect","onRowUnselect","onRowSelectAll","onRowUnselectAll"])]),_:1})}var oe=T(ae,[["render",te],["__scopeId","data-v-3436cee4"]]);const re={role:[{fieldName:"name",validators:[{key:"required"},{key:"regex",validator:{type:"extendedAlphanumericRegex"}}]},{fieldName:"code",validators:[{key:"regex",validator:{type:"extendedAlphanumericRegex"}}]},{fieldName:"description",validators:[{key:"regex",validator:{type:"extendedAlphanumericRegex"}}]},{fieldName:"roleTypeID",validators:[{key:"required"}]}]};var $={validations:re};const ne=E({name:"detail-tab",components:{Card:S,Dropdown:V,Checkbox:F,KnValidationMessages:O},props:{selectedRole:{type:Object,requried:!1},publicRole:{type:Object,requried:!1}},emits:["fieldChanged","roleTypeChanged"],data(){return{rolesManagementTabViewDescriptor:A,roleDetailValidationDescriptor:$,translatedRoleTypes:[],v$:I(),roleTypes:[],role:{}}},validations(){return{role:G("role",$.validations.role)}},async created(){this.selectedRole&&(this.role={...this.selectedRole}),await this.loadRoleTypes()},watch:{selectedRole(){this.v$.$reset(),this.role={...this.selectedRole}}},methods:{async loadRoleTypes(){await this.loadDomains("ROLE_TYPE").then(e=>{this.roleTypes=e.data,this.translatedRoleTypes=e.data.map(a=>({VALUE_CD:this.$t(`managers.rolesManagement.rolesDropdown.${a.VALUE_CD}`),VALUE_ID:a.VALUE_ID}))})},onFieldChange(e,a){this.$emit("fieldChanged",{fieldName:e,value:a})},loadDomains(e){return this.$http.get(`/knowage/restful-services/domains/listValueDescriptionByType?DOMAIN_TYPE=${e}`)},onRoleTypeChange(e,a,l){const v=this.roleTypes.find(c=>c.VALUE_ID===l.value);v&&(this.role.roleTypeCD=v.VALUE_CD);const h=l.value,f=this.role.roleTypeCD;this.$emit("roleTypeChanged",{roleTypeIDField:e,roleTypeCDField:a,ID:h,CD:f})},onPublicChange(){if(this.publicRole&&this.publicRole.id!=this.role.id&&this.role.isPublic){let e=this.$t("managers.rolesManagement.publicRoleWarning1")+`< ${this.publicRole.name} >`+this.$t("managers.rolesManagement.publicRoleWarning2");this.$confirm.require({message:e,header:this.$t("common.warning"),icon:"pi pi-exclamation-triangle",accept:()=>{this.role.isPublic=!0,this.onFieldChange("isPublic",!0)},reject:()=>{this.role.isPublic=!1,this.onFieldChange("isPublic",!1)}})}else this.onFieldChange("isPublic",this.role.isPublic)}}}),ie={id:"informations-content",class:"kn-flex kn-relative kn-height-full"},le={class:"roles-absolute-scroll"},de={class:"p-fluid p-m-5"},se={class:"p-field"},ce={class:"p-float-label"},be={for:"name",class:"kn-material-input-label"},pe={class:"p-field"},ke={class:"p-float-label"},me={for:"code",class:"kn-material-input-label"},ue={class:"p-field"},ge={class:"p-float-label"},ve={for:"description",class:"kn-material-input-label"},he={class:"p-field"},fe={class:"p-float-label"},ye={for:"roleTypeID",class:"kn-material-input-label"},we={class:"p-field"},xe={class:"p-field-checkbox"},Me={for:"isPublic"};function Ce(e,a,l,v,h,f){const c=i("InputText"),b=i("KnValidationMessages"),u=i("Dropdown"),p=i("Checkbox"),s=i("Card");return k(),m("div",ie,[r("div",le,[t(s,{style:D(e.rolesManagementTabViewDescriptor.card.style)},{content:n(()=>[r("form",de,[r("div",se,[r("span",ce,[t(c,{id:"name",class:x(["kn-material-input",{"p-invalid":e.v$.role.name.$invalid&&e.v$.role.name.$dirty}]),type:"text",modelValue:e.v$.role.name.$model,"onUpdate:modelValue":a[0]||(a[0]=o=>e.v$.role.name.$model=o),modelModifiers:{trim:!0},maxLength:"100",onBlur:a[1]||(a[1]=o=>e.v$.role.name.$touch()),onInput:a[2]||(a[2]=o=>e.onFieldChange("name",o.target.value)),"data-test":"name-input"},null,8,["modelValue","class"]),r("label",be,d(e.$t("common.name"))+" * ",1)]),t(b,{vComp:e.v$.role.name,additionalTranslateParams:{fieldName:e.$t("common.name")}},null,8,["vComp","additionalTranslateParams"])]),r("div",pe,[r("span",ke,[t(c,{id:"code",class:x(["kn-material-input",{"p-invalid":e.v$.role.code.$invalid&&e.v$.role.code.$dirty}]),type:"text",modelValue:e.v$.role.code.$model,"onUpdate:modelValue":a[3]||(a[3]=o=>e.v$.role.code.$model=o),modelModifiers:{trim:!0},maxLength:"20",onBlur:a[4]||(a[4]=o=>e.v$.role.code.$touch()),onInput:a[5]||(a[5]=o=>e.onFieldChange("code",o.target.value)),"data-test":"code-input"},null,8,["modelValue","class"]),r("label",me,d(e.$t("managers.rolesManagement.detail.code")),1)]),t(b,{vComp:e.v$.role.code,additionalTranslateParams:{fieldName:e.$t("managers.rolesManagement.detail.code")}},null,8,["vComp","additionalTranslateParams"])]),r("div",ue,[r("span",ge,[t(c,{id:"description",class:x(["kn-material-input",{"p-invalid":e.v$.role.description.$invalid&&e.v$.role.description.$dirty}]),type:"text",modelValue:e.v$.role.description.$model,"onUpdate:modelValue":a[6]||(a[6]=o=>e.v$.role.description.$model=o),modelModifiers:{trim:!0},maxLength:"150",onBlur:a[7]||(a[7]=o=>e.v$.role.description.$touch()),onInput:a[8]||(a[8]=o=>e.onFieldChange("description",o.target.value)),"data-test":"description-input"},null,8,["modelValue","class"]),r("label",ve,d(e.$t("common.description")),1)]),t(b,{vComp:e.v$.role.description,additionalTranslateParams:{fieldName:e.$t("common.description")}},null,8,["vComp","additionalTranslateParams"])]),r("div",he,[r("span",fe,[t(u,{id:"roleTypeID",class:x(["kn-material-input",{"p-invalid":e.v$.role.roleTypeID.$invalid&&e.v$.role.roleTypeID.$dirty}]),options:e.translatedRoleTypes,optionLabel:"VALUE_CD",optionValue:"VALUE_ID",modelValue:e.v$.role.roleTypeID.$model,"onUpdate:modelValue":a[9]||(a[9]=o=>e.v$.role.roleTypeID.$model=o),onBeforeShow:a[10]||(a[10]=o=>e.v$.role.roleTypeID.$touch()),onChange:a[11]||(a[11]=o=>e.onRoleTypeChange("roleTypeID","roleTypeCD",o))},null,8,["options","modelValue","class"]),r("label",ye,d(e.$t("managers.rolesManagement.detail.roleTypeID"))+" * ",1)]),t(b,{vComp:e.v$.role.roleTypeID,additionalTranslateParams:{fieldName:e.$t("managers.rolesManagement.detail.roleTypeID")}},null,8,["vComp","additionalTranslateParams"])]),r("div",we,[r("span",xe,[t(p,{id:"isPublic",name:"isPublic",modelValue:e.role.isPublic,"onUpdate:modelValue":a[12]||(a[12]=o=>e.role.isPublic=o),onChange:e.onPublicChange,binary:!0,"data-test":"is-public-checkbox"},null,8,["modelValue","onChange"]),r("label",Me,d(e.$t("managers.rolesManagement.detail.isPublic")),1)])])])]),_:1},8,["style"])])])}var Ae=T(ne,[["render",Ce]]);const Ee=E({name:"authorizations-tab",components:{Card:S,InputSwitch:K},props:{selectedRole:{type:Object,requried:!1},authList:Array,authCBs:Object},emits:["authChanged"],data(){return{rolesManagementTabViewDescriptor:A,role:{},authorizationList:[],authorizationCBs:{}}},created(){this.authorizationList=this.authList,this.authorizationCBs=this.authCBs,this.role={...this.selectedRole}},watch:{selectedRole:{handler:function(e){this.role={...e}},deep:!0}},methods:{authChanged(e,a){this.$emit("authChanged",{fieldName:e,value:a})}}}),Te={id:"informations-content",class:"kn-flex kn-relative kn-height-full"},Se={class:"roles-absolute-scroll"},Ne={class:"p-grid"},$e={class:"p-field-checkbox p-m-3"},ze=["for"];function De(e,a,l,v,h,f){const c=i("Toolbar"),b=i("InputSwitch"),u=i("Card");return k(),m("div",Te,[r("div",Se,[t(u,{class:"kn-card no-padding"},{content:n(()=>[(k(!0),m(M,null,N(e.rolesManagementTabViewDescriptor.categories,(p,s)=>(k(),m("div",{key:s},[e.authorizationCBs[p.categoryName]&&e.authorizationCBs[p.categoryName].length?(k(),m(M,{key:0},[t(c,{class:"kn-toolbar kn-toolbar--secondary"},{start:n(()=>[C(d(e.$t(p.name)),1)]),_:2},1024),r("div",Ne,[(k(!0),m(M,null,N(e.authorizationCBs[p.categoryName],(o,g)=>(k(),m("div",{key:g,class:"p-xl-3 p-lg-4 p-md-6 p-sm-12"},[r("div",$e,[t(b,{id:"cb-"+s+"-"+g,modelValue:e.role[o.fieldName],"onUpdate:modelValue":w=>e.role[o.fieldName]=w,disabled:o.enableForRole&&e.role.roleTypeCD==="ADMIN",onChange:w=>e.authChanged(o.fieldName,e.role[o.fieldName])},null,8,["id","modelValue","onUpdate:modelValue","disabled","onChange"]),r("label",{for:"cb-"+s+"-"+g},d(e.$t(o.label)),9,ze)])]))),128))])],64)):R("",!0)]))),128))]),_:1})])])}var Re=T(Ee,[["render",De]]);const Ie=E({components:{DomainCategoryTab:oe,RoleDetailTab:Ae,TabView:P,TabPanel:U,RoleAuthorizationsTab:Re},props:{id:{type:String,required:!1},publicRole:{type:Object,required:!1}},emits:["touched","closed","inserted"],data(){return{rolesManagementTabViewDescriptor:A,selectedBusinessModels:[],selectedDataSets:[],selectedKPICategories:[],selectedRole:{},roleMetaModelCategories:[],selectedCategories:[],authorizationList:[],authorizationCBs:{},businessModelList:[],dataSetList:[],kpiCategoriesList:[],loading:!1,operation:"insert",v$:I()}},computed:{buttonDisabled(){return this.v$.$invalid}},watch:{id(){this.loadSelectedRole(),this.clearSelectedLists()}},setup(){return{store:B()}},async created(){await this.loadAllDomainsData(),await this.loadSelectedRole(),await this.loadAuthorizations(),this.initAuthorizationCB()},methods:{async handleSubmit(){if(this.v$.$invalid)return;this.selectedRole.roleMetaModelCategories=[],this.mapCategories();let e="/knowage/restful-services/2.0/roles/";this.selectedRole.id&&(this.operation="update",e+=this.selectedRole.id),await this.$http.post(e,this.selectedRole).then(()=>{this.store.setInfo({title:this.$t(this.rolesManagementTabViewDescriptor.operation[this.operation].toastTitle),msg:this.$t(this.rolesManagementTabViewDescriptor.operation.success)}),this.$emit("inserted"),this.$router.replace("/roles-management")})},loadCategories(e){return this.$http.get(`/knowage/restful-services/2.0/roles/categories/${e}`).finally(()=>this.loading=!1)},loadDomains(e){return this.$http.get(`/knowage/restful-services/domains/listValueDescriptionByType?DOMAIN_TYPE=${e}`).finally(()=>this.loading=!1)},async loadAuthorizations(){this.loading=!0,await this.$http.get("/knowage/restful-services/authorizations").then(e=>{this.authorizationList=e.data.root,this.rolesManagementTabViewDescriptor.authorizations.forEach(a=>{a.visible=this.authorizationList.findIndex(l=>a.dbname===l.name)>=0})}).finally(()=>this.loading=!1)},initAuthorizationCB(){this.rolesManagementTabViewDescriptor.categories.forEach(e=>{this.authorizationCBs[e.categoryName]=this.rolesManagementTabViewDescriptor.authorizations.filter(a=>a.category===e.categoryName&&a.visible)})},async loadAllDomainsData(){this.loading=!0,await this.loadDomains("BM_CATEGORY").then(e=>{e.data.map(a=>{this.businessModelList.push({categoryId:a.VALUE_ID,categoryName:a.VALUE_NM})})}),await this.loadDomains("DATASET_CATEGORY").then(e=>{e.data.map(a=>{this.dataSetList.push({categoryId:a.VALUE_ID,categoryName:a.VALUE_NM})})}),await this.loadDomains("KPI_KPI_CATEGORY").then(e=>{e.data.map(a=>{this.kpiCategoriesList.push({categoryId:a.VALUE_ID,categoryName:a.VALUE_NM})})}),this.loading=!1},async loadSelectedRole(){this.loading=!0,this.id?(await this.$http.get(`/knowage/restful-services/2.0/roles/${this.id}`).then(e=>this.selectedRole=e.data),await this.loadCategories(this.id).then(e=>{this.clearSelectedLists(),e.data.map(a=>{let l=this.indexInList(a,this.businessModelList);l!=-1&&this.selectedBusinessModels.push(this.businessModelList[l]),l=this.indexInList(a,this.dataSetList),l!=-1&&this.selectedDataSets.push(this.dataSetList[l]),l=this.indexInList(a,this.kpiCategoriesList),l!=-1&&this.selectedKPICategories.push(this.kpiCategoriesList[l])})})):this.selectedRole={...A.newRoleDefaultValues,name:""},this.loading=!1},setDirty(){this.$emit("touched")},closeTemplate(){this.$router.push("/roles-management"),this.$emit("closed")},indexInList(e,a){return a.findIndex(l=>l.categoryId===e.categoryId)},clearSelectedLists(){this.selectedBusinessModels=[],this.selectedDataSets=[],this.selectedKPICategories=[]},mapCategories(){this.selectedBusinessModels.length>0&&this.selectedBusinessModels.map(e=>{this.selectedRole.roleMetaModelCategories.push({categoryId:e.categoryId})}),this.selectedDataSets.length>0&&this.selectedDataSets.map(e=>{this.selectedRole.roleMetaModelCategories.push({categoryId:e.categoryId})}),this.selectedKPICategories.length>0&&this.selectedKPICategories.map(e=>{this.selectedRole.roleMetaModelCategories.push({categoryId:e.categoryId})})},setSelectedBusinessModels(e){this.selectedBusinessModels=e,this.$emit("touched")},setSelectedDataSets(e){this.selectedDataSets=e,this.$emit("touched")},setSelectedKPICategories(e){this.selectedKPICategories=e,this.$emit("touched")},onFieldChange(e){this.selectedRole[e.fieldName]=e.value,this.$emit("touched")},onRoleTypeChange(e){this.selectedRole[e.roleTypeIDField]=e.ID,this.selectedRole[e.roleTypeCDField]=e.CD,this.$emit("touched")}}});function _e(e,a,l,v,h,f){const c=i("Button"),b=i("Toolbar"),u=i("ProgressBar"),p=i("RoleDetailTab"),s=i("TabPanel"),o=i("RoleAuthorizationsTab"),g=i("DomainCategoryTab"),w=i("TabView");return k(),m(M,null,[t(b,{class:"kn-toolbar kn-toolbar--secondary p-m-0"},{start:n(()=>[C(d(e.selectedRole.name),1)]),end:n(()=>[t(c,{icon:"pi pi-save",class:"p-button-text p-button-rounded p-button-plain",onClick:e.handleSubmit,disabled:e.buttonDisabled},null,8,["onClick","disabled"]),t(c,{icon:"pi pi-times",class:"p-button-text p-button-rounded p-button-plain",onClick:e.closeTemplate},null,8,["onClick"])]),_:1}),e.loading?(k(),z(u,{key:0,mode:"indeterminate",class:"kn-progress-bar"})):R("",!0),t(w,{class:"roles-tabview","data-test":"tab-view"},{default:n(()=>[t(s,null,{header:n(()=>[r("span",null,d(e.$t("managers.rolesManagement.detail.title")),1)]),default:n(()=>[t(p,{selectedRole:e.selectedRole,publicRole:e.publicRole,onFieldChanged:e.onFieldChange,onRoleTypeChanged:e.onRoleTypeChange},null,8,["selectedRole","publicRole","onFieldChanged","onRoleTypeChanged"])]),_:1}),t(s,null,{header:n(()=>[r("span",null,d(e.$t("managers.rolesManagement.authorizations.title")),1)]),default:n(()=>[t(o,{selectedRole:e.selectedRole,authList:e.authorizationList,authCBs:e.authorizationCBs,onAuthChanged:e.onFieldChange},null,8,["selectedRole","authList","authCBs","onAuthChanged"])]),_:1}),t(s,null,{header:n(()=>[r("span",null,d(e.$t("managers.rolesManagement.businessModels")),1)]),default:n(()=>[t(g,{title:e.$t("managers.rolesManagement.businessModels")+" "+e.$t("managers.rolesManagement.categories"),categoryList:e.businessModelList,selected:e.selectedBusinessModels,onChanged:a[0]||(a[0]=y=>e.setSelectedBusinessModels(y))},null,8,["title","categoryList","selected"])]),_:1}),t(s,null,{header:n(()=>[r("span",null,d(e.$t("managers.rolesManagement.dataSets")),1)]),default:n(()=>[t(g,{title:e.$t("managers.rolesManagement.dataSets")+" "+e.$t("managers.rolesManagement.categories"),categoryList:e.dataSetList,selected:e.selectedDataSets,onChanged:a[1]||(a[1]=y=>e.setSelectedDataSets(y))},null,8,["title","categoryList","selected"])]),_:1}),t(s,null,{header:n(()=>[r("span",null,d(e.$t("managers.rolesManagement.kpiCategories")),1)]),default:n(()=>[t(g,{title:e.$t("managers.rolesManagement.kpiCategories"),categoryList:e.kpiCategoriesList,selected:e.selectedKPICategories,onChanged:a[2]||(a[2]=y=>e.setSelectedKPICategories(y))},null,8,["title","categoryList","selected"])]),_:1})]),_:1})],64)}var Be=T(Ie,[["render",_e]]);export{Be as default};
//# sourceMappingURL=RolesManagementTabView-e76cd226.js.map
