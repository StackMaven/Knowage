import{d as y,ad as N,s as I,_ as A,r,y as $,o as d,h as g,w as o,a as i,D as h,f as a,G as S,t as s,z as _,c as m,A as f,p as U,b as L,l as O,n as P,g as x,v as V,u as B,B as R}from"./index-1e676509.js";import{K as F,u as z,c as G}from"./KnValidatonMessages-ebe48c72.js";const K={style:{"margin-bottom":"2em",width:"100%"}},X={header:{style:{display:"flex","flex-direction":"column"}},style:{"max-width":"50px"}},j={insert:{toastTitle:"common.toast.createTitle"},success:"managers.tenantManagement.tenantSaved",update:{toastTitle:"common.toast.updateTitle"}},Q={style:{"margin-bottom":"40px"}};var M={card:K,column:X,operation:j,pField:Q};const Y={tenant:[{fieldName:"MULTITENANT_NAME",validators:[{key:"required"},{key:"regex",validator:{type:"extendedAlphanumericRegex"}}]}]};var C={validations:Y};const H=y({name:"detail-tab",components:{Card:N,KnValidationMessages:F},props:{selectedTenant:{type:Object,required:!1},listOfThemes:Array},computed:{disableField(){return!!this.tenant.MULTITENANT_ID}},emits:["fieldChanged","roleTypeChanged"],data(){return{tabViewDescriptor:M,tenantDetailValidationDescriptor:C,v$:z(),tenant:{},themes:[]}},validations(){return{tenant:G("tenant",C.validations.tenant)}},setup(){return{store:I()}},created(){this.selectedTenant&&Object.keys(this.selectedTenant).length>0?this.tenant={...this.selectedTenant}:(this.tenant={},this.tenant.MULTITENANT_THEME="sbi_default"),this.listOfThemes&&(this.themes=[...this.listOfThemes])},watch:{async selectedTenant(){this.v$.$reset(),this.tenant={...this.selectedTenant},await this.$http.get(`/knowage/restful-services/multitenant/image?TENANT=${this.tenant.MULTITENANT_NAME}`).then(e=>{this.tenant.MULTITENANT_IMAGE=e.data})},listOfThemes(){this.themes=[...this.listOfThemes]}},methods:{onFieldChange(e,t){this.$emit("fieldChanged",{fieldName:e,value:t})},uploadFile(e){const t=new FileReader;t.addEventListener("load",()=>{this.tenant.MULTITENANT_IMAGE=t.result||"",this.onFieldChange("MULTITENANT_IMAGE",this.tenant.MULTITENANT_IMAGE)},!1),e.srcElement.files[0]&&e.srcElement.files[0].size<"200000"?(t.readAsDataURL(e.srcElement.files[0]),this.v$.$touch()):this.store.setError({title:this.$t("common.error.uploading"),msg:this.$t("common.error.exceededSize",{size:"(200KB)"})})}}}),J=e=>(U("data-v-62be0566"),e=e(),L(),e),q={class:"p-fluid p-m-5"},Z={class:"p-float-label"},W={for:"MULTITENANT_NAME",class:"kn-material-input-label"},ee={class:"p-col-3 kn-height-full"},te={for:"organizationImage"},ae=J(()=>i("i",{class:"pi pi-upload"},null,-1)),oe=[ae],re={class:"imageContainer p-d-flex p-jc-center p-ai-center"},ne={key:0,class:"far fa-image fa-5x icon"},ie=["src"];function be(e,t,b,v,u,T){const c=r("InputText"),l=r("KnValidationMessages"),p=r("Card"),k=$("tooltip");return d(),g(p,{style:h(e.tabViewDescriptor.card.style)},{content:o(()=>[i("form",q,[i("div",{class:"p-field",style:h(e.tabViewDescriptor.pField.style)},[i("span",Z,[a(c,{id:"MULTITENANT_NAME",class:S(["kn-material-input",{"p-invalid":e.v$.tenant.MULTITENANT_NAME.$invalid&&e.v$.tenant.MULTITENANT_NAME.$dirty}]),type:"text",disabled:e.disableField,modelValue:e.v$.tenant.MULTITENANT_NAME.$model,"onUpdate:modelValue":t[0]||(t[0]=n=>e.v$.tenant.MULTITENANT_NAME.$model=n),modelModifiers:{trim:!0},maxLength:"20",onBlur:t[1]||(t[1]=n=>e.v$.tenant.MULTITENANT_NAME.$touch()),onInput:t[2]||(t[2]=n=>e.onFieldChange("MULTITENANT_NAME",n.target.value)),"data-test":"name-input"},null,8,["disabled","modelValue","class"]),i("label",W,s(e.$t("common.name"))+" * ",1)]),a(l,{vComp:e.v$.tenant.MULTITENANT_NAME,additionalTranslateParams:{fieldName:e.$t("common.name")}},null,8,["vComp","additionalTranslateParams"])],4),i("div",ee,[i("input",{id:"organizationImage",type:"file",onChange:t[3]||(t[3]=(...n)=>e.uploadFile&&e.uploadFile(...n)),accept:"image/png, image/jpeg"},null,32),_((d(),m("label",te,oe)),[[k,e.$t("common.upload"),void 0,{bottom:!0}]]),i("div",re,[e.tenant.MULTITENANT_IMAGE?f("",!0):(d(),m("i",ne)),e.tenant.MULTITENANT_IMAGE?(d(),m("img",{key:1,src:e.tenant.MULTITENANT_IMAGE,class:"kn-no-select"},null,8,ie)):f("",!0)])])])]),_:1},8,["style"])}var de=A(H,[["render",be],["__scopeId","data-v-62be0566"]]);const le=y({name:"selection-table",components:{Card:N,Column:O,DataTable:P},props:{title:String,dataList:Array,selectedData:Array},emits:["changed"],data(){return{tabViewDescriptor:M,selectedCategories:[]}},watch:{selectedData(){this.selectedCategories=this.selectedData}},created(){this.selectedCategories=this.selectedData},methods:{setDirty(){this.$emit("changed",this.selectedCategories)},onSelectAll(e){this.selectedCategories=e.data,this.$emit("changed",this.selectedCategories)},onUnselectAll(){this.selectedCategories=[],this.$emit("changed",this.selectedCategories)}}});function se(e,t,b,v,u,T){const c=r("Toolbar"),l=r("Column"),p=r("DataTable"),k=r("Card");return d(),g(k,{style:h(e.tabViewDescriptor.card.style)},{header:o(()=>[a(c,{class:"kn-toolbar kn-toolbar--secondary"},{start:o(()=>[x(s(e.title),1)]),_:1})]),content:o(()=>[a(p,{value:e.dataList,selection:e.selectedCategories,"onUpdate:selection":t[0]||(t[0]=n=>e.selectedCategories=n),class:"p-datatable-sm kn-table",dataKey:"ID",responsiveLayout:"stack",breakpoint:"960px",onRowSelect:e.setDirty,onRowUnselect:e.setDirty,onRowSelectAll:e.onSelectAll,onRowUnselectAll:e.onUnselectAll,scrollable:!0,"data-test":"data-table"},{empty:o(()=>[x(s(e.$t("common.info.noDataFound")),1)]),default:o(()=>[a(l,{selectionMode:"multiple",style:h(e.tabViewDescriptor.column.style),dataKey:"ID"},null,8,["style"]),a(l,{field:"LABEL",header:e.$t("common.name")},null,8,["header"]),e.dataList&&e.dataList.length>0&&e.dataList[0].DESCRIPTION?(d(),g(l,{key:0,field:"DESCRIPTION",header:e.$t("common.description")},null,8,["header"])):f("",!0)]),_:1},8,["value","selection","onRowSelect","onRowUnselect","onRowSelectAll","onRowUnselectAll"])]),_:1},8,["style"])}var ce=A(le,[["render",se]]);const pe=y({components:{TabView:V,TabPanel:B,TenantDetail:de,ProductTypes:ce},props:{selectedTenant:{type:Object,required:!1},licenses:Array},emits:["touched","closed","inserted"],data(){return{tabViewDescriptor:M,loading:!1,touched:!1,operation:"insert",v$:z(),tenant:{},listOfThemes:[],availableLicenses:[],listOfProductTypes:[],listOfSelectedProducts:[],listOfDataSources:[],listOfSelectedDataSources:[]}},computed:{buttonDisabled(){return!!(this.listOfSelectedProducts&&this.listOfSelectedProducts.length===0||this.listOfSelectedDataSources&&this.listOfSelectedDataSources.length===0||this.v$.$invalid)}},setup(){return{store:I()}},mounted(){this.selectedTenant&&(this.tenant={...this.selectedTenant}),this.availableLicenses=this.licenses,this.loadAllData(),this.getTenantData()},watch:{selectedTenant(){this.tenant={...this.selectedTenant},this.getTenantData()},licenses(){this.availableLicenses=this.licenses}},methods:{loadData(e){return this.$http.get(`/knowage/restful-services/multitenant${e}`)},async loadAllData(){this.loading=!0,await this.loadData("/themes").then(e=>{this.listOfThemes=e.data.root}),await this.loadData("/datasources").then(e=>{this.listOfDataSources=e.data.root}),await this.loadData("/producttypes").then(e=>{this.listOfProductTypes=e.data.root,this.filterArrayByTargetArr(this.listOfProductTypes,this.availableLicenses)}),this.loading=!1},filterArrayByTargetArr(e,t){var b=e.filter(v=>t.find(u=>v.LABEL==u.product));this.listOfProductTypes=b},async getTenantData(){this.loading=!0,this.listOfSelectedProducts=null,this.listOfSelectedDataSources=null,this.touched=!1,await this.loadData(`/producttypes?TENANT=${this.tenant.MULTITENANT_NAME}`).then(e=>{var t=e.data.root;this.listOfSelectedProducts=[],this.copySelectedElement(t,this.listOfSelectedProducts)}),await this.loadData(`/datasources?TENANT=${this.tenant.MULTITENANT_NAME}`).then(e=>{var t=e.data.root;this.listOfSelectedDataSources=[],this.copySelectedElement(t,this.listOfSelectedDataSources)}),this.loading=!1},copySelectedElement(e,t){for(var b=0;b<e.length;b++)e[b].CHECKED==!0&&t.push(e[b])},async handleSubmit(){if(this.v$.$invalid)return;let e="/knowage/restful-services/multitenant/save";await this.$http.post(e,this.createTenantToSave()).then(t=>{this.selectedTenant?this.store.setInfo({title:this.$t(this.tabViewDescriptor.operation[this.operation].toastTitle),msg:this.$t(this.tabViewDescriptor.operation.success)}):this.store.setInfo({title:this.$t(this.tabViewDescriptor.operation[this.operation].toastTitle),msg:this.$t(this.tabViewDescriptor.operation.success)+t.data.NEW_USER,duration:0}),this.$emit("inserted"),this.$router.replace("/tenants-management")})},createTenantToSave(){let e={};return e.MULTITENANT_ID=this.tenant.MULTITENANT_ID?""+this.tenant.MULTITENANT_ID:"",e.MULTITENANT_NAME=this.tenant.MULTITENANT_NAME,this.tenant.MULTITENANT_THEME&&(e.MULTITENANT_THEME=this.tenant.MULTITENANT_THEME),e.MULTITENANT_IMAGE=this.tenant.MULTITENANT_IMAGE,e.DS_LIST=this.listOfSelectedDataSources.map(t=>(delete t.CHECKED,t)),e.PRODUCT_TYPE_LIST=this.listOfSelectedProducts.map(t=>(delete t.CHECKED,t)),e},closeTemplate(){this.$router.push("/tenants-management"),this.$emit("closed")},onFieldChange(e){this.tenant[e.fieldName]=e.value,this.touched=!0,this.$emit("touched")},setSelectedProducts(e){this.listOfSelectedProducts=e,this.touched=!0,this.$emit("touched")},setSelectedDataSources(e){this.listOfSelectedDataSources=e,this.touched=!0,this.$emit("touched")},closeTemplateConfirm(){this.touched?this.$confirm.require({message:this.$t("common.toast.unsavedChangesMessage"),header:this.$t("common.toast.unsavedChangesHeader"),icon:"pi pi-exclamation-triangle",accept:()=>{this.touched=!1,this.closeTemplate()}}):this.closeTemplate()}}}),ke={class:"card"};function ve(e,t,b,v,u,T){const c=r("Button"),l=r("Toolbar"),p=r("ProgressBar"),k=r("TenantDetail"),n=r("TabPanel"),E=r("ProductTypes"),D=r("TabView");return d(),m(R,null,[a(l,{class:"kn-toolbar kn-toolbar--secondary p-m-0"},{start:o(()=>[x(s(e.tenant.MULTITENANT_NAME),1)]),end:o(()=>[a(c,{icon:"pi pi-save",class:"p-button-text p-button-rounded p-button-plain",onClick:e.handleSubmit,disabled:e.buttonDisabled},null,8,["onClick","disabled"]),a(c,{icon:"pi pi-times",class:"p-button-text p-button-rounded p-button-plain",onClick:e.closeTemplateConfirm},null,8,["onClick"])]),_:1}),e.loading?(d(),g(p,{key:0,mode:"indeterminate",class:"kn-progress-bar"})):f("",!0),i("div",ke,[a(D,{class:"tabview-custom","data-test":"tab-view"},{default:o(()=>[a(n,null,{header:o(()=>[i("span",null,s(e.$t("managers.tenantManagement.detail.title")),1)]),default:o(()=>[a(k,{selectedTenant:e.tenant,listOfThemes:e.listOfThemes,onFieldChanged:e.onFieldChange},null,8,["selectedTenant","listOfThemes","onFieldChanged"])]),_:1}),a(n,null,{header:o(()=>[i("span",null,s(e.$t("managers.tenantManagement.productTypes.title")),1)]),default:o(()=>[a(E,{title:e.$t("managers.tenantManagement.productTypes.title"),dataList:e.listOfProductTypes,selectedData:e.listOfSelectedProducts,onChanged:t[0]||(t[0]=w=>e.setSelectedProducts(w))},null,8,["title","dataList","selectedData"])]),_:1}),a(n,null,{header:o(()=>[i("span",null,s(e.$t("managers.tenantManagement.dataSource.title")),1)]),default:o(()=>[a(E,{title:e.$t("managers.tenantManagement.dataSource.title"),dataList:e.listOfDataSources,selectedData:e.listOfSelectedDataSources,onChanged:t[1]||(t[1]=w=>e.setSelectedDataSources(w))},null,8,["title","dataList","selectedData"])]),_:1})]),_:1})])],64)}var ge=A(pe,[["render",ve],["__scopeId","data-v-1bb5b9e6"]]);export{ge as default};
//# sourceMappingURL=TenantManagementTabView-c8cf252d.js.map
