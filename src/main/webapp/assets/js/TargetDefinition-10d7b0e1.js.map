{"version":3,"file":"TargetDefinition-10d7b0e1.js","sources":["../../../../modules/kpi/targetDefinition/TargetDefinition.vue"],"sourcesContent":["<template>\r\n    <div class=\"kn-page\">\r\n        <div class=\"kn-page-content p-grid p-m-0\">\r\n            <div class=\"kn-list--column p-col-4 p-sm-4 p-md-3 p-p-0\">\r\n                <Toolbar class=\"kn-toolbar kn-toolbar--primary\">\r\n                    <template #start>\r\n                        {{ $t('kpi.targetDefinition.title') }}\r\n                    </template>\r\n                    <template #end>\r\n                        <KnFabButton icon=\"fas fa-plus\" @click=\"showForm(null, false)\" data-test=\"open-form-button\"></KnFabButton>\r\n                    </template>\r\n                </Toolbar>\r\n                <ProgressBar mode=\"indeterminate\" class=\"kn-progress-bar\" v-if=\"loading\" data-test=\"progress-bar\" />\r\n                <Listbox\r\n                    v-if=\"!loading\"\r\n                    class=\"kn-list--column\"\r\n                    :options=\"targetList\"\r\n                    :filter=\"true\"\r\n                    :filterPlaceholder=\"$t('common.search')\"\r\n                    optionLabel=\"name\"\r\n                    filterMatchMode=\"contains\"\r\n                    :filterFields=\"targetDefinitionDecriptor.filterFields\"\r\n                    :emptyFilterMessage=\"$t('common.info.noDataFound')\"\r\n                    @change=\"showForm($event.value, false)\"\r\n                    data-test=\"target-list\"\r\n                >\r\n                    <template #empty>{{ $t('common.info.noDataFound') }}</template>\r\n                    <template #option=\"slotProps\">\r\n                        <div class=\"kn-list-item\" data-test=\"list-item\">\r\n                            <div class=\"kn-list-item-text\">\r\n                                <span>{{ slotProps.option.name }}</span>\r\n                                <span class=\"kn-list-item-text-secondary\">{{ formatDate(slotProps.option.startValidity) }} - {{ formatDate(slotProps.option.endValidity) }}</span>\r\n                            </div>\r\n                            <Button icon=\"far fa-copy\" class=\"p-button-text p-button-rounded p-button-plain\" @click.stop=\"cloneTargetConfirm(slotProps.option)\" data-test=\"clone-button\" />\r\n                            <Button icon=\"far fa-trash-alt\" class=\"p-button-text p-button-rounded p-button-plain\" @click.stop=\"deleteTargetConfirm(slotProps.option.id)\" data-test=\"delete-button\" />\r\n                        </div>\r\n                    </template>\r\n                </Listbox>\r\n            </div>\r\n            <div class=\"p-col-8 p-sm-8 p-md-9 p-p-0 p-m-0 kn-router-view\">\r\n                <router-view @close=\"closeForm\" @touched=\"touched = true\" @saved=\"reloadMetadata\" />\r\n            </div>\r\n        </div>\r\n    </div>\r\n</template>\r\n<script lang=\"ts\">\r\nimport { defineComponent } from 'vue'\r\nimport { iTargetDefinition } from './TargetDefinition'\r\nimport { formatDate } from '@/helpers/commons/localeHelper'\r\nimport targetDefinitionDecriptor from './TargetDefinitionDescriptor.json'\r\nimport KnFabButton from '@/components/UI/KnFabButton.vue'\r\nimport Listbox from 'primevue/listbox'\r\nimport { AxiosResponse } from 'axios'\r\nimport mainStore from '../../../App.store'\r\n\r\nexport default defineComponent({\r\n    name: 'target-definition',\r\n    components: { KnFabButton, Listbox },\r\n    data() {\r\n        return {\r\n            targetList: [] as iTargetDefinition[],\r\n            loading: false,\r\n            touched: false,\r\n            targetDefinitionDecriptor: targetDefinitionDecriptor,\r\n            formatDate: formatDate\r\n        }\r\n    },\r\n    setup() {\r\n        const store = mainStore()\r\n        return { store }\r\n    },\r\n    async created() {\r\n        await this.loadAllMetadata()\r\n    },\r\n    methods: {\r\n        async loadAllMetadata() {\r\n            this.loading = true\r\n            await this.$http\r\n                .get(import.meta.env.VITE_RESTFUL_SERVICES_PATH + '1.0/kpiee/listTarget')\r\n                .then(\r\n                    (response: AxiosResponse<any>) =>\r\n                        (this.targetList = response.data.map((target: any) => {\r\n                            return {\r\n                                id: target.id,\r\n                                name: target.name,\r\n                                startValidity: new Date(target.startValidity),\r\n                                endValidity: new Date(target.endValidity),\r\n                                author: target.author,\r\n                                values: target.values,\r\n                                category: target.category\r\n                            }\r\n                        }))\r\n                )\r\n                .finally(() => (this.loading = false))\r\n        },\r\n        showForm(target: any, clone: Boolean) {\r\n            const path = target ? `/target-definition/edit?id=${target.id}&clone=${clone}` : '/target-definition/new-target-definition'\r\n            if (!this.touched) {\r\n                this.$router.push(path)\r\n            } else {\r\n                this.$confirm.require({\r\n                    message: this.$t('common.toast.unsavedChangesMessage'),\r\n                    header: this.$t('common.toast.unsavedChangesHeader'),\r\n                    icon: 'pi pi-exclamation-triangle',\r\n                    accept: () => {\r\n                        this.touched = false\r\n                        this.$router.push(path)\r\n                    }\r\n                })\r\n            }\r\n        },\r\n        deleteTargetConfirm(targetId: number) {\r\n            this.$confirm.require({\r\n                message: this.$t('common.toast.deleteMessage'),\r\n                header: this.$t('common.toast.deleteTitle'),\r\n                icon: 'pi pi-exclamation-triangle',\r\n                accept: () => this.deleteTarget(targetId)\r\n            })\r\n        },\r\n        async deleteTarget(targetId: number) {\r\n            await this.$http.delete(import.meta.env.VITE_RESTFUL_SERVICES_PATH + '1.0/kpiee/' + targetId + '/deleteTarget').then(() => {\r\n                this.store.setInfo({\r\n                    title: this.$t('common.toast.deleteTitle'),\r\n                    msg: this.$t('common.toast.deleteSuccess')\r\n                })\r\n                this.closeForm()\r\n                this.loadAllMetadata()\r\n            })\r\n        },\r\n        cloneTargetConfirm(target: any) {\r\n            this.$confirm.require({\r\n                header: this.$t('common.toast.cloneConfirmTitle'),\r\n                accept: () => this.showForm(target, true)\r\n            })\r\n        },\r\n        closeForm() {\r\n            if (!this.touched) {\r\n                this.handleClose()\r\n            } else {\r\n                this.$confirm.require({\r\n                    message: this.$t('common.toast.unsavedChangesMessage'),\r\n                    header: this.$t('common.toast.unsavedChangesHeader'),\r\n                    icon: 'pi pi-exclamation-triangle',\r\n                    accept: () => {\r\n                        this.touched = false\r\n                        this.handleClose()\r\n                    }\r\n                })\r\n            }\r\n        },\r\n        handleClose() {\r\n            this.$router.replace('/target-definition')\r\n        },\r\n        reloadMetadata(id) {\r\n            this.$router.replace(`/target-definition/edit?id=${id}&clone=${false}`)\r\n            this.touched = false\r\n            this.loadAllMetadata()\r\n        }\r\n    }\r\n})\r\n</script>\r\n<style lang=\"scss\" scoped>\r\n.kn-list-column {\r\n    border-right: 1px solid #ccc;\r\n}\r\n\r\n.list-header {\r\n    font-weight: bold;\r\n}\r\n</style>\r\n"],"names":["Listbox","mainStore","_openBlock","_createElementBlock","_createElementVNode","_createVNode","_withCtx","_createBlock","_createCommentVNode","_toDisplayString"],"mappings":"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"}