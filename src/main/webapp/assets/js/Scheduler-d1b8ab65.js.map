{"version":3,"file":"Scheduler-d1b8ab65.js","sources":["../../../../modules/managers/scheduler/Scheduler.vue"],"sourcesContent":["<template>\r\n    <div class=\"kn-page\">\r\n        <div class=\"kn-page-content p-grid p-m-0\">\r\n            <div class=\"kn-list--column p-col-4 p-sm-4 p-md-3 p-p-0\">\r\n                <Toolbar class=\"kn-toolbar kn-toolbar--primary\">\r\n                    <template #start>\r\n                        {{ $t('managers.scheduler.title') }}\r\n                    </template>\r\n                    <template #end>\r\n                        <FabButton icon=\"fas fa-plus\" @click=\"showJobDetail(null, false)\" data-test=\"progress-bar\" />\r\n                    </template>\r\n                </Toolbar>\r\n                <ProgressBar v-if=\"loading\" class=\"kn-progress-bar\" mode=\"indeterminate\" />\r\n                <KnListBox :options=\"jobs\" :settings=\"schedulerDescriptor.knListSettings\" @click=\"showJobDetail($event, false)\" @clone.stop=\"showJobDetail($event, true)\" @delete.stop=\"deleteJobConfirm\" />\r\n            </div>\r\n\r\n            <div class=\"p-col-8 p-sm-8 p-md-9 p-p-0 p-m-0 kn-page\">\r\n                <router-view :selectedJob=\"selectedJob\" @closed=\"touched = false\" @documentSaved=\"loadSelectJob\" @close=\"closeDetail\" @triggerSaved=\"loadPage\" />\r\n            </div>\r\n        </div>\r\n    </div>\r\n</template>\r\n\r\n<script lang=\"ts\">\r\nimport { defineComponent } from 'vue'\r\nimport { iPackage } from './Scheduler'\r\nimport { AxiosResponse } from 'axios'\r\nimport FabButton from '@/components/UI/KnFabButton.vue'\r\nimport KnListBox from '@/components/UI/KnListBox/KnListBox.vue'\r\nimport schedulerDescriptor from './SchedulerDescriptor.json'\r\nimport mainStore from '../../../App.store'\r\n\r\nexport default defineComponent({\r\n    name: 'scheduler',\r\n    components: { FabButton, KnListBox },\r\n    data() {\r\n        return {\r\n            schedulerDescriptor,\r\n            jobs: [] as iPackage[],\r\n            selectedJob: null as iPackage | null,\r\n            loading: false\r\n        }\r\n    },\r\n    setup() {\r\n        const store = mainStore()\r\n        return { store }\r\n    },\r\n    async created() {\r\n        await this.loadPage()\r\n    },\r\n    methods: {\r\n        async loadPage() {\r\n            if (this.$route.query.id) {\r\n                await this.loadSelectJob(this.$route.query.id as string)\r\n            } else {\r\n                this.selectedJob = { jobName: '', jobDescription: '', documents: [], triggers: [], edit: false } as any\r\n                await this.loadJobs()\r\n            }\r\n        },\r\n        async loadJobs() {\r\n            this.loading = true\r\n            this.jobs = []\r\n            let tempJobs = [] as iPackage[]\r\n            await this.$http.get(import.meta.env.VITE_RESTFUL_SERVICES_PATH + `scheduleree/listAllJobs/`).then((response: AxiosResponse<any>) => (tempJobs = response.data.root))\r\n            tempJobs.forEach((el: iPackage) => {\r\n                if (el.jobGroup === 'BIObjectExecutions') {\r\n                    this.jobs.push({ ...el, numberOfDocuments: el.documents.length })\r\n                }\r\n            })\r\n            this.loading = false\r\n        },\r\n        showJobDetail(event: any, clone: boolean) {\r\n            this.selectedJob = event && event.item ? { ...event.item, edit: true } : { jobName: '', jobDescription: '', documents: [], triggers: [] }\r\n\r\n            if (clone && this.selectedJob) {\r\n                this.selectedJob.jobName = this.$t('common.copyOf') + ' ' + this.selectedJob.jobName\r\n                this.selectedJob.edit = false\r\n            }\r\n\r\n            const path = event && event.item ? `/scheduler/edit-package-schedule?id=${event.item.jobName}&clone=${clone}` : '/scheduler/new-package-schedule'\r\n            this.$router.push(path)\r\n        },\r\n        async deleteJobConfirm(event: any) {\r\n            this.$confirm.require({\r\n                message: this.$t('common.toast.deleteMessage'),\r\n                header: this.$t('common.toast.deleteTitle'),\r\n                icon: 'pi pi-exclamation-triangle',\r\n                accept: async () => {\r\n                    await this.deleteJob(event.item.jobName)\r\n                }\r\n            })\r\n        },\r\n        async deleteJob(jobName: string) {\r\n            this.loading = true\r\n            let tempResponse = null as any\r\n            await this.$http\r\n                .post(import.meta.env.VITE_RESTFUL_SERVICES_PATH + `scheduleree/deleteJob?jobGroup=BIObjectExecutions&jobName=${jobName}`)\r\n                .then((response: AxiosResponse<any>) => {\r\n                    this.store.setInfo({\r\n                        title: this.$t('common.toast.deleteTitle'),\r\n                        msg: this.$t('common.toast.deleteSuccess')\r\n                    })\r\n                    tempResponse = response.data\r\n                })\r\n                .catch((error) => {\r\n                    this.store.setError({\r\n                        title: this.$t('common.toast.deleteTitle'),\r\n                        msg: error?.message\r\n                    })\r\n                })\r\n\r\n            if (tempResponse?.resp === 'ok') {\r\n                await this.loadJobs()\r\n                this.selectedJob = null\r\n                this.$router.push('/scheduler')\r\n            }\r\n            this.loading = false\r\n        },\r\n        async loadSelectJob(name: string) {\r\n            await this.loadJobs()\r\n\r\n            this.selectedJob = this.jobs.find((el: iPackage) => {\r\n                return el.jobName === name\r\n            }) as iPackage\r\n\r\n            if (this.selectedJob) {\r\n                this.selectedJob.edit = true\r\n            }\r\n        },\r\n        closeDetail() {\r\n            this.selectedJob = null\r\n        }\r\n    }\r\n})\r\n</script>\r\n"],"names":["FabButton","mainStore","_openBlock","_createElementBlock","_createElementVNode","_createVNode","_withCtx","_createBlock","_createCommentVNode","_withModifiers"],"mappings":"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"}