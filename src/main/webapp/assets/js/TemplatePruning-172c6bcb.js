import{_ as A,d as C,ad as D,aj as E,s as z,r as c,o as b,c as m,a as n,f as d,w as l,g as k,t as p,h as f,A as v,G as _}from"./index-1e676509.js";import{s as I}from"./calendar.esm-60a451ba.js";import{s as $}from"./tree.esm-837306a6.js";const S=C({name:"template-pruning",components:{Calendar:I,Card:D,ProgressSpinner:E,Tree:$},data(){return{selectedDate:new Date,folderStructure:[],documents:[],nodes:[],selectedDocuments:{},documentSelectionVisible:!1,loading:!1}},computed:{maxDate(){return new Date},filterDisabled(){return!this.selectedDate},documentSelectionMessage(){return this.documents.length!=0?this.$t("managers.templatePruning.documentSelectionMessage"):this.$t("managers.templatePruning.noDocuments")},documentsAvailable(){return this.documents.length>0},deleteDisabled(){return Object.keys(this.selectedDocuments).length===0}},setup(){return{store:z()}},methods:{formatDate(a){return a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate()},async loadDocumentSelection(){this.loading=!0,this.selectedDocuments={},await this.loadDocuments(this.selectedDate),await this.loadFolderStructure(),this.createNodeTree(),this.removeEmptyFolders(),this.documentSelectionVisible=!0,this.loading=!1},async loadFolderStructure(){await this.$http.get("/knowage/restful-services/2.0/folders?includeDocs=true").then(a=>this.folderStructure=a.data)},async loadDocuments(a){await this.$http.get(`/knowage/restful-services/2.0/documents?date=${this.formatDate(a)}`).then(e=>this.documents=e.data)},createNodeTree(){this.nodes=[];const a=[];this.folderStructure.forEach(e=>{const t={key:e.name,icon:"pi pi-folder",id:e.id,parentId:e.parentId,label:e.name,children:[],data:{name:e.name}};t.children=a.filter(o=>t.id===o.parentId),this.attachDocumentsToNode(e,t),this.attachFolderToTree(t,a)})},attachDocumentsToNode(a,e){a.biObjects.forEach(t=>{var i;this.documents.findIndex(r=>r.id===t.id)>=0&&((i=e.children)==null||i.push({key:t.id,icon:"pi pi-file",id:t.id,label:t.name,data:t.name}))})},attachFolderToTree(a,e){var t,o;if(a.parentId){let i=null;for(let r=0;r<e.length;r++)if(a.parentId===e[r].id){(t=e[r].children)==null||t.push(a);break}for(let r=0;r<this.nodes.length;r++)if(i=this.findParentFolder(a,this.nodes[r]),i){(o=i.children)==null||o.push(a);break}i||e.push(a)}else this.nodes.push(a)},findParentFolder(a,e){if(a.parentId===e.id)return e;{let t=null;if(e.children)for(let o=0;o<e.children.length&&(t=this.findParentFolder(a,e.children[o]),!t);o++);return t}},filterDocuments(a,e){var t;if(a.children&&a.children.length>0)for(let o=a.children.length-1;o>=0;o--)this.filterDocuments(a.children[o],a);if(((t=a.children)==null?void 0:t.length)==0&&e&&e.children){const o=e.children,i=o.findIndex(r=>r.id===a.id);o.splice(i,1)}},removeEmptyFolders(){var a;for(let e=0;e<this.nodes.length;e++)this.filterDocuments(this.nodes[e],null),((a=this.nodes[e].children)==null?void 0:a.length)===0&&(this.nodes[e].selectable=!1)},setOpenFolderIcon(a){a.icon="pi pi-folder-open"},setClosedFolderIcon(a){a.icon="pi pi-folder"},deleteConfirm(){this.$confirm.require({message:this.$t("common.toast.deleteMessage"),header:this.$t("common.toast.deleteTitle"),icon:"pi pi-exclamation-triangle",accept:()=>this.deleteDocuments()})},async deleteDocuments(){const a=[];this.selectedDocuments&&Object.keys(this.selectedDocuments).forEach(e=>{isNaN(e)||a.push({id:+e,data:this.formatDate(this.selectedDate)})}),await this.$http.post("/knowage/restful-services/template/deleteTemplate",a).then(()=>{this.store.setInfo({title:this.$t("common.toast.deleteTitle"),msg:this.$t("common.toast.deleteSuccess")}),this.selectedDocuments={},this.loadDocumentSelection()})}}}),N={class:"kn-page"},T={class:"kn-page-content p-m-0"},F={key:1,id:"spinner"},P={id:"cards-container",class:"kn-page-contentp-grid p-m-0"},B={class:"p-col-12"},U={class:"p-d-flex"},V={class:"kn-flex"},j={class:"kn-flex"},O={class:"p-d-flex"},X={class:"p-float-label"},Q={for:"expirationDate",class:"kn-material-input-label"},K={key:0,class:"p-col-12"},Y={class:"p-d-flex p-flex-column"},J={class:"kn-flex"},R={class:"kn-flex p-mt-3"};function G(a,e,t,o,i,r){const u=c("Toolbar"),x=c("ProgressBar"),w=c("ProgressSpinner"),y=c("Calendar"),g=c("Button"),h=c("Card"),M=c("Tree");return b(),m("div",N,[n("div",T,[d(u,{class:"kn-toolbar kn-toolbar--primary"},{start:l(()=>[k(p(a.$t("managers.templatePruning.title")),1)]),_:1}),a.loading?(b(),f(x,{key:0,mode:"indeterminate",class:"kn-progress-bar"})):v("",!0),a.loading?(b(),m("div",F,[d(w)])):v("",!0),n("div",P,[n("div",B,[d(h,null,{header:l(()=>[d(u,{class:"kn-toolbar kn-toolbar--secondary"},{start:l(()=>[k(p(a.$t("managers.templatePruning.referenceDate")),1)]),_:1})]),content:l(()=>[n("div",U,[n("div",V,p(a.$t("managers.templatePruning.enterDateMessage")),1),n("div",j,[n("div",O,[n("span",X,[d(y,{id:"expirationDate",class:_(["kn-material-input",{"p-invalid":!a.selectedDate}]),modelValue:a.selectedDate,"onUpdate:modelValue":e[0]||(e[0]=s=>a.selectedDate=s),showIcon:!0,maxDate:a.maxDate,manualInput:!1,"data-test":"date-input"},null,8,["modelValue","class","maxDate"]),n("label",Q,p(a.$t("managers.templatePruning.selectDate"))+" * ",1)]),d(g,{icon:"pi pi-filter",class:"p-button-text p-button-rounded p-button-plain",disabled:a.filterDisabled,onClick:a.loadDocumentSelection,"aria-label":"Filter","data-test":"filter-button"},null,8,["disabled","onClick"])])])])]),_:1})]),a.documentSelectionVisible?(b(),m("div",K,[d(h,{"data-test":"document-selection-card"},{header:l(()=>[d(u,{class:"kn-toolbar kn-toolbar--secondary"},{start:l(()=>[k(p(a.$t("managers.templatePruning.documentSelection")),1)]),_:1})]),content:l(()=>[n("div",Y,[n("div",J,[n("p",null,p(a.documentSelectionMessage),1),a.documentsAvailable?(b(),f(g,{key:0,class:"kn-button kn-button--primary",disabled:a.deleteDisabled,onClick:a.deleteConfirm,"aria-label":"Delete Templates","data-test":"delete-button"},{default:l(()=>[k(p(a.$t("common.delete")),1)]),_:1},8,["disabled","onClick"])):v("",!0)]),n("div",R,[d(M,{id:"document-tree",value:a.nodes,selectionMode:"checkbox",selectionKeys:a.selectedDocuments,"onUpdate:selectionKeys":e[1]||(e[1]=s=>a.selectedDocuments=s),filter:!0,filterMode:"lenient",onNodeExpand:e[2]||(e[2]=s=>a.setOpenFolderIcon(s)),onNodeCollapse:e[3]||(e[3]=s=>a.setClosedFolderIcon(s)),"data-test":"document-tree"},null,8,["value","selectionKeys"])])])]),_:1})])):v("",!0)])])])}var H=A(S,[["render",G],["__scopeId","data-v-5ae974a8"]]);export{H as default};
//# sourceMappingURL=TemplatePruning-172c6bcb.js.map
