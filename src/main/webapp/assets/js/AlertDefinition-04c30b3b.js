import{_ as v,d as C,X as _,a4 as A,s as w,r as a,o as n,c as y,a as s,f as i,w as l,g as h,t as r,h as d,A as c,V as u}from"./index-1e676509.js";import{a as F}from"./AlertDefinitionDescriptor-4ed1dbf8.js";const B=C({name:"alert",components:{KnFabButton:_,Listbox:A},data(){return{alertDescriptor:F,alertList:[],loading:!1,touched:!1}},setup(){return{store:w()}},created(){this.loadAllAlerts()},methods:{async loadAllAlerts(){this.loading=!0,await this.$http.get("/knowage/restful-services/1.0/alert/listAlert").then(t=>this.alertList=t.data.map(e=>({id:e.id,name:e.name,status:e.jobStatus}))).finally(()=>this.loading=!1)},showForm(t){const e=t.value?`/alert/${t.value.id}`:"/alert/new-alert";this.$router.push(e)},deleteAlertConfirm(t){this.$confirm.require({message:this.$t("common.toast.deleteMessage"),header:this.$t("common.toast.deleteTitle"),icon:"pi pi-exclamation-triangle",accept:()=>this.deleteAlert(t)})},async deleteAlert(t){await this.$http.delete("/knowage/restful-services/1.0/alert/"+t+"/delete").then(()=>{this.store.setInfo({title:this.$t("common.toast.deleteTitle"),msg:this.$t("common.toast.deleteSuccess")}),this.$router.push("/alert"),this.loadAllAlerts()})},async handleStatus(t){if(t.status!=="EXPIRED"){var e="scheduler/"+(t.status=="SUSPENDED"?"resumeTrigger":"pauseTrigger")+"?jobGroup=ALERT_JOB_GROUP&triggerGroup=ALERT_JOB_GROUP&jobName="+t.id+"&triggerName="+t.id;await this.$http.post("/knowage/restful-services/"+e),this.loadAllAlerts()}},closeForm(){this.touched?this.$confirm.require({message:this.$t("common.toast.unsavedChangesMessage"),header:this.$t("common.toast.unsavedChangesHeader"),icon:"pi pi-exclamation-triangle",accept:()=>{this.touched=!1,this.handleClose()}}):this.handleClose()},handleClose(){this.$router.replace("/alert")},reloadAlert(t){this.$router.replace(`/alert/${t}`),this.touched=!1,this.loadAllAlerts()}}}),S={class:"kn-page"},D={class:"kn-page-content p-grid p-m-0"},T={class:"kn-list--column p-col-4 p-sm-4 p-md-3 p-p-0"},E={class:"kn-list-item","data-test":"list-item"},L={class:"kn-list-item-text"},N={class:"kn-list-item-text-secondary"},M={class:"p-col-8 p-sm-8 p-md-9 p-p-0 p-m-0 kn-router-view"};function V(t,e,R,G,O,U){const g=a("KnFabButton"),f=a("Toolbar"),$=a("ProgressBar"),p=a("Button"),k=a("Listbox"),b=a("router-view");return n(),y("div",S,[s("div",D,[s("div",T,[i(f,{class:"kn-toolbar kn-toolbar--primary"},{start:l(()=>[h(r(t.$t("kpi.alert.title")),1)]),end:l(()=>[i(g,{icon:"fas fa-plus",onClick:t.showForm,"data-test":"open-form-button"},null,8,["onClick"])]),_:1}),t.loading?(n(),d($,{key:0,mode:"indeterminate",class:"kn-progress-bar","data-test":"progress-bar"})):c("",!0),t.loading?c("",!0):(n(),d(k,{key:1,class:"kn-list--column",options:t.alertList,filter:!0,filterPlaceholder:t.$t("common.search"),optionLabel:"name",filterMatchMode:"contains",filterFields:t.alertDescriptor.filterFields,emptyFilterMessage:t.$t("common.info.noDataFound"),onChange:t.showForm,"data-test":"target-list"},{empty:l(()=>[h(r(t.$t("common.info.noDataFound")),1)]),option:l(o=>[s("div",E,[s("div",L,[s("span",null,r(o.option.name),1),s("span",N,r(o.option.status),1)]),i(p,{icon:"pi pi-trash",class:"p-button-text p-button-rounded p-button-plain",onClick:u(m=>t.deleteAlertConfirm(o.option.id),["stop"]),"data-test":"delete-button"},null,8,["onClick"]),o.option.status=="SUSPENDED"?(n(),d(p,{key:0,icon:"pi pi-play",class:"p-button-text p-button-rounded p-button-plain",onClick:u(m=>t.handleStatus(o.option),["stop"]),"data-test":"resume-button"},null,8,["onClick"])):c("",!0),o.option.status=="ACTIVE"?(n(),d(p,{key:1,icon:"pi pi-pause",class:"p-button-text p-button-rounded p-button-plain",onClick:u(m=>t.handleStatus(o.option),["stop"]),"data-test":"suspend-button"},null,8,["onClick"])):c("",!0)])]),_:1},8,["options","filterPlaceholder","filterFields","emptyFilterMessage","onChange"]))]),s("div",M,[i(b,{onClose:t.closeForm,onTouched:e[0]||(e[0]=o=>t.touched=!0),onSaved:t.reloadAlert},null,8,["onClose","onSaved"])])])])}var K=v(B,[["render",V]]);export{K as default};
//# sourceMappingURL=AlertDefinition-04c30b3b.js.map
