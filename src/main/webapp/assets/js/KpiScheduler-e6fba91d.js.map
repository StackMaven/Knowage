{"version":3,"file":"KpiScheduler-e6fba91d.js","sources":["../../../../modules/kpi/kpiScheduler/KpiScheduler.vue"],"sourcesContent":["<template>\r\n    <div class=\"kn-page\">\r\n        <div class=\"kn-page-content p-grid p-m-0\">\r\n            <div class=\"kn-list--column p-col-4 p-sm-4 p-md-3 p-p-0\">\r\n                <Toolbar class=\"kn-toolbar kn-toolbar--primary\">\r\n                    <template #start>\r\n                        {{ $t('kpi.kpiScheduler.title') }}\r\n                    </template>\r\n                    <template #end>\r\n                        <FabButton icon=\"fas fa-plus\" @click=\"showForm\" data-test=\"new-button\" />\r\n                    </template>\r\n                </Toolbar>\r\n                <ProgressBar mode=\"indeterminate\" class=\"kn-progress-bar\" v-if=\"loading\" data-test=\"progress-bar\" />\r\n                <Listbox\r\n                    v-if=\"!loading\"\r\n                    class=\"kn-list\"\r\n                    :options=\"schedulerList\"\r\n                    :listStyle=\"kpiSchedulerDescriptor.listBox.style\"\r\n                    :filter=\"true\"\r\n                    :filterPlaceholder=\"$t('common.search')\"\r\n                    filterMatchMode=\"contains\"\r\n                    :filterFields=\"kpiSchedulerDescriptor.filterFields\"\r\n                    :emptyFilterMessage=\"$t('common.info.noDataFound')\"\r\n                    @change=\"showForm($event.value)\"\r\n                    data-test=\"scheduler-list\"\r\n                >\r\n                    <template #empty>{{ $t('common.info.noDataFound') }}</template>\r\n                    <template #option=\"slotProps\">\r\n                        <div class=\"kn-list-item\" :class=\"getBordersClass(slotProps.option.jobStatus)\" data-test=\"list-item\">\r\n                            <div class=\"kn-list-item-text\">\r\n                                <div>\r\n                                    <span>{{ slotProps.option.name }}</span>\r\n                                </div>\r\n                                <div class=\"p-d-flex p-flex-row kn-truncated\">\r\n                                    <Chip class=\"p-m-1\" v-tooltip.top=\"slotProps.option.kpiNames\" v-for=\"(kpiName, index) in slotProps.option.kpiNames.split(',')\" :key=\"index\" :label=\"kpiName\"></Chip>\r\n                                </div>\r\n                            </div>\r\n                            <i v-if=\"slotProps.option.jobStatus.toUpperCase() !== 'EXPIRED'\" :class=\"playIcon(slotProps.option.jobStatus)\" @click=\"startSchedule(slotProps.option)\" />\r\n                            <Button class=\"p-button-link p-button-sm\" icon=\"fa fa-ellipsis-v\" @click=\"toggle($event, slotProps.option)\" aria-haspopup=\"true\" aria-controls=\"overlay_menu\" data-test=\"menu-button\" />\r\n                            <Menu ref=\"menu\" :model=\"items\" :popup=\"true\" data-test=\"menu\"></Menu>\r\n                        </div>\r\n                    </template>\r\n                </Listbox>\r\n            </div>\r\n\r\n            <div class=\"p-col-8 p-sm-8 p-md-9 p-p-0 p-m-0\">\r\n                <router-view @touched=\"touched = true\" @closed=\"touched = false\" @inserted=\"loadPage\" />\r\n            </div>\r\n        </div>\r\n    </div>\r\n</template>\r\n\r\n<script lang=\"ts\">\r\nimport { defineComponent } from 'vue'\r\nimport { iKpiSchedule } from './KpiScheduler'\r\nimport { AxiosResponse } from 'axios'\r\nimport Chip from 'primevue/chip'\r\nimport kpiSchedulerDescriptor from './KpiSchedulerDescriptor.json'\r\nimport FabButton from '@/components/UI/KnFabButton.vue'\r\nimport Listbox from 'primevue/listbox'\r\nimport Menu from 'primevue/menu'\r\nimport mainStore from '../../../App.store'\r\n\r\nexport default defineComponent({\r\n    name: 'kpi-scheduler',\r\n    components: { Chip, FabButton, Listbox, Menu },\r\n    data() {\r\n        return {\r\n            kpiSchedulerDescriptor,\r\n            schedulerList: [] as iKpiSchedule[],\r\n            items: [] as { label: String; icon: string; command: Function }[],\r\n            loading: false,\r\n            touched: false\r\n        }\r\n    },\r\n    setup() {\r\n        const store = mainStore()\r\n        return { store }\r\n    },\r\n    async created() {\r\n        await this.loadPage()\r\n    },\r\n    methods: {\r\n        async loadAllSchedules() {\r\n            this.loading = true\r\n            await this.$http\r\n                .get(import.meta.env.VITE_RESTFUL_SERVICES_PATH + '1.0/kpi/listSchedulerKPI')\r\n                .then((response: AxiosResponse<any>) => {\r\n                    this.schedulerList = response.data\r\n                    this.schedulerList.sort((a: iKpiSchedule, b: iKpiSchedule) => (a.name.toUpperCase() > b.name.toUpperCase() ? 1 : -1))\r\n                })\r\n                .finally(() => (this.loading = false))\r\n        },\r\n        async loadPage() {\r\n            this.loading = true\r\n            await this.loadAllSchedules()\r\n            this.touched = false\r\n            this.loading = false\r\n        },\r\n        toggle(event: any, scheduler: iKpiSchedule) {\r\n            this.createMenuItems(scheduler)\r\n            const menu = this.$refs.menu as any\r\n            menu.toggle(event)\r\n        },\r\n        createMenuItems(scheduler: iKpiSchedule) {\r\n            this.items = []\r\n            this.items.push({ label: this.$t('common.clone'), icon: 'pi pi-copy', command: () => this.cloneSchedulerConfirm(scheduler) })\r\n            this.items.push({ label: this.$t('common.delete'), icon: 'far fa-trash-alt', command: () => this.deleteScheduleConfirm(scheduler.id as number) })\r\n        },\r\n        playIcon(jobStatus: string) {\r\n            return jobStatus.toUpperCase() === 'SUSPENDED' ? 'fa fa-play' : 'fa fa-pause'\r\n        },\r\n        cloneSchedulerConfirm(scheduler: iKpiSchedule) {\r\n            this.$confirm.require({\r\n                header: this.$t('common.toast.cloneConfirmTitle'),\r\n                accept: () => this.showForm(scheduler, true)\r\n            })\r\n        },\r\n        showForm(event: any, clone: boolean) {\r\n            clone = clone ? true : false\r\n\r\n            const path = event.id ? `/kpi-scheduler/edit-kpi-schedule?id=${event.id}&clone=${clone}` : '/kpi-scheduler/new-kpi-schedule'\r\n            if (!this.touched) {\r\n                this.$router.push(path)\r\n            } else {\r\n                this.$confirm.require({\r\n                    message: this.$t('common.toast.unsavedChangesMessage'),\r\n                    header: this.$t('common.toast.unsavedChangesHeader'),\r\n                    icon: 'pi pi-exclamation-triangle',\r\n                    accept: () => {\r\n                        this.touched = false\r\n                        this.$router.push(path)\r\n                    }\r\n                })\r\n            }\r\n        },\r\n        startSchedule(schedule: iKpiSchedule) {\r\n            if (schedule.jobStatus?.toUpperCase() === 'EXPIRED') {\r\n                return\r\n            }\r\n            const query = '?jobGroup=KPI_SCHEDULER_GROUP&triggerGroup=KPI_SCHEDULER_GROUP&jobName=' + schedule.id + '&triggerName=' + schedule.id\r\n            const action = schedule.jobStatus?.toUpperCase() === 'SUSPENDED' ? 'resumeTrigger' : 'pauseTrigger'\r\n            this.$http.post(import.meta.env.VITE_RESTFUL_SERVICES_PATH + 'scheduler/' + action + query).then((response: AxiosResponse<any>) => {\r\n                if (response.data.resp === 'ok') {\r\n                    schedule.jobStatus = schedule.jobStatus === 'SUSPENDED' ? 'ACTIVE' : 'SUSPENDED'\r\n                }\r\n            })\r\n        },\r\n        deleteScheduleConfirm(scheduleId: number) {\r\n            this.$confirm.require({\r\n                message: this.$t('common.toast.deleteMessage'),\r\n                header: this.$t('common.toast.deleteTitle'),\r\n                icon: 'pi pi-exclamation-triangle',\r\n                accept: () => this.deleteSchedule(scheduleId)\r\n            })\r\n        },\r\n        async deleteSchedule(scheduleId: number) {\r\n            await this.$http.delete(import.meta.env.VITE_RESTFUL_SERVICES_PATH + `1.0/kpi/${scheduleId}/deleteKpiScheduler`).then(() => {\r\n                this.store.setInfo({\r\n                    title: this.$t('common.toast.deleteTitle'),\r\n                    msg: this.$t('common.toast.deleteSuccess')\r\n                })\r\n                this.$router.push('/kpi-scheduler')\r\n                this.loadPage()\r\n            })\r\n        },\r\n        getBordersClass(jobStatus: string) {\r\n            switch (jobStatus) {\r\n                case 'SUSPENDED':\r\n                    return 'kn-list-item-warning'\r\n                case 'ACTIVE':\r\n                    return 'kn-list-item-success'\r\n                case 'EXPIRED':\r\n                    return 'kn-list-item-error'\r\n            }\r\n        }\r\n    }\r\n})\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n::v-deep(.p-chip-text) {\r\n    font-size: 0.5rem;\r\n}\r\n</style>\r\n"],"names":["Chip","FabButton","Listbox","Menu","mainStore","_openBlock","_createElementBlock","_createElementVNode","_createVNode","_withCtx","_createBlock","_createCommentVNode","_toDisplayString","_Fragment","_renderList","_withDirectives","_normalizeClass"],"mappings":"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"}