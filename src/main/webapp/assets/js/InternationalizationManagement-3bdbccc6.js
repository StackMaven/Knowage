import{f as V}from"./filterHelper-a723991a.js";import{_ as I,d as U,v as B,u as O,l as N,n as _,M as X,s as Q,r as d,y as j,o as n,c as u,h as c,A as k,f as g,w as s,B as E,C as A,g as z,t as h,a as m,D as H,G as L,z as x}from"./index-1e676509.js";import{s as q}from"./checkbox.esm-fa6c8259.js";const J=[{field:"label",header:"common.label"},{field:"message",header:"managers.internationalizationManagement.table.messageCode"}],R={label:"",language:"",message:""},Y={buttonsHeaderStyle:"width:200px",dirtyHeaderStyle:"width: 2%",searchBoxStyle:"width: 20%"},G=[{disabled:!0,field:"label",header:"common.label"},{disabled:!0,field:"defaultMessageCode",header:"managers.internationalizationManagement.table.defaultMessage"},{field:"message",header:"managers.internationalizationManagement.table.messageCode"}];var M={defaultLanguageColumns:J,defaultMessage:R,headerStyles:Y,notDefaultLanguageColumns:G};const K=U({name:"internationalization-management",components:{TabView:B,TabPanel:O,Column:N,DataTable:_,Checkbox:q,Button:X},computed:{columns(){return this.selectedLanguage.defaultLanguage?M.defaultLanguageColumns:M.notDefaultLanguageColumns}},data(){return{loading:!1,intDescriptor:M,languages:[],defaultLanguage:{},selectedLanguage:{},messages:[],allMessages:[],defaultLangMessages:[],showOnlyEmptyFields:!1,initialShowEmptyFields:!1,dirty:!1,activeTab:0,previousActiveTab:-1,filters:{global:[V]}}},setup(){return{store:Q()}},async created(){await this.getLanguages(),this.setDefaultLanguage(),this.getMessages(this.defaultLanguage)},methods:{filterEmptyMessages(){this.messages=this.showOnlyEmptyFields?[...this.allMessages.filter(e=>!e.message)]:[...this.allMessages]},atFieldChange(e){e.data.dirty=!0,this.dirty=!0},setDefaultLanguage(){let e;for(var t in this.languages)this.languages[t].defaultLanguage&&(e=t,this.defaultLanguage=this.languages[t]);this.languages.unshift(this.languages.splice(e,1)[0]),this.selectLanguage(0)},addEmptyLabel(){var e={language:"",label:"",message:""};this.messages.unshift(e)},selectLanguage(e){var t=this.languages[e];this.selectedLanguage=this.languages[e],this.getMessages(t)},async switchTabConfirm(e){this.dirty?this.$confirm.require({message:this.$t("common.toast.unsavedChangesMessage"),header:this.$t("common.toast.unsavedChangesHeader"),icon:"pi pi-exclamation-triangle",accept:()=>{this.switchTab(e),this.dirty=!1},reject:()=>{this.activeTab=this.previousActiveTab}}):(this.switchTab(e),this.previousActiveTab=this.activeTab)},switchTab(e){this.initialShowEmptyFields=this.showOnlyEmptyFields.valueOf(),this.showOnlyEmptyFields=!1,this.activeTab=e,this.selectLanguage(e)},initCheck(){this.initialShowEmptyFields&&(this.showOnlyEmptyFields=!0,this.filterEmptyMessages())},async setDataForDefaultLanguage(e){e.data.length==0?this.addEmptyLabel():(await this.setDefaultLanguageValues(e),this.initCheck())},async setDefaultLanguageValues(e){this.defaultLangMessages=e.data,this.messages=e.data},async setEmptyDatatableData(e){this.defaultLangMessages.forEach(t=>{var o={};o.language=e.languageTag,o.label=t.label,o.defaultMessageCode=t.message,o.message="",this.messages.push(o)})},async checkForMessages(e,t){e.data.length!=0?await this.setFilledDatatableData(e,t):await this.setEmptyDatatableData(t),this.initCheck()},async setFilledDatatableData(e,t){this.defaultLangMessages.forEach(o=>{var r=e.data.find(p=>p.label==o.label);if(r)r.defaultMessageCode=o.message,this.messages.push(r);else{var b={language:t.languageTag,label:o.label,defaultMessageCode:o.message,message:""};this.messages.push(b)}})},getMessages(e){return this.messages=[],this.loading=!0,this.$http.get("/knowage/restful-services/2.0/i18nMessages/internationalization/?currLanguage="+e.languageTag).then(t=>{e.defaultLanguage?this.setDataForDefaultLanguage(t):this.checkForMessages(t,e),this.allMessages=[...this.messages]}).finally(()=>this.loading=!1)},async getLanguages(){return this.loading=!0,this.$http.get("/knowage/restful-services/2.0/internationalization/languages").then(e=>{this.languages=e.data.wrappedObject}).finally(()=>this.loading=!1)},saveOrUpdateMessage(e,t,o){return t.id?(delete t.defaultMessageCode,this.$http.put(e,t)):(t.defaultMessageCode&&delete t.defaultMessageCode,t.language=o.languageTag,this.$http.post(e,t))},saveLabel(e,t){let o="/knowage/restful-services/2.0/i18nMessages";var r={...t};delete r.dirty,this.saveOrUpdateMessage(o,r,e).then(b=>{b.data.errors?this.store.setError({msg:b.data.errors}):this.store.setInfo({msg:this.$t("common.toast.updateSuccess")}),this.getMessages(e)}),this.initialShowEmptyFields=!1,this.showOnlyEmptyFields=!1,this.dirty=!1},deleteLabelConfirm(e,t,o){let r=t.data,b=t.index;if(r.id){let p="";r.defaultMessageCode?(p="/knowage/restful-services/2.0/i18nMessages/",this.$confirm.require({message:this.$t("managers.internationalizationManagement.delete.deleteMessage"),header:this.$t("managers.internationalizationManagement.delete.deleteMessageTitle"),icon:"pi pi-exclamation-triangle",accept:()=>this.deleteLabel(p,r.id,e)})):(p="/knowage/restful-services/2.0/i18nMessages/deletedefault/",this.$confirm.require({message:this.$t("managers.internationalizationManagement.delete.deleteDefault"),header:this.$t("managers.internationalizationManagement.delete.deleteDefaultTitle"),icon:"pi pi-exclamation-triangle",accept:()=>this.deleteLabel(p,r.id,e)}))}else o?this.messages.splice(b,1):this.store.setError({title:this.$t("managers.internationalizationManagement.delete.deleteDefaultTitle"),msg:this.$t("managers.internationalizationManagement.delete.cantDelete")})},async deleteLabel(e,t,o){await this.$http.delete(e+t).then(r=>{r.data.errors?this.store.setError({title:"Error",msg:r.data.errors}):(this.store.setInfo({title:this.$t("common.toast.deleteTitle"),msg:this.$t("common.toast.deleteSuccess")}),this.getMessages(o))}),this.initialShowEmptyFields=!1,this.showOnlyEmptyFields=!1}}}),Z={class:"kn-page"},W={key:0},P={class:"table-header p-d-flex"},ee=m("i",{class:"pi pi-search"},null,-1),te={class:"p-field-checkbox p-mt-4"},ae={for:"findEmptyFields"},oe={key:0,class:"pi pi-flag"},re={class:"p-d-flex p-jc-center p-ai-center"};function ne(e,t,o,r,b,p){const D=d("ProgressBar"),v=d("InputText"),$=d("Checkbox"),w=d("Column"),f=d("Button"),T=d("DataTable"),F=d("TabPanel"),S=d("TabView"),y=j("tooltip");return n(),u("div",Z,[e.loading?(n(),c(D,{key:0,mode:"indeterminate",class:"kn-progress-bar","data-test":"progress-bar"})):k("",!0),g(S,{onTabClick:t[3]||(t[3]=i=>e.switchTabConfirm(i.index)),activeIndex:e.activeTab,"onUpdate:activeIndex":t[4]||(t[4]=i=>e.activeTab=i),lazy:"","data-test":"tab-view",class:"internationalization-management kn-tab kn-page-content"},{default:s(()=>[(n(!0),u(E,null,A(e.languages,i=>(n(),c(F,{key:i},{header:s(()=>[z(h(i.language)+" ",1),i.defaultLanguage?(n(),u("span",W,h(e.$t("managers.internationalizationManagement.defaultLanguage")),1)):k("",!0)]),default:s(()=>[e.loading?k("",!0):(n(),c(T,{key:0,editMode:"cell",value:e.messages,loading:e.loading,class:"p-datatable kn-table",dataKey:"id",responsiveLayout:"stack",breakpoint:"960px",filters:e.filters,"onUpdate:filters":t[2]||(t[2]=a=>e.filters=a),"data-test":"messages-table"},{header:s(()=>[m("div",P,[m("span",{class:"p-input-icon-left p-mr-3",style:H(e.intDescriptor.headerStyles.searchBoxStyle)},[ee,g(v,{class:"kn-material-input",modelValue:e.filters.global.value,"onUpdate:modelValue":t[0]||(t[0]=a=>e.filters.global.value=a),type:"text",placeholder:e.$t("common.search"),"data-test":"filterInput"},null,8,["modelValue","placeholder"])],4),m("div",te,[g($,{id:"findEmptyFields",binary:!0,modelValue:e.showOnlyEmptyFields,"onUpdate:modelValue":t[1]||(t[1]=a=>e.showOnlyEmptyFields=a),onChange:e.filterEmptyMessages,"data-test":"checkbox"},null,8,["modelValue","onChange"]),m("label",ae,h(e.$t("managers.internationalizationManagement.showBlankMessages")),1)])])]),empty:s(()=>[z(h(e.$t("common.info.noDataFound")),1)]),filter:s(({filterModel:a})=>[g(v,{type:"text",modelValue:a.value,"onUpdate:modelValue":l=>a.value=l,class:"p-column-filter"},null,8,["modelValue","onUpdate:modelValue"])]),default:s(()=>[g(w,{headerStyle:e.intDescriptor.headerStyles.dirtyHeaderStyle},{body:s(a=>[a.data.dirty?(n(),u("i",oe)):k("",!0)]),_:1},8,["headerStyle"]),(n(!0),u(E,null,A(e.columns,a=>(n(),c(w,{field:a.field,header:e.$t(a.header),key:a.field,sortable:!0,class:L({disabledColumn:a.disabled,editableColumn:!a.disabled})},{body:s(l=>[a.disabled?(n(),u("span",{key:1,class:L({disabledCell:a.disabled,"kn-disabled-text":a.disabled,editableCell:!a.disabled})},h(l.data[l.column.props.field]),3)):(n(),c(v,{key:0,modelValue:l.data[l.column.props.field],"onUpdate:modelValue":C=>l.data[l.column.props.field]=C,class:"kn-material-input p-inputtext-sm p-p-2",onInput:C=>e.atFieldChange(l),"data-test":"input-field-"+l.data.id},null,8,["modelValue","onUpdate:modelValue","onInput","data-test"]))]),_:2},1032,["field","header","class"]))),128)),g(w,{headerStyle:e.intDescriptor.headerStyles.buttonsHeaderStyle},{header:s(()=>[i.defaultLanguage?(n(),c(f,{key:0,label:e.$t("managers.internationalizationManagement.table.addLabel"),class:"p-button kn-button--primary",onClick:e.addEmptyLabel},null,8,["label","onClick"])):k("",!0)]),body:s(a=>[m("div",re,[x(g(f,{icon:"pi pi-save",class:"p-button-link",onClick:l=>e.saveLabel(i,a.data)},null,8,["onClick"]),[[y,e.$t("common.save"),void 0,{top:!0}]]),i.defaultLanguage?x((n(),c(f,{key:0,icon:"pi pi-trash",class:"p-button-link",onClick:l=>e.deleteLabelConfirm(i,a,!0)},null,8,["onClick"])),[[y,e.$t("common.delete"),void 0,{top:!0}]]):k("",!0),i.defaultLanguage?k("",!0):x((n(),c(f,{key:1,icon:"pi pi-times",class:"p-button-link",onClick:l=>e.deleteLabelConfirm(i,a,!1)},null,8,["onClick"])),[[y,e.$t("common.cancel"),void 0,{top:!0}]])])]),_:2},1032,["headerStyle"])]),_:2},1032,["value","loading","filters"]))]),_:2},1024))),128))]),_:1},8,["activeIndex"])])}var de=I(K,[["render",ne]]);export{de as default};
//# sourceMappingURL=InternationalizationManagement-3bdbccc6.js.map
