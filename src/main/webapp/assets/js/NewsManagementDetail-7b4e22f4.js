import{K as E,u as z,c as S}from"./KnValidatonMessages-ebe48c72.js";import{d as h,ad as A,a5 as V,a6 as U,_ as f,r as n,o as m,h as w,w as d,f as r,g as u,t as i,a as o,D as s,G as v,l as R,n as I,s as B,ba as F,c as L,A as P,B as K}from"./index-1e676509.js";import{s as O}from"./calendar.esm-60a451ba.js";import{s as q}from"./editor.esm-7f249187.js";import{s as H}from"./inputswitch.esm-80317a38.js";import{s as X}from"./textarea.esm-32051d54.js";const j={style:{margin:"1rem"}},Q=[{value:1,name:"News"},{value:2,name:"Notification"},{value:3,name:"Warning"}],J={title:{style:{width:"50%",margin:"0.5rem"}},expirationDate:{style:{width:"20%",margin:"0.5rem"}},type:{style:{width:"30%",margin:"0.5rem"}}},Y={style:{height:"260px"}};var G={card:j,newsTypes:Q,input:J,editor:Y};const W={news:[{fieldName:"title",validators:[{key:"required"},{key:"regex",validator:{type:"extendedAlphanumericRegex"}}]},{fieldName:"expirationDate",validators:[{key:"required"}]},{fieldName:"type",validators:[{key:"required"}]},{fieldName:"description",validators:[{key:"required"}]}]};var M={validations:W};const Z=h({name:"news-detail-card",components:{Calendar:O,Card:A,Dropdown:V,Editor:q,InputSwitch:H,KnValidationMessages:E,Textarea:X},props:{selectedNews:{type:Object,requried:!1}},emits:["fieldChanged"],data(){return{moment:U,newsDetailCardDescriptor:G,newsDetailCardValidationDescriptor:M,news:{},v$:z()}},validations(){return{news:S("news",M.validations.news)}},computed:{descriptionHelp(){var a,t;return((t=(a=this.news.description)==null?void 0:a.length)!=null?t:"0")+" / 140"}},async created(){this.loadNews()},watch:{selectedNews(){this.v$.$reset(),this.loadNews()}},methods:{onFieldChange(a,t){this.$emit("fieldChanged",{fieldName:a,value:t})},onActiveChange(){this.$emit("fieldChanged",{fieldName:"active",value:this.news.active})},loadNews(){var a;this.news={...this.selectedNews},(a=this.news)!=null&&a.type||(this.news.type=1)},onManualDateChange(){setTimeout(()=>this.$emit("fieldChanged",{fieldName:"expirationDate",value:this.news.expirationDate}),250)}}}),_={for:"active",class:"kn-material-input-label p-ml-3"},aa={class:"p-fluid p-m-2"},ta={class:"p-field p-d-flex"},ea={class:"p-float-label"},oa={for:"title",class:"kn-material-input-label"},ra={class:"p-float-label"},na={for:"expirationDate",id:"calendar-label"},da={class:"p-float-label"},ia={for:"type",class:"kn-material-input-label"},la={class:"p-field"},sa={for:"description",class:"kn-material-input-label"},ca={class:"p-float-label"},pa={class:"p-d-flex p-flex-row p-jc-between"},ba={id:"description-help"},ka={class:"p-field"};function va(a,t,y,x,C,$){const c=n("InputSwitch"),p=n("Toolbar"),b=n("InputText"),l=n("KnValidationMessages"),k=n("Calendar"),g=n("Dropdown"),D=n("Textarea"),N=n("Editor"),T=n("Card");return m(),w(T,{style:s(a.newsDetailCardDescriptor.card.style)},{header:d(()=>[r(p,{class:"kn-toolbar kn-toolbar--secondary"},{start:d(()=>[u(i(a.$t("managers.newsManagement.settings")),1)]),end:d(()=>[r(c,{id:"active",modelValue:a.news.active,"onUpdate:modelValue":t[0]||(t[0]=e=>a.news.active=e),onChange:a.onActiveChange,"data-test":"active-input"},null,8,["modelValue","onChange"]),o("label",_,i(a.$t("managers.newsManagement.active")),1)]),_:1})]),content:d(()=>[o("form",aa,[o("div",ta,[o("div",{style:s(a.newsDetailCardDescriptor.input.title.style)},[o("span",ea,[r(b,{id:"title",class:v(["kn-material-input",{"p-invalid":a.v$.news.title.$invalid&&a.v$.news.title.$dirty}]),type:"text",modelValue:a.v$.news.title.$model,"onUpdate:modelValue":t[1]||(t[1]=e=>a.v$.news.title.$model=e),modelModifiers:{trim:!0},onBlur:t[2]||(t[2]=e=>a.v$.news.title.$touch()),onInput:t[3]||(t[3]=e=>a.onFieldChange("title",e.target.value)),"data-test":"title-input"},null,8,["modelValue","class"]),o("label",oa,i(a.$t("managers.newsManagement.form.title"))+" * ",1)]),r(l,{vComp:a.v$.news.title,additionalTranslateParams:{fieldName:a.$t("managers.newsManagement.form.title")}},null,8,["vComp","additionalTranslateParams"])],4),o("div",{style:s(a.newsDetailCardDescriptor.input.expirationDate.style)},[o("span",ra,[r(k,{id:"expirationDate",class:v(["kn-material-input",{"p-invalid":a.v$.news.expirationDate.$invalid&&a.v$.news.expirationDate.$dirty}]),type:"text",modelValue:a.v$.news.expirationDate.$model,"onUpdate:modelValue":t[4]||(t[4]=e=>a.v$.news.expirationDate.$model=e),showIcon:!0,onBlur:t[5]||(t[5]=e=>a.v$.news.expirationDate.$touch()),onInput:a.onManualDateChange,onDateSelect:t[6]||(t[6]=e=>a.onFieldChange("expirationDate",e.valueOf())),"data-test":"expiration-input"},null,8,["modelValue","class","onInput"]),o("label",na,i(a.$t("managers.newsManagement.form.expirationDate"))+" * ",1)]),r(l,{vComp:a.v$.news.expirationDate,additionalTranslateParams:{fieldName:a.$t("managers.newsManagement.form.expirationDate")}},null,8,["vComp","additionalTranslateParams"])],4),o("div",{style:s(a.newsDetailCardDescriptor.input.type.style)},[o("span",da,[r(g,{id:"type",class:v(["kn-material-input",{"p-invalid":a.v$.news.type.$invalid&&a.v$.news.type.$dirty}]),modelValue:a.v$.news.type.$model,"onUpdate:modelValue":t[7]||(t[7]=e=>a.v$.news.type.$model=e),options:a.newsDetailCardDescriptor.newsTypes,optionLabel:"name",optionValue:"value",onBeforeShow:t[8]||(t[8]=e=>a.v$.news.type.$touch()),onChange:t[9]||(t[9]=e=>a.onFieldChange("type",e.value))},null,8,["class","modelValue","options"]),o("label",ia,i(a.$t("managers.newsManagement.form.type"))+" * ",1)]),r(l,{vComp:a.v$.news.type,additionalTranslateParams:{fieldName:a.$t("managers.newsManagement.form.type")}},null,8,["vComp","additionalTranslateParams"])],4)]),o("div",la,[o("label",sa,i(a.$t("managers.newsManagement.form.description"))+" * ",1),o("span",ca,[r(D,{id:"description",class:v(["kn-material-input",{"p-invalid":a.v$.news.description.$invalid&&a.v$.news.description.$dirty}]),modelValue:a.v$.news.description.$model,"onUpdate:modelValue":t[10]||(t[10]=e=>a.v$.news.description.$model=e),modelModifiers:{trim:!0},autoResize:!0,maxLength:"140",rows:"2",placeholder:a.$t("managers.newsManagement.form.descriptionPlaceholder"),onBlur:t[11]||(t[11]=e=>a.v$.news.description.$touch()),onInput:t[12]||(t[12]=e=>a.onFieldChange("description",e.target.value)),"data-test":"description-input"},null,8,["modelValue","class","placeholder"])]),o("div",pa,[o("div",null,[r(l,{vComp:a.v$.news.description,additionalTranslateParams:{fieldName:a.$t("managers.newsManagement.form.description")}},null,8,["vComp","additionalTranslateParams"])]),o("small",ba,i(a.descriptionHelp),1)])]),o("div",ka,[o("span",null,[r(N,{id:"html",modelValue:a.news.html,"onUpdate:modelValue":t[13]||(t[13]=e=>a.news.html=e),editorStyle:a.newsDetailCardDescriptor.editor.style,onTextChange:t[14]||(t[14]=e=>a.onFieldChange("html",e.htmlValue))},null,8,["modelValue","editorStyle"])])])])]),_:1},8,["style"])}var ma=f(Z,[["render",va],["__scopeId","data-v-55806dca"]]);const ua={insert:{toastTitle:"common.toast.createTitle"},update:{toastTitle:"common.toast.updateTitle"},success:"common.toast.success"};var ga={operation:ua};const ha={header:{style:{"min-width":"70%","text-transform":"capitalize"}},style:{width:"30%"}},fa={style:{margin:"1rem"}},wa={scrollHeight:"200px"};var ya={column:ha,card:fa,table:wa};const xa=h({name:"roles-card",components:{Card:A,Column:R,DataTable:I},props:{categoryList:Array,selected:Array},emits:["changed"],data(){return{rolesCardDescriptor:ya,selectedCategories:[]}},watch:{selected(){this.loadSelectedCategories()}},created(){this.loadSelectedCategories()},methods:{setDirty(){this.$emit("changed",this.selectedCategories)},onSelectAll(a){this.selectedCategories=a.data,this.$emit("changed",this.selectedCategories)},onUnselectAll(){this.selectedCategories=[],this.$emit("changed",this.selectedCategories)},loadSelectedCategories(){this.selectedCategories=this.selected}}});function Ca(a,t,y,x,C,$){const c=n("Toolbar"),p=n("Column"),b=n("DataTable"),l=n("Card");return m(),w(l,{style:s(a.rolesCardDescriptor.card.style)},{header:d(()=>[r(c,{class:"kn-toolbar kn-toolbar--secondary"},{start:d(()=>[u(i(a.$t("managers.newsManagement.roles")),1)]),_:1})]),content:d(()=>[r(b,{value:a.categoryList,selection:a.selectedCategories,"onUpdate:selection":t[0]||(t[0]=k=>a.selectedCategories=k),class:"p-datatable-sm kn-table",dataKey:"id",rows:20,scrollable:!0,scrollHeight:a.rolesCardDescriptor.table.scrollHeight,responsiveLayout:"stack",breakpoint:"960px",onRowSelect:a.setDirty,onRowUnselect:a.setDirty,onRowSelectAll:a.onSelectAll,onRowUnselectAll:a.onUnselectAll,"data-test":"data-table"},{empty:d(()=>[u(i(a.$t("common.info.noDataFound")),1)]),default:d(()=>[r(p,{field:"name",header:a.$t("managers.newsManagement.role"),style:s(a.rolesCardDescriptor.column.header.style)},null,8,["header","style"]),r(p,{selectionMode:"multiple",style:s(a.rolesCardDescriptor.column.style),dataKey:"id"},null,8,["style"])]),_:1},8,["value","selection","scrollHeight","onRowSelect","onRowUnselect","onRowSelectAll","onRowUnselectAll"])]),_:1},8,["style"])}var $a=f(xa,[["render",Ca]]);const Ma=h({components:{NewsDetailCard:ma,RolesCard:$a},props:{id:{type:String,required:!1}},emits:["touched","closed","inserted"],data(){return{newsManagementDetailDescriptor:ga,selectedNews:{type:1,roles:[]},roleList:[],loading:!1,touched:!1,operation:"insert"}},computed:{invalid(){return this.selectedNews.title==null||this.selectedNews.expirationDate==null||this.selectedNews.description==null||this.selectedNews.type==null}},watch:{id(){this.loadSelectedNews()}},setup(){return{store:B()}},async created(){await this.loadSelectedNews(),await this.loadRoles()},methods:{async loadSelectedNews(){this.loading=!0,this.id?await this.$http.get(`/knowage/restful-services/2.0/news/${this.id}?isTechnical=true`).then(a=>this.selectedNews={...a.data,expirationDate:new Date(a.data.expirationDate)}):this.selectedNews={type:1,roles:[]},this.loading=!1},async loadRoles(){this.loading=!0,await this.$http.get("/knowage/restful-services/2.0/roles").then(a=>{this.roleList=a.data}).finally(()=>this.loading=!1)},async handleSubmit(){this.invalid||(this.selectedNews.id&&(this.operation="update"),await this.$http.post("/knowage/restful-services/2.0/news",{...this.selectedNews,expirationDate:new Date(this.selectedNews.expirationDate).valueOf()}).then(()=>{this.store.setInfo({title:this.$t(this.newsManagementDetailDescriptor.operation[this.operation].toastTitle),msg:this.$t(this.newsManagementDetailDescriptor.operation.success)}),this.$emit("inserted"),F.send(JSON.stringify(this.selectedNews)),this.$router.replace("/news-management")}).catch(()=>{}))},setDirty(){this.touched=!0,this.$emit("touched")},closeTemplateConfirm(){this.touched?this.$confirm.require({message:this.$t("common.toast.unsavedChangesMessage"),header:this.$t("common.toast.unsavedChangesHeader"),icon:"pi pi-exclamation-triangle",accept:()=>{this.touched=!1,this.closeTemplate()}}):this.closeTemplate()},closeTemplate(){this.$router.push("/news-management"),this.$emit("closed")},setSelectedRoles(a){this.selectedNews.roles=a,this.touched=!0,this.$emit("touched")},onFieldChange(a){this.selectedNews[a.fieldName]=a.value,this.touched=!0,this.$emit("touched")}}}),Aa={class:"card"},Da={class:"card"};function Na(a,t,y,x,C,$){const c=n("Button"),p=n("Toolbar"),b=n("ProgressBar"),l=n("NewsDetailCard"),k=n("RolesCard");return m(),L(K,null,[r(p,{class:"kn-toolbar kn-toolbar--primary p-m-0"},{start:d(()=>[u(i(a.$t("managers.newsManagement.detailTitle")),1)]),end:d(()=>[r(c,{icon:"pi pi-save",class:"p-button-text p-button-rounded p-button-plain",onClick:a.handleSubmit,disabled:a.invalid},null,8,["onClick","disabled"]),r(c,{icon:"pi pi-times",class:"p-button-text p-button-rounded p-button-plain",onClick:a.closeTemplateConfirm,"data-test":"close-button"},null,8,["onClick"])]),_:1}),a.loading?(m(),w(b,{key:0,mode:"indeterminate",class:"kn-progress-bar"})):P("",!0),o("div",Aa,[r(l,{selectedNews:a.selectedNews,onFieldChanged:a.onFieldChange},null,8,["selectedNews","onFieldChanged"])]),o("div",Da,[r(k,{categoryList:a.roleList,selected:a.selectedNews.roles,onChanged:t[0]||(t[0]=g=>a.setSelectedRoles(g))},null,8,["categoryList","selected"])])],64)}var Ra=f(Ma,[["render",Na]]);export{Ra as default};
//# sourceMappingURL=NewsManagementDetail-7b4e22f4.js.map
