import{_ as N,d as k,j as y,X as v,a4 as _,s as b,ba as C,r as s,o as l,c as M,a as n,f as a,w as i,g as c,t as r,h as p,A as d,V as F}from"./index-1e676509.js";const T=["title","description","newsType"],B={1:{className:"far fa-newspaper"},2:{className:"fas fa-envelope"},3:{className:"fas fa-exclamation-circle"}};var A={filterFields:T,iconTypesMap:B};const L=k({name:"news-management",components:{Avatar:y,FabButton:v,Listbox:_},data(){return{newsManagementDescriptor:A,newsList:[],touched:!1,loading:!1}},setup(){return{store:b()}},async created(){await this.loadAllNews()},methods:{async loadAllNews(){this.loading=!0,this.newsList=[],await this.$http.get("/knowage/restful-services/2.0/news").then(e=>{e.data.map(t=>{this.newsList.push({...t,newsType:this.setNewsType(t.type)})})}).finally(()=>this.loading=!1)},showForm(e){const t=e.value?`/news-management/${e.value.id}`:"/news-management/new-news";this.touched?this.$confirm.require({message:this.$t("common.toast.unsavedChangesMessage"),header:this.$t("common.toast.unsavedChangesHeader"),icon:"pi pi-exclamation-triangle",accept:()=>{this.touched=!1,this.$router.push(t)}}):this.$router.push(t)},deleteNewsConfirm(e){this.$confirm.require({message:this.$t("common.toast.deleteMessage"),header:this.$t("common.toast.deleteTitle"),icon:"pi pi-exclamation-triangle",accept:()=>{this.touched=!1,this.onDeleteNewsConfirm(e)}})},async onDeleteNewsConfirm(e){await this.deleteNews(e)&&this.deleteNewsWebSocket(e)},async deleteNews(e){let t=!1;return await this.$http.delete("/knowage/restful-services/2.0/news/"+e.id).then(()=>{this.store.setInfo({title:this.$t("common.toast.deleteTitle"),msg:this.$t("common.toast.deleteSuccess")}),t=!0,this.$router.push("/news-management"),this.loadAllNews()}),t},deleteNewsWebSocket(e){C.send(JSON.stringify(e))},pageReload(){this.touched=!1,this.loadAllNews()},setNewsType(e){switch(e){case 1:return"News";case 2:return"Notification";case 3:return"Warning"}}}}),D={class:"kn-page"},S={class:"kn-page-content p-grid p-m-0"},V={class:"kn-list--column p-col-4 p-sm-4 p-md-3 p-p-0"},W={class:"kn-list-item","data-test":"list-item"},E={class:"kn-list-item-text"},I={class:"kn-list-item-text-secondary"},O={class:"p-col-8 p-sm-8 p-md-9 p-p-0 p-m-0"};function R(e,t,q,K,j,z){const m=s("FabButton"),h=s("Toolbar"),u=s("ProgressBar"),f=s("Avatar"),w=s("Button"),g=s("Listbox"),$=s("router-view");return l(),M("div",D,[n("div",S,[n("div",V,[a(h,{class:"kn-toolbar kn-toolbar--primary"},{start:i(()=>[c(r(e.$t("managers.newsManagement.title")),1)]),end:i(()=>[a(m,{icon:"fas fa-plus",onClick:e.showForm,"data-test":"open-form-button"},null,8,["onClick"])]),_:1}),e.loading?(l(),p(u,{key:0,mode:"indeterminate",class:"kn-progress-bar","data-test":"progress-bar"})):d("",!0),e.loading?d("",!0):(l(),p(g,{key:1,class:"kn-list--column",options:e.newsList,listStyle:"max-height:calc(100% - 62px)",filter:!0,filterPlaceholder:e.$t("common.search"),optionLabel:"name",filterMatchMode:"contains",filterFields:e.newsManagementDescriptor.filterFields,emptyFilterMessage:e.$t("managers.newsManagement.noResults"),onChange:e.showForm,"data-test":"news-list"},{empty:i(()=>[c(r(e.$t("common.info.noDataFound")),1)]),option:i(o=>[n("div",W,[a(f,{icon:e.newsManagementDescriptor.iconTypesMap[o.option.type].className,shape:"circle",size:"medium"},null,8,["icon"]),n("div",E,[n("span",null,r(o.option.title),1),n("span",I,r(o.option.description),1)]),a(w,{icon:"far fa-trash-alt",class:"p-button-link p-button-sm",onClick:F(H=>e.deleteNewsConfirm(o.option),["stop"]),"data-test":"delete-button"},null,8,["onClick"])])]),_:1},8,["options","filterPlaceholder","filterFields","emptyFilterMessage","onChange"]))]),n("div",O,[a($,{onTouched:t[0]||(t[0]=o=>e.touched=!0),onClosed:t[1]||(t[1]=o=>e.touched=!1),onInserted:e.pageReload},null,8,["onInserted"])])])])}var P=N(L,[["render",R]]);export{P as default};
//# sourceMappingURL=NewsManagement-315cc9b2.js.map
