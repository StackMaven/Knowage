import{d as S,a5 as U,_ as L,r as p,o as i,c as b,B as P,C as O,f as d,G as y,a as s,t as c,A as h,h as C,w as v,i as F,q as ee,y as N,z as E,g as $,s as j,a4 as ae,k as te,l as oe,n as re,ae as ne,a3 as ie,N as le}from"./index-1e676509.js";import{s as se,a as de}from"./fieldset.esm-61ec4a9f.js";import{s as ce}from"./sidebar.esm-2131cfd1.js";import{s as pe}from"./overlaypanel.esm-944aa237.js";import{s as be}from"./menu.esm-6bee86d0.js";import{u as q,c as V,K as ke}from"./KnValidatonMessages-ebe48c72.js";import{s as B}from"./calendar.esm-60a451ba.js";import{s as me}from"./inputswitch.esm-80317a38.js";import{s as ue}from"./multiselect.esm-ce4000f7.js";import{s as X}from"./textarea.esm-32051d54.js";import{s as ge}from"./chips.esm-693c3c01.js";import{K as he,d as fe}from"./KnScheduler-d2aec922.js";import{K as ve}from"./KnCalculatedField-ab0b2f81.js";import{C as ye}from"./client-1808a2c5.js";import"./checkbox.esm-fa6c8259.js";import"./radiobutton.esm-c3e6fa9b.js";import"./KnHint-6d455703.js";const we={all:{values:[{code:"string",label:"java.lang.String"},{code:"integer",label:"java.lang.Integer"},{code:"string",label:"java.util.String"},{code:"float",label:"java.lang.Float"},{code:"double",label:"java.lang.Double"}]},"java.lang.Double":{icon:{class:"material-icons",name:"numbers"},values:[{code:"string",label:"java.lang.String"}]},"java.lang.Integer":{icon:{class:"material-icons",name:"numbers"},values:[{code:"string",label:"java.lang.String"},{code:"float",label:"java.lang.Float"},{code:"double",label:"java.lang.Double"}]},"java.lang.Long":{icon:{class:"material-icons",name:"numbers"},values:[{code:"string",label:"java.lang.String"},{code:"double",label:"java.lang.Double"}]},"java.lang.String":{icon:"fas fa-quote-left",values:[{code:"string",label:"java.lang.String"},{code:"integer",label:"java.lang.Integer"},{code:"double",label:"java.lang.Double"}]},"java.math.BigDecimal":{icon:{class:"material-icons",name:"numbers"},values:[{code:"string",label:"java.lang.String"},{code:"double",label:"java.lang.Double"}]},"java.sql.Date":{icon:"fas fa-quote-left",values:[{code:"string",label:"java.lang.String"}]},"java.sql.Timestamp":{icon:"fas fa-quote-left",values:[{code:"string",label:"java.lang.String"}]},"java.util.String":{icon:"far fa-calendar-alt",values:[{code:"string",label:"java.lang.String"}]},"oracle.sql.TIMESTAMP":{icon:"fas fa-quote-left",values:[{code:"string",label:"java.lang.String"}]}},xe={buttonClassHeader:"p-button-text p-button-rounded p-button-plain kn-datapreparation-button"},Me={refreshRate:{options:[{code:"NEVER",id:1,name:"managers.workspaceManagement.dataPreparation.dataset.refreshRate.frequency.NEVER"},{code:"DAILY",id:2,name:"managers.workspaceManagement.dataPreparation.dataset.refreshRate.frequency.DAILY"},{code:"WEEKLY",id:3,name:"managers.workspaceManagement.dataPreparation.dataset.refreshRate.frequency.WEEKLY"},{code:"MONTHLY",id:4,name:"managers.workspaceManagement.dataPreparation.dataset.refreshRate.frequency.MONTHLY"},{code:"YEARLY",id:5,name:"managers.workspaceManagement.dataPreparation.dataset.refreshRate.frequency.YEARLY"}]}},Ce=[{code:"ATTRIBUTE",icon:"fas fa-font",label:"managers.workspaceManagement.dataPreparation.roles.attribute"},{code:"MEASURE",icon:"fas fa-hashtag",label:"managers.workspaceManagement.dataPreparation.roles.measure"}],Ae=[{category:"tableStructure",description:"managers.workspaceManagement.dataPreparation.transformations.calculatedField.description",editColumn:!1,icon:"pi pi-plus-circle",label:"managers.workspaceManagement.dataPreparation.transformations.calculatedField.label",name:"calculatedField",position:0,toolbar:!0,type:"calculatedField"},{category:"tableStructure",description:"managers.workspaceManagement.dataPreparation.transformations.drop.description",editColumn:!0,icon:"pi pi-minus-circle",label:"managers.workspaceManagement.dataPreparation.transformations.drop.label",name:"drop",position:1,toolbar:!1,type:"simple"},{category:"tableStructure",description:"managers.workspaceManagement.dataPreparation.transformations.merge.description",editColumn:!1,icon:{class:"material-icons",name:"merge_type"},label:"managers.workspaceManagement.dataPreparation.transformations.merge.label",name:"merge",position:2,toolbar:!0,type:"simple"},{category:"tableStructure",description:"managers.workspaceManagement.dataPreparation.transformations.split.description",editColumn:!1,icon:{class:"material-icons",name:"call_split"},label:"managers.workspaceManagement.dataPreparation.transformations.split.label",name:"split",position:3,toolbar:!0,type:"split"},{category:"filtering",description:"managers.workspaceManagement.dataPreparation.transformations.filter.description",editColumn:!0,icon:{class:"material-icons",name:"auto_fix_normal"},label:"managers.workspaceManagement.dataPreparation.transformations.filter.label",name:"filter",position:4,toolbar:!0,type:"filter"},{category:"visualization",description:"managers.workspaceManagement.dataPreparation.transformations.padding.description",editColumn:!0,icon:{class:"material-icons",name:"padding"},label:"managers.workspaceManagement.dataPreparation.transformations.padding.label",name:"padding",position:6,toolbar:!0,type:"simple"},{category:"cleaning",description:"managers.workspaceManagement.dataPreparation.transformations.removeDuplicates.description",editColumn:!0,icon:{class:"material-icons",name:"control_point_duplicate"},label:"managers.workspaceManagement.dataPreparation.transformations.removeDuplicates.label",name:"removeDuplicates",position:7,toolbar:!0,type:"simple"},{category:"cleaning",description:"managers.workspaceManagement.dataPreparation.transformations.removeNull.description",editColumn:!0,icon:"fas fa-columns",label:"managers.workspaceManagement.dataPreparation.transformations.removeNull.label",name:"removeNull",position:8,toolbar:!0,type:"simple"},{category:"editing",description:"managers.workspaceManagement.dataPreparation.transformations.replace.description",editColumn:!0,icon:"fas fa-sync-alt",incompatibleDataTypes:["date"],label:"managers.workspaceManagement.dataPreparation.transformations.replace.label",name:"replace",position:9,toolbar:!0,type:"simple"},{category:"reporting",description:"managers.workspaceManagement.dataPreparation.transformations.statistics.description",editColumn:!1,icon:"pi pi-chart-bar",label:"managers.workspaceManagement.dataPreparation.transformations.statistics.label",name:"statistics",position:10,toolbar:!1,type:"custom"},{category:"cleaning",description:"managers.workspaceManagement.dataPreparation.transformations.trim.description",editColumn:!0,icon:"fas fa-cut",label:"managers.workspaceManagement.dataPreparation.transformations.trim.label",name:"trim",position:11,toolbar:!1,type:"simple"},{category:"tableStructure",description:"managers.workspaceManagement.dataPreparation.transformations.changeType.description",editColumn:!0,hidden:!0,icon:"fas fa-hashtag",label:"managers.workspaceManagement.dataPreparation.transformations.changeType.label",name:"changeType",position:12,toolbar:!0,type:"simple"}],De={"java.lang.Double":"number","java.lang.Float":"number","java.lang.Integer":"number","java.lang.Long":"number","java.lang.String":"string","java.math.BigDecimal":"number","java.sql.Date":"date","java.sql.Timestamp":"timestamp","java.util.String":"string","oracle.sql.TIMESTAMP":"timestamp"};var J={compatibilityMap:we,css:xe,dataPreparation:Me,roles:Ce,transformations:Ae,typeMap:De};const Te="managers.workspaceManagement.dataPreparation.dataset.hint",Ee={configuration:[{fieldName:"name",validators:[{key:"required"},{key:"maximumCharacters",validator:{params:{max:100},type:"maxLength"}},{key:"regex",validator:{type:"extendedAlphanumericRegex"}}]},{fieldName:"description",validators:[{key:"maximumCharacters",validator:{params:{max:500},type:"maxLength"}},{key:"regex",validator:{type:"extendedAlphanumericRegex"}}]}]};var Q={hint:Te,validations:Ee};const ze={parameters:[{name:"columns",optionLabel:"header",optionValue:"header",type:"multiSelect",validationRules:"required"},{availableOptions:[],name:"destType",placeholder:"managers.workspaceManagement.dataPreparation.transformations.destType",type:"dropdown",validationRules:"required|alpha_dash"}],validations:[{fieldName:"columns",validators:[{key:"required"},{key:"maximumCharacters",validator:{params:{max:100},type:"maxLength"}},{key:"regex",validator:{type:"extendedAlphanumericRegex"}}]}]},Pe={parameters:[{name:"columnName",type:"string",validationRules:"required|alpha"}],validations:[{fieldName:"column",validators:[{key:"required"},{key:"maximumCharacters",validator:{params:{max:100},type:"maxLength"}},{key:"regex",validator:{type:"extendedAlphanumericRegex"}}]}]},$e={parameters:[{name:"columns",optionLabel:"header",type:"multiSelect",validationRules:"required"},{name:"separator",type:"string",validationRules:"alpha"},{name:"columnName",type:"string",validationRules:"required|alpha"}]},Se={parameters:[{name:"prefix",type:"string",validationRules:"alpha_dash"},{name:"columns",optionLabel:"header",optionValue:"header",type:"multiSelect",validationRules:"required"},{name:"suffix",type:"string",validationRules:"alpha_dash"}],validations:[{fieldName:"columns",validators:[{key:"required"},{key:"maximumCharacters",validator:{params:{max:100},type:"maxLength"}},{key:"regex",validator:{type:"extendedAlphanumericRegex"}}]},{fieldName:"prefix",validators:[{key:"required"},{key:"maximumCharacters",validator:{params:{max:100},type:"maxLength"}},{key:"regex",validator:{type:"extendedAlphanumericRegex"}}]},{fieldName:"suffix",validators:[{key:"required"},{key:"maximumCharacters",validator:{params:{max:100},type:"maxLength"}},{key:"regex",validator:{type:"extendedAlphanumericRegex"}}]}]},Le={parameters:[{name:"columns",optionLabel:"header",optionValue:"header",type:"multiSelect",validationRules:"required"}],validations:[{fieldName:"column",validators:[{key:"required"},{key:"maximumCharacters",validator:{params:{max:100},type:"maxLength"}},{key:"regex",validator:{type:"extendedAlphanumericRegex"}}]}]},_e={parameters:[{name:"columns",optionLabel:"header",optionValue:"header",type:"multiSelect",validationRules:"required"}],validations:[{fieldName:"columns",validators:[{key:"required"},{key:"maximumCharacters",validator:{params:{max:100},type:"maxLength"}},{key:"regex",validator:{type:"extendedAlphanumericRegex"}}]}]},Oe={parameters:[{name:"columns",optionLabel:"header",optionValue:"header",type:"multiSelect",validationRules:"required"},{name:"oldChar",type:"string",validationRules:"required|alpha_dash"},{name:"newChar",type:"string",validationRules:"required|alpha_dash"}],validations:[{fieldName:"column",validators:[{key:"required"},{key:"maximumCharacters",validator:{params:{max:100},type:"maxLength"}},{key:"regex",validator:{type:"extendedAlphanumericRegex"}}]},{fieldName:"oldChar",validators:[{key:"required"},{key:"maximumCharacters",validator:{params:{max:100},type:"maxLength"}},{key:"regex",validator:{type:"extendedAlphanumericRegex"}}]},{fieldName:"newChar",validators:[{key:"required"},{key:"maximumCharacters",validator:{params:{max:100},type:"maxLength"}},{key:"regex",validator:{type:"extendedAlphanumericRegex"}}]}]},Ie={parameters:[{name:"columns",optionLabel:"header",optionValue:"header",type:"multiSelect",validationRules:"required"}],validations:[{fieldName:"column",validators:[{key:"required"},{key:"maximumCharacters",validator:{params:{max:100},type:"maxLength"}},{key:"regex",validator:{type:"extendedAlphanumericRegex"}}]}]};var I={changeType:ze,drop:Pe,merge:$e,padding:Se,removeDuplicates:Le,removeNull:_e,replace:Oe,trim:Ie};const Ue=S({name:"data-preparation-simple",props:{readOnly:Boolean,col:String,columns:{type:Array},transformation:{}},components:{Calendar:B,Dropdown:U,InputSwitch:me,MultiSelect:ue,Textarea:X},emits:["update:transformation"],data(){return{descriptor:I,localTransformation:{},v$:q(),dirty:!1,currentId:0}},validations(){var e;if(((e=this.transformation)==null?void 0:e.type)==="simple"){this.setupLocal();let a=this.descriptor[this.localTransformation.name].validations?this.descriptor[this.localTransformation.name].validations:[];return{localTransformation:V("localTransformation",a)}}},mounted(){this.setupLocal()},methods:{handleMultiSelectChange(e){e&&this.refreshTransfrormation()},refreshTransfrormation(){this.localTransformation&&(this.localTransformation.type==="simple"?this.descriptor[this.localTransformation.name].parameters:[]).forEach(a=>{var t,o;if(a.name=="columns"&&(a.type==="multiSelect"||a.type==="dropdown")){let l=this.localTransformation.parameters.filter(m=>m.name==a.name);if((l==null?void 0:l.length)>0){let m=l[0];if(this.col){let g=(t=this.columns)==null?void 0:t.filter(x=>x.header==this.col);g&&g.length>0&&(g[0].disabled=!0,m.value=a.type==="multiSelect"?g:g[0][a.optionValue])}else(o=this.columns)==null||o.forEach(g=>g.disabled=!1)}}})},setupLocal(){var t;if(Object.keys(this.localTransformation).length==0){this.localTransformation=this.transformation?{...this.transformation}:{};let o=this.transformation&&this.transformation.name?this.transformation.name:"";if(o&&((t=this.transformation)==null?void 0:t.type)==="simple"){let l=JSON.parse(JSON.stringify(this.descriptor[o].parameters));if(this.readOnly)for(var e=0;e<l.length;e++){let m=l[e].name;for(var a=0;a<this.localTransformation.parameters.length;a++)this.localTransformation.parameters[a].name==m&&(l[e].value=this.localTransformation.parameters[a].value)}this.localTransformation.parameters=l}this.refreshTransfrormation()}},translate(e){const a=e.availableOptions;return a.forEach(t=>{t.label=this.$t(t.label)}),a}},watch:{localTransformation:{handler(e){this.localTransformation=e,this.$emit("update:transformation",e)},deep:!0}}}),Ne={class:"simple"},qe={key:0,class:"p-float-label"},Ve=["for"],Re={key:1,class:"p-float-label"},Fe=["for"],je={key:2,class:"p-float-label"},Be=["for"],Xe={key:3,class:"p-float-label"},Je=["for"],Qe={key:4,class:"p-float-label"},Ye=["for"],Ke={key:5,class:"p-float-label"},He=["for"];function Ge(e,a,t,o,l,m){const g=p("InputText"),x=p("Calendar"),D=p("InputSwitch"),w=p("Dropdown"),M=p("MultiSelect"),f=p("Textarea");return i(),b("div",Ne,[(i(!0),b(P,null,O(e.localTransformation.parameters,(r,k)=>(i(),b("span",{key:k,class:"p-field p-ml-2 kn-flex data-prep-simple-transformation"},[r.type=="string"?(i(),b("span",qe,[d(g,{id:r.id,type:"text",modelValue:r.value,"onUpdate:modelValue":A=>r.value=A,disabled:e.readOnly,class:y(["kn-material-input",r.validationRules&&r.validationRules.includes("required")&&!r.value?"p-invalid":""])},null,8,["id","modelValue","onUpdate:modelValue","disabled","class"]),s("label",{for:"input_index_"+k,class:"kn-material-input-label"},c(e.$t("managers.workspaceManagement.dataPreparation.transformations."+r.name)),9,Ve)])):h("",!0),r.type==="date"?(i(),b("span",Re,[d(x,{id:r.id,modelValue:r.value,"onUpdate:modelValue":A=>r.value=A,disabled:e.readOnly,class:y(["kn-material-input",{"p-invalid":r.validationRules&&r.validationRules.includes("required")&&!r.value}])},null,8,["id","modelValue","onUpdate:modelValue","disabled","class"]),s("label",{for:r.type+"_index_"+k,class:"kn-material-input-label"},c(e.$t("managers.workspaceManagement.dataPreparation.transformations."+r.name)),9,Fe)])):h("",!0),r.type==="boolean"?(i(),b("span",je,[d(D,{id:r.id,modelValue:r.value,"onUpdate:modelValue":A=>r.value=A,disabled:e.readOnly},null,8,["id","modelValue","onUpdate:modelValue","disabled"]),s("label",{for:"inputSwitch_index_"+k,class:"kn-material-input-label"},c(e.$t("managers.workspaceManagement.dataPreparation.transformations."+r.name)),9,Be)])):h("",!0),r.type==="dropdown"?(i(),b("span",Xe,[d(w,{id:r.id,modelValue:r.value,"onUpdate:modelValue":A=>r.value=A,options:r.availableOptions?e.translate(r):e.columns,showClear:!r.validationRules||r.validationRules&&!r.validationRules.includes("required"),optionLabel:r.optionLabel?r.optionLabel:"label",optionValue:r.optionValue?r.optionValue:"code",disabled:e.col&&r.name==="columns"||e.readOnly,class:y(["kn-material-input",{"p-invalid":r.validationRules&&r.validationRules.includes("required")&&!r.value}])},null,8,["id","modelValue","onUpdate:modelValue","options","showClear","optionLabel","optionValue","disabled","class"]),s("label",{for:"selectedCondition_index_"+k,class:"kn-material-input-label"},c(e.$t("managers.workspaceManagement.dataPreparation.transformations."+r.name)),9,Je)])):h("",!0),r.type=="multiSelect"?(i(),b("span",Qe,[d(M,{id:r.id,modelValue:r.value,"onUpdate:modelValue":A=>r.value=A,options:e.columns,optionLabel:r.optionLabel?r.optionLabel:"label",display:"chip",optionDisabled:"disabled",onChange:a[0]||(a[0]=A=>e.handleMultiSelectChange(A)),"allow-empty":!1,disabled:e.col||e.readOnly,class:y(["kn-material-input",{"p-invalid":r.validationRules&&r.validationRules.includes("required")&&!r.value}]),filter:!0},null,8,["id","modelValue","onUpdate:modelValue","options","optionLabel","disabled","class"]),s("label",{for:"selectedItems_index_"+k,class:"kn-material-input-label"},c(e.$t("managers.workspaceManagement.dataPreparation.transformations.columns")),9,Ye)])):h("",!0),r.type=="textarea"?(i(),b("span",Ke,[d(f,{id:r.id,modelValue:r.value,"onUpdate:modelValue":A=>r.value=A,disabled:e.readOnly,rows:"5",cols:"30",class:y(["kn-material-input",{"p-invalid":r.validationRules&&r.validationRules.includes("required")&&!r.value}]),autoResize:!1},null,8,["id","modelValue","onUpdate:modelValue","disabled","class"]),s("label",{for:r.type+"_index_"+k,class:"kn-material-input-label"},c(e.$t("managers.workspaceManagement.dataPreparation.transformations."+r.name)),9,He)])):h("",!0)]))),128))])}var Ze=L(Ue,[["render",Ge],["__scopeId","data-v-58765871"]]);const We=[{availableForTypes:"string",code:"like",label:"like"},{availableForTypes:"string",code:"notLike",label:"NOT like"},{availableForTypes:"string|date|timestamp",code:"isNull",label:"is null"},{availableForTypes:"string|date|timestamp",code:"isNotNull",label:"is NOT null"},{availableForTypes:"string|number",code:"equals",label:"="},{availableForTypes:"number",code:"minorThan",label:"< "},{availableForTypes:"number",code:"greaterThan",label:"> "},{availableForTypes:"number",code:"minorOrEqualsThan<=",label:"<= "},{availableForTypes:"number",code:"greaterOrEqualsThan",label:">= "},{availableForTypes:"string|number",code:"notEquals",label:"!= "},{availableForTypes:"string|number",code:"in",label:"IN "},{availableForTypes:"string|number",code:"notIn",label:"NOT IN"},{availableForTypes:"date|timestamp",code:"after",label:"After"},{availableForTypes:"date|timestamp",code:"before",label:"Before"},{availableForTypes:"date|timestamp",code:"between",label:"Between"}],ea={"java.lang.Double":"number","java.lang.Float":"number","java.lang.Integer":"number","java.lang.Long":"number","java.lang.String":"string","java.math.BigDecimal":"number","java.sql.Date":"date","java.sql.Timestamp":"timestamp","java.util.String":"string","oracle.sql.TIMESTAMP":"timestamp"};var R={availableConditions:We,typesMap:ea};const aa=S({name:"data-preparation-filter-transformation",props:{columns:{type:Array},col:String,readOnly:Boolean,transformation:{}},components:{Dropdown:U,Calendar:B,Chips:ge},emits:["update:transformation"],data(){return{availableConditions:R.availableConditions,descriptor:R,localTransformation:[{}]}},mounted(){if(this.localTransformation=[{}],this.transformation&&this.transformation.parameters)for(let e=0;e<this.transformation.parameters.length;e++){let a=this.transformation.parameters[e].name,t=this.transformation.parameters[e].value;switch(a){case"condition":this.localTransformation[0].condition=t;break;case"text":this.localTransformation[0].text=t;break;case"startDate":this.localTransformation[0].startDate=t;break;case"endDate":this.localTransformation[0].endDate=t;break;case"number":this.localTransformation[0].number=t;break}}this.col&&this.columns&&(this.localTransformation[0].column=this.columns.filter(e=>e.header===this.col)[0])},methods:{addNewRow(){var e={};this.col&&this.columns&&(e.column=this.columns.filter(a=>a.header===this.col)[0]),this.localTransformation.push(e)},deleteRow(e){this.localTransformation.splice(e,1)},getAvailableConditions(e){return this.availableConditions.filter(t=>{let o=t.availableForTypes.split("|"),l=this.getColType(this.localTransformation[e].column);return!!o.includes(l)})},getColType(e){return this.descriptor.typesMap[e.Type]},showEndDate(e){let a=["between","before"];return this.isShowDate(e,a)},isShowDate(e,a){if(!this.localTransformation[e].column||!this.localTransformation[e].condition)return!1;let t=this.getColType(this.localTransformation[e].column);return!!((t=="date"||t=="timestamp")&&a.includes(this.localTransformation[e].condition))},showStartDate(e){let a=["between","after"];return this.isShowDate(e,a)},showInputText(e){let a=["isNull","isNotNull","in","notIn"];return!this.localTransformation[e].column||!this.localTransformation[e].condition?!1:this.getColType(this.localTransformation[e].column)=="string"&&!a.includes(this.localTransformation[e].condition)},showInputNumber(e){let a=["in","notIn"];return!this.localTransformation[e].column||!this.localTransformation[e].condition?!1:this.getColType(this.localTransformation[e].column)=="number"&&!a.includes(this.localTransformation[e].condition)},showValuesList(e){let a=["in","notIn"];return!this.localTransformation[e].column||!this.localTransformation[e].condition?!1:!!a.includes(this.localTransformation[e].condition)}},watch:{localTransformation:{handler(e){this.$emit("update:transformation",e)},deep:!0}}}),ta={class:"data-prep-custom-transformation"},oa={class:"p-float-label p-field kn-flex"},ra={class:"kn-material-input-label"},na={key:0,class:"p-float-label p-field p-mx-2"},ia={class:"kn-material-input-label"},la={key:1,class:"p-float-label p-field kn-flex"},sa={class:"kn-material-input-label"},da={key:2,class:"p-float-label p-field kn-flex"},ca={class:"kn-material-input-label"},pa={key:3,class:"p-float-label p-field kn-flex"},ba={class:"kn-material-input-label"},ka={key:4,class:"p-float-label p-field kn-flex"},ma={class:"kn-material-input-label"},ua={key:5,class:"kn-flex"},ga={class:"p-float-label kn-material-input"},ha={class:"kn-material-input-label"},fa={id:"chips-help"},va={class:"p-d-flex p-jc-center p-ai-center"};function ya(e,a,t,o,l,m){const g=p("Dropdown"),x=p("Calendar"),D=p("InputText"),w=p("Chips"),M=p("Button");return i(),b("div",ta,[(i(!0),b(P,null,O(e.localTransformation,(f,r)=>(i(),b("div",{class:"p-d-flex",key:r},[s("span",oa,[d(g,{modelValue:f.column,"onUpdate:modelValue":k=>f.column=k,options:e.columns,class:"kn-material-input",optionLabel:"fieldAlias",filter:!0,disabled:e.col||e.readOnly},null,8,["modelValue","onUpdate:modelValue","options","disabled"]),s("label",ra,c(e.$t("managers.workspaceManagement.dataPreparation.transformations.column")),1)]),f.column?(i(),b("span",na,[d(g,{modelValue:f.condition,"onUpdate:modelValue":k=>f.condition=k,disabled:e.readOnly,options:e.getAvailableConditions(r),optionLabel:"label",optionValue:"code",class:"kn-material-input"},null,8,["modelValue","onUpdate:modelValue","disabled","options"]),s("label",ia,c(e.$t("managers.workspaceManagement.dataPreparation.transformations.conditions")),1)])):h("",!0),e.showStartDate(r)?(i(),b("span",la,[d(x,{modelValue:f.startDate,"onUpdate:modelValue":k=>f.startDate=k,disabled:e.readOnly,class:"kn-material-input"},null,8,["modelValue","onUpdate:modelValue","disabled"]),s("label",sa,c(e.$t("managers.workspaceManagement.dataPreparation.transformations.startDate")),1)])):h("",!0),e.showEndDate(r)?(i(),b("span",da,[d(x,{modelValue:f.endDate,"onUpdate:modelValue":k=>f.endDate=k,disabled:e.readOnly,class:"kn-material-input"},null,8,["modelValue","onUpdate:modelValue","disabled"]),s("label",ca,c(e.$t("managers.workspaceManagement.dataPreparation.transformations.endDate")),1)])):h("",!0),e.showInputText(r)?(i(),b("span",pa,[d(D,{type:"text",modelValue:f.text,"onUpdate:modelValue":k=>f.text=k,disabled:e.readOnly,class:"kn-material-input"},null,8,["modelValue","onUpdate:modelValue","disabled"]),s("label",ba,c(e.$t("managers.workspaceManagement.dataPreparation.transformations.text")),1)])):h("",!0),e.showInputNumber(r)?(i(),b("span",ka,[d(D,{type:"number",modelValue:f.number,"onUpdate:modelValue":k=>f.number=k,disabled:e.readOnly,class:"kn-material-input"},null,8,["modelValue","onUpdate:modelValue","disabled"]),s("label",ma,c(e.$t("managers.workspaceManagement.dataPreparation.transformations.number")),1)])):h("",!0),e.showValuesList(r)?(i(),b("span",ua,[s("span",ga,[d(w,{class:"kn-width-full",multiple:!0,modelValue:f.valuesList,"onUpdate:modelValue":k=>f.valuesList=k},null,8,["modelValue","onUpdate:modelValue"]),s("label",ha,c(e.$t("managers.workspaceManagement.dataPreparation.transformations.values")),1)]),s("small",fa,c(e.$t("common.chipsHint")),1)])):h("",!0),s("span",null,[!e.readOnly&&e.localTransformation.length>1?(i(),C(M,{key:0,icon:"pi pi-trash",class:y("p-button-text p-button-rounded p-button-plain"),onClick:k=>e.deleteRow(r)},null,8,["onClick"])):h("",!0)])]))),128)),s("span",va,[e.readOnly?h("",!0):(i(),C(M,{key:0,icon:"pi pi-plus",class:"p-button-text p-button-rounded p-button-plain",onClick:a[0]||(a[0]=f=>e.addNewRow())}))])])}var wa=L(aa,[["render",ya]]);const xa=[{code:"string",label:"String"},{code:"date",label:"Date"},{code:"number",label:"Number"}],Ma={availableOptions:[{code:"separator",label:"managers.workspaceManagement.dataPreparation.transformations.useSeparator"},{code:"numberOfChars",label:"managers.workspaceManagement.dataPreparation.transformations.useNumberOfChars"}]},Ca=[{name:"columns",optionLabel:"header",optionValue:"header",type:"dropdown",validationRules:"required"},{name:"column1",type:"string",validationRules:"required|alpha_dash"},{availableOptions:[],name:"destType1",placeholder:"managers.workspaceManagement.dataPreparation.transformations.destType",type:"dropdown",validationRules:"required|alpha_dash"},{name:"column2",type:"string",validationRules:"required|alpha_dash"},{availableOptions:[],name:"destType2",placeholder:"managers.workspaceManagement.dataPreparation.transformations.destType",type:"dropdown",validationRules:"required|alpha_dash"},{availableOptions:[{code:"split_separator",label:"managers.workspaceManagement.dataPreparation.transformations.useSeparator"},{code:"split_numberOfChars",label:"managers.workspaceManagement.dataPreparation.transformations.useNumberOfChars"}],name:"splitMethod",placeholder:"managers.workspaceManagement.dataPreparation.transformations.condition",type:"dropdown",validationRules:"required|alpha_dash"},{dependsFromField:"splitMethod",dependsFromOptions:"split_separator",name:"separator",type:"string",validationRules:"alpha"},{dependsFromField:"splitMethod",dependsFromOptions:"split_numberOfChars",name:"numberOfChars",type:"string",validationRules:"numeric"}];var _={availableOutputTypes:xa,condition:Ma,parameters:Ca};const Aa=S({name:"data-preparation-split-transformation",props:{columns:{type:Array},col:String,readOnly:Boolean,transformation:{}},components:{Dropdown:U,Fieldset:se},emits:["update:transformation"],data(){return{availableConditions:_.condition.availableOptions,availableOutputTypes:_.availableOutputTypes,descriptor:_,localTransformation:{}}},mounted(){if(this.localTransformation={},this.readOnly&&this.transformation&&this.transformation.parameters)for(let e=0;e<this.transformation.parameters.length;e++)this.transformation.parameters[e].name=="condition"?this.localTransformation.condition=this.transformation.parameters[e].value:this.transformation.parameters[e].name=="numOfChars"?this.localTransformation.numOfChars=this.transformation.parameters[e].value:this.transformation.parameters[e].name=="separator"?this.localTransformation.separator=this.transformation.parameters[e].value:this.transformation.parameters[e].name=="outputColumn1"?this.localTransformation.outputColumn1=this.transformation.parameters[e].value:this.transformation.parameters[e].name=="separator"?this.localTransformation.separator=this.transformation.parameters[e].value:this.transformation.parameters[e].name=="outputColumn1"?this.localTransformation.outputColumn1=this.transformation.parameters[e].value:this.transformation.parameters[e].name=="outputColumn2"?this.localTransformation.outputColumn2=this.transformation.parameters[e].value:this.transformation.parameters[e].name=="outputType1"?this.localTransformation.outputType1=this.transformation.parameters[e].value:this.transformation.parameters[e].name=="outputType2"?this.localTransformation.outputType2=this.transformation.parameters[e].value:this.transformation.parameters[e].name=="columns"&&(this.localTransformation.column=this.transformation.parameters[e].value[0])},methods:{getStringColumns(e){return e.filter(a=>a.Type=="java.lang.String")},translatedLabel(e){return this.$t(e.label)}},watch:{localTransformation:{handler(e,a){a!==e&&this.$emit("update:transformation",e)},deep:!0}}}),Da={class:"data-prep-custom-transformation"},Ta={class:"p-d-flex"},Ea={class:"p-float-label p-field p-ml-2 kn-flex"},za={class:"kn-material-input-label"},Pa={class:"p-float-label p-field p-ml-2 kn-flex"},$a={class:"kn-material-input-label"},Sa={key:0,class:"p-float-label p-field p-ml-2 kn-flex"},La={class:"kn-material-input-label"},_a={key:1,class:"p-float-label p-field p-ml-2 kn-flex"},Oa={class:"kn-material-input-label"},Ia={class:"p-d-flex"},Ua={class:"p-float-label p-field p-ml-2 kn-flex"},Na={class:"kn-material-input-label"},qa={class:"p-d-flex"},Va={class:"p-float-label p-field p-ml-2 kn-flex"},Ra={class:"kn-material-input-label"};function Fa(e,a,t,o,l,m){const g=p("Dropdown"),x=p("InputText"),D=p("Fieldset");return i(),b("div",Da,[s("div",Ta,[s("span",Ea,[d(g,{modelValue:e.localTransformation.column,"onUpdate:modelValue":a[0]||(a[0]=w=>e.localTransformation.column=w),options:e.getStringColumns(e.columns),class:"kn-material-input",optionLabel:"fieldAlias",filter:!0,disabled:e.col||e.readOnly},null,8,["modelValue","options","disabled"]),s("label",za,c(e.$t("managers.workspaceManagement.dataPreparation.transformations.column")),1)]),s("span",Pa,[d(g,{modelValue:e.localTransformation.condition,"onUpdate:modelValue":a[1]||(a[1]=w=>e.localTransformation.condition=w),disabled:e.readOnly,options:e.availableConditions,optionLabel:e.translatedLabel,optionValue:"code",class:"kn-material-input"},null,8,["modelValue","disabled","options","optionLabel"]),s("label",$a,c(e.$t("managers.workspaceManagement.dataPreparation.transformations.conditions")),1)]),e.localTransformation.condition==="numberOfChars"?(i(),b("span",Sa,[d(x,{type:"number",modelValue:e.localTransformation.numOfChars,"onUpdate:modelValue":a[2]||(a[2]=w=>e.localTransformation.numOfChars=w),disabled:e.readOnly,class:"kn-material-input"},null,8,["modelValue","disabled"]),s("label",La,c(e.$t("managers.workspaceManagement.dataPreparation.transformations.numOfChars")),1)])):h("",!0),e.localTransformation.condition==="separator"?(i(),b("span",_a,[d(x,{type:"text",modelValue:e.localTransformation.separator,"onUpdate:modelValue":a[3]||(a[3]=w=>e.localTransformation.separator=w),disabled:e.readOnly,class:"kn-material-input"},null,8,["modelValue","disabled"]),s("label",Oa,c(e.$t("managers.workspaceManagement.dataPreparation.transformations.separator")),1)])):h("",!0)]),d(D,{legend:e.$t("managers.workspaceManagement.dataPreparation.transformations.split.outputColumn")+" 1"},{default:v(()=>[s("div",Ia,[s("span",Ua,[d(x,{type:"text",modelValue:e.localTransformation.outputColumn1,"onUpdate:modelValue":a[4]||(a[4]=w=>e.localTransformation.outputColumn1=w),disabled:e.readOnly,class:"kn-material-input"},null,8,["modelValue","disabled"]),s("label",Na,c(e.$t("common.name")),1)])])]),_:1},8,["legend"]),d(D,{legend:e.$t("managers.workspaceManagement.dataPreparation.transformations.split.outputColumn")+" 2"},{default:v(()=>[s("div",qa,[s("span",Va,[d(x,{type:"text",modelValue:e.localTransformation.outputColumn2,"onUpdate:modelValue":a[5]||(a[5]=w=>e.localTransformation.outputColumn2=w),disabled:e.readOnly,class:"kn-material-input"},null,8,["modelValue","disabled"]),s("label",Ra,c(e.$t("common.name")),1)])])]),_:1},8,["legend"])])}var ja=L(Aa,[["render",Fa]]);const Ba=S({name:"data-preparation-detail-dialog",props:{transformation:{},columns:{type:Array},col:String,readOnly:Boolean},components:{DataPreparationSimple:Ze,Dialog:F,Message:ee,DataPreparationFilter:wa,DataPreparationSplit:ja},data(){return{localCopy:{},v$:q(),validationDescriptor:Q,simpleDescriptor:I}},validations(){return{vTransformation:V("localCopy",this.validationDescriptor.validations.configuration)}},emits:["update:transformation","update:col","update:readOnly","send-transformation"],created(){this.simpleDescriptor={...I}},methods:{addNewRow(){var e,a;(a=this.localCopy)==null||a.parameters.push((e=this.localCopy)==null?void 0:e.parameters[0])},convertTransformation(){var o;let e=this.localCopy,a={parameters:[],type:e==null?void 0:e.name};if((e==null?void 0:e.name)==="filter")return this.convertFilterTransformation(e,a);if((e==null?void 0:e.name)==="split")return this.convertSplitTransformation(e,a);let t={columns:[]};return(o=e==null?void 0:e.parameters)==null||o.forEach(l=>{Object.keys(l).forEach(m=>{l.value&&!this.isToBeSkipped(m)&&(m=="name"&&l[m]=="columns"?t.columns=this.getColumns(l):t[l[m]]=l.value)})}),a.parameters.push(t),a},convertSplitTransformation(e,a){let t=e==null?void 0:e.parameters;return this.convertCustomTransformation(t,a),a},convertCustomTransformation(e,a){let t={columns:[]};Object.keys(e).forEach(o=>{o==="column"?t.columns.push(e[o].header):t[o]=e[o]}),a.parameters.push(t)},convertFilterTransformation(e,a){var t;return(t=e==null?void 0:e.parameters)==null||t.forEach(o=>{this.convertCustomTransformation(o,a)}),a},isToBeSkipped(e){return e==="value"||e==="type"||e.includes("option")||e.includes("available")||e.includes("depends")||e.includes("validation")||e.includes("placeholder")},closeDialog(){this.$emit("update:readOnly",!1),this.$emit("update:col",!1),this.$emit("update:transformation",!1)},deleteRow(e){var a,t;this.localCopy&&((a=this.localCopy.parameters)==null?void 0:a.length)>1&&((t=this.localCopy)==null||t.parameters.splice(e,1))},getColumns(e){let a=[];return Array.isArray(e.value)?e.value.forEach(t=>{a.push(t.header)}):a.push(e.value),a},handleTransformation(){let e=this.convertTransformation();this.$emit("send-transformation",e),this.closeDialog()},resetAndClose(){this.closeDialog()},updateLocalCopy(e){var a,t;((a=this.localCopy)==null?void 0:a.name)==="filter"||((t=this.localCopy)==null?void 0:t.name)==="split"?this.localCopy.parameters=e:this.localCopy=e}},watch:{transformation:{handler(e){this.localCopy=JSON.parse(JSON.stringify(e))},deep:!0}}});function Xa(e,a,t,o,l,m){const g=p("Message"),x=p("DataPreparationSimple"),D=p("DataPreparationFilter"),w=p("DataPreparationSplit"),M=p("Button"),f=p("Dialog"),r=N("t");return i(),C(f,{class:"kn-dialog--toolbar--primary dataPreparationDialog",visible:e.transformation&&e.transformation.type!="calculatedField",header:(e.localCopy&&e.localCopy.type?e.$t("managers.workspaceManagement.dataPreparation.transformations."+e.localCopy.name+".label")+" - ":"")+e.$t("managers.workspaceManagement.dataPreparation.parametersConfiguration"),closable:!1,modal:"",breakpoints:{"960px":"75vw","640px":"100vw"}},{footer:v(()=>[d(M,{class:"p-button-text kn-button thirdButton",label:e.$t("common.cancel"),onClick:e.resetAndClose},null,8,["label","onClick"]),e.readOnly?h("",!0):E((i(),C(M,{key:0,class:"kn-button kn-button--primary",onClick:e.handleTransformation},null,8,["onClick"])),[[r,"common.apply"]])]),default:v(()=>[e.localCopy&&e.localCopy.description?(i(),C(g,{key:0,severity:"info",closable:!1},{default:v(()=>[$(c(e.$t(e.localCopy.description)),1)]),_:1})):h("",!0),e.localCopy.type==="simple"?(i(),C(x,{key:1,transformation:e.localCopy,"onUpdate:transformation":e.updateLocalCopy,columns:e.columns,col:e.col,readOnly:e.readOnly},null,8,["transformation","onUpdate:transformation","columns","col","readOnly"])):h("",!0),e.localCopy.type==="filter"?(i(),C(D,{key:2,transformation:e.localCopy,"onUpdate:transformation":e.updateLocalCopy,columns:e.columns,col:e.col,readOnly:e.readOnly},null,8,["transformation","onUpdate:transformation","columns","col","readOnly"])):h("",!0),e.localCopy.type==="split"?(i(),C(w,{key:3,transformation:e.localCopy,"onUpdate:transformation":e.updateLocalCopy,columns:e.columns,col:e.col,readOnly:e.readOnly},null,8,["transformation","onUpdate:transformation","columns","col","readOnly"])):h("",!0)]),_:1},8,["visible","header"])}var Ja=L(Ba,[["render",Xa]]);const Qa=S({name:"data-preparation-detail-save-dialog",props:{originalDataset:{},config:{},columns:[],instanceId:{},processId:{},preparedDsMeta:{},visibility:Boolean},components:{Dialog:F,KnScheduler:he,KnValidationMessages:ke,Textarea:X},data(){return{descriptor:J,preparedDataset:{},v$:q(),validationDescriptor:Q,schedulerDescriptor:fe,currentCronExpression:"",isFirstSave:!0,touched:!1,schedulationPaused:!1,schedulationEnabled:!1,cronExpressionType:""}},setup(){return{store:j()}},updated(){this.processId&&this.processId!=""&&(this.isFirstSave=!1)},emits:["update:visibility","update:instanceId","update:processId"],validations(){return{preparedDataset:V("preparedDataset",this.validationDescriptor.validations.configuration)}},computed:{saveButtonDisabled(){return this.v$.$invalid||!this.preparedDataset.name}},methods:{savePreparedDataset(){let e=this.createProcessDefinition();this.saveOrUpdateProcess(e).then(a=>{let t=a.data.id;this.$emit("update:processId",t);let o=this.createDatasetDefinition();this.saveOrUpdateInstance(t,o).then(l=>{this.$emit("update:instanceId",l.data.id),this.store.setInfo({title:"Saved successfully"})},()=>{this.store.setError({title:"Save error",msg:"Cannot add process instance"})})},()=>{this.store.setError({title:"Save error",msg:"Cannot create process"})}),this.resetAndClose()},saveOrUpdateProcess(e){return this.processId&&this.processId!=""?this.$http.put(`/knowage-data-preparation/api/1.0/process/${this.processId}`,e):this.$http.post("/knowage-data-preparation/api/1.0/process",e)},saveOrUpdateInstance(e,a){return this.instanceId&&this.instanceId!=""?this.$http.post(`/knowage-data-preparation/api/1.0/instance/${this.instanceId}`,a):this.$http.post("/knowage-data-preparation/api/1.0/process/"+e+"/instance",a)},createDatasetDefinition(){let e={};e.config={},e.config.paused=this.schedulationPaused,this.schedulationEnabled&&(e.config.cron=this.currentCronExpression,e.config.type=this.cronExpressionType),e.dataSetLabel=this.originalDataset.label,e.dataSetId=this.originalDataset.id;var a=new Date;return this.preparedDataset.label?e.destinationDataSetLabel=this.preparedDataset.label:e.destinationDataSetLabel="ds__"+a.getTime()%1e7,e.destinationDataSetName=this.preparedDataset.name,e.destinationDataSetDescription=this.preparedDataset.description,e.meta=this.createMetaDefinition(),e.dsId=this.preparedDataset.id,e},createMetaDefinition(){var a;let e=[];return(a=this.columns)==null||a.forEach(t=>{let o={};o.displayedName=t.fieldAlias,o.name=t.header,o.fieldType=t.fieldType,o.type=t.Type,e.push(o)}),e},createProcessDefinition(){let e={};return this.config&&this.config.transformations&&(e.definition=this.config.transformations),e},cancel(){this.touched?this.$confirm.require({message:this.$t("common.toast.unsavedChangesHeader"),header:this.$t("common.toast.unsavedChangesMessage"),icon:"pi pi-exclamation-triangle",accept:()=>this.resetAndClose()}):this.resetAndClose()},resetAndClose(){var e,a,t,o;this.cronExpressionType=(e=this.preparedDsMeta.config)==null?void 0:e.type,this.currentCronExpression=(a=this.preparedDsMeta.config)!=null&&a.cron?this.preparedDsMeta.config.cron:"",this.schedulationPaused=((t=this.preparedDsMeta.config)==null?void 0:t.schedulationPaused)||!1,this.schedulationEnabled=!!((o=this.preparedDsMeta.config)!=null&&o.cron),this.closeDialog()},closeDialog(){this.$emit("update:visibility",!1)},loadTranslations(){this.descriptor.dataPreparation.refreshRate.options.forEach(e=>{e.name=this.$t(e.name)})},updateSchedulationPaused(e){this.schedulationPaused=e},updateSchedulationEnabled(e){this.schedulationEnabled=e},updateCurrentCronExpression(e){this.currentCronExpression=e},updateCronExpressionType(e){this.cronExpressionType=e}},watch:{preparedDsMeta:{handler(){var e,a,t,o;Object.keys(this.preparedDsMeta).length>0&&(this.preparedDataset=this.preparedDsMeta,this.cronExpressionType=(e=this.preparedDsMeta.config)==null?void 0:e.type,this.currentCronExpression=(a=this.preparedDsMeta.config)!=null&&a.cron?this.preparedDsMeta.config.cron:"",this.schedulationPaused=((t=this.preparedDsMeta.config)==null?void 0:t.schedulationPaused)||!1,this.schedulationEnabled=!!((o=this.preparedDsMeta.config)!=null&&o.cron))},deep:!0}},created(){this.loadTranslations()}}),Ya={class:"p-grid p-m-0"},Ka={class:"p-col-12"},Ha={class:"p-d-flex"},Ga={class:"p-float-label kn-flex p-mr-2"},Za={class:"kn-material-input-label",for:"label"},Wa={class:"p-float-label"},et={class:"kn-material-input-label",for:"label"},at={class:"schedulerContainer"};function tt(e,a,t,o,l,m){const g=p("InputText"),x=p("KnValidationMessages"),D=p("Textarea"),w=p("KnScheduler"),M=p("Button"),f=p("Dialog"),r=N("t");return i(),C(f,{class:"p-fluid kn-dialog--toolbar--primary dataPreparationSaveDialog",visible:e.visibility,footer:"footer",header:e.$t("managers.workspaceManagement.dataPreparation.savePreparedDataset"),closable:!1,modal:""},{footer:v(()=>[d(M,{class:"kn-button--secondary",label:e.$t("common.cancel"),onClick:e.cancel},null,8,["label","onClick"]),E(d(M,{class:"kn-button--primary",disabled:e.saveButtonDisabled,onClick:a[5]||(a[5]=k=>e.savePreparedDataset())},null,8,["disabled"]),[[r,"common.save"]])]),default:v(()=>[s("div",Ya,[s("div",Ka,[s("div",Ha,[s("span",Ga,[d(g,{class:y(["kn-material-input",{"p-invalid":e.v$.preparedDataset.name.$invalid}]),type:"text",disabled:!e.isFirstSave,modelValue:e.v$.preparedDataset.name.$model,"onUpdate:modelValue":a[0]||(a[0]=k=>e.v$.preparedDataset.name.$model=k),modelModifiers:{trim:!0},maxLength:"100",onChange:a[1]||(a[1]=k=>e.touched=!0)},null,8,["disabled","modelValue","class"]),s("label",Za,c(e.$t("managers.workspaceManagement.dataPreparation.dataset.name")),1),d(x,{vComp:e.v$.preparedDataset.name,additionalTranslateParams:{fieldName:e.$t("managers.configurationManagement.headers.name")}},null,8,["vComp","additionalTranslateParams"])])]),s("span",Wa,[d(D,{class:y(["kn-material-input p-mb-1",{"p-invalid":e.v$.preparedDataset.description.$invalid}]),type:"text",disabled:!e.isFirstSave,modelValue:e.v$.preparedDataset.description.$model,"onUpdate:modelValue":a[2]||(a[2]=k=>e.v$.preparedDataset.description.$model=k),modelModifiers:{trim:!0},rows:"3",maxLength:"10000",onBlur:a[3]||(a[3]=k=>e.touched=!0)},null,8,["disabled","modelValue","class"]),s("label",et,c(e.$t("managers.workspaceManagement.dataPreparation.dataset.description")),1),d(x,{vComp:e.v$.preparedDataset.description,additionalTranslateParams:{fieldName:e.$t("managers.configurationManagement.headers.description")}},null,8,["vComp","additionalTranslateParams"])])]),s("div",at,[d(w,{class:"p-m-1",cronExpression:e.currentCronExpression,cronExpressionType:e.cronExpressionType,descriptor:e.schedulerDescriptor,onTouched:a[4]||(a[4]=k=>e.touched=!0),logsVisible:!1,schedulationEnabled:e.schedulationEnabled,schedulationPaused:e.schedulationPaused,"onUpdate:schedulationPaused":e.updateSchedulationPaused,"onUpdate:schedulationEnabled":e.updateSchedulationEnabled,"onUpdate:currentCronExpression":e.updateCurrentCronExpression,"onUpdate:cronExpressionType":e.updateCronExpressionType},null,8,["cronExpression","cronExpressionType","descriptor","schedulationEnabled","schedulationPaused","onUpdate:schedulationPaused","onUpdate:schedulationEnabled","onUpdate:currentCronExpression","onUpdate:cronExpressionType"])])])]),_:1},8,["visible","header"])}var ot=L(Qa,[["render",tt]]);const rt=[{category:"conditional",formula:"CASE WHEN expr1 THEN expr2 [WHEN expr3 THEN expr4]* [ELSE expr5] END",help:"dataPreparation.casewhen",label:"CASE/WHEN",name:"CASE/WHEN",officialDocumentationLink:"https://spark.apache.org/docs/2.4.8/api/sql/index.html#when"},{category:"conditional",formula:"if(expr1, expr2, expr3)",help:"dataPreparation.if",label:"if",name:"if",officialDocumentationLink:"https://spark.apache.org/docs/2.4.8/api/sql/index.html#if"},{category:"conditional",formula:"nullif(expr1, expr2)",help:"dataPreparation.nullif",label:"nullif",name:"nullif",officialDocumentationLink:"https://spark.apache.org/docs/2.4.8/api/sql/index.html#nullif"},{category:"conditional",formula:"nvl(expr1, expr2)",help:"dataPreparation.nvl",label:"nvl",name:"nvl",officialDocumentationLink:"https://spark.apache.org/docs/2.4.8/api/sql/index.html#nvl"},{category:"math",formula:"abs(expr)",help:"dataPreparation.abs",label:"abs",name:"abs",officialDocumentationLink:"https://spark.apache.org/docs/2.4.8/api/sql/index.html#abs"},{category:"math",formula:"acos(expr)",help:"dataPreparation.acos",label:"acos",name:"acos",officialDocumentationLink:"https://spark.apache.org/docs/2.4.8/api/sql/index.html#acos"},{category:"math",formula:"asin(expr)",help:"dataPreparation.asin",label:"asin",name:"asin",officialDocumentationLink:"https://spark.apache.org/docs/2.4.8/api/sql/index.html#asin"},{category:"math",formula:"atan(expr)",help:"dataPreparation.atan",label:"atan",name:"atan",officialDocumentationLink:"https://spark.apache.org/docs/2.4.8/api/sql/index.html#atan"},{category:"math",formula:"cos(expr)",help:"dataPreparation.cos",label:"cos",name:"cos",officialDocumentationLink:"https://spark.apache.org/docs/2.4.8/api/sql/index.html#cos"},{category:"math",formula:"exp(expr)",help:"dataPreparation.exp",label:"exp",name:"exp",officialDocumentationLink:"https://spark.apache.org/docs/2.4.8/api/sql/index.html#exp"},{category:"math",formula:"factorial(expr)",help:"dataPreparation.factorial",label:"factorial",name:"factorial",officialDocumentationLink:"https://spark.apache.org/docs/2.4.8/api/sql/index.html#factorial"},{category:"math",formula:"floor(expr)",help:"dataPreparation.floor",label:"floor",name:"floor",officialDocumentationLink:"https://spark.apache.org/docs/2.4.8/api/sql/index.html#floor"},{category:"math",formula:"ln(expr)",help:"dataPreparation.ln",label:"ln",name:"ln",officialDocumentationLink:"https://spark.apache.org/docs/2.4.8/api/sql/index.html#ln"},{category:"math",formula:"log(base, expr)",help:"dataPreparation.log",label:"log",name:"log",officialDocumentationLink:"https://spark.apache.org/docs/2.4.8/api/sql/index.html#log"},{category:"math",formula:"pow(expr1, expr2)",help:"dataPreparation.pow",label:"pow",name:"pow",officialDocumentationLink:"https://spark.apache.org/docs/2.4.8/api/sql/index.html#pow"},{category:"math",formula:"round(expr, d)",help:"dataPreparation.round",label:"round",name:"round",officialDocumentationLink:"https://spark.apache.org/docs/2.4.8/api/sql/index.html#round"},{category:"math",formula:"sin(expr)",help:"dataPreparation.sin",label:"sin",name:"sin",officialDocumentationLink:"https://spark.apache.org/docs/2.4.8/api/sql/index.html#sin"},{category:"math",formula:"tan(expr)",help:"dataPreparation.tan",label:"tan",name:"tan",officialDocumentationLink:"https://spark.apache.org/docs/2.4.8/api/sql/index.html#tan"},{category:"string",formula:"char_length(expr)",help:"dataPreparation.char_length",label:"char_length",name:"char_length",officialDocumentationLink:"https://spark.apache.org/docs/2.4.8/api/sql/index.html#char_length"},{category:"string",formula:"coalesce(expr1, expr2, ...)",help:"dataPreparation.coalesce",label:"coalesce",name:"coalesce",officialDocumentationLink:"https://spark.apache.org/docs/2.4.8/api/sql/index.html#coalesce"},{category:"string",formula:"concat(col1, col2, ..., colN)",help:"dataPreparation.concat",label:"concat",name:"concat",officialDocumentationLink:"https://spark.apache.org/docs/2.4.8/api/sql/index.html#concat"},{category:"string",formula:"left(str, len)",help:"dataPreparation.left",label:"left",name:"left",officialDocumentationLink:"https://spark.apache.org/docs/2.4.8/api/sql/index.html#left"},{category:"string",formula:"length(expr)",help:"dataPreparation.length",label:"length",name:"length",officialDocumentationLink:"https://spark.apache.org/docs/2.4.8/api/sql/index.html#length"},{category:"string",formula:"locate(substr, str[, pos])",help:"dataPreparation.locate",label:"locate",name:"locate",officialDocumentationLink:"https://spark.apache.org/docs/2.4.8/api/sql/index.html#locate"},{category:"string",formula:"lower(str)",help:"dataPreparation.lower",label:"lower",name:"lower",officialDocumentationLink:"https://spark.apache.org/docs/2.4.8/api/sql/index.html#lower"},{category:"string",formula:"lpad(str, len, pad)",help:"dataPreparation.lpad",label:"lpad",name:"lpad",officialDocumentationLink:"https://spark.apache.org/docs/2.4.8/api/sql/index.html#lpad"},{category:"string",formula:"ltrim(str)",help:"dataPreparation.ltrim1",label:"ltrim1",name:"ltrim1",officialDocumentationLink:"https://spark.apache.org/docs/2.4.8/api/sql/index.html#ltrim1"},{category:"string",formula:"ltrim(trimStr, str)",help:"dataPreparation.ltrim2",label:"ltrim2",name:"ltrim2",officialDocumentationLink:"https://spark.apache.org/docs/2.4.8/api/sql/index.html#ltrim2"},{category:"string",formula:"replace(str, search[, replace])",help:"dataPreparation.replace",label:"replace",name:"replace",officialDocumentationLink:"https://spark.apache.org/docs/2.4.8/api/sql/index.html#replace"},{category:"string",formula:"rtrim(str)",help:"dataPreparation.rtrim1",label:"rtrim1",name:"rtrim1",officialDocumentationLink:"https://spark.apache.org/docs/2.4.8/api/sql/index.html#rtrim1"},{category:"string",formula:"rtrim(trimStr, str)",help:"dataPreparation.rtrim2",label:"rtrim2",name:"rtrim2",officialDocumentationLink:"https://spark.apache.org/docs/2.4.8/api/sql/index.html#rtrim2"},{category:"string",formula:"sha(expr)",help:"dataPreparation.sha",label:"sha",name:"sha",officialDocumentationLink:"https://spark.apache.org/docs/2.4.8/api/sql/index.html#sha"},{category:"string",formula:"substr(str, pos[, len])",help:"dataPreparation.substr",label:"substr",name:"substr",officialDocumentationLink:"https://spark.apache.org/docs/2.4.8/api/sql/index.html#substr"},{category:"string",formula:"trim(str)",help:"dataPreparation.trim",label:"trim",name:"trim",officialDocumentationLink:"https://spark.apache.org/docs/2.4.8/api/sql/index.html#trim"},{category:"string",formula:"upper(str)",help:"dataPreparation.upper",label:"upper",name:"upper",officialDocumentationLink:"https://spark.apache.org/docs/2.4.8/api/sql/index.html#upper"},{category:"temporal",formula:"add_months(start_date, num_months)",help:"dataPreparation.add_months",label:"add_months",name:"add_months",officialDocumentationLink:"https://spark.apache.org/docs/2.4.8/api/sql/index.html#add_months"},{category:"temporal",formula:"current_date()",help:"dataPreparation.current_date",label:"current_date",name:"current_date",officialDocumentationLink:"https://spark.apache.org/docs/2.4.8/api/sql/index.html#current_date"},{category:"temporal",formula:"current_timestamp()",help:"dataPreparation.current_timestamp",label:"current_timestamp",name:"current_timestamp",officialDocumentationLink:"https://spark.apache.org/docs/2.4.8/api/sql/index.html#current_timestamp"},{category:"temporal",formula:"date_add(start_date, num_days)",help:"dataPreparation.date_add",label:"date_add",name:"date_add",officialDocumentationLink:"https://spark.apache.org/docs/2.4.8/api/sql/index.html#date_add"},{category:"temporal",formula:"date_sub(start_date, num_days)",help:"dataPreparation.date_sub",label:"date_sub",name:"date_sub",officialDocumentationLink:"https://spark.apache.org/docs/2.4.8/api/sql/index.html#date_sub"},{category:"temporal",formula:"date_trunc(fmt, ts)",help:"dataPreparation.date_trunc",label:"date_trunc",name:"date_trunc",officialDocumentationLink:"https://spark.apache.org/docs/2.4.8/api/sql/index.html#date_trunc"},{category:"temporal",formula:"datediff(endDate, startDate)",help:"dataPreparation.datediff",label:"datediff",name:"datediff",officialDocumentationLink:"https://spark.apache.org/docs/2.4.8/api/sql/index.html#datediff"},{category:"temporal",formula:"day(date)",help:"dataPreparation.day",label:"day",name:"day",officialDocumentationLink:"https://spark.apache.org/docs/2.4.8/api/sql/index.html#day"},{category:"temporal",formula:"dayofmonth(date)",help:"dataPreparation.dayofmonth",label:"dayofmonth",name:"dayofmonth",officialDocumentationLink:"https://spark.apache.org/docs/2.4.8/api/sql/index.html#dayofmonth"},{category:"temporal",formula:"dayofweek(date)",help:"dataPreparation.dayofweek",label:"dayofweek",name:"dayofweek",officialDocumentationLink:"https://spark.apache.org/docs/2.4.8/api/sql/index.html#dayofweek"},{category:"temporal",formula:"dayofyear(date)",help:"dataPreparation.dayofyear",label:"dayofyear",name:"dayofyear",officialDocumentationLink:"https://spark.apache.org/docs/2.4.8/api/sql/index.html#dayofyear"},{category:"temporal",formula:"hour(timestamp)",help:"dataPreparation.hour",label:"hour",name:"hour",officialDocumentationLink:"https://spark.apache.org/docs/2.4.8/api/sql/index.html#hour"},{category:"temporal",formula:"last_day(date)",help:"dataPreparation.last_day",label:"last_day",name:"last_day",officialDocumentationLink:"https://spark.apache.org/docs/2.4.8/api/sql/index.html#last_day"},{category:"temporal",formula:"minute(timestamp)",help:"dataPreparation.minute",label:"minute",name:"minute",officialDocumentationLink:"https://spark.apache.org/docs/2.4.8/api/sql/index.html#minute"},{category:"temporal",formula:"month(date)",help:"dataPreparation.month",label:"month",name:"month",officialDocumentationLink:"https://spark.apache.org/docs/2.4.8/api/sql/index.html#month"},{category:"temporal",formula:"months_between(timestamp1, timestamp2[, roundOff])",help:"dataPreparation.months_between",label:"months_between",name:"months_between",officialDocumentationLink:"https://spark.apache.org/docs/2.4.8/api/sql/index.html#months_between"},{category:"temporal",formula:"next_day(start_date, day_of_week)",help:"dataPreparation.next_day",label:"next_day",name:"next_day",officialDocumentationLink:"https://spark.apache.org/docs/2.4.8/api/sql/index.html#next_day"},{category:"temporal",formula:"quarter(date)",help:"dataPreparation.quarter",label:"quarter",name:"quarter",officialDocumentationLink:"https://spark.apache.org/docs/2.4.8/api/sql/index.html#quarter"},{category:"temporal",formula:"second(timestamp)",help:"dataPreparation.second",label:"second",name:"second",officialDocumentationLink:"https://spark.apache.org/docs/2.4.8/api/sql/index.html#second"},{category:"temporal",formula:"timestamp(expr)",help:"dataPreparation.timestamp",label:"timestamp",name:"timestamp",officialDocumentationLink:"https://spark.apache.org/docs/2.4.8/api/sql/index.html#timestamp"},{category:"temporal",formula:"to_date(date_str[, fmt])",help:"dataPreparation.to_date",label:"to_date",name:"to_date",officialDocumentationLink:"https://spark.apache.org/docs/2.4.8/api/sql/index.html#to_date"},{category:"temporal",formula:"to_timestamp(timestamp_str[, fmt])",help:"dataPreparation.to_timestamp",label:"to_timestamp",name:"to_timestamp",officialDocumentationLink:"https://spark.apache.org/docs/2.4.8/api/sql/index.html#to_timestamp"},{category:"temporal",formula:"weekday(date)",help:"dataPreparation.weekday",label:"weekday",name:"weekday",officialDocumentationLink:"https://spark.apache.org/docs/2.4.8/api/sql/index.html#weekday"},{category:"temporal",formula:"weekofyear(date)",help:"dataPreparation.weekofyear",label:"weekofyear",name:"weekofyear",officialDocumentationLink:"https://spark.apache.org/docs/2.4.8/api/sql/index.html#weekofyear"},{category:"temporal",formula:"year(date)",help:"dataPreparation.year",label:"year",name:"year",officialDocumentationLink:"https://spark.apache.org/docs/2.4.8/api/sql/index.html#year"}],nt=[{code:"string",label:"string"},{code:"numeric",label:"numeric"},{code:"timestamp",label:"timestamp"},{code:"date",label:"date"}],it={label:"category"},lt="dataPreparation.formula",st="dataPreparation.hint",dt=[{fieldName:"colName",validators:[{key:"required"},{key:"maximumCharacters",validator:{params:{max:100},type:"maxLength"}},{key:"regex",validator:{type:"extendedAlphanumericRegex"}}]},{fieldName:"formula",validators:[{key:"required"},{key:"maximumCharacters",validator:{params:{max:1e3},type:"maxLength"}}]}];var ct={availableFunctions:rt,availableTypes:nt,category:it,formula:lt,hint:st,validations:dt};const pt=S({name:"data-preparation-detail",props:{id:Number,transformations:Array,existingProcessId:String,existingInstanceId:String,existingDataset:String},components:{Listbox:ae,KnCalculatedField:ve,Badge:te,Column:oe,DataPreparationDialog:Ja,DataPreparationSaveDialog:ot,DataTable:re,Divider:de,Dropdown:U,OverlayPanel:pe,Sidebar:ce,Menu:be},data(){return{descriptor:J,loading:0,datasetData:Array(),displayDataPreparationDialog:!1,selectedProduct:null,visibleRight:!1,visibility:!1,selectedTransformation:null,showSaveDialog:!1,showCFDialog:!1,columns:[],col:null,descriptorTransformations:Array(),dataset:{},simpleDescriptor:I,splitDescriptor:_,client:{},cfDescriptor:ct,instanceId:"",processId:"",readOnly:!1,preparedDsMeta:{},progressMode:"indeterminate",cfType:""}},setup(){return{store:j()}},async created(){if(this.loading++,this.descriptorTransformations=Object.assign([],this.descriptor.transformations),await this.$http.get("/knowage/restful-services/1.0/datasets/dataset/id/"+this.id).then(t=>{this.dataset=t.data[0]}),this.dataset){await this.initDsMetadata(),this.initTransformations();var e=new URL(window.location.origin);e.protocol=e.protocol.replace("http","ws");var a=e+"knowage-data-preparation/ws?X-Kn-Authorization="+localStorage.getItem("token");this.client=new ye({brokerURL:a,connectHeaders:{},heartbeatIncoming:4e3,heartbeatOutgoing:4e3}),this.client.onConnect=()=>{this.client.subscribe("/user/queue/preview",t=>{t.body?this.updateTable(t.body):console.log("got empty message"),this.loading--},{dsId:this.dataset.id}),this.client.subscribe("/user/queue/error",t=>{var o;if(t.body){let l=JSON.parse(t.body);this.store.setError({title:"Error",msg:l.message})}else this.store.setError({title:"Error"});this.dataset.config&&((o=this.dataset.config.transformations)==null?void 0:o.length)>0&&this.dataset.config.transformations.splice(-1),this.loading--}),this.client.subscribe("/user/queue/prepare",t=>{if(t.body){let o=JSON.parse(t.body);o.statusOk?this.store.setInfo({title:"Dataset prepared successfully"}):this.store.setError({title:"Cannot prepare dataset",msg:o.errorMessage})}else this.store.setError({title:"Websocket error",msg:"got empty message"})},{dsId:this.dataset.id}),this.transformations&&this.client.publish({destination:"/app/preview",headers:{dsId:this.dataset.id},body:JSON.stringify(this.dataset.config.transformations)})},this.client.activate()}},methods:{getFormattedDate(e,a){return ne(e,a,!0)},getProgressValue(){if(this.dataset.config&&this.dataset.config.transformations&&this.dataset.config.transformations.length&&this.dataset.config.transformations.length>1){this.progressMode="";let e=this.dataset.config.transformations.length;return 100*(e-this.loading)/e}return this.progressMode="indeterminate",0},reverseTransformations(){return this.dataset.config&&this.dataset.config.transformations?[...this.dataset.config.transformations].reverse():[]},cancelCFDialog(){this.selectedTransformation=null,this.showCFDialog=!1,this.cfType=""},saveCFDialog(e){let a=this.convertCFTransformation(e);this.handleTransformation(a),this.showCFDialog=!1},convertCFTransformation(e){let a={parameters:[],type:"calculatedField"},t={columns:[]};return Object.keys(e).forEach(o=>{o==="column"?t.columns.push(e[o].header):t[o]=e[o]}),this.cfDescriptor.availableTypes&&(t.type=this.cfType),a.parameters.push(t),a},calculateDisabledProperty(e){if(this.loading>0)return!0;let a=!1;return e.type==="advancedFilter"&&(this.dataset.config?a=this.dataset.config.transformations.filter(t=>t.type==="filter").length<2:a=!0),a},changeAlias(e){e.editing?delete e.editing:e.editing=!0},closeTemplate(){this.$router.go(-1)},refreshOriginalDataset(){this.$http.post(`/knowage/restful-services/1.0/data-preparation/prepare/${this.dataset.id}`,{},{headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json;charset=UTF-8"}}).then(()=>{this.store.setInfo({title:this.$t("workspace.myData.isPreparing")})}).catch(()=>{}),this.client.publish({destination:"/app/prepare",body:this.dataset.id})},openTransformationDetail(e){this.readOnly=!0;let a=this.descriptorTransformations.filter(o=>o.name==e.type)[0];a.parameters=[];let t=e.parameters[0];if(Object.keys(t).forEach(o=>{let l={};if(l.name=o,o=="columns"){let m=[];for(let g=0;g<t[o].length;g++){let x=this.columns.filter(D=>D.fieldAlias.toUpperCase()===t[o][g].toUpperCase())[0];m.push(x)}l.value=m}else l.value=t[o];e.type==="calculatedField"&&this.cfDescriptor.availableTypes&&(this.cfType=e.parameters[0].type),a.parameters.push(l)}),e.type=="filter"||e.type=="split"){let o=this.columns.filter(l=>l.fieldAlias.toUpperCase()===e.parameters[0].columns[0].toUpperCase())[0];this.callFunction(a,o)}else this.callFunction(a,void 0)},getTransformationsMenu(e){return this.descriptorTransformations.filter(a=>a.editColumn&&!a.hidden).filter(a=>{var t;return a.incompatibleDataTypes?!((t=a.incompatibleDataTypes)!=null&&t.includes(e.Type)):!0})},initTransformations(){this.transformations&&(this.dataset.config||(this.dataset.config={}),this.dataset.config.transformations=this.transformations,this.loading++)},async initDsMetadata(){if(this.existingProcessId&&(this.processId=this.existingProcessId),this.existingInstanceId&&(this.instanceId=this.existingInstanceId),this.existingDataset){let e=JSON.parse(this.existingDataset),a={};a.label=e.label,a.name=e.name,a.description=e.description,a.id=e.id,await this.$http.get("/knowage-data-preparation/api/1.0/process/by-destination-data-set/"+e.id).then(t=>{let o=t.data.instance;o.config&&(a.config=o.config)}),this.preparedDsMeta=a}},getColHeader(e,a){let t="column_"+a;return e.filter(l=>l.mappedTo==t)[0].alias},callFunction(e,a){if(e.name==="changeType"||e.name==="split"){let o=e.name==="changeType"?this.simpleDescriptor[e.name].parameters:this.splitDescriptor.parameters;for(var t=0;t<o.length;t++){let l=o[t];(l.name==="destType"||l.name==="destType1"||l.name==="destType2")&&(l.availableOptions=a?this.getCompatibilityType(a):this.descriptor.compatibilityMap.all.values,l.availableOptions.forEach(m=>{m.label=this.removePrefixFromType(m.label)}))}this.selectedTransformation=e,a&&(this.col=a.header)}else e.name==="drop"&&a?this.$confirm.require({message:this.$t("common.toast.deleteMessage"),header:this.$t("common.toast.deleteTitle"),icon:"pi pi-exclamation-triangle",accept:()=>{let o=this.simpleDescriptor[e.name].parameters[0];o.value=a.header,e.parameters=[],e.parameters.push(o);let l={parameters:[],type:"drop"},m={columns:[]};m.columns.push(a.header),l.parameters.push(m),this.handleTransformation(l)}}):(this.selectedTransformation=e,a&&(this.col=a.header),e.name==="calculatedField"&&(this.showCFDialog=!0))},handleTransformation(e){this.dataset.config||(this.dataset.config={}),this.dataset.config.transformations||(this.dataset.config.transformations=[]),this.dataset.config.transformations.push(e),this.loading++,this.client.publish({destination:"/app/preview",headers:{dsId:this.dataset.id},body:JSON.stringify(this.dataset.config.transformations)})},toggleSidebarVisibility(){this.visibleRight=!0},deleteTransformation(e){e?this.dataset.config.transformations.splice(e,1):this.dataset.config.transformations.splice(-1),this.loading++,this.client.publish({destination:"/app/preview",headers:{dsId:this.dataset.id},body:JSON.stringify(this.dataset.config.transformations)})},getCompatibilityType(e){return this.descriptor.compatibilityMap[e.Type].values},toggle(e,a){this.$refs[a].toggle(e)},getMenuForToolbar(){let e=this.descriptorTransformations.filter(t=>t.toolbar&&!t.hidden).sort(function(t,o){return t.position>o.position?1:t.position<o.position?-1:0}),a=[];if(e.length>0){let t=e[0].category;a.push(e[0]);for(let o=1;o<e.length;o++)t!==e[o].category&&(t=e[o].category,a.push("divider")),a.push(e[o])}return a},removePrefixFromType(e){let a=e.split(".",-1);return a.length>0?a[a.length-1]:a[0]},saveDataset(){this.showSaveDialog=!0},translateRoles(){let e=this.descriptor.roles;return e.forEach(a=>a.label=this.$t(a.label)),e},switchEditMode(e){e.edit=!e.edit},updateReadOnly(e){this.readOnly=e},updateInstanceId(e){this.instanceId=e},updateprocessId(e){this.processId=e},updateTable(e){let a=JSON.parse(e),t=a.metadata.columns;this.columns=[];for(let o=0;o<t.length;o++){let l={};l.Type=t[o].type,l.disabled=!1,l.fieldAlias=t[o].alias,l.fieldType=t[o].fieldType,l.header=t[o].name,this.columns.push(l)}this.datasetData=[],a.rows.forEach(o=>{let l={};for(let m=0;m<o.length;m++){let g=this.getColHeader(t,m);l[g]=o[m]}this.datasetData.push(l)})}},unmounted(){Object.keys(this.client).length>0&&(this.client.deactivate(),this.client={})}}),bt={class:"kn-page kn-data-preparation"},kt={class:"p-col-4"},mt={key:0,class:"p-float-label p-field p-ml-2 kn-flex"},ut={class:"kn-material-input-label"},gt={class:"arrow-button-container"},ht={class:"kn-page-content p-grid p-m-0 managerDetail"},ft={class:"info-container"},vt={class:"original-dataset"},yt=s("i",{class:"fa fa-database p-mr-2"},null,-1),wt={class:"titleContainer"},xt={class:"kn-truncated"},Mt={class:"p-text-uppercase kn-list-item transformationSidebarElement"},Ct={key:0},At={key:1},Dt={class:"p-float-label"},Tt={class:"aliasAndType p-ml-2"},Et=["onUpdate:modelValue","onBlur","onKeydown"],zt=["onClick"],Pt={class:"kn-list-item-text-secondary kn-truncated roleType"},$t=["onClick"],St=$(),Lt={class:"p-ml-2"},_t={key:0},Ot={key:1},It={key:2};function Ut(e,a,t,o,l,m){const g=p("Dropdown"),x=p("KnCalculatedField"),D=p("DataPreparationDialog"),w=p("DataPreparationSaveDialog"),M=p("Button"),f=p("Toolbar"),r=p("Divider"),k=p("Badge"),A=p("ProgressBar"),Y=p("Listbox"),K=p("Sidebar"),H=p("OverlayPanel"),G=p("Menu"),Z=p("Column"),W=p("DataTable"),z=N("tooltip");return i(),b("div",bt,[d(x,{visibility:e.showCFDialog,"onUpdate:visibility":a[1]||(a[1]=n=>e.showCFDialog=n),onSave:e.saveCFDialog,onCancel:e.cancelCFDialog,fields:e.columns,descriptor:e.cfDescriptor,propCalcFieldFunctions:e.cfDescriptor.availableFunctions,readOnly:e.readOnly,"onUpdate:readOnly":e.updateReadOnly,template:e.selectedTransformation,"onUpdate:template":a[2]||(a[2]=n=>e.selectedTransformation=n),valid:e.cfType!==""},{additionalInputs:v(()=>[s("div",kt,[e.cfDescriptor.availableTypes?(i(),b("span",mt,[d(g,{modelValue:e.cfType,"onUpdate:modelValue":a[0]||(a[0]=n=>e.cfType=n),options:e.cfDescriptor.availableTypes,disabled:e.readOnly,class:y(["kn-material-input",{"p-invalid":!e.cfType}]),optionLabel:"label",optionValue:"code"},null,8,["modelValue","options","disabled","class"]),s("label",ut,c(e.$t("components.knCalculatedField.type")),1)])):h("",!0)])]),_:1},8,["visibility","onSave","onCancel","fields","descriptor","propCalcFieldFunctions","readOnly","onUpdate:readOnly","template","valid"]),d(D,{transformation:e.selectedTransformation,"onUpdate:transformation":a[3]||(a[3]=n=>e.selectedTransformation=n),onSendTransformation:e.handleTransformation,columns:e.columns,col:e.col,"onUpdate:col":a[4]||(a[4]=n=>e.col=n),readOnly:e.readOnly,"onUpdate:readOnly":e.updateReadOnly},null,8,["transformation","onSendTransformation","columns","col","readOnly","onUpdate:readOnly"]),d(w,{visibility:e.showSaveDialog,"onUpdate:visibility":a[5]||(a[5]=n=>e.showSaveDialog=n),originalDataset:e.dataset,config:e.dataset.config,columns:e.columns,instanceId:e.instanceId,"onUpdate:instanceId":e.updateInstanceId,processId:e.processId,"onUpdate:processId":e.updateprocessId,preparedDsMeta:e.preparedDsMeta},null,8,["visibility","originalDataset","config","columns","instanceId","onUpdate:instanceId","processId","onUpdate:processId","preparedDsMeta"]),d(f,{class:"kn-toolbar kn-toolbar--primary p-m-0"},{start:v(()=>[$(c(e.$t("managers.workspaceManagement.dataPreparation.label"))+" ("+c(e.$t("managers.workspaceManagement.dataPreparation.originalDataset"))+": "+c(e.dataset.name)+")",1)]),end:v(()=>[E(d(M,{icon:"pi pi-refresh",class:"p-button-text p-button-rounded p-button-plain",onClick:e.refreshOriginalDataset,disabled:e.loading>0},null,8,["onClick","disabled"]),[[z,e.$t("common.refresh"),void 0,{bottom:!0}]]),E(d(M,{icon:"pi pi-save",class:"p-button-text p-button-rounded p-button-plain",onClick:e.saveDataset,disabled:e.loading>0},null,8,["onClick","disabled"]),[[z,e.$t("common.save"),void 0,{bottom:!0}]]),E(d(M,{icon:"pi pi-times",class:"p-button-text p-button-rounded p-button-plain",onClick:a[6]||(a[6]=n=>e.closeTemplate())},null,512),[[z,e.$t("common.close"),void 0,{bottom:!0}]])]),_:1}),d(f,{class:"kn-toolbar kn-toolbar--secondary p-m-0 toolbarCustomConfig"},{start:v(()=>[(i(!0),b(P,null,O(e.getMenuForToolbar(),(n,T)=>(i(),b(P,{key:T},[n!=="divider"?E((i(),C(M,{key:0,class:y(e.descriptor.css.buttonClassHeader),onClick:u=>e.callFunction(n),disabled:e.calculateDisabledProperty(n)},{default:v(()=>[n.icon.class?(i(),b("span",{key:0,class:y(n.icon.class)},c(n.icon.name),3)):(i(),b("i",{key:1,class:y(n.icon)},null,2))]),_:2},1032,["class","onClick","disabled"])),[[z,e.$t(n.label),void 0,{bottom:!0}]]):(i(),C(r,{key:1,layout:"vertical"}))],64))),128))]),end:v(()=>[s("div",gt,[d(M,{icon:"pi pi-arrow-left",class:y(e.descriptor.css.buttonClassHeader),style:{overflow:"visible"},onClick:a[7]||(a[7]=n=>e.toggleSidebarVisibility())},null,8,["class"]),e.dataset.config&&e.dataset.config.transformations&&e.dataset.config.transformations.length>0?(i(),C(k,{key:0,class:"arrow-badge",value:e.dataset.config&&e.dataset.config.transformations&&e.dataset.config.transformations.length},null,8,["value"])):h("",!0)])]),_:1}),e.loading>0?(i(),b(P,{key:0},[e.progressMode==="indeterminate"?(i(),C(A,{key:0,class:"kn-progress-bar",mode:e.progressMode,value:e.getProgressValue()},null,8,["mode","value"])):(i(),C(A,{key:1,class:"kn-progress-bar",value:e.getProgressValue()},null,8,["value"]))],64)):h("",!0),d(r,{class:"kn-divider dividerCustomConfig"}),s("div",ht,[d(K,{visible:e.visibleRight,"onUpdate:visible":a[9]||(a[9]=n=>e.visibleRight=n),position:"right",class:"kn-data-preparation-sidenav"},{default:v(()=>[s("div",ft,[s("div",vt,[yt,s("span",null,c(e.$t("managers.workspaceManagement.dataPreparation.originalDataset")),1),$(": "+c(e.dataset.label),1)])]),s("div",wt,[s("h4",xt,c(e.$t("managers.workspaceManagement.dataPreparation.transformations.label")),1)]),d(r,{class:"p-m-0 p-p-0 dividerCustomConfig"}),d(Y,{class:"kn-list kn-flex kn-list-no-border-right",options:e.reverseTransformations(),optionLabel:"type"},{option:v(n=>[s("div",Mt,[n.option.type!="calculatedField"?(i(),b("div",Ct,c(n.option.type)+" - "+c(n.option.parameters[0].columns[0]),1)):(i(),b("div",At,c(n.option.type)+" - "+c(n.option.parameters[0].colName),1)),s("div",null,[n.option.type!="trim"&&n.option.type!="drop"?E((i(),C(M,{key:0,icon:"fas fa-eye",class:y(e.descriptor.css.buttonClassHeader),onClick:T=>e.openTransformationDetail(n.option)},null,8,["class","onClick"])),[[z,e.$t("common.preview")]]):h("",!0),n.index==0?E((i(),C(M,{key:1,icon:"p-jc-end pi pi-trash",class:y(e.descriptor.css.buttonClassHeader),onClick:a[8]||(a[8]=T=>e.deleteTransformation()),disabled:e.loading>0},null,8,["class","disabled"])),[[z,e.$t("common.delete")]]):h("",!0)])])]),_:1},8,["options"])]),_:1},8,["visible"]),d(W,{ref:"dt",value:e.datasetData,class:"p-datatable-sm kn-table data-prep-table",dataKey:"id",paginator:e.datasetData.length>20,rows:20,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",breakpoint:"960px",currentPageReportTemplate:e.$t("common.table.footer.paginated",{first:"{first}",last:"{last}",totalRecords:"{totalRecords}"}),loading:e.loading>0,resizableColumns:!0,columnResizeMode:"expand",showGridlines:"",responsiveLayout:"scroll",scrollable:!0,scrollDirection:"both"},{empty:v(()=>[$(c(e.$t("common.info.noDataFound")),1)]),loading:v(()=>[$(c(e.$t("common.info.dataLoading")),1)]),default:v(()=>[(i(!0),b(P,null,O(e.columns,(n,T)=>(i(),C(Z,{field:n.header,key:T,style:{width:"200px"}},{header:v(()=>[n.fieldType?(i(),C(M,{key:0,class:y(e.descriptor.css.buttonClassHeader),onClick:u=>e.toggle(u,"opType-"+T)},{default:v(()=>[e.descriptor.roles.filter(u=>u.code===n.fieldType)[0].icon.class?(i(),b("span",{key:0,class:y(e.descriptor.roles.filter(u=>u.code===n.fieldType)[0].icon.class)},c(e.descriptor.roles.filter(u=>u.code===n.fieldType)[0].icon.name),3)):(i(),b("i",{key:1,class:y(e.descriptor.roles.filter(u=>u.code===n.fieldType)[0].icon)},null,2))]),_:2},1032,["class","onClick"])):h("",!0),d(H,{ref_for:!0,ref:"opType-"+T,popup:!0},{default:v(()=>[s("span",Dt,[d(g,{modelValue:n.fieldType,"onUpdate:modelValue":u=>n.fieldType=u,options:e.translateRoles(),optionLabel:"label",optionValue:"code",class:"kn-material-input"},null,8,["modelValue","onUpdate:modelValue","options"])])]),_:2},1536),s("div",Tt,[n.editing?E((i(),b("input",{key:0,class:"kn-input-text-sm",type:"text","onUpdate:modelValue":u=>n.fieldAlias=u,onBlur:u=>e.changeAlias(n),onKeydown:le(u=>e.changeAlias(n),["enter"])},null,40,Et)),[[ie,n.fieldAlias]]):(i(),b("span",{key:1,class:"kn-clickable",onClick:u=>e.changeAlias(n)},c(n.fieldAlias),9,zt)),s("span",Pt,c(e.$t(e.removePrefixFromType(n.Type))),1)]),d(M,{icon:"pi pi-ellipsis-v",class:y(e.descriptor.css.buttonClassHeader),onClick:u=>e.toggle(u,"trOpType-"+T)},null,8,["class","onClick"]),d(G,{model:e.getTransformationsMenu(n),ref_for:!0,ref:"trOpType-"+T,popup:!0},{item:v(({item:u})=>[s("span",{class:y(["p-menuitem-link","toolbarCustomConfig",e.descriptor.css.buttonClassHeader]),onClick:Nt=>e.callFunction(u,n)},[u.icon.class?(i(),b("span",{key:0,class:y([u.icon.class,"menu-icon"])},c(u.icon.name),3)):(i(),b("i",{key:1,class:y(u.icon)},null,2)),St,s("span",Lt,c(e.$t(u.label)),1)],10,$t)]),_:2},1032,["model"])]),body:v(({data:u})=>[n.Type.toLowerCase().includes("time")?(i(),b("span",_t,c(e.getFormattedDate(u[n.header],{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})),1)):n.Type.toLowerCase().includes("date")?(i(),b("span",Ot,c(e.getFormattedDate(u[n.header],{year:"numeric",month:"2-digit",day:"2-digit"})),1)):(i(),b("span",It,c(u[n.header]),1))]),_:2},1032,["field"]))),128))]),_:1},8,["value","paginator","currentPageReportTemplate","loading"])])])}var to=L(pt,[["render",Ut]]);export{to as default};
//# sourceMappingURL=DataPreparationDetail-d6feefbd.js.map
