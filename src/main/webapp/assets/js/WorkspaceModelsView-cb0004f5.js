import{m as O}from"./WorkspaceDescriptor-d4693b02.js";import{d as V,l as q,n as X,x as $,s as T,_ as Q,r as a,y as j,o,h as i,w as b,f as d,g as I,t as w,D as y,c as v,C as F,B as A,a as m,A as c,z as B,V as z,X as K,q as J}from"./index-1e676509.js";import{D as R,W as Y}from"./WorkspaceCard-6d9360d0.js";import{s as G}from"./selectbutton.esm-1085ac65.js";import{f as S}from"./filterHelper-a723991a.js";import{s as Z}from"./menu.esm-6bee86d0.js";import{Q as _}from"./QBE-95a8c4bc.js";import{s as H}from"./multiselect.esm-ce4000f7.js";import"./sidebar.esm-2131cfd1.js";import"./contextmenu.esm-4301c9fe.js";import"./chip.esm-057ba1f1.js";import"./inputswitch.esm-80317a38.js";import"./calendar.esm-60a451ba.js";import"./chips.esm-693c3c01.js";import"./checkbox.esm-fa6c8259.js";import"./KnValidatonMessages-ebe48c72.js";import"./KnCronDescriptor-98645843.js";import"./KnParameterSidebar-7c5f3d6f.js";import"./tree.esm-837306a6.js";import"./radiobutton.esm-c3e6fa9b.js";import"./KnCalculatedField-ab0b2f81.js";import"./KnHint-6d455703.js";const P=[{field:"name",header:"common.name"},{field:"description",header:"common.description"}],tt={style:{"text-align":"end",width:"10%"}},et={message:{"align-items":"center",display:"flex","justify-content":"center","text-align":"center"}};var at={columns:P,iconColumn:tt,styles:et};const ot=V({name:"workspace-models-table",components:{Column:q,DataTable:X,Menu:Z},props:{propItems:{type:Array}},emits:["openDatasetInQBEClick","editDatasetClick","deleteDatasetClick","selected"],data(){return{workspaceModelsTableDescriptor:at,items:[],columns:[],filters:{name:{operator:$.AND,constraints:[S]},description:{operator:$.AND,constraints:[S]}},menuItems:[],user:null}},watch:{propItems(){this.loadTable()}},setup(){return{store:T()}},created(){this.user=this.store.$state.user,this.loadTable()},methods:{loadTable(){this.loadItems()},loadItems(){this.items=this.propItems},canDeleteFederation(t){return this.user.isSuperadmin||this.user.userId===t.owner},openDatasetInQBE(t){this.$emit("openDatasetInQBEClick",t)},editDataset(t){this.$emit("editDatasetClick",t)},deleteDataset(t){this.$emit("deleteDatasetClick",t)},toggle(t,e){this.createMenuItems(e),this.$refs.menu.toggle(t)},createMenuItems(t){this.menuItems=[],this.menuItems.push({icon:"pi pi-pencil",label:this.$t("workspace.myModels.editDataset"),command:()=>this.editDataset(t)}),this.canDeleteFederation(t)&&this.menuItems.push({icon:"fas fa-trash-alt",label:this.$t("workspace.myModels.deleteDataset"),command:()=>this.deleteDataset(t)})}}}),rt={class:"p-d-flex p-flex-row p-jc-end"},nt={key:0,class:"p-d-flex p-flex-row"};function dt(t,e,l,p,f,N){const k=a("Message"),x=a("InputText"),g=a("Column"),u=a("Button"),M=a("Menu"),C=a("DataTable"),h=j("tooltip");return o(),i(C,{value:t.items,id:"models-table",class:"p-datatable-sm kn-table",filters:t.filters,"onUpdate:filters":e[0]||(e[0]=n=>t.filters=n),filterDisplay:"menu",dataKey:"name",responsiveLayout:"stack",breakpoint:"960px"},{empty:b(()=>[d(k,{class:"p-m-2",severity:"info",closable:!1,style:y(t.workspaceModelsTableDescriptor.styles.message)},{default:b(()=>[I(w(t.$t("common.info.noDataFound")),1)]),_:1},8,["style"])]),default:b(()=>[(o(!0),v(A,null,F(t.workspaceModelsTableDescriptor.columns,n=>(o(),i(g,{class:"kn-truncated",field:n.field,header:t.$t(n.header),key:n.field,sortable:!0},{filter:b(({filterModel:s})=>[d(x,{type:"text",modelValue:s.value,"onUpdate:modelValue":D=>s.value=D,class:"p-column-filter"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["field","header"]))),128)),d(g,{style:y(t.workspaceModelsTableDescriptor.iconColumn.style)},{body:b(n=>[m("div",rt,[n.data.type==="federatedDataset"?(o(),v("div",nt,[d(u,{icon:"fas fa-ellipsis-v",class:"p-button-link",onClick:s=>t.toggle(s,n.data)},null,8,["onClick"]),d(M,{ref:"menu",model:t.menuItems,popup:!0},null,8,["model"])])):c("",!0),B(d(u,{icon:"fas fa-info-circle",class:"p-button-link",onClick:z(s=>t.$emit("selected",n.data),["stop"]),"data-test":"info-button-"+n.data.name},null,8,["onClick","data-test"]),[[h,t.$t("workspace.myModels.showInfo"),void 0,{left:!0}]]),B(d(u,{icon:"fas fa-search",class:"p-button-link",onClick:z(s=>t.openDatasetInQBE(n.data),["stop"])},null,8,["onClick"]),[[h,t.$t("workspace.myModels.openInQBE"),void 0,{left:!0}]])])]),_:1},8,["style"])]),_:1},8,["value","filters"])}var it=Q(ot,[["render",dt]]);const lt=V({name:"workspace-models-view",components:{MultiSelect:H,DetailSidebar:R,KnFabButton:K,Message:J,SelectButton:G,WorkspaceModelsTable:it,WorkspaceCard:Y,QBE:_},emits:["showMenu","toggleDisplayView","showQbeDialog"],props:{toggleCardDisplay:{type:Boolean}},data(){return{mainDescriptor:O,selectedCategories:[],selectedCategoryIds:[],businessModels:[],federatedDatasets:[],allItems:[],filteredItems:[],tableMode:"All",selectButtonOptions:["Business"],selectedModel:null,searchWord:"",showDetailSidebar:!1,user:null,loading:!1,datasetDrivers:null,datasetName:"",qbeVisible:!1,selectedQbeDataset:null,modelCategories:[]}},computed:{hasEnableFederatedDatasetFunctionality(){return this.user&&this.user.functionalities?this.user.functionalities.includes("EnableFederatedDataset"):!1}},watch:{tableMode(){this.resetSearch(),this.selectedModel=null}},setup(){return{store:T()}},async created(){this.user=this.store.$state.user,await this.getModelCategories(),await this.loadBusinessModels(),this.hasEnableFederatedDatasetFunctionality&&(await this.loadFederatedDatasets(),this.selectButtonOptions.push("Federated"),this.selectButtonOptions.push("All")),this.loadAllItems()},methods:{loadAllItems(){this.allItems=[...this.businessModels,...this.federatedDatasets],this.filteredItems=[...this.allItems]},async loadBusinessModels(){this.loading=!0,await this.$http.get("/knowage/restful-services/2.0/businessmodels/?fileExtension=jar").then(t=>{this.businessModels=t.data,this.businessModels=this.businessModels.map(e=>({...e,type:"businessModel"}))}),this.loading=!1},async loadFederatedDatasets(){this.loading=!0,await this.$http.get("/knowage/restful-services/federateddataset/").then(t=>{this.federatedDatasets=t.data,this.federatedDatasets=this.federatedDatasets.map(e=>({...e,type:"federatedDataset"}))}),this.loading=!1},async getModelCategories(){return this.loading=!0,this.$http.get("/knowage/restful-services/domainsforfinaluser/bm-categories").then(t=>{this.modelCategories=[...t.data]})},searchItems(t){setTimeout(()=>{if(t!=null&&t.value&&(this.selectedCategoryIds=[],t.value.forEach(e=>{this.selectedCategoryIds.push(e.VALUE_ID)})),!this.searchWord.trim().length&&this.selectedCategoryIds.length==0)this.filteredItems=[...this.allItems];else{let e=[];this.tableMode==="Business"?e=this.businessModels:this.tableMode==="Federated"?e=this.federatedDatasets:e=this.allItems,this.selectedCategoryIds.length>0?this.filteredItems=e.filter(l=>{var p,f;return this.selectedCategoryIds.includes(l.category)&&(((p=l.name)==null?void 0:p.toLowerCase().includes(this.searchWord.toLowerCase()))||((f=l.description)==null?void 0:f.toLowerCase().includes(this.searchWord.toLowerCase())))}):this.filteredItems=e.filter(l=>{var p,f;return((p=l.name)==null?void 0:p.toLowerCase().includes(this.searchWord.toLowerCase()))||((f=l.description)==null?void 0:f.toLowerCase().includes(this.searchWord.toLowerCase()))})}},250)},resetSearch(){this.searchWord=""},openDatasetInQBE(t){this.selectedQbeDataset=t,this.qbeVisible=!0},createNewFederation(){this.$router.push("models/federation-definition/new-federation")},editDataset(t){this.$router.push(`models/federation-definition/${t.federation_id}`)},deleteDatasetConfirm(t){this.$confirm.require({message:this.$t("common.toast.deleteMessage"),header:this.$t("common.toast.deleteTitle"),icon:"pi pi-exclamation-triangle",accept:async()=>await this.deleteDataset(t)})},async deleteDataset(t){this.loading=!0,await this.$http.delete(`/knowage/restful-services/2.0/federateddataset/${t.federation_id}`).then(async()=>{this.store.setInfo({title:this.$t("common.toast.deleteTitle"),msg:this.$t("common.toast.success")}),this.showDetailSidebar=!1,await this.reloadFederatedDatasets()}).catch(()=>{}),this.loading=!1},async reloadFederatedDatasets(){await this.loadFederatedDatasets(),this.loadAllItems(),this.filteredItems=[...this.federatedDatasets]},setSelectedModel(t){this.selectedModel=t,this.showDetailSidebar=!0},toggleDisplayView(){this.$emit("toggleDisplayView")},onTableModeChange(){switch(this.selectedCategoryIds=[],this.selectedCategories=[],this.tableMode){case"Business":this.filteredItems=[...this.businessModels];break;case"Federated":this.filteredItems=[...this.federatedDatasets];break;case"All":this.filteredItems=[...this.allItems]}},closeQbe(){this.qbeVisible=!1,this.selectedQbeDataset=null}}}),st={class:"p-d-flex p-flex-row p-ai-center p-flex-wrap"},ct={class:"p-float-label p-mr-auto model-search"},bt={class:"kn-material-input-label"},pt={class:"p-m-2 kn-overflow"},ft={key:1,class:"p-grid p-m-2","data-test":"card-container"};function kt(t,e,l,p,f,N){const k=a("Button"),x=a("KnFabButton"),g=a("Toolbar"),u=a("ProgressBar"),M=a("InputText"),C=a("MultiSelect"),h=a("SelectButton"),n=a("WorkspaceModelsTable"),s=a("Message"),D=a("WorkspaceCard"),U=a("DetailSidebar"),W=a("QBE");return o(),v(A,null,[d(g,{class:"kn-toolbar kn-toolbar--secondary p-d-flex p-flex-row"},{start:b(()=>[d(k,{id:"showSidenavIcon",icon:"fas fa-bars",class:"p-button-text p-button-rounded p-button-plain",onClick:e[0]||(e[0]=r=>t.$emit("showMenu"))}),I(" "+w(t.$t("workspace.myModels.title")),1)]),end:b(()=>[t.toggleCardDisplay?(o(),i(k,{key:0,icon:"fas fa-list",class:"p-button-text p-button-rounded p-button-plain",onClick:t.toggleDisplayView},null,8,["onClick"])):c("",!0),t.toggleCardDisplay?c("",!0):(o(),i(k,{key:1,icon:"fas fa-th-large",class:"p-button-text p-button-rounded p-button-plain",onClick:t.toggleDisplayView},null,8,["onClick"])),t.tableMode==="Federated"?(o(),i(x,{key:2,icon:"fas fa-plus",onClick:t.createNewFederation},null,8,["onClick"])):c("",!0)]),_:1}),t.loading?(o(),i(u,{key:0,mode:"indeterminate",class:"kn-progress-bar"})):c("",!0),m("div",st,[d(M,{class:"kn-material-input p-m-3 model-search",modelValue:t.searchWord,"onUpdate:modelValue":e[1]||(e[1]=r=>t.searchWord=r),placeholder:t.$t("common.search"),onInput:t.searchItems,"data-test":"search-input"},null,8,["modelValue","placeholder","onInput"]),m("span",ct,[d(C,{class:"kn-material-input kn-width-full",style:y(t.mainDescriptor.style.multiselect),modelValue:t.selectedCategories,"onUpdate:modelValue":e[2]||(e[2]=r=>t.selectedCategories=r),options:t.modelCategories,optionLabel:"VALUE_CD",onChange:t.searchItems,filter:!0},null,8,["style","modelValue","options","onChange"]),m("label",bt,w(t.$t("common.type")),1)]),d(h,{class:"p-mx-2",modelValue:t.tableMode,"onUpdate:modelValue":e[3]||(e[3]=r=>t.tableMode=r),options:t.selectButtonOptions,onClick:t.onTableModeChange},null,8,["modelValue","options","onClick"])]),m("div",pt,[t.toggleCardDisplay?c("",!0):(o(),i(n,{key:0,propItems:t.filteredItems,onSelected:t.setSelectedModel,onOpenDatasetInQBEClick:t.openDatasetInQBE,onEditDatasetClick:t.editDataset,onDeleteDatasetClick:t.deleteDatasetConfirm,"data-test":"models-table"},null,8,["propItems","onSelected","onOpenDatasetInQBEClick","onEditDatasetClick","onDeleteDatasetClick"])),t.toggleCardDisplay?(o(),v("div",ft,[t.filteredItems.length===0?(o(),i(s,{key:0,class:"kn-flex p-m-2",severity:"info",closable:!1,style:y(t.mainDescriptor.style.message)},{default:b(()=>[I(w(t.$t("common.info.noDataFound")),1)]),_:1},8,["style"])):(o(!0),v(A,{key:1},F(t.filteredItems,(r,L)=>(o(),i(D,{key:L,viewType:r&&r.federation_id?"federationDataset":"businessModel",document:r,onOpenSidebar:t.setSelectedModel,onOpenDatasetInQBE:e[4]||(e[4]=E=>t.openDatasetInQBE(E)),onEditDataset:t.editDataset,onDeleteDataset:t.deleteDatasetConfirm,onMonitoring:e[5]||(e[5]=E=>t.showMonitoring=!t.showMonitoring)},null,8,["viewType","document","onOpenSidebar","onEditDataset","onDeleteDataset"]))),128))])):c("",!0)]),d(U,{visible:t.showDetailSidebar,viewType:t.selectedModel&&t.selectedModel.federation_id?"federationDataset":"businessModel",document:t.selectedModel,onOpenDatasetInQBE:e[6]||(e[6]=r=>t.openDatasetInQBE(r)),onEditDataset:t.editDataset,onDeleteDataset:t.deleteDatasetConfirm,onMonitoring:e[7]||(e[7]=r=>t.showMonitoring=!t.showMonitoring),onClose:e[8]||(e[8]=r=>t.showDetailSidebar=!1),"data-test":"detail-sidebar"},null,8,["visible","viewType","document","onEditDataset","onDeleteDataset"]),t.qbeVisible?(o(),i(W,{key:1,visible:t.qbeVisible,dataset:t.selectedQbeDataset,onClose:t.closeQbe},null,8,["visible","dataset","onClose"])):c("",!0)],64)}var Nt=Q(lt,[["render",kt],["__scopeId","data-v-f360b7dc"]]);export{Nt as default};
//# sourceMappingURL=WorkspaceModelsView-cb0004f5.js.map
