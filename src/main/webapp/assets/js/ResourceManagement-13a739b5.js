import{d as F,i as B,a5 as L,s as z,m as X,_ as $,r as l,y as N,o as c,c as k,f as r,w as d,g as w,t as s,a as i,z as A,A as p,p as O,b as R,q as _,h,G as S,l as Q,n as P,F as U,x as V,I as Y,bb as J,W as H,B as W,C as G,E as Z,D as q,aY as ee,N as ae}from"./index-1e676509.js";import{s as oe}from"./tree.esm-837306a6.js";import{s as j}from"./inputswitch.esm-80317a38.js";import{s as te}from"./textarea.esm-32051d54.js";import{s as re,a as ne}from"./accordiontab.esm-2c1b3232.js";import{s as K}from"./breadcrumb.esm-bbffcb4d.js";import{s as ie}from"./fileupload.esm-1d15ac9e.js";import{K as le}from"./KnHint-6d455703.js";const de=[{displayType:"date",field:"lastModified",header:"managers.resourceManagement.column.lastModified",position:3,style:{width:"20%"}},{field:"name",header:"managers.resourceManagement.column.name",position:1,style:{width:"60%"}},{field:"selectionMode",header:"",position:0,style:{width:"5%"}},{displayType:"fileSize",field:"size",header:"managers.resourceManagement.column.size",position:2,style:{width:"15%"}}],ce={accuracyAndPerformance:{label:"managers.resourceManagement.metadata.accuracyAndPerformance"},formatOfData:{label:"managers.resourceManagement.metadata.formatOfData"},openSource:{label:"managers.resourceManagement.metadata.openSource"},typeOfAnalytics:{label:"managers.resourceManagement.metadata.typeOfAnalytics.label",options:[{name:"managers.resourceManagement.metadata.typeOfAnalytics.options.descriptive",value:"descriptive"},{name:"managers.resourceManagement.metadata.typeOfAnalytics.options.predictive",value:"predictive"},{name:"managers.resourceManagement.metadata.typeOfAnalytics.options.prescriptive",value:"prescriptive"}]},usageOfTheModel:{label:"managers.resourceManagement.metadata.usageOfTheModel"},version:{label:"managers.resourceManagement.metadata.version"}};var D={column:de,metadata:ce};const se=F({name:"metadata-dialog",components:{Dialog:B,Dropdown:L,InputSwitch:j,Accordion:re,AccordionTab:ne,Textarea:te},data(){return{dirty:!1,loading:!0,metadata:{},checked:!1,descriptor:D,translatedOptions:Array()}},setup(){return{store:z()}},created(){this.loadMetadata();let e=this.descriptor.metadata.typeOfAnalytics.options;for(var a in e){let n=e[a];n.name=this.$t(n.name),this.translatedOptions.push(n)}},props:{id:String,visibility:Boolean},emits:["update:visibility"],methods:{closeDialog(){this.$emit("update:visibility",!1)},loadMetadata(){this.loading=!0,this.id&&this.$http.get("/knowage-api/api/2.0/resources/files/metadata?key="+this.id).then(e=>{this.metadata=e.data}).catch(()=>{this.store.setError({title:this.$t("common.toast.metadata"),msg:this.$t("common.toast.metadataLoadingFailed")})}),this.loading=!1},removeImage(){this.metadata.image="",this.setDirty()},saveMetadata(){this.loading=!0,this.id&&this.$http.post("/knowage-api/api/2.0/resources/files/metadata?key="+this.id,this.metadata,{responseType:"arraybuffer",headers:{"Content-Type":"application/json"}}).then(()=>{this.store.setInfo({title:this.$t("common.toast.updateTitle"),msg:this.$t("common.toast.updateSuccess")})}).catch(e=>{this.store.setError({title:this.$t("common.toast.updateTitle"),msg:this.$t(e)})}),this.loading=!1,this.closeDialog()},setDirty(){this.dirty=!0},uploadFile(e){const a=new FileReader;let n=this;a.addEventListener("load",function(){n.metadata.image=a.result||""},!1),e.srcElement.files[0]&&e.srcElement.files[0].size<"200000"?(a.readAsDataURL(e.srcElement.files[0]),this.setDirty()):this.store.setError({title:this.$t("common.error.uploading"),msg:this.$t("common.error.exceededSize",{size:"(200KB)"})})}},computed:{...X(z,{locale:"locale"})},watch:{id(){this.loadMetadata()}}}),be=e=>(O("data-v-dabea8e0"),e=e(),R(),e),pe={class:"managerDetail"},ke={class:"p-grid p-m-3 p-fluid p-ai-start"},ue={class:"p-float-label p-col-4"},me={class:"kn-material-input-label",for:"name"},ge={class:"p-float-label p-col-2"},he={class:"kn-material-input-label",for:"name"},ve={class:"p-float-label p-col-3"},fe={class:"kn-material-input-label",for:"outputType"},we={class:"p-col-3 p-d-flex p-jc-end"},xe={class:"kn-material-input-label p-mr-2",for:"name"},ye={class:"p-float-label p-col-8 descriptionTextArea"},Me={class:"kn-material-input-label",for:"description"},Ae={class:"p-col-4 kn-height-full"},Ce={class:"p-d-flex p-jc-end p-ai-center"},Ee={for:"inputImage"},ze=be(()=>i("i",{class:"p-button-text p-button-sm p-button-rounded p-button-plain p-p-0 pi pi-upload"},null,-1)),Fe=[ze],$e={class:"imageContainer p-d-flex p-jc-center p-ai-center"},De={key:0,class:"far fa-image fa-5x icon"},Te=["src"];function Ie(e,a,n,m,T,I){const b=l("InputText"),v=l("Dropdown"),f=l("InputSwitch"),u=l("Textarea"),g=l("AccordionTab"),M=l("Accordion"),y=l("Button"),E=l("Dialog"),C=N("tooltip");return c(),k("div",pe,[r(E,{class:"kn-dialog--toolbar--primary knMetadataDialog",visible:e.visibility,footer:"footer",header:e.$t("managers.resourceManagement.metadata.dialog.title"),closable:!1,modal:"",onId:e.loadMetadata},{footer:d(()=>[r(y,{class:"kn-button kn-button--secondary",onClick:e.closeDialog},{default:d(()=>[w(s(e.$t("common.close")),1)]),_:1},8,["onClick"]),r(y,{class:"kn-button kn-button--primary",onClick:e.saveMetadata,disabled:!e.dirty},{default:d(()=>[w(s(e.$t("common.save")),1)]),_:1},8,["onClick","disabled"])]),default:d(()=>[i("div",ke,[i("span",ue,[r(b,{id:"name",class:"kn-material-input",type:"text",modelValue:e.metadata.name,"onUpdate:modelValue":a[0]||(a[0]=o=>e.metadata.name=o),onChange:e.setDirty},null,8,["modelValue","onChange"]),i("label",me,s(e.$t("common.name")),1)]),i("span",ge,[r(b,{id:"name",class:"kn-material-input",type:"text",modelValue:e.metadata.version,"onUpdate:modelValue":a[1]||(a[1]=o=>e.metadata.version=o),onChange:e.setDirty},null,8,["modelValue","onChange"]),i("label",he,s(e.$t(e.descriptor.metadata.version.label)),1)]),i("span",ve,[r(v,{id:"typeOfAnalytics",class:"kn-material-input",modelValue:e.metadata.typeOfAnalytics,"onUpdate:modelValue":a[2]||(a[2]=o=>e.metadata.typeOfAnalytics=o),onChange:e.setDirty,options:e.translatedOptions,optionLabel:"name",optionValue:"value"},null,8,["modelValue","onChange","options"]),i("label",fe,s(e.$t(e.descriptor.metadata.typeOfAnalytics.label)),1)]),i("span",we,[i("label",xe,s(e.$t(e.descriptor.metadata.openSource.label)),1),r(f,{modelValue:e.metadata.openSource,"onUpdate:modelValue":a[3]||(a[3]=o=>e.metadata.openSource=o),onChange:e.setDirty},null,8,["modelValue","onChange"])]),i("span",ye,[r(u,{modelValue:e.metadata.description,"onUpdate:modelValue":a[4]||(a[4]=o=>e.metadata.description=o),class:"kn-material-input",style:{resize:"none"},id:"description",rows:"5",onChange:e.setDirty},null,8,["modelValue","onChange"]),i("label",Me,s(e.$t("common.description")),1)]),i("span",Ae,[i("span",Ce,[i("input",{id:"inputImage",type:"file",onChange:a[5]||(a[5]=(...o)=>e.uploadFile&&e.uploadFile(...o)),accept:"image/png, image/jpeg"},null,32),A((c(),k("label",Ee,Fe)),[[C,e.$t("common.upload"),void 0,{bottom:!0}]]),e.metadata.image?A((c(),k("i",{key:0,class:"p-button-text p-button-sm p-button-rounded p-button-plain p-p-0 pi pi-times p-ml-2",onClick:a[6]||(a[6]=(...o)=>e.removeImage&&e.removeImage(...o))},null,512)),[[C,e.$t("common.delete"),void 0,{bottom:!0}]]):p("",!0)]),i("div",$e,[e.metadata.image?p("",!0):(c(),k("i",De)),e.metadata.image?(c(),k("img",{key:1,src:e.metadata.image,height:"100%",class:"kn-no-select"},null,8,Te)):p("",!0)])])]),r(M,{class:"p-col-12"},{default:d(()=>[r(g,{header:e.$t(e.descriptor.metadata.accuracyAndPerformance.label)},{default:d(()=>[r(u,{modelValue:e.metadata.accuracyAndPerformance,"onUpdate:modelValue":a[7]||(a[7]=o=>e.metadata.accuracyAndPerformance=o),class:"kn-material-input metadataTextArea",style:{resize:"none"},id:"accuracyAndPerformance",rows:"3",onChange:e.setDirty},null,8,["modelValue","onChange"])]),_:1},8,["header"]),r(g,{header:e.$t(e.descriptor.metadata.usageOfTheModel.label)},{default:d(()=>[r(u,{modelValue:e.metadata.usageOfTheModel,"onUpdate:modelValue":a[8]||(a[8]=o=>e.metadata.usageOfTheModel=o),class:"kn-material-input metadataTextArea",style:{resize:"none"},id:"usageOfTheModel",rows:"3",onChange:e.setDirty},null,8,["modelValue","onChange"])]),_:1},8,["header"]),r(g,{header:e.$t(e.descriptor.metadata.formatOfData.label)},{default:d(()=>[r(u,{modelValue:e.metadata.formatOfData,"onUpdate:modelValue":a[9]||(a[9]=o=>e.metadata.formatOfData=o),class:"kn-material-input metadataTextArea",style:{resize:"none"},id:"formatOfData",rows:"3",onChange:e.setDirty},null,8,["modelValue","onChange"])]),_:1},8,["header"])]),_:1})]),_:1},8,["visible","header","onId"])])}var Ue=$(se,[["render",Ie],["__scopeId","data-v-dabea8e0"]]);const Se=F({name:"import-file-dialog",components:{Dialog:B,FileUpload:ie,InputSwitch:j,Message:_},props:{path:String,visibility:Boolean,existingFiles:Array},data(){return{checked:!1,descriptor:D,uploadedFiles:[],loading:!1}},emits:["update:visibility","fileUploaded"],setup(){return{store:z()}},methods:{isArchive(){return this.uploadedFiles.length==1&&(this.uploadedFiles[0].type=="application/zip"||this.uploadedFiles[0].type=="application/x-zip-compressed")},closeDialog(){this.uploadedFiles=[],this.$emit("update:visibility",!1)},onDelete(e){this.uploadedFiles.splice(e)},onUpload(e){this.uploadedFiles[0]=e.files[0]},checkExistingFile(){let e=!1;if(this.existingFiles&&this.uploadedFiles[0]){for(var a in this.existingFiles)if(this.existingFiles[a].name===this.uploadedFiles[0].name){e=!0;break}}return e&&!this.checked},notifyExtractionWarning(){return this.isArchive()&&this.checked},async startImportFile(){if(this.uploadedFiles[0]&&this.path){this.loading=!0;var e=new FormData;e.append("file",this.uploadedFiles[0]),e.append("key",this.path);let a=this.checked?"true":"false";e.append("extract",a),await this.$http.post("/knowage-api/api/2.0/resources/files/uploadFile",e,{headers:{"Content-Type":"multipart/form-data"}}).then(n=>{n.data.errors?this.store.setError({title:this.$t("common.error.uploading"),msg:this.$t("managers.resourceManagement.upload.completedWithErrors")}):this.store.setInfo({title:this.$t("common.uploading"),msg:this.$t("common.toast.uploadSuccess")})},n=>this.store.setError({title:this.$t("common.error.uploading"),msg:this.$t(n)})).finally(()=>{this.loading=!1,this.closeDialog(),this.uploadedFiles=[],this.$emit("fileUploaded")})}else this.store.setWarning({title:this.$t("common.uploading"),msg:this.$t("managers.widgetGallery.noFileProvided")})}}}),Ne={key:0},Ve={key:1},Be={for:"active",class:"kn-material-input-label p-mr-3"};function Oe(e,a,n,m,T,I){const b=l("Message"),v=l("FileUpload"),f=l("InputSwitch"),u=l("Button"),g=l("Dialog"),M=N("t");return c(),h(g,{class:"kn-dialog--toolbar--primary importFileDialog",visible:e.visibility,footer:"footer",header:e.$t("common.import"),closable:!1,modal:""},{footer:d(()=>[r(u,{class:"p-button-text kn-button",label:e.$t("common.cancel"),onClick:e.closeDialog},null,8,["label","onClick"]),A(r(u,{class:"kn-button kn-button--primary",disabled:e.uploadedFiles&&e.uploadedFiles.length==0,onClick:e.startImportFile},null,8,["disabled","onClick"]),[[M,"common.import"]])]),default:d(()=>[e.checkExistingFile()?(c(),k("span",Ne,[r(b,{severity:"warn"},{default:d(()=>[w(s(e.$t("managers.resourceManagement.uploadFile.fileWillBeOverwritten")),1)]),_:1})])):p("",!0),e.notifyExtractionWarning()?(c(),k("span",Ve,[r(b,{severity:"warn"},{default:d(()=>[w(s(e.$t("managers.resourceManagement.uploadFile.fileAndFoldersContentWillBeOverwritten")),1)]),_:1})])):p("",!0),r(v,{name:"demo[]",chooseLabel:e.$t("common.choose"),customUpload:!0,onUploader:e.onUpload,onRemove:e.onDelete,auto:"true",maxFileSize:5e7,multiple:!1,fileLimit:1},{empty:d(()=>[i("p",null,s(e.$t("common.dragAndDropFileHere")),1)]),_:1},8,["chooseLabel","onUploader","onRemove"]),e.isArchive()?(c(),k("span",{key:2,class:S(e.notifyExtractionWarning()||e.checkExistingFile()?"inputFileToggleWithToolbar":"inputFileToggle")},[i("label",Be,s(e.$t("managers.resourceManagement.extract")),1),r(f,{modelValue:e.checked,"onUpdate:modelValue":a[0]||(a[0]=y=>e.checked=y)},null,8,["modelValue"])],2)):p("",!0)]),_:1},8,["visible","header"])}var Re=$(Se,[["render",Oe]]);const je=F({components:{Breadcrumb:K,Column:Q,DataTable:P,ResourceManagementImportFileDialog:Re},props:{folder:Object},emits:["touched","closed","inserted","folderCreated","fileUploaded"],data(){return{descriptor:D,loading:!1,touched:!1,files:[],selectedFiles:[],filters:{global:{value:null,matchMode:U.CONTAINS},name:{operator:V.OR,constraints:[{value:null,matchMode:U.STARTS_WITH}]},size:{operator:V.OR,constraints:[{value:null,matchMode:U.STARTS_WITH}]},lastModified:{operator:V.OR,constraints:[{value:null,matchMode:U.CONTAINS}]}},home:{icon:"pi pi-home"},items:[],folderName:"",importFile:!1,selectedFolder:{}}},computed:{},beforeRouteUpdate(){this.loadSelectedFolder()},setup(){return{store:z()}},created(){this.loadSelectedFolder()},mounted(){},methods:{closeDetail(){this.$emit("closed")},downloadFiles(){this.$http.post("/knowage-api/api/2.0/resources/files/download",this.getKeyAndFilenamesObj(),{responseType:"arraybuffer",headers:{"Content-Type":"application/json",Accept:"application/zip; charset=utf-8"}}).then(e=>{Y(e),this.selectedFiles=[]}).catch(e=>{this.store.setError({title:this.$t("common.error.downloading"),msg:this.$t(e)})}).finally(()=>this.loading=!1)},getBreadcrumbs(){this.items=[];let e=this.getCurrentFolderPath();e&&e.split("\\").forEach(n=>{let m={label:n,to:null};this.items.push(m)})},getCurrentFolderPath(){return this.folder?this.folder.relativePath:void 0},getCurrentFolderKey(){return this.folder?""+this.folder.key:void 0},getOrderedColumns(){let e=this.descriptor.column;return e.sort(function(a,n){return a.position>n.position?1:a.position<n.position?-1:0}),e},getDataValue(e){return J(e)},getDate(e){return H(e,"LLL")},async loadSelectedFolder(){this.loading=!0,this.files=[],this.selectedFiles=[],this.folder&&await this.$http.get("/knowage-api/api/2.0/resources/files?key="+this.folder.key).then(e=>{this.files=e.data,this.getBreadcrumbs()}).catch(e=>{this.store.setError({title:this.$t("common.error.downloading"),msg:this.$t(e)})}).finally(()=>this.loading=!1)},openImportFileDialog(){this.importFile=!this.importFile},setDirty(){this.touched=!0,this.$emit("touched")},showDeleteDialog(){this.$confirm.require({message:this.$t("common.toast.deleteMessage"),header:this.$t("common.toast.deleteConfirmTitle"),icon:"pi pi-exclamation-triangle",accept:()=>this.deleteFiles()})},deleteFiles(){this.loading=!0,this.$http.delete("/knowage-api/api/2.0/resources/files",{headers:{"Content-Type":"application/json"},data:this.getKeyAndFilenamesObj()}).then(()=>{this.selectedFiles=[],this.loadSelectedFolder(),this.store.setInfo({title:this.$t("common.toast.deleteTitle"),msg:this.$t("common.toast.deleteSuccess")})}).catch(()=>{this.store.setError({title:this.$t("common.toast.deleteTitle"),msg:this.$t("common.error.deleting")})}).finally(()=>this.loading=!1)},getKeyAndFilenamesObj(){let e={};if(this.folder){e.key=this.folder.key,e.selectedFilesNames=[];for(var a in this.selectedFiles)e.selectedFilesNames.push(this.selectedFiles[a].name)}return e},fileUploaded(){this.loadSelectedFolder(),this.$emit("fileUploaded")}},watch:{id(e,a){e!=a&&this.loadSelectedFolder()},folder(){this.loading=!0,this.selectedFolder={...this.folder},this.loadSelectedFolder(),this.loading=!1}}}),Ke=e=>(O("data-v-6cad4e86"),e=e(),R(),e),Le={class:"kn-page"},Xe={class:"cleanText"},_e={class:"kn-page-content"},Qe={class:"managerDetail p-grid p-m-0 kn-height-full"},Pe={class:"p-col"},Ye={class:"p-grid p-pt-0"},Je={class:"p-col-10"},He={class:"p-input-icon-left p-col p-p-0"},We=Ke(()=>i("i",{class:"pi pi-search"},null,-1)),Ge={class:"p-col p-d-flex p-jc-end p-ai-center"},Ze={key:0},qe={key:1},ea={key:2},aa=["title"];function oa(e,a,n,m,T,I){const b=l("Button"),v=l("Toolbar"),f=l("ProgressBar"),u=l("Breadcrumb"),g=l("ResourceManagementImportFileDialog"),M=l("InputText"),y=l("Column"),E=l("DataTable"),C=N("tooltip");return c(),k("div",Le,[r(v,{class:"kn-toolbar kn-toolbar--secondary p-m-0"},{start:d(()=>[i("span",Xe,s(e.folder.label),1)]),end:d(()=>[A(r(b,{icon:"pi pi-times",class:"p-button-text p-button-rounded p-button-plain",onClick:a[0]||(a[0]=o=>e.closeDetail())},null,512),[[C,e.$t("common.close"),void 0,{bottom:!0}]])]),_:1}),e.loading?(c(),h(f,{key:0,mode:"indeterminate",class:"kn-progress-bar"})):p("",!0),r(u,{home:e.home,model:e.items},null,8,["home","model"]),i("div",_e,[e.selectedFiles.length>0?(c(),h(v,{key:0,class:"kn-toolbar kn-toolbar--default p-m-0"},{start:d(()=>[w(s(e.$tc("managers.resourceManagement.selectedFiles",e.selectedFiles.length,{num:e.selectedFiles.length})),1)]),end:d(()=>[r(b,{icon:"fas fa-download",class:"p-button-text p-button-rounded p-button-plain kn-button-light",onClick:e.downloadFiles},null,8,["onClick"]),r(b,{icon:"fas fa-trash",class:"p-button-text p-button-rounded p-button-plain kn-button-light",onClick:e.showDeleteDialog},null,8,["onClick"])]),_:1})):p("",!0),r(g,{visibility:e.importFile,"onUpdate:visibility":a[1]||(a[1]=o=>e.importFile=o),path:e.folder.key,onFileUploaded:e.fileUploaded,existingFiles:e.files},null,8,["visibility","path","onFileUploaded","existingFiles"]),i("div",Qe,[i("div",Pe,[r(E,{ref:"dt",value:e.files,loading:e.loading,selection:e.selectedFiles,"onUpdate:selection":a[4]||(a[4]=o=>e.selectedFiles=o),filters:e.filters,"onUpdate:filters":a[5]||(a[5]=o=>e.filters=o),class:"p-datatable-sm kn-table",paginator:!0,rows:10,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[10,15,20],responsiveLayout:"stack",breakpoint:"960px",currentPageReportTemplate:e.$t("common.table.footer.paginated",{first:"{first}",last:"{last}",totalRecords:"{totalRecords}"}),globalFilterFields:["name","type","tags"]},{header:d(()=>[i("div",Ye,[i("div",Je,[i("span",He,[We,r(M,{class:"kn-material-input",type:"text",modelValue:e.filters.global.value,"onUpdate:modelValue":a[2]||(a[2]=o=>e.filters.global.value=o),placeholder:e.$t("common.search"),badge:"0"},null,8,["modelValue","placeholder"])])]),i("div",Ge,[r(b,{icon:"fas fa-sync-alt",class:"p-button-text p-button-sm p-button-rounded p-button-plain p-p-0",onClick:a[3]||(a[3]=o=>e.loadSelectedFolder()),disabled:e.selectedFiles.length>0},null,8,["disabled"]),r(b,{icon:"fas fa-upload",class:"p-button-text p-button-sm p-button-rounded p-button-plain p-p-0",onClick:e.openImportFileDialog,disabled:e.selectedFiles.length>0},null,8,["onClick","disabled"])])])]),empty:d(()=>[w(s(e.$t("common.info.noDataFound")),1)]),loading:d(()=>[w(s(e.$t("common.info.dataLoading")),1)]),default:d(()=>[(c(!0),k(W,null,G(e.getOrderedColumns(),o=>(c(),h(y,{field:o.field,header:e.$t(o.header),class:"kn-truncated",key:o.position,style:q(o.style),selectionMode:o.field=="selectionMode"?"multiple":"",exportable:o.field=="selectionMode"?!1:""},Z({_:2},[o.field!="selectionMode"?{name:"body",fn:d(({data:t})=>[o.displayType=="fileSize"?(c(),k("span",Ze,s(e.getDataValue(t.size)),1)):o.displayType=="date"?(c(),k("span",qe,s(e.getDate(t.lastModified)),1)):(c(),k("span",ea,[i("span",{class:"kn-truncated",title:t[o.field]},s(t[o.field]),9,aa)]))])}:void 0]),1032,["field","header","style","selectionMode","exportable"]))),128))]),_:1},8,["value","loading","selection","filters","currentPageReportTemplate"])])])])])}var ta=$(je,[["render",oa],["__scopeId","data-v-6cad4e86"]]);const ra=F({name:"import-file-dialog",components:{Breadcrumb:K,Dialog:B},props:{visibility:Boolean,path:String},emits:["update:visibility","createFolder"],data(){return{descriptor:D,home:{icon:"pi pi-home"},items:[],folderName:"",loading:!1}},mounted(){this.setBreadcrumbs(),this.folderName=""},methods:{closeDialog(){this.folderName="",this.$emit("update:visibility",!1)},emitCreateFolder(){this.$emit("createFolder",this.folderName),this.folderName=""},setBreadcrumbs(){this.folderName="",this.items=[],this.path&&this.path.split("\\",-1).forEach(a=>{let n={label:a};this.items.push(n)})}},watch:{path(e,a){e!=a&&this.setBreadcrumbs()}}}),na={class:"createFolderDialogContent"},ia={class:"p-float-label"},la={class:"kn-material-input-label",for:"label"};function da(e,a,n,m,T,I){const b=l("Breadcrumb"),v=l("InputText"),f=l("Button"),u=l("Dialog");return c(),h(u,{class:"kn-dialog--toolbar--primary createFolderDialog",visible:e.visibility,footer:"footer",header:e.$t("managers.resourceManagement.createFolder"),closable:!1,modal:""},{footer:d(()=>[r(f,{class:"kn-button kn-button--secondary",onClick:e.closeDialog},{default:d(()=>[w(s(e.$t("common.cancel")),1)]),_:1},8,["onClick"]),r(f,{class:"kn-button kn-button--primary",disabled:e.folderName&&e.folderName.length==0,onClick:e.emitCreateFolder},{default:d(()=>[w(s(e.$t("common.save")),1)]),_:1},8,["disabled","onClick"])]),default:d(()=>[r(b,{home:e.home,model:e.items},null,8,["home","model"]),i("div",na,[i("span",ia,[r(v,{class:"folderNameInputText",type:"text",modelValue:e.folderName,"onUpdate:modelValue":a[0]||(a[0]=g=>e.folderName=g)},null,8,["modelValue"]),i("label",la,s(e.$t("managers.resourceManagement.foldernamePlaceholder")),1)])])]),_:1},8,["visible","header"])}var ca=$(ra,[["render",da]]);const sa=F({name:"resource-management",components:{KnHint:le,ResourceManagementMetadataDialog:Ue,ResourceManagementCreateFolderDialog:ca,ResourceManagementDetail:ta,Tree:oe},data(){return{descriptor:D,displayMetadataDialog:!1,loading:!1,nodes:[],expandedKeys:{},selectedKeys:null,metadataKey:null,dirty:!1,buttonsVisible:[],showHint:!0,touched:!1,selectedFolder:{},folderCreation:!1,formVisible:!1}},setup(){return{store:z()}},async created(){this.loadPage()},methods:{createFolder(e){if(e&&this.selectedFolder){let a={};a.key=""+this.selectedFolder.key,a.folderName=e,this.$http.post("/knowage-api/api/2.0/resources/folders",a,{responseType:"arraybuffer",headers:{"Content-Type":"application/json"}}).then(()=>{this.$emit("folderCreated",!0)}).catch(n=>{this.store.setError({title:this.$t("common.error.saving"),msg:this.$t(n)})}).finally(()=>{this.loading=!1,this.openCreateFolderDialog(),this.loadPage(this.showHint,this.formVisible)})}},getCurrentFolderPath(){return this.selectedFolder?this.selectedFolder.relativePath:void 0},getCurrentFolderKey(){return this.selectedFolder?""+this.selectedFolder.key:void 0},getButtonClass(e){let a=" kn-hide";return this.buttonsVisible[e.key]&&!e.edit&&(a=""),"p-button-text p-button-sm p-button-rounded p-button-plain p-p-0"+a},openCreateFolderDialog(){this.folderCreation=!this.folderCreation},toggleInput(e){if(e.level>0)if(e.edit&&e.label!==e.edit){if(this.selectedFolder){let a={};a.key=this.selectedFolder.key,a.folderName=e.label,this.loading=!0,this.$http.post("/knowage-api/api/2.0/resources/folders/update",a,{responseType:"arraybuffer",headers:{"Content-Type":"application/json"}}).then(()=>{delete e.edit,this.store.setInfo({title:this.$t("managers.resoruceManagement.renameFolder"),msg:this.$t("managers.resoruceManagement.folderRenamedSuccessfully")})}).catch(n=>{this.store.setError({title:this.$t("managers.resoruceManagement.renameFolder"),msg:this.$t(n)})}).finally(()=>{this.loading=!1})}}else e.edit=e.label},addIcon(e){for(var a in e){let n=e[a];n.icon="far fa-folder",n.children&&n.children.length>0&&this.addIcon(n.children)}},loadPage(e,a){this.loading=!0,this.showHint=e!=null?e:!0,this.formVisible=a!=null?a:!1,this.$http.get("/knowage-api/api/2.0/resources/folders").then(n=>{let m=n.data.root[0];m.label="HOME",m.icon="pi pi-home",m.disabled=!0,this.addIcon(m.children),this.nodes=n.data.root,this.loading=!1}).finally(()=>this.loading=!1)},openMetadataDialog(e){this.metadataKey=e.key,this.displayMetadataDialog=!this.displayMetadataDialog},deleteFolder(e){this.loading=!0,this.$http.delete("/knowage-api/api/2.0/resources/folders",{headers:{"Content-Type":"application/json"},data:{key:e.key}}).then(()=>{this.loadPage(),this.store.setInfo({title:this.$t("common.toast.deleteTitle"),msg:this.$t("common.toast.deleteSuccess")})}).catch(()=>{this.store.setError({title:this.$t("common.toast.deleteTitle"),msg:this.$t("common.toast.deleteFailed")})}).finally(()=>this.loading=!1)},downloadDirect(e){this.loading=!0;let a={};a.key=e.key,this.$http.post("/knowage-api/api/2.0/resources/folders/download",a,{responseType:"arraybuffer",headers:{"Content-Type":"application/json",Accept:"application/zip; charset=utf-8"}}).then(n=>{ee(n,this.selectedFolder.label+".zip")}).finally(()=>this.loading=!1)},setDirty(){this.dirty=!0},showForm(e){this.touched?this.$confirm.require({message:this.$t("common.toast.unsavedChangesMessage"),header:this.$t("common.toast.unsavedChangesHeader"),icon:"pi pi-exclamation-triangle",accept:()=>{this.touched=!1,this.setSelected(e)}}):this.setSelected(e)},setSelected(e){this.selectedFolder=e,this.formVisible=!0,this.showHint=!1},showDeleteDialog(e){this.$confirm.require({message:this.$t("common.toast.deleteMessage"),header:this.$t("common.toast.deleteConfirmTitle"),icon:"pi pi-exclamation-triangle",accept:()=>this.deleteFolder(e)})},switchToHint(){this.formVisible=!1,this.showHint=!0,this.expandedKeys={},this.selectedKeys=null,this.metadataKey=null,this.dirty=!1,this.touched=!1,this.selectedFolder={}}}}),ba={class:"kn-page"},pa={class:"kn-page-content p-grid p-m-0"},ka={class:"p-col-4 p-sm-4 p-md-3 p-p-0 p-d-flex p-flex-column"},ua=["onMouseover","onMouseleave","data-test"],ma=["onDblclick"],ga={class:"p-col-8 p-sm-8 p-md-9 p-p-0 p-m-0 kn-page"};function ha(e,a,n,m,T,I){const b=l("Button"),v=l("Toolbar"),f=l("ProgressBar"),u=l("ResourceManagementMetadataDialog"),g=l("ResourceManagementCreateFolderDialog"),M=l("InputText"),y=l("Tree"),E=l("KnHint"),C=l("ResourceManagementDetail"),o=N("tooltip");return c(),k("div",ba,[i("div",pa,[i("div",ka,[r(v,{class:"kn-toolbar kn-toolbar--primary"},{start:d(()=>[w(s(e.$t("managers.resourceManagement.title")),1)]),end:d(()=>[r(b,{icon:"fas fa-sync-alt",class:"p-button-text p-button-sm p-button-rounded p-button-plain p-p-0",onClick:a[0]||(a[0]=t=>e.loadPage(e.showHint,e.formVisible))}),r(b,{icon:"fas fa-folder-plus",class:"p-button-text p-button-sm p-button-rounded p-button-plain p-p-0",onClick:e.openCreateFolderDialog},null,8,["onClick"])]),_:1}),e.loading?(c(),h(f,{key:0,mode:"indeterminate",class:"kn-progress-bar","data-test":"progress-bar"})):p("",!0),r(u,{visibility:e.displayMetadataDialog,"onUpdate:visibility":a[1]||(a[1]=t=>e.displayMetadataDialog=t),id:e.metadataKey,"onUpdate:id":a[2]||(a[2]=t=>e.metadataKey=t)},null,8,["visibility","id"]),r(g,{visibility:e.folderCreation,"onUpdate:visibility":a[3]||(a[3]=t=>e.folderCreation=t),onCreateFolder:e.createFolder,path:e.selectedFolder?e.selectedFolder.relativePath:""},null,8,["visibility","onCreateFolder","path"]),r(y,{id:"folders-tree",value:e.nodes,selectionMode:"single",expandedKeys:e.expandedKeys,filter:!0,filterMode:"lenient","data-test":"functionality-tree",class:"kn-tree kn-flex p-flex-column foldersTree",onNodeSelect:a[4]||(a[4]=t=>e.showForm(t)),selectionKeys:e.selectedKeys,"onUpdate:selectionKeys":a[5]||(a[5]=t=>e.selectedKeys=t)},{default:d(t=>[i("div",{class:"p-d-flex p-flex-row p-ai-center p-jc-between",onMouseover:x=>e.buttonsVisible[t.node.key]=!0,onMouseleave:x=>e.buttonsVisible[t.node.key]=!1,"data-test":"tree-item-"+t.node.key},[t.node.edit?p("",!0):(c(),k("span",{key:0,class:"kn-truncated",onDblclick:x=>e.toggleInput(t.node)},s(t.node.label),41,ma)),t.node.edit?(c(),h(M,{key:1,class:"kn-material-input fileNameInputText",type:"text",modelValue:t.node.label,"onUpdate:modelValue":x=>t.node.label=x,maxlength:"50",onBlur:x=>e.toggleInput(t.node),onKeyup:ae(x=>e.toggleInput(t.node),["enter"])},null,8,["modelValue","onUpdate:modelValue","onBlur","onKeyup"])):p("",!0),i("div",null,[t.node.modelFolder?A((c(),h(b,{key:0,icon:"fas fa-table",class:S(e.getButtonClass(t.node)),onClick:x=>e.openMetadataDialog(t.node),"data-test":"move-up-button-"+t.node.key},null,8,["class","onClick","data-test"])),[[o,e.$t("managers.resourceManagement.openMetadata"),void 0,{top:!0}]]):p("",!0),A(r(b,{icon:"fa fa-download ",class:S(e.getButtonClass(t.node)),onClick:x=>e.downloadDirect(t.node),"data-test":"move-down-button-"+t.node.key},null,8,["class","onClick","data-test"]),[[o,e.$t("common.download"),void 0,{top:!0}]]),t.node.level>0?A((c(),h(b,{key:1,icon:"far fa-trash-alt",class:S(e.getButtonClass(t.node)),onClick:x=>e.showDeleteDialog(t.node),"data-test":"delete-button-"+t.node.key},null,8,["class","onClick","data-test"])),[[o,e.$t("common.delete"),void 0,{top:!0}]]):p("",!0)])],40,ua)]),_:1},8,["value","expandedKeys","selectionKeys"])]),i("div",ga,[e.showHint?(c(),h(E,{key:0,title:"managers.resourceManagement.title",hint:"managers.resourceManagement.hint"},null,8,["title","hint"])):p("",!0),e.formVisible?(c(),h(C,{key:1,folder:e.selectedFolder,parentKey:e.folderParentKey,onTouched:a[6]||(a[6]=t=>e.touched=!0),onClose:e.onClose,onInserted:a[7]||(a[7]=t=>e.loadPage(t)),onFolderCreated:e.loadPage,onClosed:a[8]||(a[8]=t=>e.switchToHint()),onFileUploaded:a[9]||(a[9]=t=>e.loadPage(!1,!0))},null,8,["folder","parentKey","onClose","onFolderCreated"])):p("",!0)])])])}var Ea=$(sa,[["render",ha]]);export{Ea as default};
//# sourceMappingURL=ResourceManagement-13a739b5.js.map
