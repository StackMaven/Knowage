import{d as M,a5 as I,a9 as N,_ as C,r as n,o as s,c as m,f as r,w as i,a as t,G as f,t as l,h as w,A as h,B as F,a4 as U,g as y,v as S,u as B,be as P,s as D,i as R,a8 as O,C as q,X as j,a7 as T,V}from"./index-1e676509.js";import{K}from"./KnListBox-94855720.js";import{K as X,u as z,c as W}from"./KnValidatonMessages-ebe48c72.js";import{s as Q}from"./textarea.esm-32051d54.js";import{s as J}from"./multiselect.esm-ce4000f7.js";import{s as Y}from"./inputswitch.esm-80317a38.js";import{K as G}from"./KnHint-6d455703.js";import{s as H}from"./radiobutton.esm-c3e6fa9b.js";import"./menu.esm-6bee86d0.js";const _={buttons:[{emits:"download",icon:"fas fa-download",label:"common.download"},{emits:"delete",icon:"far fa-trash-alt",label:"common.delete"}],defaultSortField:"type",filterFields:["name","type"],interaction:{parameterLabel:"id",parameterValue:"id",type:"event"},sortFields:["name","type"],textField:"type",titleField:"name"},Z={baseLayer:!1,category_id:null,descr:"",icon:null,label:null,layerId2:null,layerIdentify:null,layerLabel:null,layerName:null,layerOrder:null,name:null,properties:[],roles:[],type:null};var ee={knListSettings:_,newLayer:Z};const ae={layer:[{fieldName:"label",validators:[{key:"required"}]},{fieldName:"name",validators:[{key:"required"}]},{fieldName:"layerLabel",validators:[{key:"required"}]},{fieldName:"layerName",validators:[{key:"required"}]},{fieldName:"layerIdentify",validators:[{key:"required"}]},{fieldName:"layerOrder",validators:[{key:"required"}]},{fieldName:"type",validators:[{key:"required"}]},{fieldName:"layerURL",validators:[{key:"required",validator:{type:"url-required"}}]}]};var te={validations:ae};const oe=M({components:{KnValidationMessages:X,Textarea:Q,MultiSelect:J,Dropdown:I,KnInputFile:N,InputSwitch:Y},props:{selectedLayer:{type:Object,required:!0},allRoles:{type:Array,required:!0},allCategories:{type:Array,required:!0}},computed:{},emits:[],data(){return{v$:z(),descriptor:te,layer:{},triggerUpload:!1,uploading:!1,layerTypes:[{label:this.$t("common.file"),value:"File"},{label:this.$t("managers.layersManagement.layerTypes.wfs"),value:"WFS"},{label:this.$t("managers.layersManagement.layerTypes.wms"),value:"WMS"},{label:this.$t("managers.layersManagement.layerTypes.tms"),value:"TMS"},{label:this.$t("managers.layersManagement.layerTypes.google"),value:"Google"},{label:this.$t("managers.layersManagement.layerTypes.osm"),value:"OSM"}]}},async created(){this.layer=this.selectedLayer},watch:{selectedLayer(){this.layer=this.selectedLayer}},validations(){const a={"url-required":c=>!["WFS","WMS","TMS"].includes(this.layer.type)||c};return{layer:W("layer",this.descriptor.validations.layer,a)}},methods:{setUploadType(){this.triggerUpload=!1,setTimeout(()=>this.triggerUpload=!0,200)},uploadLayerFile(e){this.uploading=!0;let a=e.target.files[0];this.layer.layerFile={file:a,fileName:a.name},this.triggerUpload=!1,setTimeout(()=>this.uploading=!1,200)}}}),re={class:"p-fluid p-formgrid p-grid"},ne={class:"p-field p-col-12 p-lg-6"},le={class:"p-float-label"},ie={for:"label",class:"kn-material-input-label"},de={class:"p-field p-col-12 p-lg-6"},se={class:"p-float-label"},ce={for:"name",class:"kn-material-input-label"},be={class:"p-field p-col-12 p-lg-6"},pe={class:"p-float-label"},ke={for:"descr",class:"kn-material-input-label"},me={class:"p-field p-col-12 p-lg-6"},ue={class:"p-float-label"},ge={for:"category",class:"kn-material-input-label"},ve={class:"p-fluid p-formgrid p-grid"},he={class:"p-field p-col-12 p-lg-6"},fe={class:"p-float-label"},ye={for:"label",class:"kn-material-input-label"},we={class:"p-field p-col-12 p-lg-6"},xe={class:"p-float-label"},$e={for:"name",class:"kn-material-input-label"},Me={class:"p-col-12 p-lg-4 p-mt-3"},Ce={class:"p-as-center"},Ae={for:"baseLayer",class:"kn-material-input-label p-ml-2"},Le={class:"p-field p-col-12 p-lg-4"},Te={class:"p-float-label"},Ee={for:"name",class:"kn-material-input-label"},Fe={class:"p-field p-col-12 p-lg-4"},Ve={class:"p-float-label"},De={for:"name",class:"kn-material-input-label"},ze={class:"p-col-12"},Ie={class:"p-float-label"},Ne={for:"layerRoles",class:"kn-material-input-label"},Ue={class:"p-fluid p-formgrid p-grid"},Se={class:"p-field p-col-12"},Be={class:"p-float-label"},Pe={for:"layerType",class:"kn-material-input-label"},Re={key:0,class:"p-field p-col-12 p-d-flex"},Oe={class:"kn-flex"},qe={class:"p-float-label"},je={for:"fileName",class:"kn-material-input-label"},Ke={key:1,class:"p-field p-col-12"},Xe={class:"p-float-label"},We={for:"label",class:"kn-material-input-label"},Qe={class:"p-float-label"},Je={for:"label",class:"kn-material-input-label"},Ye={key:3,class:"p-field p-col-12 p-lg-6"},Ge={class:"p-float-label"},He={for:"label",class:"kn-material-input-label"};function _e(e,a,p,c,g,A){const d=n("InputText"),b=n("KnValidationMessages"),k=n("Textarea"),v=n("Dropdown"),u=n("Card"),x=n("InputSwitch"),$=n("MultiSelect"),L=n("Button"),E=n("KnInputFile");return s(),m(F,null,[r(u,{id:"basic-info-card"},{content:i(()=>[t("form",re,[t("div",ne,[t("span",le,[r(d,{id:"label",class:f(["kn-material-input",{"p-invalid":e.v$.layer.label.$invalid&&e.v$.layer.label.$dirty}]),type:"text",maxLength:"100",modelValue:e.v$.layer.label.$model,"onUpdate:modelValue":a[0]||(a[0]=o=>e.v$.layer.label.$model=o),onBlur:a[1]||(a[1]=o=>e.v$.layer.label.$touch()),onChange:a[2]||(a[2]=o=>e.$emit("touched"))},null,8,["modelValue","class"]),t("label",ie,l(e.$t("common.label"))+" * ",1)]),r(b,{class:"p-mt-1",vComp:e.v$.layer.label,additionalTranslateParams:{fieldName:e.$t("common.label")}},null,8,["vComp","additionalTranslateParams"])]),t("div",de,[t("span",se,[r(d,{id:"name",class:f(["kn-material-input",{"p-invalid":e.v$.layer.name.$invalid&&e.v$.layer.name.$dirty}]),type:"text",maxLength:"100",modelValue:e.v$.layer.name.$model,"onUpdate:modelValue":a[3]||(a[3]=o=>e.v$.layer.name.$model=o),onBlur:a[4]||(a[4]=o=>e.v$.layer.name.$touch()),onChange:a[5]||(a[5]=o=>e.$emit("touched"))},null,8,["modelValue","class"]),t("label",ce,l(e.$t("common.name"))+" * ",1)]),r(b,{class:"p-mt-1",vComp:e.v$.layer.name,additionalTranslateParams:{fieldName:e.$t("common.name")}},null,8,["vComp","additionalTranslateParams"])]),t("div",be,[t("span",pe,[r(k,{id:"descr",class:"kn-material-input",rows:"1",maxLength:"100",autoResize:!0,modelValue:e.layer.descr,"onUpdate:modelValue":a[6]||(a[6]=o=>e.layer.descr=o),onChange:a[7]||(a[7]=o=>e.$emit("touched"))},null,8,["modelValue"]),t("label",ke,l(e.$t("common.description")),1)])]),t("div",me,[t("span",ue,[r(v,{id:"category",class:"kn-material-input",modelValue:e.layer.category_id,"onUpdate:modelValue":a[8]||(a[8]=o=>e.layer.category_id=o),options:e.allCategories,optionLabel:"VALUE_NM",optionValue:"VALUE_ID",showClear:!0,onChange:e.onTypeChange},null,8,["modelValue","options","onChange"]),t("label",ge,l(e.$t("common.category")),1)])])])]),_:1}),r(u,{id:"basic-layer-options-card",class:"p-mt-3"},{content:i(()=>[t("form",ve,[t("div",he,[t("span",fe,[r(d,{id:"label",class:f(["kn-material-input",{"p-invalid":e.v$.layer.layerLabel.$invalid&&e.v$.layer.layerLabel.$dirty}]),type:"text",maxLength:"100",modelValue:e.v$.layer.layerLabel.$model,"onUpdate:modelValue":a[9]||(a[9]=o=>e.v$.layer.layerLabel.$model=o),onBlur:a[10]||(a[10]=o=>e.v$.layer.layerLabel.$touch()),onChange:a[11]||(a[11]=o=>e.$emit("touched"))},null,8,["modelValue","class"]),t("label",ye,l(e.$t("managers.layersManagement.layerLabel"))+" * ",1)]),r(b,{class:"p-mt-1",vComp:e.v$.layer.layerLabel,additionalTranslateParams:{fieldName:e.$t("managers.layersManagement.layerLabel")}},null,8,["vComp","additionalTranslateParams"])]),t("div",we,[t("span",xe,[r(d,{id:"name",class:f(["kn-material-input",{"p-invalid":e.v$.layer.layerName.$invalid&&e.v$.layer.layerName.$dirty}]),type:"text",maxLength:"100",modelValue:e.v$.layer.layerName.$model,"onUpdate:modelValue":a[12]||(a[12]=o=>e.v$.layer.layerName.$model=o),onBlur:a[13]||(a[13]=o=>e.v$.layer.layerName.$touch()),onChange:a[14]||(a[14]=o=>e.$emit("touched"))},null,8,["modelValue","class"]),t("label",$e,l(e.$t("managers.layersManagement.layerName"))+" * ",1)]),r(b,{class:"p-mt-1",vComp:e.v$.layer.layerName,additionalTranslateParams:{fieldName:e.$t("managers.layersManagement.layerName")}},null,8,["vComp","additionalTranslateParams"])]),t("div",Me,[t("span",Ce,[r(x,{id:"baseLayer",modelValue:e.layer.baseLayer,"onUpdate:modelValue":a[15]||(a[15]=o=>e.layer.baseLayer=o)},null,8,["modelValue"]),t("label",Ae,l(e.$t("managers.layersManagement.baseLayer")),1)])]),t("div",Le,[t("span",Te,[r(d,{id:"name",class:f(["kn-material-input",{"p-invalid":e.v$.layer.layerIdentify.$invalid&&e.v$.layer.layerIdentify.$dirty}]),type:"text",maxLength:"100",modelValue:e.v$.layer.layerIdentify.$model,"onUpdate:modelValue":a[16]||(a[16]=o=>e.v$.layer.layerIdentify.$model=o),onBlur:a[17]||(a[17]=o=>e.v$.layer.layerIdentify.$touch()),onChange:a[18]||(a[18]=o=>e.$emit("touched"))},null,8,["modelValue","class"]),t("label",Ee,l(e.$t("managers.layersManagement.layerIdentify"))+" * ",1)]),r(b,{class:"p-mt-1",vComp:e.v$.layer.layerIdentify,additionalTranslateParams:{fieldName:e.$t("managers.layersManagement.layerIdentify")}},null,8,["vComp","additionalTranslateParams"])]),t("div",Fe,[t("span",Ve,[r(d,{id:"name",class:f(["kn-material-input",{"p-invalid":e.v$.layer.layerOrder.$invalid&&e.v$.layer.layerOrder.$dirty}]),type:"number",min:"0",modelValue:e.v$.layer.layerOrder.$model,"onUpdate:modelValue":a[19]||(a[19]=o=>e.v$.layer.layerOrder.$model=o),onBlur:a[20]||(a[20]=o=>e.v$.layer.layerOrder.$touch()),onChange:a[21]||(a[21]=o=>e.$emit("touched"))},null,8,["modelValue","class"]),t("label",De,l(e.$t("managers.layersManagement.layerOrder"))+" * ",1)]),r(b,{class:"p-mt-1",vComp:e.v$.layer.layerOrder,additionalTranslateParams:{fieldName:e.$t("managers.layersManagement.layerOrder")}},null,8,["vComp","additionalTranslateParams"])]),t("div",ze,[t("span",Ie,[r($,{id:"layerRoles",class:"kn-material-input",modelValue:e.layer.roles,"onUpdate:modelValue":a[22]||(a[22]=o=>e.layer.roles=o),options:e.allRoles,optionLabel:"name",display:"chip",filter:!0},null,8,["modelValue","options"]),t("label",Ne,l(e.$t("common.roles")),1)])])])]),_:1}),r(u,{id:"layer-type-card",class:"p-mt-3"},{content:i(()=>[t("form",Ue,[t("div",Se,[t("span",Be,[r(v,{id:"layerType",class:f(["kn-material-input",{"p-invalid":e.v$.layer.type.$invalid&&e.v$.layer.type.$dirty}]),modelValue:e.v$.layer.type.$model,"onUpdate:modelValue":a[23]||(a[23]=o=>e.v$.layer.type.$model=o),options:e.layerTypes,optionLabel:"label",optionValue:"value",disabled:e.layer.layerId,onBlur:a[24]||(a[24]=o=>e.v$.layer.type.$touch()),onChange:a[25]||(a[25]=o=>e.$emit("touched"))},null,8,["modelValue","options","class","disabled"]),t("label",Pe,l(e.$t("common.type"))+" *",1)]),r(b,{class:"p-mt-1",vComp:e.v$.layer.type,additionalTranslateParams:{fieldName:e.$t("common.type")}},null,8,["vComp","additionalTranslateParams"])]),e.layer.type=="File"?(s(),m("div",Re,[t("div",Oe,[t("span",qe,[r(d,{id:"fileName",class:"kn-material-input",modelValue:e.layer.pathFile,"onUpdate:modelValue":a[26]||(a[26]=o=>e.layer.pathFile=o),disabled:!0},null,8,["modelValue"]),t("label",je,l(e.$t("managers.layersManagement.fileLocation")),1)])]),r(L,{icon:"fas fa-upload",class:"p-button-text p-button-plain p-ml-2",onClick:e.setUploadType},null,8,["onClick"]),e.uploading?h("",!0):(s(),w(E,{key:0,changeFunction:e.uploadLayerFile,accept:".json",triggerInput:e.triggerUpload},null,8,["changeFunction","triggerInput"]))])):h("",!0),e.layer.type=="WFS"||e.layer.type=="WMS"||e.layer.type=="TMS"?(s(),m("div",Ke,[t("span",Xe,[r(d,{id:"label",class:f(["kn-material-input",{"p-invalid":e.v$.layer.layerURL.$invalid&&e.v$.layer.layerURL.$dirty}]),type:"text",maxLength:"100",modelValue:e.v$.layer.layerURL.$model,"onUpdate:modelValue":a[27]||(a[27]=o=>e.v$.layer.layerURL.$model=o),onBlur:a[28]||(a[28]=o=>e.v$.layer.layerURL.$touch()),onChange:a[29]||(a[29]=o=>e.$emit("touched"))},null,8,["modelValue","class"]),t("label",We,l(e.$t("managers.layersManagement.layerURL"))+" * ",1)]),r(b,{class:"p-mt-1",vComp:e.v$.layer.layerURL,additionalTranslateParams:{fieldName:e.$t("managers.layersManagement.layerURL")}},null,8,["vComp","additionalTranslateParams"])])):h("",!0),e.layer.type=="Google"||e.layer.type=="WMS"||e.layer.type=="TMS"?(s(),m("div",{key:2,class:f([{"p-lg-6":e.layer.type=="WMS","p-lg-12":e.layer.type!="WMS"},"p-field p-col-12 p-lg-6"])},[t("span",Qe,[r(d,{id:"label",class:"kn-material-input",type:"text",maxLength:"100",modelValue:e.layer.layerOptions,"onUpdate:modelValue":a[30]||(a[30]=o=>e.layer.layerOptions=o),onChange:a[31]||(a[31]=o=>e.$emit("touched"))},null,8,["modelValue"]),t("label",Je,l(e.$t("managers.layersManagement.layerOptions")),1)])],2)):h("",!0),e.layer.type=="WMS"?(s(),m("div",Ye,[t("span",Ge,[r(d,{id:"label",class:"kn-material-input",type:"text",maxLength:"100",modelValue:e.layer.layerParams,"onUpdate:modelValue":a[32]||(a[32]=o=>e.layer.layerParams=o),onChange:a[33]||(a[33]=o=>e.$emit("touched"))},null,8,["modelValue"]),t("label",He,l(e.$t("managers.layersManagement.layerParams")),1)])])):h("",!0)])]),_:1})],64)}var Ze=C(oe,[["render",_e]]);const ea=["property"];var aa={filterFields:ea};const ta=M({name:"layers-management-filter-tab",components:{Listbox:U},props:{selectedLayer:{type:Object,required:!0},propFilters:{type:Array}},emits:["touched"],data(){return{layersManagementFilterTabDescriptor:aa,layer:null,filters:[]}},watch:{selectedLayer(){this.loadLayer(),this.loadFilters()},propFilters(){this.loadFilters()}},created(){this.loadLayer(),this.loadFilters()},methods:{loadLayer(){this.layer=this.selectedLayer},loadFilters(){var e;this.filters=[],(e=this.propFilters)==null||e.forEach(a=>{var c;((c=this.layer)==null?void 0:c.properties.findIndex(g=>g.property===a.property))===-1&&this.filters.push(a)})},addProperty(e){var a;this.moveProperty(e,this.filters,(a=this.layer)==null?void 0:a.properties)},removeProperty(e){var a;this.moveProperty(e,(a=this.layer)==null?void 0:a.properties,this.filters)},moveProperty(e,a,p){const c=a.findIndex(g=>g.property===e.property);c!==-1&&(p.push(e),a.splice(c,1),this.$emit("touched"))}}}),oa={class:"layers-management-filters"},ra={key:0,class:"p-grid"},na={class:"p-col"},la=["onClick"],ia={class:"kn-list-item-text"},da=["data-test"],sa={class:"p-col"},ca=["onClick"],ba={class:"kn-list-item-text"};function pa(e,a,p,c,g,A){const d=n("Toolbar"),b=n("Listbox");return s(),m("div",oa,[e.layer?(s(),m("div",ra,[t("div",na,[r(d,{class:"kn-toolbar kn-toolbar--secondary"},{start:i(()=>[y(l(e.$t("managers.layersManagement.layerFilter")),1)]),_:1}),r(b,{class:"kn-list layers-management-property-container",options:e.filters,filter:!0,filterPlaceholder:e.$t("common.search"),optionLabel:"property",filterMatchMode:"contains",filterFields:e.layersManagementFilterTabDescriptor.filterFields,emptyFilterMessage:e.$t("common.info.noDataFound"),"data-test":"available-properties-list"},{empty:i(()=>[y(l(e.$t("common.info.noDataFound")),1)]),option:i(k=>[t("div",{class:"kn-list-item",onClick:v=>e.addProperty(k.option)},[t("div",ia,[t("span",{"data-test":"available-property-"+k.option.property},l(k.option.property),9,da)])],8,la)]),_:1},8,["options","filterPlaceholder","filterFields","emptyFilterMessage"])]),t("div",sa,[r(d,{class:"kn-toolbar kn-toolbar--secondary"},{start:i(()=>[y(l(e.$t("managers.layersManagement.layerFilterAdded")),1)]),_:1}),r(b,{class:"kn-list layers-management-property-container",options:e.layer.properties,filter:!0,filterPlaceholder:e.$t("common.search"),optionLabel:"property",filterMatchMode:"contains",filterFields:e.layersManagementFilterTabDescriptor.filterFields,emptyFilterMessage:e.$t("common.info.noDataFound"),"data-test":"selected-properties-list"},{empty:i(()=>[y(l(e.$t("managers.layersManagement.noFilterSelected")),1)]),option:i(k=>[t("div",{class:"kn-list-item",onClick:v=>e.removeProperty(k.option)},[t("div",ba,[t("span",null,l(k.option.property),1)])],8,ca)]),_:1},8,["options","filterPlaceholder","filterFields","emptyFilterMessage"])])])):h("",!0)])}var ka=C(ta,[["render",pa],["__scopeId","data-v-62821bd7"]]);const ma=M({components:{TabView:S,TabPanel:B,LayerTab:Ze,FilterTab:ka,Toast:P},props:{selectedLayer:{type:Object,required:!0},allRoles:{type:Array,required:!0},allCategories:{type:Array,required:!0}},computed:{buttonDisabled(){return this.v$.$invalid}},emits:["touched","closed","saved"],data(){return{v$:z(),touched:!1,layer:{},loading:!1,activeIndex:0,filters:[]}},setup(){return{store:D()}},async created(){this.loadLayer(),this.getRolesForLayer()},watch:{selectedLayer(){this.loadLayer(),this.getRolesForLayer()}},methods:{loadLayer(){this.layer=this.selectedLayer,this.layer.properties=this.layer.properties?this.layer.properties.map(e=>({property:e})):[]},async getRolesForLayer(){this.layer.layerId&&await this.$http.post("/knowage/restful-services/layers/postitem",this.selectedLayer).then(e=>this.layer.roles=e.data)},closeTemplateConfirm(){this.touched?this.$confirm.require({message:this.$t("common.toast.unsavedChangesMessage"),header:this.$t("common.toast.unsavedChangesHeader"),icon:"pi pi-exclamation-triangle",accept:()=>{this.touched=!1,this.closeTemplate()}}):this.closeTemplate()},closeTemplate(){this.$router.push("/layers-management"),this.$emit("closed")},onTabChange(){this.activeIndex===1&&this.loadFilters()},async loadFilters(){this.layer&&(this.loading=!0,await this.$http.get(`/knowage/restful-services/layers/getFilter?id=${this.layer.layerId}`).then(e=>this.filters=e.data),this.loading=!1)},saveOrUpdateMessage(e){let a=e,p="/knowage/restful-services/layers";if(this.layer.layerFile){let c=new FormData;c.append("data",JSON.stringify(this.layer)),c.append("layerFile",this.layer.layerFile.file),e.layerId?p="/knowage/restful-services/layers/updateData":p="/knowage/restful-services/layers/addData",a=c}return e.layerId?this.$http.put(p,a,{headers:{Accept:"application/json, text/plain, */*","Content-Type":"multipart/form-data","X-Disable-Errors":"true"}}):this.$http.post(p,a,{headers:{Accept:"application/json, text/plain, */*","Content-Type":"multipart/form-data","X-Disable-Errors":"true"}})},async saveLayer(){this.layer.roles===null&&(this.layer.roles=[]),await this.saveOrUpdateMessage(this.layer).then(e=>{this.store.setInfo({title:this.$t("common.toast.success"),msg:this.$t("common.toast.success")});let a=this.layer.layerId?this.layer.layerId:e.data.id;this.$emit("saved",a)}).catch(e=>{this.$toast.add({severity:"error",summary:this.$t("common.error.generic"),detail:e.message,life:3e3})})}}});function ua(e,a,p,c,g,A){const d=n("Button"),b=n("Toolbar"),k=n("ProgressBar"),v=n("LayerTab"),u=n("TabPanel"),x=n("FilterTab"),$=n("TabView"),L=n("Toast");return s(),m(F,null,[r(b,{class:"kn-toolbar kn-toolbar--secondary p-m-0"},{start:i(()=>[y(l(e.selectedLayer.label),1)]),end:i(()=>[r(d,{icon:"pi pi-save",class:"p-button-text p-button-rounded p-button-plain",disabled:e.buttonDisabled,onClick:e.saveLayer},null,8,["disabled","onClick"]),r(d,{icon:"pi pi-times",class:"p-button-text p-button-rounded p-button-plain",onClick:e.closeTemplateConfirm},null,8,["onClick"])]),_:1}),e.loading?(s(),w(k,{key:0,mode:"indeterminate",class:"kn-progress-bar"})):h("",!0),r($,{activeIndex:e.activeIndex,"onUpdate:activeIndex":a[1]||(a[1]=E=>e.activeIndex=E),onTabChange:e.onTabChange,class:"kn-overflow"},{default:i(()=>[r(u,null,{header:i(()=>[t("span",null,l(e.$t("managers.layersManagement.layerTitle")),1)]),default:i(()=>[r(v,{selectedLayer:e.selectedLayer,allRoles:e.allRoles,allCategories:e.allCategories,onTouched:a[0]||(a[0]=E=>e.$emit("touched"))},null,8,["selectedLayer","allRoles","allCategories"])]),_:1}),e.layer.layerId?(s(),w(u,{key:0},{header:i(()=>[t("span",null,l(e.$t("managers.layersManagement.filterTitle")),1)]),default:i(()=>[r(x,{selectedLayer:e.selectedLayer,propFilters:e.filters},null,8,["selectedLayer","propFilters"])]),_:1})):h("",!0)]),_:1},8,["activeIndex","onTabChange"]),r(L,{position:"top-left",group:"tl"})],64)}var ga=C(ma,[["render",ua]]);const va=M({name:"layers-management-hint",components:{KnHint:G}});function ha(e,a,p,c,g,A){const d=n("KnHint");return s(),w(d,{title:e.$t("managers.layersManagement.title"),hint:e.$t("managers.layersManagement.hint")},null,8,["title","hint"])}var fa=C(va,[["render",ha]]);const ya={style:{height:"40%","max-height":"40%","max-width":"20%","min-width":"20%"}},wa=["geojson"],xa=["geojson","kml","shp"];var $a={dialog:ya,downloadModes:wa,downloadModesWFS:xa};const Ma=M({name:"qbe-join-definition-dialog",components:{Dialog:R,RadioButton:H},props:{visible:{type:Boolean},layer:{type:Object,required:!0}},emits:["close"],data(){return{layersManagementDownloadDialogDescriptor:$a,downloadMode:"geojson"}},computed:{modes(){return this.layer.type==="WFS"?this.layersManagementDownloadDialogDescriptor.downloadModesWFS:this.layersManagementDownloadDialogDescriptor.downloadModes}},created(){},methods:{closeDialog(){this.$emit("close")},async download(){await this.$http.get(`/knowage/restful-services/layers/getDownload?id=${this.layer.layerId}%2CtypeWFS=${this.downloadMode}`,{headers:{Accept:"application/json, text/plain, */*"}}).then(e=>{this.downloadMode==="geojson"?O(JSON.stringify(e.data),this.layer.name,"application/json"):window.open(e.data.url),this.$emit("close")}).catch(()=>{})}}}),Ca={key:0,class:"p-m-5"};function Aa(e,a,p,c,g,A){const d=n("Toolbar"),b=n("RadioButton"),k=n("Button"),v=n("Dialog");return s(),w(v,{id:"qbe-join-definition-dialog",class:"p-fluid kn-dialog--toolbar--primary",visible:e.visible,modal:!0,closable:!1},{header:i(()=>[r(d,{class:"kn-toolbar kn-toolbar--primary p-p-0 p-m-2 p-col-12"},{start:i(()=>[y(l(e.$t("managers.layersManagement.downloadDialogTitle")),1)]),_:1})]),footer:i(()=>[r(k,{class:"kn-button kn-button--secondary",onClick:e.closeDialog},{default:i(()=>[y(l(e.$t("common.cancel")),1)]),_:1},8,["onClick"]),r(k,{class:"kn-button kn-button--primary",onClick:e.download},{default:i(()=>[y(l(e.$t("common.download")),1)]),_:1},8,["onClick"])]),default:i(()=>[e.layer?(s(),m("div",Ca,[(s(!0),m(F,null,q(e.modes,(u,x)=>(s(),m("div",{class:"p-field-radiobutton p-d-flex p-flex-row",key:x},[r(b,{name:"downloadMode",value:u,modelValue:e.downloadMode,"onUpdate:modelValue":a[0]||(a[0]=$=>e.downloadMode=$)},null,8,["value","modelValue"]),t("label",null,l(e.$t(`managers.layersManagement.downloadTypes.${u}`)),1)]))),128))])):h("",!0)]),_:1},8,["visible"])}var La=C(Ma,[["render",Aa]]);const Ta=M({name:"roles-management",components:{FabButton:j,KnListBox:K,LayersManagementDetailView:ga,LayersManagementHint:fa,LayersManagementDownloadDialog:La},data(){return{descriptor:ee,allLayers:[],allRoles:[],allCategories:[],selectedLayer:null,touched:!1,loading:!1,downloadDialogVisible:!1,selectedLayerForDownload:null}},setup(){return{store:D()}},async created(){this.loadPage()},methods:{async loadPage(){this.loading=!0,this.touched=!1,await Promise.all([await this.getAllLayers(),await this.getAllRoles(),await this.getAllCategories()]),this.loading=!1},async getAllLayers(){await this.$http.get("/knowage/restful-services/layers").then(e=>this.allLayers=e.data.root)},async getAllRoles(){await this.$http.get("/knowage/restful-services/layers/getroles?").then(e=>this.allRoles=e.data)},async getAllCategories(){await this.$http.get("/knowage/restful-services/domains/listValueDescriptionByType?DOMAIN_TYPE=GEO_CATEGORY").then(e=>this.allCategories=e.data)},showDetail(e){this.touched?this.$confirm.require({message:this.$t("common.toast.unsavedChangesMessage"),header:this.$t("common.toast.unsavedChangesHeader"),icon:"pi pi-exclamation-triangle",accept:()=>{this.touched=!1,this.selectedLayer=e.item?T(e.item):T(this.descriptor.newLayer)}}):this.selectedLayer=e.item?T(e.item):T(this.descriptor.newLayer)},deleteLayerConfirm(e){this.$confirm.require({message:this.$t("common.toast.deleteMessage"),header:this.$t("common.toast.deleteTitle"),icon:"pi pi-exclamation-triangle",accept:()=>this.deleteLayer(e.item.layerId)})},async deleteLayer(e){await this.$http.post(`/knowage/restful-services/layers/deleteLayer?id=${e}`).then(()=>{var a;this.store.setInfo({title:this.$t("common.toast.deleteTitle"),msg:this.$t("common.toast.deleteSuccess")}),e==((a=this.selectedLayer)==null?void 0:a.layerId)&&this.onDetailClose(),this.getAllLayers()})},onDetailClose(){this.touched=!1,this.selectedLayer=null},downloadLayerFile(e){console.log("DOWNLOAD layer: ",e.item),this.selectedLayerForDownload=e.item,this.downloadDialogVisible=!0},async reloadPageOnSave(e){await this.loadPage();let a=this.allLayers.find(p=>p.layerId===e);this.selectedLayer=T(a)}}}),Ea={class:"kn-page"},Fa={class:"kn-page-content p-grid p-m-0"},Va={class:"kn-list--column p-col-4 p-sm-4 p-md-3 p-p-0"},Da={class:"p-col-8 p-sm-8 p-md-9 p-p-0 p-m-0 kn-router-view"};function za(e,a,p,c,g,A){const d=n("FabButton"),b=n("Toolbar"),k=n("ProgressBar"),v=n("KnListBox"),u=n("LayersManagementDetailView"),x=n("LayersManagementHint"),$=n("LayersManagementDownloadDialog");return s(),m("div",Ea,[t("div",Fa,[t("div",Va,[r(b,{class:"kn-toolbar kn-toolbar--primary"},{start:i(()=>[y(l(e.$t("managers.layersManagement.title")),1)]),end:i(()=>[r(d,{icon:"fas fa-plus",onClick:e.showDetail,"data-test":"open-form-button"},null,8,["onClick"])]),_:1}),e.loading?(s(),w(k,{key:0,mode:"indeterminate",class:"kn-progress-bar","data-test":"progress-bar"})):h("",!0),r(v,{options:e.allLayers,settings:e.descriptor.knListSettings,onClick:e.showDetail,onDelete:V(e.deleteLayerConfirm,["stop"]),onDownload:V(e.downloadLayerFile,["stop"])},null,8,["options","settings","onClick","onDelete","onDownload"])]),t("div",Da,[e.selectedLayer?(s(),w(u,{key:0,selectedLayer:e.selectedLayer,allRoles:e.allRoles,allCategories:e.allCategories,onClosed:e.onDetailClose,onSaved:e.reloadPageOnSave,onTouched:a[0]||(a[0]=L=>e.touched=!0)},null,8,["selectedLayer","allRoles","allCategories","onClosed","onSaved"])):(s(),w(x,{key:1}))]),r($,{visible:e.downloadDialogVisible,layer:e.selectedLayerForDownload,onClose:a[1]||(a[1]=L=>e.downloadDialogVisible=!1)},null,8,["visible","layer"])])])}var ja=C(Ta,[["render",za]]);export{ja as default};
//# sourceMappingURL=LayersManagement-a1c271ee.js.map
