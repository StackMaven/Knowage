{"version":3,"file":"AlertDefinition-04c30b3b.js","sources":["../../../../modules/kpi/alertDefinition/AlertDefinition.vue"],"sourcesContent":["<template>\r\n    <div class=\"kn-page\">\r\n        <div class=\"kn-page-content p-grid p-m-0\">\r\n            <div class=\"kn-list--column p-col-4 p-sm-4 p-md-3 p-p-0\">\r\n                <Toolbar class=\"kn-toolbar kn-toolbar--primary\">\r\n                    <template #start>\r\n                        {{ $t('kpi.alert.title') }}\r\n                    </template>\r\n                    <template #end>\r\n                        <KnFabButton icon=\"fas fa-plus\" @click=\"showForm\" data-test=\"open-form-button\"></KnFabButton>\r\n                    </template>\r\n                </Toolbar>\r\n                <ProgressBar mode=\"indeterminate\" class=\"kn-progress-bar\" v-if=\"loading\" data-test=\"progress-bar\" />\r\n                <Listbox\r\n                    v-if=\"!loading\"\r\n                    class=\"kn-list--column\"\r\n                    :options=\"alertList\"\r\n                    :filter=\"true\"\r\n                    :filterPlaceholder=\"$t('common.search')\"\r\n                    optionLabel=\"name\"\r\n                    filterMatchMode=\"contains\"\r\n                    :filterFields=\"alertDescriptor.filterFields\"\r\n                    :emptyFilterMessage=\"$t('common.info.noDataFound')\"\r\n                    @change=\"showForm\"\r\n                    data-test=\"target-list\"\r\n                >\r\n                    <template #empty>{{ $t('common.info.noDataFound') }}</template>\r\n                    <template #option=\"slotProps\">\r\n                        <div class=\"kn-list-item\" data-test=\"list-item\">\r\n                            <div class=\"kn-list-item-text\">\r\n                                <span>{{ slotProps.option.name }}</span>\r\n                                <span class=\"kn-list-item-text-secondary\">{{ slotProps.option.status }}</span>\r\n                            </div>\r\n                            <Button icon=\"pi pi-trash\" class=\"p-button-text p-button-rounded p-button-plain\" @click.stop=\"deleteAlertConfirm(slotProps.option.id)\" :data-test=\"'delete-button'\" />\r\n                            <Button v-if=\"slotProps.option.status == 'SUSPENDED'\" icon=\"pi pi-play\" class=\"p-button-text p-button-rounded p-button-plain\" @click.stop=\"handleStatus(slotProps.option)\" :data-test=\"'resume-button'\" />\r\n                            <Button v-if=\"slotProps.option.status == 'ACTIVE'\" icon=\"pi pi-pause\" class=\"p-button-text p-button-rounded p-button-plain\" @click.stop=\"handleStatus(slotProps.option)\" :data-test=\"'suspend-button'\" />\r\n                        </div>\r\n                    </template>\r\n                </Listbox>\r\n            </div>\r\n            <div class=\"p-col-8 p-sm-8 p-md-9 p-p-0 p-m-0 kn-router-view\">\r\n                <router-view @close=\"closeForm\" @touched=\"touched = true\" @saved=\"reloadAlert\" />\r\n            </div>\r\n        </div>\r\n    </div>\r\n</template>\r\n<script lang=\"ts\">\r\nimport { defineComponent } from 'vue'\r\nimport { iAlert } from './AlertDefinition'\r\nimport KnFabButton from '@/components/UI/KnFabButton.vue'\r\nimport Listbox from 'primevue/listbox'\r\nimport { AxiosResponse } from 'axios'\r\nimport alertDescriptor from './AlertDefinitionDescriptor.json'\r\nimport mainStore from '../../../App.store'\r\n\r\nexport default defineComponent({\r\n    name: 'alert',\r\n    components: { KnFabButton, Listbox },\r\n    data() {\r\n        return {\r\n            alertDescriptor,\r\n            alertList: [] as iAlert[],\r\n            loading: false,\r\n            touched: false\r\n        }\r\n    },\r\n    setup() {\r\n        const store = mainStore()\r\n        return { store }\r\n    },\r\n    created() {\r\n        this.loadAllAlerts()\r\n    },\r\n    methods: {\r\n        async loadAllAlerts() {\r\n            this.loading = true\r\n            await this.$http\r\n                .get(import.meta.env.VITE_RESTFUL_SERVICES_PATH + '1.0/alert/listAlert')\r\n                .then(\r\n                    (response: AxiosResponse<any>) =>\r\n                        (this.alertList = response.data.map((alert: any) => {\r\n                            return {\r\n                                id: alert.id,\r\n                                name: alert.name,\r\n                                status: alert.jobStatus\r\n                            }\r\n                        }))\r\n                )\r\n                .finally(() => (this.loading = false))\r\n        },\r\n        showForm(alert: any) {\r\n            const path = alert.value ? `/alert/${alert.value.id}` : `/alert/new-alert`\r\n            this.$router.push(path)\r\n        },\r\n        deleteAlertConfirm(alertId: number) {\r\n            this.$confirm.require({\r\n                message: this.$t('common.toast.deleteMessage'),\r\n                header: this.$t('common.toast.deleteTitle'),\r\n                icon: 'pi pi-exclamation-triangle',\r\n                accept: () => this.deleteAlert(alertId)\r\n            })\r\n        },\r\n        async deleteAlert(id: number) {\r\n            await this.$http.delete(import.meta.env.VITE_RESTFUL_SERVICES_PATH + '1.0/alert/' + id + '/delete').then(() => {\r\n                this.store.setInfo({\r\n                    title: this.$t('common.toast.deleteTitle'),\r\n                    msg: this.$t('common.toast.deleteSuccess')\r\n                })\r\n                this.$router.push('/alert')\r\n                this.loadAllAlerts()\r\n            })\r\n        },\r\n        async handleStatus(alert) {\r\n            if (alert.status !== 'EXPIRED') {\r\n                var data = 'scheduler/' + (alert.status == 'SUSPENDED' ? 'resumeTrigger' : 'pauseTrigger') + '?jobGroup=ALERT_JOB_GROUP&triggerGroup=ALERT_JOB_GROUP&jobName=' + alert.id + '&triggerName=' + alert.id\r\n                await this.$http.post(import.meta.env.VITE_RESTFUL_SERVICES_PATH + data)\r\n                this.loadAllAlerts()\r\n            }\r\n        },\r\n        closeForm() {\r\n            if (!this.touched) {\r\n                this.handleClose()\r\n            } else {\r\n                this.$confirm.require({\r\n                    message: this.$t('common.toast.unsavedChangesMessage'),\r\n                    header: this.$t('common.toast.unsavedChangesHeader'),\r\n                    icon: 'pi pi-exclamation-triangle',\r\n                    accept: () => {\r\n                        this.touched = false\r\n                        this.handleClose()\r\n                    }\r\n                })\r\n            }\r\n        },\r\n        handleClose() {\r\n            this.$router.replace('/alert')\r\n        },\r\n        reloadAlert(id) {\r\n            this.$router.replace(`/alert/${id}`)\r\n            this.touched = false\r\n            this.loadAllAlerts()\r\n        }\r\n    }\r\n})\r\n</script>\r\n"],"names":["Listbox","mainStore","_openBlock","_createElementBlock","_createElementVNode","_createVNode","_withCtx","_createBlock","_createCommentVNode","_toDisplayString"],"mappings":"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"}