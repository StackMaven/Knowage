import{f as w}from"./filterHelper-a723991a.js";import{_ as v,d as F,l as B,n as T,X as V,s as K,r as s,o,c,f as n,w as i,g as p,t as f,a as r,h as l,A as M,B as _,C as L,D as h}from"./index-1e676509.js";import{K as N}from"./KnHint-6d455703.js";const I=[{field:"rule",header:"kpi.measureDefinition.rulesName",style:{}},{field:"alias",header:"kpi.measureDefinition.measureName",style:{}},{field:"category.valueCd",header:"kpi.measureDefinition.category",style:{}},{field:"author",header:"common.author",style:{}}],H=["alias","rule","category.valueCd","author"],P={iconColumn:{style:{"text-align":"end"}}};var R={columns:I,globalFilterFields:H,table:P};const S=F({name:"measure-definition",components:{Column:B,DataTable:T,KnFabButton:V,KnHint:N},data(){return{measureDefinitionDescriptor:R,measuresList:[],filters:{global:[w]},loading:!1}},setup(){return{store:K()}},async created(){await this.loadPage()},methods:{async loadPage(){this.loading=!0,await this.loadMeasures(),this.loading=!1},async loadMeasures(){this.measuresList=[],await this.$http.get("/knowage/restful-services/1.0/kpi/listMeasure").then(e=>e.data.forEach(t=>{t.category&&(t.categoryName=t.translatedValueName),this.measuresList.push(t)}))},showForm(e,t){const d=e?`/measure-definition/edit?id=${e.ruleId}&ruleVersion=${e.ruleVersion}&clone=${t}`:"/measure-definition/new-measure-definition";this.$router.push(d)},cloneKpiConfirm(e){this.$confirm.require({header:this.$t("common.toast.cloneConfirmTitle"),accept:()=>this.showForm(e,!0)})},deleteMeasureConfirm(e){this.$confirm.require({message:this.$t("common.toast.deleteMessage"),header:this.$t("common.toast.deleteTitle"),icon:"pi pi-exclamation-triangle",accept:()=>this.deleteMeasure(e)})},async deleteMeasure(e){await this.$http.delete(`/knowage/restful-services/1.0/kpi/${e.ruleId}/${e.ruleVersion}/deleteRule`).then(()=>{this.store.setInfo({title:this.$t("common.toast.deleteTitle"),msg:this.$t("common.toast.deleteSuccess")}),this.loadPage()}).catch(()=>{})}}}),q={class:"kn-page"},E={class:"kn-page-content"},U={class:"table-header p-d-flex"},z={class:"p-input-icon-left p-mr-3"},A=r("i",{class:"pi pi-search"},null,-1);function G(e,t,d,X,j,J){const g=s("KnFabButton"),b=s("Toolbar"),k=s("ProgressBar"),y=s("KnHint"),$=s("InputText"),u=s("Column"),m=s("Button"),C=s("DataTable");return o(),c("div",q,[n(b,{class:"kn-toolbar kn-toolbar--primary"},{start:i(()=>[p(f(e.$t("kpi.measureDefinition.title")),1)]),end:i(()=>[n(g,{icon:"fas fa-plus",onClick:t[0]||(t[0]=a=>e.showForm(null,!1)),"data-test":"new-button"})]),_:1}),r("div",E,[e.loading?(o(),l(k,{key:0,mode:"indeterminate",class:"kn-progress-bar","data-test":"progress-bar"})):M("",!0),e.measuresList.length===0&&!e.loading?(o(),l(y,{key:1,title:"kpi.measureDefinition.title",hint:"kpi.measureDefinition.hint","data-test":"measure-hint"},null,8,["title","hint"])):(o(),l(C,{key:2,value:e.measuresList,rowGroupMode:"rowspan",groupRowsBy:"rule",paginator:!0,rows:15,loading:e.loading,class:"p-datatable-sm kn-table",dataKey:"id",filters:e.filters,"onUpdate:filters":t[2]||(t[2]=a=>e.filters=a),globalFilterFields:e.measureDefinitionDescriptor.globalFilterFields,responsiveLayout:"stack",breakpoint:"960px",onRowClick:t[3]||(t[3]=a=>e.showForm(a.data,!1)),"data-test":"measures-table"},{loading:i(()=>[p(f(e.$t("common.info.dataLoading")),1)]),header:i(()=>[r("div",U,[r("span",z,[A,n($,{class:"kn-material-input",modelValue:e.filters.global.value,"onUpdate:modelValue":t[1]||(t[1]=a=>e.filters.global.value=a),type:"text",placeholder:e.$t("common.search"),"data-test":"filterInput"},null,8,["modelValue","placeholder"])])])]),default:i(()=>[(o(!0),c(_,null,L(e.measureDefinitionDescriptor.columns,a=>(o(),l(u,{class:"kn-truncated",style:h(a.style),field:a.field,header:e.$t(a.header),key:a.field,sortable:!0},null,8,["style","field","header"]))),128)),n(u,{style:h(e.measureDefinitionDescriptor.table.iconColumn.style)},{body:i(a=>[n(m,{icon:"pi pi-copy",class:"p-button-link",onClick:D=>e.cloneKpiConfirm(a.data),"data-test":"clone-button"},null,8,["onClick"]),n(m,{icon:"pi pi-trash",class:"p-button-link",onClick:D=>e.deleteMeasureConfirm(a.data),"data-test":"delete-button-"+a.data.id},null,8,["onClick","data-test"])]),_:1},8,["style"])]),_:1},8,["value","loading","filters","globalFilterFields"]))])])}var Y=v(S,[["render",G]]);export{Y as default};
//# sourceMappingURL=MeasureDefinition-f15f0984.js.map
