import{K as j,u as L,c as X}from"./KnValidatonMessages-ebe48c72.js";import{d as S,i as q,n as K,l as Q,_ as z,r as i,o as s,h as y,w as l,f as a,g as x,t as n,a as o,G as I,A as k,ad as ve,a5 as O,a9 as se,m as Y,s as U,a1 as R,c as $,D as T,a4 as ce,y as G,z as _,V as F,B as Z,C as pe,ah as fe,a8 as le,ai as be,aj as ke,v as we,u as ye,k as xe}from"./index-1e676509.js";import{X as De}from"./x2js-1de3b703.js";import{f as H}from"./filterHelper-a723991a.js";import{s as Ce}from"./textarea.esm-32051d54.js";import{s as ue}from"./inputswitch.esm-80317a38.js";import{s as me}from"./checkbox.esm-fa6c8259.js";import{s as $e}from"./tree.esm-837306a6.js";import{s as P}from"./inlinemessage.esm-1edef892.js";import{K as W}from"./KnListBox-94855720.js";import"./menu.esm-6bee86d0.js";const Me=[{location:null,name:"foodmart",role:null,sourceCatalogue:null,sourceId:2,sourceSchema:"FOODMART",type:"database",url:"url"},{location:null,name:"foodmart_demo",role:null,sourceCatalogue:"foodmart_demo",sourceId:5,sourceSchema:null,type:"database",url:"url"}],Ae={engine:"",functionalities:[],label:"",lockedByUser:!1,name:"",refreshSeconds:0,stateCode:"",typeCode:"",visible:!0},Ee=[{deleted:!1,name:"warehouse",tableId:212},{deleted:!1,name:"employee_closure",tableId:214},{deleted:!1,name:"TEST_02",tableId:52},{deleted:!1,name:"foodmap",tableId:213},{deleted:!1,name:"SALARY",tableId:51},{deleted:!1,name:"sales_segment_ly",tableId:215},{deleted:!1,name:"PROMOTION",tableId:50}],Ie=[{domainCode:"STATE",domainName:"Object state",translatedValueDescription:"Document temporanlly not in use",translatedValueName:"Suspended",valueCd:"SUSP",valueDescription:"sbidomains.ds.susp",valueId:36,valueName:"sbidomains.nm.susp"},{domainCode:"STATE",domainName:"Object state",translatedValueDescription:"Document in development phase",translatedValueName:"Development",valueCd:"DEV",valueDescription:"sbidomains.ds.dev",valueId:40,valueName:"sbidomains.nm.dev"},{domainCode:"STATE",domainName:"Object state",translatedValueDescription:"Document in testing phase",translatedValueName:"Test",valueCd:"TEST",valueDescription:"sbidomains.ds.test",valueId:41,valueName:"sbidomains.nm.test"},{domainCode:"STATE",domainName:"Object state",translatedValueDescription:"Document released for end users use",translatedValueName:"Released",valueCd:"REL",valueDescription:"sbidomains.ds.rel",valueId:42,valueName:"sbidomains.nm.rel"}],Te={absoluteScroll:{height:"100%",left:0,"overflow-x":"hidden","overflow-y":"auto",position:"absolute",top:0,width:"100%"},driverDetailsContainer:{display:"flex",flex:3,"flex-direction":"column"},flex:{display:"flex",flex:1,"flex-direction":"column"},previewImage:"175",spinnerStyle:{background:"rgb(0 0 0 / 25%)",height:"100%",position:"absolute",width:"100%","z-index":"9999"},tableHeader:{width:"3em"},width90:{width:"98%"}};var V={metaSourceResource:Me,newDocument:Ae,savedTables:Ee,states:Ie,style:Te};async function ge(e,t,r,d,g,D){var M,v;const p=(M=t.locale)==null?void 0:M.split("_")[0],b=t.userUniqueIdentifier,u=(v=t.locale)==null?void 0:v.split("_")[1];let A=g.name.split(".");const f=A[A.length-1];let w=await Se(e,f,d,g);const m=w.olap.cube._reference;let h=await ze(e,m);if(!h)return;const C=Ue(b,p,u,r,d,w,h);e.get("/knowagewhatifengine/restful-services/olap/startolap",{headers:{Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9"},params:C}).then(()=>{D.push(`/olap-designer/${r}?olapId=${d.id}&olapName=${d.name}&olapLabel=${d.label}&artifactId=${h.currentContentId}`)})}async function Se(e,t,r,d){let g={};return await e.get(`/knowage/restful-services/2.0/documentdetails/${r.id}/templates/selected/${d.id}`,{headers:{Accept:"application/json, text/plain, */*","X-Disable-Errors":"true"}}).then(D=>{t=="sbicockpit"||t=="json"||t=="sbigeoreport"?g=JSON.stringify(D.data,null,4):g=D.data,g=new De().xml2js(g)}),g}async function ze(e,t){let r=null;return await e.get(`/knowage/restful-services/2.0/mondrianSchemasResource/name=${t}`).then(d=>r=d.data),r}function Ue(e,t,r,d,g,D,p){const b=new URLSearchParams;return b.set("user_id",decodeURIComponent(e)),b.set("SBI_LANGUAGE",decodeURIComponent(t)),b.set("SBI_COUNTRY",decodeURIComponent(r)),b.set("ENGINE",g.engine),b.set("SBI_EXECUTION_ID",decodeURIComponent(d)),b.set("DOCUMENT_LABEL",decodeURIComponent(g.label)),b.set("document",decodeURIComponent(""+g.id)),b.set("template",D.olap.JSONTEMPLATE),b.set("SBI_ARTIFACT_ID",decodeURIComponent(""+p.id)),b.set("schemaID",decodeURIComponent(""+p.id)),b.set("SBI_ARTIFACT_VERSION_ID",decodeURIComponent(""+p.currentContentId)),b.set("schemaName",decodeURIComponent(p.name)),b.set("onEditMode",decodeURIComponent("")),b}const Ve=[{label:"common.right",value:"east"},{label:"common.top",value:"north"},{label:"common.bottom",value:"south"},{label:"common.left",value:"west"}],Ne=["name","label","description","author","scope"],Fe={center:{"align-self":"center","text-align":"center"}},Oe={document:[{fieldName:"label",validators:[{key:"required"},{key:"regex",validator:{type:"extendedAlphanumericRegex"}}]},{fieldName:"name",validators:[{key:"required"},{key:"regex",validator:{type:"extendedAlphanumericRegex"}}]},{fieldName:"description",validators:[{key:"regex",validator:{type:"extendedAlphanumericRegex"}}]},{fieldName:"typeCode",validators:[{key:"required"}]},{fieldName:"engine",validators:[{key:"required"}]},{fieldName:"stateCode",validators:[{key:"required"}]}]};var B={driversPositions:Ve,globalFilterFields:Ne,style:Fe,validations:Oe};const Pe=S({name:"dataset-dialog",components:{Dialog:q,DataTable:K,Column:Q},props:{visible:{type:Boolean,required:!1}},emits:["closeDialog","saveSelectedDataset"],data(){return{mainDescriptor:V,infoDescriptor:B,loading:!1,filters:{global:[H]},datasets:[],selectedDataset:{}}},created(){this.getAllDatasets()},methods:{async getAllDatasets(){this.loading=!0,this.$http.get("/knowage/restful-services/2.0/datasets/basicinfo/all/").then(e=>this.datasets=e.data).finally(()=>this.loading=!1)}}}),Le={id:"search-container",class:"p-input-icon-left p-mr-3"},Be=o("i",{class:"pi pi-search"},null,-1);function Re(e,t,r,d,g,D){const p=i("Toolbar"),b=i("InputText"),u=i("Column"),A=i("DataTable"),f=i("Button"),w=i("Dialog");return s(),y(w,{class:"document-details-dialog remove-padding",contentStyle:e.mainDescriptor.style.flex,position:"right",visible:e.visible,modal:!1,closable:!1,baseZIndex:10,autoZIndex:!0},{header:l(()=>[a(p,{class:"kn-toolbar kn-toolbar--secondary kn-width-full"},{start:l(()=>[x(n(e.$t("documentExecution.documentDetails.info.datasetDialogTitle")),1)]),_:1})]),footer:l(()=>[a(f,{class:"p-button-text kn-button",label:e.$t("common.cancel"),onClick:t[3]||(t[3]=m=>e.$emit("closeDialog"))},null,8,["label"]),a(f,{class:"kn-button kn-button--primary",label:e.$t("common.save"),onClick:t[4]||(t[4]=m=>(e.$emit("saveSelectedDataset",e.selectedDataset),e.$emit("closeDialog")))},null,8,["label"])]),default:l(()=>[a(A,{class:"p-datatable-sm kn-table p-m-2",value:e.datasets,dataKey:"id",responsiveLayout:"stack",filters:e.filters,"onUpdate:filters":t[1]||(t[1]=m=>e.filters=m),globalFilterFields:e.infoDescriptor.globalFilterFields,loading:e.loading,selection:e.selectedDataset,"onUpdate:selection":t[2]||(t[2]=m=>e.selectedDataset=m),selectionMode:"single",stripedRows:""},{header:l(()=>[o("span",Le,[Be,a(b,{class:"kn-material-input",modelValue:e.filters.global.value,"onUpdate:modelValue":t[0]||(t[0]=m=>e.filters.global.value=m),type:"text",placeholder:e.$t("common.search"),"data-test":"filterInput"},null,8,["modelValue","placeholder"])])]),empty:l(()=>[x(n(e.$t("common.info.noDataFound")),1)]),default:l(()=>[a(u,{class:"kn-truncated",field:"label",header:e.$t("common.label"),sortable:!0},null,8,["header"]),a(u,{class:"kn-truncated",field:"name",header:e.$t("common.name"),sortable:!0},null,8,["header"]),a(u,{class:"kn-truncated",field:"description",header:e.$t("common.description"),sortable:!0},null,8,["header"]),a(u,{class:"kn-truncated",field:"owner",header:e.$t("common.owner"),sortable:!0},null,8,["header"]),a(u,{class:"kn-truncated",field:"scope",header:e.$t("managers.datasetManagement.scope"),sortable:!0},null,8,["header"])]),_:1},8,["value","filters","globalFilterFields","loading","selection"])]),_:1},8,["contentStyle","visible"])}var _e=z(Pe,[["render",Re]]);const je=S({name:"scheduler-document-accordion-tree",components:{Checkbox:me,Tree:$e},props:{propFunctionalities:{type:Array},propSelectedFolders:{type:Array}},data(){return{functionalities:[],selectedFolders:[],nodes:[],expandedKeys:{}}},watch:{propFunctionalities(){this.loadFunctionalities(),this.createNodeTree(),this.expandAll()},propSelectedFolders(){this.loadSelectedFolders()}},created(){this.loadFunctionalities(),this.createNodeTree(),this.expandAll(),this.loadSelectedFolders()},methods:{loadFunctionalities(){this.functionalities=this.propFunctionalities},loadSelectedFolders(){this.selectedFolders=this.propSelectedFolders?this.propSelectedFolders:[]},createNodeTree(){this.nodes=[];const e=[];this.functionalities.forEach(t=>{const r={key:t.name,id:t.id,parentId:t.parentId,label:t.name,children:[],data:t,path:t.path,customIcon:t.childs?"pi pi-folder-open":"pi pi-folder",selectable:t.codType==="USER_FUNCT"||t.parentId};r.children=e.filter(d=>r.id===d.parentId),this.attachFolderToTree(r,e)})},attachFolderToTree(e,t){var r,d;if(e.parentId){let g=null;for(let D=0;D<t.length;D++)if(e.parentId===t[D].id){e.data.parentFolder=t[D],(r=t[D].children)==null||r.push(e);break}for(let D=0;D<this.nodes.length;D++)if(g=this.findParentFolder(e,this.nodes[D]),g){e.data.parentFolder=g,(d=g.children)==null||d.push(e);break}g||t.push(e)}else this.nodes.push(e)},findParentFolder(e,t){if(e.parentId===t.id)return t;{let r=null;if(t.children)for(let d=0;d<t.children.length&&(r=this.findParentFolder(e,t.children[d]),!r);d++);return r}},expandAll(){for(let e of this.nodes)this.expandNode(e);this.expandedKeys={...this.expandedKeys}},expandNode(e){if(e.children&&e.children.length){this.expandedKeys[e.key]=!0;for(let t of e.children)this.expandNode(t)}},setOpenFolderIcon(e){e.customIcon="pi pi-folder-open"},setClosedFolderIcon(e){e.customIcon="pi pi-folder"},emitSelectedFolders(){this.$emit("selected",this.selectedFolders)}}});function Xe(e,t,r,d,g,D){const p=i("Checkbox"),b=i("Tree");return s(),y(b,{class:"documents-tree",value:e.nodes,expandedKeys:e.expandedKeys,onNodeExpand:t[1]||(t[1]=u=>e.setOpenFolderIcon(u)),onNodeCollapse:t[2]||(t[2]=u=>e.setClosedFolderIcon(u))},{default:l(u=>[o("i",{class:I(["p-mr-2",u.node.customIcon])},null,2),u.node.selectable?(s(),y(p,{key:0,name:"folders",modelValue:e.selectedFolders,"onUpdate:modelValue":t[0]||(t[0]=A=>e.selectedFolders=A),value:u.node.path,onChange:e.emitSelectedFolders},null,8,["modelValue","value","onChange"])):k("",!0),o("b",null,n(u.node.label),1)]),_:1},8,["value","expandedKeys"])}var qe=z(je,[["render",Xe],["__scopeId","data-v-1d9689f3"]]);const Ke=S({name:"document-details-informations",components:{DatasetDialog:_e,Card:ve,Textarea:Ce,Dropdown:O,InputSwitch:ue,KnValidationMessages:j,KnInputFile:se,DocumentDetailsTree:qe},props:{selectedDocument:{type:Object},selectedDataset:{type:Object},availableStates:{type:Array},documentTypes:{type:Array,required:!0},documentEngines:{type:Array,required:!0},availableDatasources:{type:Array},availableFolders:{type:Array},availableTemplates:{type:Array},availableAttributes:{type:Array}},emits:["setTemplateForUpload","setImageForUpload","deleteImage","touched","openDesignerDialog"],computed:{filteredEngines(){return this.document.typeCode?this.documentEngines.filter(e=>e.biobjTypeId===this.documentTypes.filter(t=>t.valueCd===this.document.typeCode)[0].valueId):[]},isDataSourceVisible(){switch(this.document.engine){case"knowageofficeengine":case"knowagecompositedoce":case"knowageprocessengine":case"knowagechartengine":case"knowagenetworkengine":case"knowagecockpitengine":case"knowagedossierengine":case"knowagekpiengine":case"knowagesvgviewerengine":return!1;default:return!0}},isDataSetVisible(){switch(this.document.engine){case"knowagegisengine":case"knowagechartengine":case"knowagenetworkengine":return!0;default:return!1}},getImageUrl(){var e;return`/knowage/servlet/AdapterHTTP?ACTION_NAME=MANAGE_PREVIEW_FILE_ACTION&SBI_ENVIRONMENT=DOCBROWSER&LIGHT_NAVIGATOR_DISABLED=TRUE&operation=DOWNLOAD&fileName=${(e=this.selectedDocument)==null?void 0:e.previewFile}`},designerButtonVisible(){return this.document.typeCode=="OLAP"||this.document.typeCode=="KPI"||this.document.engine=="knowagegisengine"},...Y(U,{user:"user"})},data(){return{v$:L(),mainDescriptor:V,infoDescriptor:B,uploading:!1,lockedByUser:!1,triggerUpload:!1,showDatasetDialog:!1,triggerImageUpload:!1,dataset:{},folders:[],document:{},templates:[],templateToUpload:{name:""},imageToUpload:{name:""},visibilityAttribute:"",restrictionValue:"",driversPositions:B.driversPositions,listOfTemplates:[],imagePreviewUrl:null,imagePreview:!1}},setup(){return{store:U()}},async created(){this.setData(),await this.getAllTemplates()},watch:{async selectedDocument(){this.setData(),await this.getAllTemplates()}},validations(){return{document:X("document",B.validations.document)}},methods:{setData(){this.templates=this.availableTemplates,this.document=this.selectedDocument,this.dataset=this.selectedDataset,this.folders=this.availableFolders,this.resetImagePreview(),this.IsLockedByUser()},IsLockedByUser(){this.lockedByUser=this.document.lockedByUser==="true"},setIsLockedByUser(){this.document.lockedByUser=this.lockedByUser?"true":"false"},addRestriction(){this.document.profiledVisibility?this.document.profiledVisibility=this.document.profiledVisibility+" AND "+this.visibilityAttribute+" = "+this.restrictionValue:this.document.profiledVisibility=this.visibilityAttribute+" = "+this.restrictionValue},clearAllRestrictions(){this.document.profiledVisibility="",this.visibilityAttribute="",this.restrictionValue=""},saveSelectedDataset(e){this.document.dataSetId=e.id,this.dataset=e},setUploadType(){this.triggerUpload=!1,setTimeout(()=>this.triggerUpload=!0,200)},setTemplateForUpload(e){this.uploading=!0,this.templateToUpload=e.target.files[0],this.$emit("setTemplateForUpload",e.target.files[0]),this.triggerUpload=!1,setTimeout(()=>this.uploading=!1,200)},setImageUploadType(){this.triggerImageUpload=!1,setTimeout(()=>this.triggerImageUpload=!0,200)},setImageForUpload(e){this.uploading=!0,this.imageToUpload=e.target.files[0],this.$emit("setImageForUpload",e.target.files[0]),this.setImagePreview(e.target.files[0]),this.triggerImageUpload=!1,setTimeout(()=>this.uploading=!1,200)},setImagePreview(e){this.imagePreviewUrl=URL.createObjectURL(e),this.imagePreview=!0,this.store.setInfo({title:this.$t("common.uploadFileSuccess"),msg:this.$t("documentExecution.documentDetails.info.imageInfo")})},resetImagePreview(){this.imagePreviewUrl=null,this.imagePreview=!1},setFunctionality(e){this.document.functionalities=e},onTypeChange(){this.$emit("touched"),this.document.engine=""},openDesignerConfirm(){this.$confirm.require({header:this.$t("common.toast.warning"),message:this.$t("documentExecution.olap.openDesignerMsg"),icon:"pi pi-exclamation-triangle",accept:()=>{switch(this.document.typeCode){case"KPI":this.openKpiDocumentDesigner();break;case"MAP":{this.openGis();break}default:this.openDesigner()}}})},async openDesigner(){if(this.listOfTemplates.length===0)this.$emit("openDesignerDialog");else{const e=this.findActiveTemplate(),t=R({length:16,type:"base64"});await ge(this.$http,this.user,t,this.document,e,this.$router)}},findActiveTemplate(){let e=null;for(let t=0;t<this.listOfTemplates.length;t++)if(this.listOfTemplates[t].active){e=this.listOfTemplates[t];break}return e},translatedLabel(e){return this.$t(e.label)},openKpiDocumentDesigner(){this.$router.push(`/kpi-edit/${this.document.id}?from=documentDetail`)},openGis(){this.$router.push(`/gis/edit?documentId=${this.document.id}`)},async getAllTemplates(){this.document&&this.document.id&&this.$http.get(`/knowage/restful-services/2.0/documentdetails/${this.document.id}/templates`).then(e=>this.listOfTemplates=e.data)}}}),Qe={class:"p-grid p-m-0 kn-flex"},Je={class:"p-col-7 p-m-0 p-p-0 right-border p-d-flex p-flex-column kn-flex"},Ye={id:"informations-content",class:"kn-flex kn-relative"},Ge={key:0},Ze={class:"p-field p-col-12 p-d-flex"},He={class:"kn-flex"},We={class:"p-float-label"},et={for:"fileName",class:"kn-material-input-label"},tt={class:"p-fluid p-formgrid p-grid p-m-1"},ot={class:"p-field p-col-12 p-lg-6"},at={class:"p-float-label"},rt={for:"label",class:"kn-material-input-label"},nt={class:"p-field p-col-12 p-lg-6"},it={class:"p-float-label"},lt={for:"name",class:"kn-material-input-label"},dt={class:"p-field p-col-12 p-lg-6"},st=["src","height"],ct=["src","height"],pt={class:"p-field p-col-12 p-lg-6"},bt={class:"p-float-label"},kt={for:"description",class:"kn-material-input-label"},ut={class:"p-field p-col-12 p-d-flex"},mt={class:"kn-flex"},gt={class:"p-float-label"},ht={for:"fileName",class:"kn-material-input-label"},vt={class:"p-field p-col-12 p-lg-6"},ft={class:"p-float-label"},wt={for:"type",class:"kn-material-input-label"},yt={class:"p-field p-col-12 p-lg-6"},xt={class:"p-float-label"},Dt={for:"engine",class:"kn-material-input-label"},Ct={for:"datasource",class:"kn-material-input-label"},$t={key:1,class:"p-field p-col-12 p-lg-6 p-d-flex"},Mt={class:"kn-flex"},At={class:"p-float-label"},Et={for:"dataset",class:"kn-material-input-label"},It={class:"p-field p-col-12 p-lg-6"},Tt={class:"p-float-label"},St={for:"state",class:"kn-material-input-label"},zt={class:"p-field p-col-12 p-lg-6"},Ut={class:"p-float-label"},Vt={for:"refresh",class:"kn-material-input-label"},Nt={class:"p-field p-col-12 p-lg-6 p-jc-center p-mt-3"},Ft=o("i",{class:"far fa-eye p-ml-2"},null,-1),Ot={for:"visible",class:"kn-material-input-label p-ml-2"},Pt={class:"p-field p-col-12 p-lg-6 p-mt-3"},Lt=o("i",{class:"fas fa-lock p-ml-2"},null,-1),Bt={for:"locked",class:"kn-material-input-label p-ml-2"},Rt={class:"p-col-5 p-m-0 p-p-0 p-d-flex p-flex-column kn-flex"},_t={id:"position-content",class:"kn-flex kn-relative"},jt={key:0,id:"driver-position-container",class:"p-m-2"},Xt={class:"p-field p-float-label p-col-12"},qt={class:"p-dropdown-option"},Kt={class:"kn-capitalize"},Qt={for:"attributes",class:"kn-material-input-label"},Jt={id:"restriction-container",class:"p-m-2"},Yt={class:"p-formgrid p-grid p-mb-3"},Gt={class:"p-float-label p-col-10"},Zt={for:"profiledVisibility",class:"kn-material-input-label"},Ht={class:"p-formgrid p-grid"},Wt={class:"p-field p-float-label p-col-12 p-lg-5"},eo={for:"attributes",class:"kn-material-input-label"},to={class:"p-field p-float-label p-col-12 p-lg-6"},oo={for:"restrictionValue",class:"kn-material-input-label"},ao={id:"tree-container",class:"p-m-2"};function ro(e,t,r,d,g,D){const p=i("Button"),b=i("Toolbar"),u=i("InputText"),A=i("KnInputFile"),f=i("KnValidationMessages"),w=i("Textarea"),m=i("Dropdown"),h=i("InputSwitch"),C=i("Card"),M=i("DocumentDetailsTree"),v=i("DatasetDialog");return s(),$("div",Qe,[o("div",Je,[a(b,{class:"kn-toolbar kn-toolbar--secondary"},{start:l(()=>[x(n(e.$t("documentExecution.documentDetails.info.infoTitle")),1)]),end:l(()=>[e.designerButtonVisible?(s(),y(p,{key:0,label:e.$t("documentExecution.olap.openDesigner"),class:"p-button-text p-button-plain",onClick:e.openDesignerConfirm},null,8,["label","onClick"])):k("",!0)]),_:1}),o("div",Ye,[o("div",{style:T(e.mainDescriptor.style.absoluteScroll)},[a(C,{class:"p-m-2"},{content:l(()=>{var E;return[e.templates.length==0?(s(),$("div",Ge,[o("div",Ze,[o("div",He,[o("span",We,[a(u,{id:"fileName",class:"kn-material-input kn-width-full",modelValue:e.templateToUpload.name,"onUpdate:modelValue":t[0]||(t[0]=c=>e.templateToUpload.name=c),disabled:!0},null,8,["modelValue"]),o("label",et,n(e.$t("documentExecution.documentDetails.info.uploadTemplate")),1)])]),a(p,{icon:"fas fa-upload fa-1x",class:"p-button-text p-button-plain p-ml-2",onClick:e.setUploadType},null,8,["onClick"]),e.uploading?k("",!0):(s(),y(A,{key:0,label:"",changeFunction:e.setTemplateForUpload,triggerInput:e.triggerUpload},null,8,["changeFunction","triggerInput"]))])])):k("",!0),o("form",tt,[o("div",ot,[o("span",at,[a(u,{id:"label",class:I(["kn-material-input",{"p-invalid":e.v$.document.label.$invalid&&e.v$.document.label.$dirty}]),type:"text",maxLength:"100",modelValue:e.v$.document.label.$model,"onUpdate:modelValue":t[1]||(t[1]=c=>e.v$.document.label.$model=c),onBlur:t[2]||(t[2]=c=>e.v$.document.label.$touch()),onChange:t[3]||(t[3]=c=>e.$emit("touched"))},null,8,["modelValue","class"]),o("label",rt,n(e.$t("common.label"))+" * ",1)]),a(f,{class:"p-mt-1",vComp:e.v$.document.label,additionalTranslateParams:{fieldName:e.$t("common.label")}},null,8,["vComp","additionalTranslateParams"])]),o("div",nt,[o("span",it,[a(u,{id:"name",class:I(["kn-material-input",{"p-invalid":e.v$.document.name.$invalid&&e.v$.document.name.$dirty}]),type:"text",maxLength:"200",modelValue:e.v$.document.name.$model,"onUpdate:modelValue":t[4]||(t[4]=c=>e.v$.document.name.$model=c),onBlur:t[5]||(t[5]=c=>e.v$.document.name.$touch()),onChange:t[6]||(t[6]=c=>e.$emit("touched"))},null,8,["modelValue","class"]),o("label",lt,n(e.$t("common.name"))+" * ",1)]),a(f,{class:"p-mt-1",vComp:e.v$.document.name,additionalTranslateParams:{fieldName:e.$t("common.name")}},null,8,["vComp","additionalTranslateParams"])]),o("div",dt,[((E=e.selectedDocument)==null?void 0:E.previewFile)&&!e.imagePreview?(s(),$("img",{key:0,id:"image-preview",src:e.getImageUrl,height:e.mainDescriptor.style.previewImage},null,8,st)):k("",!0),e.imagePreviewUrl&&e.imagePreview?(s(),$("img",{key:1,id:"image-preview",src:e.imagePreviewUrl,height:e.mainDescriptor.style.previewImage},null,8,ct)):k("",!0)]),o("div",pt,[o("span",bt,[a(w,{id:"description",class:I(["kn-material-input",{"p-invalid":e.v$.document.description.$invalid&&e.v$.document.description.$dirty}]),rows:"9",maxLength:"400",autoResize:!0,modelValue:e.v$.document.description.$model,"onUpdate:modelValue":t[7]||(t[7]=c=>e.v$.document.description.$model=c),onBlur:t[8]||(t[8]=c=>e.v$.document.description.$touch()),onChange:t[9]||(t[9]=c=>e.$emit("touched"))},null,8,["modelValue","class"]),o("label",kt,n(e.$t("common.description")),1)]),a(f,{class:"p-mt-1",vComp:e.v$.document.description,additionalTranslateParams:{fieldName:e.$t("common.description")}},null,8,["vComp","additionalTranslateParams"])]),o("div",ut,[o("div",mt,[o("span",gt,[a(u,{id:"fileName",class:"kn-material-input",modelValue:e.document.previewFile,"onUpdate:modelValue":t[10]||(t[10]=c=>e.document.previewFile=c),disabled:!0},null,8,["modelValue"]),o("label",ht,n(e.$t("documentExecution.documentDetails.info.previewImage")),1)])]),a(p,{icon:"fas fa-upload fa-1x",class:"p-button-text p-button-plain p-ml-2",onClick:e.setImageUploadType},null,8,["onClick"]),e.document.previewFile?(s(),y(p,{key:0,icon:"fas fa-trash fa-1x",class:"p-button-text p-button-plain p-ml-2",onClick:t[11]||(t[11]=c=>e.$emit("deleteImage"))})):k("",!0),a(A,{changeFunction:e.setImageForUpload,accept:".png, .jpg, .jpeg",triggerInput:e.triggerImageUpload},null,8,["changeFunction","triggerInput"])]),o("div",vt,[o("span",ft,[a(m,{id:"type",class:I(["kn-material-input",{"p-invalid":e.v$.document.typeCode.$invalid&&e.v$.document.typeCode.$dirty}]),modelValue:e.v$.document.typeCode.$model,"onUpdate:modelValue":t[12]||(t[12]=c=>e.v$.document.typeCode.$model=c),options:e.documentTypes,optionLabel:"translatedValueName",optionValue:"valueCd",onBlur:t[13]||(t[13]=c=>e.v$.document.typeCode.$touch()),onChange:e.onTypeChange},null,8,["modelValue","options","class","onChange"]),o("label",wt,n(e.$t("importExport.catalogFunction.column.type"))+" *",1)]),a(f,{class:"p-mt-1",vComp:e.v$.document.typeCode,additionalTranslateParams:{fieldName:e.$t("importExport.catalogFunction.column.type")}},null,8,["vComp","additionalTranslateParams"])]),o("div",yt,[o("span",xt,[a(m,{id:"engine",class:I(["kn-material-input",{"p-invalid":e.v$.document.engine.$invalid&&e.v$.document.engine.$dirty}]),modelValue:e.v$.document.engine.$model,"onUpdate:modelValue":t[14]||(t[14]=c=>e.v$.document.engine.$model=c),options:e.filteredEngines,optionLabel:"name",optionValue:"label",disabled:!e.document.typeCode||e.document.typeCode=="",onBlur:t[15]||(t[15]=c=>e.v$.document.engine.$touch()),onChange:t[16]||(t[16]=c=>e.$emit("touched"))},null,8,["modelValue","options","disabled","class"]),o("label",Dt,n(e.$t("documentExecution.documentDetails.info.engine"))+" *",1)]),o("small",null,n(e.$t("documentExecution.documentDetails.info.engineHint")),1),a(f,{class:"p-mt-1",vComp:e.v$.document.engine,additionalTranslateParams:{fieldName:e.$t("documentExecution.documentDetails.info.engine")}},null,8,["vComp","additionalTranslateParams"])]),e.isDataSourceVisible?(s(),$("span",{key:0,class:I(["p-field p-float-label p-col-12 p-lg-6",{"p-lg-12":!e.isDataSetVisible}])},[a(m,{id:"datasource",class:"kn-material-input",modelValue:e.document.dataSourceLabel,"onUpdate:modelValue":t[17]||(t[17]=c=>e.document.dataSourceLabel=c),options:e.availableDatasources,optionLabel:"label",optionValue:"label"},null,8,["modelValue","options"]),o("label",Ct,n(e.$t("managers.businessModelManager.dataSource")),1)],2)):k("",!0),e.isDataSetVisible?(s(),$("div",$t,[o("div",Mt,[o("span",At,[a(u,{id:"dataset",class:"kn-material-input",modelValue:e.dataset.name,"onUpdate:modelValue":t[18]||(t[18]=c=>e.dataset.name=c),disabled:!0},null,8,["modelValue"]),o("label",Et,n(e.$t("common.dataset")),1)])]),e.isDataSetVisible?(s(),y(p,{key:0,icon:"fas fa-search fa-1x",class:"p-button-text p-button-plain p-ml-2",onClick:t[19]||(t[19]=c=>e.showDatasetDialog=!0)})):k("",!0)])):k("",!0),o("div",It,[o("span",Tt,[a(m,{id:"state",class:I(["kn-material-input",{"p-invalid":e.v$.document.stateCode.$invalid&&e.v$.document.stateCode.$dirty}]),modelValue:e.v$.document.stateCode.$model,"onUpdate:modelValue":t[20]||(t[20]=c=>e.v$.document.stateCode.$model=c),options:e.availableStates,optionLabel:"translatedValueName",optionValue:"valueCd",onBlur:t[21]||(t[21]=c=>e.v$.document.stateCode.$touch()),onChange:t[22]||(t[22]=c=>e.$emit("touched"))},null,8,["modelValue","options","class"]),o("label",St,n(e.$t("common.state"))+" *",1)]),a(f,{class:"p-mt-1",vComp:e.v$.document.stateCode,additionalTranslateParams:{fieldName:e.$t("common.state")}},null,8,["vComp","additionalTranslateParams"])]),o("div",zt,[o("span",Ut,[a(u,{id:"refresh",class:"kn-material-input",modelValue:e.document.refreshSeconds,"onUpdate:modelValue":t[23]||(t[23]=c=>e.document.refreshSeconds=c),type:"number"},null,8,["modelValue"]),o("label",Vt,n(e.$t("documentExecution.documentDetails.info.refresh")),1)]),o("small",null,n(e.$t("documentExecution.documentDetails.info.refreshHint")),1)]),o("span",Nt,[a(h,{id:"visible",modelValue:e.document.visible,"onUpdate:modelValue":t[24]||(t[24]=c=>e.document.visible=c)},null,8,["modelValue"]),Ft,o("label",Ot,n(e.$t("common.visible")),1)]),o("span",Pt,[a(h,{id:"locked",modelValue:e.lockedByUser,"onUpdate:modelValue":t[25]||(t[25]=c=>e.lockedByUser=c),onChange:e.setIsLockedByUser},null,8,["modelValue","onChange"]),Lt,o("label",Bt,n(e.$t("common.locked")),1)])])]}),_:1})],4)])]),o("div",Rt,[a(b,{class:"kn-toolbar kn-toolbar--secondary"},{start:l(()=>[x(n(e.$t("documentExecution.documentDetails.info.positionTitle")),1)]),_:1}),o("div",_t,[o("div",{style:T(e.mainDescriptor.style.absoluteScroll)},[e.document.drivers&&e.document.drivers.length>0?(s(),$("div",jt,[a(b,{class:"kn-toolbar kn-toolbar--default"},{start:l(()=>[x(n(e.$t("documentExecution.documentDetails.info.parametersPanelPosition")),1)]),_:1}),a(C,null,{content:l(()=>[o("span",Xt,[a(m,{id:"attributes",class:"kn-material-input kn-width-full",modelValue:e.document.parametersRegion,"onUpdate:modelValue":t[26]||(t[26]=E=>e.document.parametersRegion=E),options:e.driversPositions,optionLabel:e.translatedLabel,optionValue:"value"},{option:l(E=>[o("div",qt,[o("span",Kt,n(e.$t(E.option.label)),1)])]),_:1},8,["modelValue","options","optionLabel"]),o("label",Qt,n(e.$t("documentExecution.documentDetails.info.positionTitle")),1)])]),_:1})])):k("",!0),o("div",Jt,[a(b,{class:"kn-toolbar kn-toolbar--default"},{start:l(()=>[x(n(e.$t("documentExecution.documentDetails.info.restrictionsTitle")),1)]),_:1}),a(C,null,{content:l(()=>[o("form",Yt,[o("span",Gt,[a(w,{id:"profiledVisibility",class:"kn-material-input kn-width-full",rows:"1",autoResize:!0,modelValue:e.document.profiledVisibility,"onUpdate:modelValue":t[27]||(t[27]=E=>e.document.profiledVisibility=E),disabled:!0},null,8,["modelValue"]),o("label",Zt,n(e.$t("documentExecution.documentDetails.info.profiledVisibility")),1)]),a(p,{icon:"fas fa-plus-circle fa-1x",class:"p-button-text p-button-plain p-ml-2 p-col-1",disabled:!e.visibilityAttribute,onClick:e.addRestriction},null,8,["disabled","onClick"]),a(p,{icon:"fas fa-eraser fa-1x",class:"p-button-text p-button-plain p-ml-2 p-col-1",onClick:e.clearAllRestrictions},null,8,["onClick"])]),o("form",Ht,[o("span",Wt,[a(m,{id:"attributes",class:"kn-material-input kn-width-full",modelValue:e.visibilityAttribute,"onUpdate:modelValue":t[28]||(t[28]=E=>e.visibilityAttribute=E),options:e.availableAttributes,optionLabel:"attributeName",optionValue:"attributeName"},null,8,["modelValue","options"]),o("label",eo,n(e.$t("documentExecution.documentDetails.info.attribute")),1)]),o("span",{class:"p-col-12 p-lg-1",style:T(e.infoDescriptor.style.center)},"=",4),o("span",to,[a(u,{id:"restrictionValue",class:"kn-material-input kn-width-full",modelValue:e.restrictionValue,"onUpdate:modelValue":t[29]||(t[29]=E=>e.restrictionValue=E)},null,8,["modelValue"]),o("label",oo,n(e.$t("documentExecution.documentDetails.info.restrictionValueHint")),1)])])]),_:1})]),o("div",ao,[a(b,{class:"kn-toolbar kn-toolbar--default"},{start:l(()=>[x(n(e.$t("documentExecution.documentDetails.info.visibilityLocationTitle")),1)]),_:1}),a(C,{class:"card-0-padding"},{content:l(()=>[a(M,{propFunctionalities:e.folders,propSelectedFolders:e.document.functionalities,onSelected:e.setFunctionality},null,8,["propFunctionalities","propSelectedFolders","onSelected"])]),_:1})])],4)])]),e.showDatasetDialog?(s(),y(v,{key:0,selectedDataset:e.selectedDataset,visible:e.showDatasetDialog,onCloseDialog:t[30]||(t[30]=E=>e.showDatasetDialog=!1),onSaveSelectedDataset:e.saveSelectedDataset},null,8,["selectedDataset","visible","onSaveSelectedDataset"])):k("",!0)])}var no=z(Ke,[["render",ro]]);const io=["contains","not contains"],lo=["AND","OR"],so=["equal","greater","greaterequal","less","lessequal","contains","not contains","starts with","ends with"],co={buttons:[{emits:"delete",icon:"fas fa-trash-alt",label:"common.delete"},{emits:"moveUp",icon:"fas fa-arrow-up",label:"moveUp"},{emits:"moveDown",icon:"fas fa-arrow-down",label:"moveDown"}],defaultSortField:"priority",interaction:{type:"event"},textField:"parameterUrlName",titleField:"label"},po={conditionDialog:{"max-width":"60%","min-width":"60%"},modalityCheckbox:{"align-self":"center"}},bo={driver:[{fieldName:"label",validators:[{key:"required",validator:{type:"drivers-validator"}},{key:"regex",validator:{type:"extendedAlphanumericRegex"}}]},{fieldName:"parameterUrlName",validators:[{key:"required",validator:{type:"drivers-validator"}},{key:"regex",validator:{type:"alphanumericNoSpaces"}},{key:"custom_unique",validator:{type:"custom-unique"}}]},{fieldName:"parameter",validators:[{key:"required",validator:{type:"drivers-validator"}}]}],selectedCondition:[{fieldName:"viewLabel",validators:[{key:"required",validator:{type:"visibility-validator"}}]},{fieldName:"compareValue",validators:[{key:"required",validator:{type:"visibility-validator"}}]},{fieldName:"parFatherId",validators:[{key:"required",validator:{type:"visibility-validator"}}]},{fieldName:"operation",validators:[{key:"required",validator:{type:"visibility-validator"}}]}]};var N={availableOperators:io,connectingOperators:lo,dataOperators:so,knListSettings:co,style:po,validations:bo};const ko=S({name:"document-drivers",components:{Listbox:ce,Dialog:q,Dropdown:O,Checkbox:me,InlineMessage:P},props:{availableDrivers:{type:Array,required:!0},selectedDocument:{type:Object,required:!0},selectedDriver:{type:Object,required:!0}},emits:["driversChanged"],data(){return{mainDescriptor:V,driversDescriptor:N,availableOperators:N.dataOperators,connectingOperators:N.connectingOperators,modes:[],lovs:[],condition:{},conditionFormVisible:!1,loading:!1,modalities:{},selectedModes:[],originalModalities:[],conditions:[],oldDropdownValue:null,driver:null,operation:"insert",errorMessage:"",displayWarning:!1}},watch:{async selectedDriver(){this.loadSelectedDriver(),this.driver&&(await this.loadDataDependencies(),this.driver.parameter&&(await this.loadModes(),await this.loadLovs()))}},setup(){return{store:U()}},async created(){this.loadSelectedDriver(),this.selectedDriver&&(await this.loadDataDependencies(),await this.loadModes(),await this.loadLovs())},methods:{loadSelectedDriver(){this.oldDropdownValue=null,this.driver=this.selectedDriver,this.driver&&this.driver.parameter&&(this.oldDropdownValue=this.driver.parameter)},async loadDataDependencies(){this.conditions=[],this.driver&&this.driver.id&&await this.$http.get(`/knowage/restful-services/2.0/documentdetails/${this.selectedDocument.id}/datadependencies?driverId=${this.selectedDriver.id}`).then(e=>e.data.forEach(t=>{const r=this.conditions.findIndex(d=>d.parFatherId===t.parFatherId&&d.filterOperation==t.filterOperation&&d.logicOperator==t.logicOperator);t.modalities=[],t.modalities.push({conditionId:t.id,useModeId:t.useModeId,filterColumn:t.filterColumn}),r>-1?this.conditions[r].modalities.push({conditionId:t.id,useModeId:t.useModeId,filterColumn:t.filterColumn}):this.conditions.push(t)}))},async loadModes(){this.$http.get(`/knowage/restful-services/2.0/analyticalDrivers/${this.selectedDriver.parID}/modes`).then(e=>this.modes=e.data)},async loadLovs(){this.$http.get(`/knowage/restful-services/2.0/analyticalDrivers/${this.selectedDriver.parID}/lovs`).then(e=>this.lovs=e.data)},getLovs(e){const t=this.lovs.findIndex(r=>r.id===e);if(t>-1)return JSON.parse(this.lovs[t].lovProviderJSON).QUERY["VISIBLE-COLUMNS"].split(",")},isModeActive(e){return this.selectedModes.findIndex(r=>r===e)===-1},urlNotUnique(e){return this.availableDrivers.findIndex(r=>{var d;return r.parameterUrlName===e&&r.id!=((d=this.driver)==null?void 0:d.id)})===-1},excludeCurrentDriverFromList(){return this.availableDrivers.filter(e=>e.id!=this.selectedDriver.id)},setParFatherUrlName(e){this.availableDrivers.filter(t=>{t.id===e.value&&(this.condition.parFatherUrlName=t.parameterUrlName)})},showAnalyticalDropdownConfirm(){this.oldDropdownValue&&this.$confirm.require({message:this.$t("managers.businessModelManager.analyticalDropdownConfirm"),header:this.$t("common.toast.deleteTitle"),icon:"pi pi-exclamation-triangle",accept:()=>"",reject:()=>this.resetDrodpwonValue()})},resetDrodpwonValue(){this.driver&&(this.driver.parameter=this.oldDropdownValue)},showForm(e){this.originalModalities=[],this.selectedModes=[],e.value?(this.condition={...e.value,parFather:this.selectedDriver},this.condition.modalities.forEach(t=>{this.originalModalities.push(t),this.selectedModes.push(t.useModeId),this.modalities[t.useModeId]=t.filterColumn})):this.condition={parFather:this.excludeCurrentDriverFromList()[0],parFatherId:this.excludeCurrentDriverFromList()[0].id,filterOperation:"equal",logicOperator:"AND"},this.conditionFormVisible=!0},async handleSubmit(){this.condition.id&&(this.operation="update");const e=Object.keys(this.modalities);for(let t=0;t<this.selectedModes.length;t++)for(let r=0;r<e.length;r++)if(this.selectedModes[t]===+e[r]){console.log("CONDITION -----------",this.condition),console.log("SEL DRIVER -----------",this.selectedDriver);const d={...this.condition,parFatherId:this.condition.parFatherId,parFatherUrlName:this.getDriverProperty(this.condition.parFatherId,"parameterUrlName"),parId:this.selectedDriver.id,useModeId:+e[r],filterColumn:this.modalities[this.selectedModes[t]]};if(this.operation==="update"){const g=this.originalModalities.findIndex(D=>D.conditionId===d.id);g>-1&&this.originalModalities.splice(g,1)}d.prog||(d.prog=0),d.prog++,delete d.parFather,delete d.modalities,await this.sendRequest(`/knowage/restful-services/2.0/documentdetails/${this.selectedDocument.id}/datadependencies`,d).then(g=>{g.data.errors?(this.errorMessage=g.data.errors[0].message,this.displayWarning=!0):this.store.setInfo({title:this.$t("common.toast.success"),msg:this.$t("documentExecution.documentDetails.drivers.conditionSavedMsg")})})}this.originalModalities.forEach(t=>{this.deleteCondition({...this.condition,id:t.conditionId,parFatherId:this.condition.parFatherId,parFatherUrlName:this.selectedDriver.parameterUrlName,parId:this.selectedDriver.id,useModeId:t.useModeId,filterColumn:t.filterColumn})}),this.originalModalities=[],this.loadData()},sendRequest(e,t){return this.operation==="insert"?this.$http.post(e,t,{headers:{Accept:"application/json, text/plain, */*","X-Disable-Errors":"true"}}):this.$http.put(e,t,{headers:{Accept:"application/json, text/plain, */*","X-Disable-Errors":"true"}})},async deleteConditions(e){e.modalities.forEach(t=>{this.deleteCondition({...e,id:t.conditionId,useModeId:t.useModeId,filterColumn:t.filterColumn})})},async deleteCondition(e){delete e.parFather,delete e.modalities,await this.$http.post(`/knowage/restful-services/2.0/documentdetails/${this.selectedDocument.id}/datadependencies/delete`,e,{headers:{Accept:"application/json, text/plain, */*","X-Disable-Errors":"true"}}).then(()=>{this.store.setInfo({title:this.$t("common.toast.deleteTitle"),msg:this.$t("common.toast.deleteSuccess")}),this.loadData()})},deleteAllConditions(){var e;this.oldDropdownValue=(e=this.driver)==null?void 0:e.parameter,this.conditions.forEach(t=>this.deleteCondition(t))},loadData(){this.loadDataDependencies(),this.loadModes(),this.loadLovs(),this.selectedModes=[],this.condition={},this.operation="insert",this.conditionFormVisible=!1},getDriverProperty(e,t){const r=this.availableDrivers.findIndex(d=>d.id===e);return r!==-1?this.availableDrivers[r][t]:""}}}),uo={key:0,class:"kn-remove-card-padding p-col"},mo={class:"kn-list-item"},go={class:"kn-list-item-text"},ho={class:"kn-truncated"},vo={id:"form-container",class:"p-m-1"},fo={class:"p-fluid p-formgrid p-grid p-mx-2 p-mt-5"},wo={class:"p-field p-col-12 p-md-4"},yo={class:"p-float-label"},xo={for:"driver",class:"kn-material-input-label"},Do={class:"p-field p-col-12 p-md-4"},Co={class:"p-float-label"},$o={for:"filterOp",class:"kn-material-input-label"},Mo={class:"p-field p-col-12 p-md-4"},Ao={class:"p-float-label"},Eo={for:"logicalOp",class:"kn-material-input-label"},Io={class:"p-fluid p-formgrid p-grid"},To={class:"p-col-12 p-m-0"},So={class:"mode-inputs p-col-8"},zo={class:"kn-material-input-label"},Uo={key:0};function Vo(e,t,r,d,g,D){const p=i("Button"),b=i("Toolbar"),u=i("ProgressBar"),A=i("Listbox"),f=i("InlineMessage"),w=i("Dropdown"),m=i("Checkbox"),h=i("Dialog"),C=G("tooltip");return e.loading?k("",!0):(s(),$("div",uo,[a(b,{class:"kn-toolbar kn-toolbar--default"},{start:l(()=>[x(n(e.$t("documentExecution.documentDetails.drivers.conditionsTitle")),1)]),end:l(()=>[a(p,{label:e.$t("managers.businessModelManager.addCondition"),class:"p-button-text p-button-rounded p-button-plain kn-white-color",onClick:e.showForm},null,8,["label","onClick"])]),_:1}),e.loading?(s(),y(u,{key:0,mode:"indeterminate",class:"kn-progress-bar"})):k("",!0),a(A,{class:"kn-list data-condition-list",options:e.conditions,onChange:e.showForm},{empty:l(()=>[x(n(e.$t("documentExecution.documentDetails.drivers.noDataCond")),1)]),option:l(M=>[o("div",mo,[o("div",go,[_((s(),$("span",ho,[o("b",null,n(M.option.filterOperation)+" "+n(e.$t("documentExecution.documentDetails.drivers.dataConditionsValue")),1),x(" "+n(M.option.parFatherUrlName),1)])),[[C,M.option.filterOperation+e.$t("documentExecution.documentDetails.drivers.dataConditionsValue")+M.option.parFatherUrlName,void 0,{top:!0}]])]),a(p,{icon:"far fa-trash-alt",class:"p-button-text p-button-rounded p-button-plain",onClick:F(v=>e.deleteConditions(M.option),["stop"])},null,8,["onClick"])])]),_:1},8,["options","onChange"]),a(h,{class:"remove-padding",style:T(e.driversDescriptor.style.conditionDialog),visible:e.conditionFormVisible,modal:!0,closable:!1},{header:l(()=>[a(b,{class:"kn-toolbar kn-toolbar--primary kn-width-full"},{start:l(()=>[x(n(e.$t("documentExecution.documentDetails.drivers.visualizationTitle")),1)]),_:1})]),footer:l(()=>[a(p,{class:"p-button-text kn-button",label:e.$t("common.cancel"),onClick:t[4]||(t[4]=M=>e.conditionFormVisible=!1)},null,8,["label"]),a(p,{class:"kn-button kn-button--primary",label:e.$t("common.save"),onClick:e.handleSubmit},null,8,["label","onClick"])]),default:l(()=>[o("div",vo,[o("div",null,[a(f,{severity:"info",class:"kn-width-full"},{default:l(()=>[x(n(e.$t("documentExecution.documentDetails.drivers.dataHint")),1)]),_:1})]),o("form",fo,[o("div",wo,[o("span",yo,[a(w,{id:"driver",class:"kn-material-input",modelValue:e.condition.parFatherId,"onUpdate:modelValue":t[0]||(t[0]=M=>e.condition.parFatherId=M),options:e.excludeCurrentDriverFromList(),optionLabel:"label",optionValue:"id",onChange:e.setParFatherUrlName},null,8,["modelValue","options","onChange"]),o("label",xo,n(e.$t("documentExecution.documentDetails.drivers.ad"))+" "+n(e.$t("documentExecution.documentDetails.drivers.adDepends")),1)])]),o("div",Do,[o("span",Co,[a(w,{id:"filterOp",class:"kn-material-input",modelValue:e.condition.filterOperation,"onUpdate:modelValue":t[1]||(t[1]=M=>e.condition.filterOperation=M),options:e.availableOperators},null,8,["modelValue","options"]),o("label",$o,n(e.$t("managers.businessModelManager.filterOperator")),1)])]),o("div",Mo,[o("span",Ao,[a(w,{id:"logicalOp",class:"kn-material-input",modelValue:e.condition.logicOperator,"onUpdate:modelValue":t[2]||(t[2]=M=>e.condition.logicOperator=M),options:e.connectingOperators},null,8,["modelValue","options"]),o("label",Eo,n(e.$t("managers.businessModelManager.logicOperator")),1)])]),(s(!0),$(Z,null,pe(e.modes,M=>(s(),$("div",{key:M.useID,class:"p-col-12 p-mb-4"},[o("form",Io,[o("p",To,n(e.$t("managers.businessModelManager.modality")+": "+M.name),1),o("div",{class:"mode-inputs p-col-4",style:T(e.driversDescriptor.style.modalityCheckbox)},[a(m,{class:"p-mr-2",value:M.useID,modelValue:e.selectedModes,"onUpdate:modelValue":t[3]||(t[3]=v=>e.selectedModes=v),disabled:e.readonly},null,8,["value","modelValue","disabled"]),o("label",null,n(e.$t("managers.businessModelManager.check")),1)],4),o("div",So,[o("label",zo,n(e.$t("managers.businessModelManager.lovsColumn")),1),a(w,{id:"parFather",class:"kn-material-input",modelValue:e.modalities[M.useID],"onUpdate:modelValue":v=>e.modalities[M.useID]=v,options:e.getLovs(M.idLov),placeholder:e.$t("managers.businessModelManager.lovsColumnSelect")},{value:l(v=>[v.value?(s(),$("div",Uo,[o("span",null,n(v.value),1)])):k("",!0)]),option:l(v=>[o("div",null,[o("span",null,n(v.option),1)])]),_:2},1032,["modelValue","onUpdate:modelValue","options","placeholder"])])])]))),128))])])]),_:1},8,["style","visible"])]))}var No=z(ko,[["render",Vo],["__scopeId","data-v-57003935"]]);const Fo=S({name:"document-drivers",components:{Listbox:ce,Dialog:q,Dropdown:O,KnValidationMessages:j,InlineMessage:P},props:{selectedDocument:{type:Object,required:!0},availableDrivers:{type:Array,required:!0},selectedDriver:{type:Object,required:!0}},emits:["driversChanged"],data(){return{v$:L(),mainDescriptor:V,driversDescriptor:N,selectedCondition:{},visusalDependencyObjects:[],availableOperators:N.availableOperators,showVisibilityConditionDialog:!1,loading:!1}},watch:{selectedDriver(){this.selectedDriver.id&&this.getVisualDependenciesByDriverId()}},setup(){return{store:U()}},created(){this.selectedDriver.id&&this.getVisualDependenciesByDriverId()},validations(){const t={"visibility-validator":d=>Object.keys(this.selectedCondition).length===0||d};return{selectedCondition:X("selectedCondition",N.validations.selectedCondition,t)}},methods:{async getVisualDependenciesByDriverId(){this.loading=!0,this.$http.get(`/knowage/restful-services/2.0/documentdetails/${this.selectedDocument.id}/visualdependencies?driverId=${this.selectedDriver.id}`).then(e=>{this.visusalDependencyObjects=e.data}).finally(()=>this.loading=!1)},openVisibilityConditionDialog(e){e!="newCondition"?this.selectedCondition={...e}:this.selectedCondition={parId:this.selectedDriver.id,prog:this.visusalDependencyObjects.length+1},this.showVisibilityConditionDialog=!0},setParFatherUrlName(e){this.availableDrivers.filter(t=>{t.id===e.value&&(this.selectedCondition.parFatherUrlName=t.parameterUrlName)})},async saveCondition(){await this.saveRequest().then(()=>{this.store.setInfo({title:this.$t("common.save"),msg:this.$t("documentExecution.documentDetails.drivers.conditionSavedMsg")}),this.showVisibilityConditionDialog=!1,this.getVisualDependenciesByDriverId()}).catch(e=>{this.store.setError({title:this.$t("common.error.saving"),msg:e})})},saveRequest(){return this.selectedCondition.id?this.$http.put(`/knowage/restful-services/2.0/documentdetails/${this.selectedDocument.id}/visualdependencies`,this.selectedCondition,{headers:{Accept:"application/json, text/plain, */*","X-Disable-Errors":"true"}}):this.$http.post(`/knowage/restful-services/2.0/documentdetails/${this.selectedDocument.id}/visualdependencies`,this.selectedCondition,{headers:{Accept:"application/json, text/plain, */*","X-Disable-Errors":"true"}})},async deleteCondition(e){await this.$http.post(`/knowage/restful-services/2.0/documentdetails/${this.selectedDocument.id}/visualdependencies/delete`,e,{headers:{Accept:"application/json, text/plain, */*","X-Disable-Errors":"true"}}).then(()=>{this.store.setInfo({title:this.$t("common.toast.deleteTitle"),msg:this.$t("common.toast.deleteSuccess")}),this.getVisualDependenciesByDriverId()}).catch(t=>{this.store.setError({title:this.$t("common.toast.errorTitle"),msg:t})})}}}),Oo={class:"kn-remove-card-padding p-col"},Po={class:"kn-list-item"},Lo={class:"kn-list-item-text"},Bo={class:"kn-truncated"},Ro={class:"p-fluid p-formgrid p-grid p-m-2"},_o={class:"p-field p-col-12 p-mt-2"},jo={class:"p-float-label"},Xo={for:"title",class:"kn-material-input-label"},qo={class:"p-field p-col-12 p-md-4"},Ko={class:"p-float-label"},Qo={for:"driver",class:"kn-material-input-label"},Jo={class:"p-field p-col-12 p-md-4"},Yo={class:"p-float-label"},Go={for:"operator",class:"kn-material-input-label"},Zo={class:"p-field p-col-12 p-md-4"},Ho={class:"p-float-label"},Wo={for:"title",class:"kn-material-input-label"};function ea(e,t,r,d,g,D){const p=i("Button"),b=i("Toolbar"),u=i("ProgressBar"),A=i("Listbox"),f=i("InlineMessage"),w=i("InputText"),m=i("KnValidationMessages"),h=i("Dropdown"),C=i("Dialog"),M=G("tooltip");return s(),$(Z,null,[o("div",Oo,[a(b,{class:"kn-toolbar kn-toolbar--default"},{start:l(()=>[x(n(e.$t("documentExecution.documentDetails.drivers.visibilityTitle")),1)]),end:l(()=>[a(p,{label:e.$t("managers.businessModelManager.addCondition"),class:"p-button-text p-button-rounded p-button-plain kn-white-color",onClick:t[0]||(t[0]=v=>e.openVisibilityConditionDialog("newCondition"))},null,8,["label"])]),_:1}),e.loading?(s(),y(u,{key:0,mode:"indeterminate",class:"kn-progress-bar"})):k("",!0),a(A,{class:"kn-list data-condition-list",options:e.visusalDependencyObjects,onChange:t[1]||(t[1]=v=>e.openVisibilityConditionDialog(v.value))},{empty:l(()=>[x(n(e.$t("documentExecution.documentDetails.drivers.noVisCond")),1)]),option:l(v=>[o("div",Po,[o("div",Lo,[_((s(),$("span",Bo,[o("b",null,n(v.option.viewLabel),1),x(" "+n(v.option.parFatherUrlName)+" "+n(v.option.operation)+n(v.option.compareValue),1)])),[[M,v.option.viewLabel+" "+v.option.parFatherUrlName+" "+v.option.operation+v.option.compareValue,void 0,{top:!0}]])]),a(p,{icon:"far fa-trash-alt",class:"p-button-text p-button-rounded p-button-plain",onClick:F(E=>e.deleteCondition(v.option),["stop"])},null,8,["onClick"])])]),_:1},8,["options"])]),a(C,{class:"remove-padding",style:T(e.driversDescriptor.style.conditionDialog),visible:e.showVisibilityConditionDialog,modal:!0,closable:!1},{header:l(()=>[a(b,{class:"kn-toolbar kn-toolbar--primary kn-width-full"},{start:l(()=>[x(n(e.$t("documentExecution.documentDetails.drivers.visualizationTitle")),1)]),_:1})]),footer:l(()=>[a(p,{class:"p-button-text kn-button",label:e.$t("common.cancel"),onClick:t[10]||(t[10]=v=>{e.showVisibilityConditionDialog=!1,e.selectedCondition={}})},null,8,["label"]),a(p,{class:"kn-button kn-button--primary",label:e.$t("common.save"),disabled:e.v$.$invalid,onClick:e.saveCondition},null,8,["label","disabled","onClick"])]),default:l(()=>[a(f,{severity:"info",class:"p-m-2 kn-width-full"},{default:l(()=>[x(n(e.$t("documentExecution.documentDetails.drivers.visualizationHint")),1)]),_:1}),o("form",Ro,[o("div",_o,[o("span",jo,[a(w,{id:"title",class:I(["kn-material-input",{"p-invalid":e.v$.selectedCondition.viewLabel.$invalid&&e.v$.selectedCondition.viewLabel.$dirty}]),modelValue:e.v$.selectedCondition.viewLabel.$model,"onUpdate:modelValue":t[2]||(t[2]=v=>e.v$.selectedCondition.viewLabel.$model=v),onBlur:t[3]||(t[3]=v=>e.v$.selectedCondition.viewLabel.$touch())},null,8,["modelValue","class"]),o("label",Xo,n(e.$t("common.title"))+" *",1)]),a(m,{class:"p-mt-1",vComp:e.v$.selectedCondition.viewLabel,additionalTranslateParams:{fieldName:e.$t("common.title")}},null,8,["vComp","additionalTranslateParams"])]),o("div",qo,[o("span",Ko,[a(h,{id:"driver",class:I(["kn-material-input",{"p-invalid":e.v$.selectedCondition.parFatherId.$invalid&&e.v$.selectedCondition.parFatherId.$dirty}]),modelValue:e.v$.selectedCondition.parFatherId.$model,"onUpdate:modelValue":t[4]||(t[4]=v=>e.v$.selectedCondition.parFatherId.$model=v),options:e.availableDrivers,optionLabel:"label",optionValue:"id",onBlur:t[5]||(t[5]=v=>e.v$.selectedCondition.parFatherId.$touch()),onChange:e.setParFatherUrlName},null,8,["modelValue","options","class","onChange"]),o("label",Qo,n(e.$t("managers.businessModelManager.analyticalDriver"))+" *",1)]),a(m,{class:"p-mt-1",vComp:e.v$.selectedCondition.parFatherId,additionalTranslateParams:{fieldName:e.$t("managers.businessModelManager.analyticalDriver")}},null,8,["vComp","additionalTranslateParams"])]),o("div",Jo,[o("span",Yo,[a(h,{id:"operator",class:I(["kn-material-input",{"p-invalid":e.v$.selectedCondition.operation.$invalid&&e.v$.selectedCondition.operation.$dirty}]),modelValue:e.v$.selectedCondition.operation.$model,"onUpdate:modelValue":t[6]||(t[6]=v=>e.v$.selectedCondition.operation.$model=v),options:e.availableOperators,onBlur:t[7]||(t[7]=v=>e.v$.selectedCondition.operation.$touch())},null,8,["modelValue","options","class"]),o("label",Go,n(e.$t("managers.businessModelManager.analyticalDriver"))+" *",1)]),a(m,{class:"p-mt-1",vComp:e.v$.selectedCondition.operation,additionalTranslateParams:{fieldName:e.$t("managers.businessModelManager.analyticalDriver")}},null,8,["vComp","additionalTranslateParams"])]),o("div",Zo,[o("span",Ho,[a(w,{id:"title",class:I(["kn-material-input",{"p-invalid":e.v$.selectedCondition.compareValue.$invalid&&e.v$.selectedCondition.compareValue.$dirty}]),modelValue:e.v$.selectedCondition.compareValue.$model,"onUpdate:modelValue":t[8]||(t[8]=v=>e.v$.selectedCondition.compareValue.$model=v),onBlur:t[9]||(t[9]=v=>e.v$.selectedCondition.compareValue.$touch())},null,8,["modelValue","class"]),o("label",Wo,n(e.$t("common.value"))+" *",1)]),a(m,{class:"p-mt-1",vComp:e.v$.selectedCondition.compareValue,additionalTranslateParams:{fieldName:e.$t("common.value")}},null,8,["vComp","additionalTranslateParams"])])])]),_:1},8,["style","visible"])],64)}var ta=z(Fo,[["render",ea],["__scopeId","data-v-772083c0"]]);const oa=S({name:"document-drivers",components:{DataConditions:No,VisibilityConditions:ta,KnListBox:W,KnValidationMessages:j,InputSwitch:ue,Dropdown:O,InlineMessage:P},props:{selectedDocument:{type:Object,required:!0},availableDrivers:{type:Array,required:!0},availableAnalyticalDrivers:{type:Array,required:!0}},emits:["driversChanged"],data(){return{mainDescriptor:V,driversDescriptor:N,v$:L(),drivers:[],driversToChange:[],driversToDelete:[],selectedDriver:{},driverParuses:[],lovIdAndColumns:[],visusalDependencyObjects:[],dataDependencyObjects:[],transformedObj:{},document:{},loading:!1}},setup(){return{store:U()}},created(){this.getDocumentDrivers(),this.document=this.selectedDocument},watch:{selectedDocument(){this.getDocumentDrivers(),this.document=this.selectedDocument,this.selectedDriver={}}},validations(){const e={"custom-unique":r=>this.urlNotUnique(r),"drivers-validator":r=>Object.keys(this.selectedDriver).length===0||r};return{selectedDriver:X("driver",N.validations.driver,e)}},methods:{urlNotUnique(e){return this.document.drivers.findIndex(r=>{var d;return r.parameterUrlName===e&&r.id!=((d=this.selectedDriver)==null?void 0:d.id)})===-1},async getDocumentDrivers(){var e,t;this.loading=!0,(e=this.selectedDocument)!=null&&e.id&&this.$http.get(`/knowage/restful-services/2.0/documentdetails/${(t=this.selectedDocument)==null?void 0:t.id}/drivers`).then(r=>this.document.drivers=r.data).finally(()=>this.loading=!1)},selectDriver(e){this.selectedDriver=e,this.setParameterInfo(this.selectedDriver)},setParId(e){this.selectedDriver.parID=e},markSelectedDriverForChange(){this.selectedDriver.isChanged=!0,this.selectedDriver.numberOfErrors=this.v$.$errors.length},changeDriverValue(e){this.selectedDriver.isChanged=!0,this.selectedDriver.numberOfErrors=this.v$.$errors.length,this.setParId(e.value.id)},setParameterInfo(e){if(this.availableAnalyticalDrivers)for(var t=0;t<this.availableAnalyticalDrivers.length;t++)(e.parameter&&this.availableAnalyticalDrivers[t].id==e.parID||e.parameter&&this.availableAnalyticalDrivers[t].name==e.parameter.name)&&(e.parameter={...this.availableAnalyticalDrivers[t]},e.parID=this.availableAnalyticalDrivers[t].id)},addNewDriver(){this.transformedObj={};let e={label:"",parameter:this.availableAnalyticalDrivers[0]?this.availableAnalyticalDrivers[0]:null,parameterUrlName:"",priority:this.document.drivers.length==0?1:this.document.drivers.length+1,biObjectID:this.selectedDocument.id,visible:!0,required:!0,multivalue:!1,numberOfErrors:1};this.selectedDocument.id&&(this.document.drivers?(this.document.drivers.push(e),this.selectDriver(this.document.drivers[this.document.drivers.length-1])):(this.document.drivers=[e],this.selectDriver(this.document.drivers[1])))},async movePriority(e,t){t=="up"?e.priority-=1:e.priority+=1,await this.$http.put(`/knowage/restful-services/2.0/documentdetails/${this.selectedDocument.id}/drivers/${e.id}`,e,{headers:{Accept:"application/json, text/plain, */*","X-Disable-Errors":"true"}}).then(()=>{this.store.setInfo({title:"Succes",msg:"Driver priority changed"}),this.getDocumentDrivers()}).catch(()=>this.store.setError({title:this.$t("common.toast.errorTitle"),msg:this.$t("documentExecution.documentDetails.drivers.priorityError")}))},deleteDriverConfirm(e){this.$confirm.require({header:this.$t("common.toast.deleteConfirmTitle"),message:this.$t("documentExecution.documentDetails.drivers.deleteMessage"),icon:"pi pi-exclamation-triangle",accept:()=>this.deleteDriver(e.item)})},async deleteDriver(e){if(e.id)await this.$http.delete(`/knowage/restful-services/2.0/documentdetails/${this.document.id}/drivers/${e.id}`,{headers:{"X-Disable-Errors":"true"}}).then(()=>{let t=this.document.drivers.findIndex(r=>r.id===e.id);this.document.drivers.splice(t,1),this.store.setInfo({title:this.$t("common.toast.deleteTitle"),msg:this.$t("common.toast.deleteSuccess")}),this.selectedDriver={}}).catch(t=>{this.store.setError({title:this.$t("common.toast.errorTitle"),msg:t.message})});else{let t=this.document.drivers.findIndex(r=>r.priority===e.priority);this.document.drivers.splice(t,1),this.selectedDriver={}}}}}),aa={class:"p-grid p-m-0 kn-flex"},ra={class:"p-col-4 p-sm-4 p-md-3 p-p-0 p-d-flex p-flex-column kn-flex"},na={id:"drivers-list-container",class:"kn-flex kn-relative"},ia={key:0,id:"driver-details-container",class:"kn-flex kn-relative"},la={class:"p-m-2"},da={key:0},sa={class:"p-fluid p-formgrid p-grid p-m-1"},ca={class:"p-field p-col-12"},pa={class:"p-float-label"},ba={for:"label",class:"kn-material-input-label"},ka={class:"p-field p-col-12"},ua={class:"p-float-label"},ma={key:0,class:"p-dropdown-driver-value"},ga={key:1},ha={class:"p-dropdown-driver-option"},va={for:"analytical",class:"kn-material-input-label"},fa={class:"p-field p-col-12"},wa={class:"p-float-label"},ya={for:"parameterUrlName",class:"kn-material-input-label"},xa={class:"p-field p-col-12 p-md-4 p-jc-center p-mt-3"},Da=o("i",{class:"far fa-eye p-ml-2"},null,-1),Ca={for:"visible",class:"kn-material-input-label p-ml-2"},$a={class:"p-field p-col-12 p-md-4 p-jc-center p-mt-3"},Ma=o("i",{class:"fas fa-asterisk p-ml-2"},null,-1),Aa={for:"required",class:"kn-material-input-label p-ml-2"},Ea={class:"p-field p-col-12 p-md-4 p-jc-center p-mt-3"},Ia=o("i",{class:"fas fa-list p-ml-2"},null,-1),Ta={for:"multivalue",class:"kn-material-input-label p-ml-2"},Sa={key:2,class:"p-grid p-mt-1"};function za(e,t,r,d,g,D){const p=i("Button"),b=i("Toolbar"),u=i("ProgressBar"),A=i("KnListBox"),f=i("InlineMessage"),w=i("InputText"),m=i("KnValidationMessages"),h=i("Dropdown"),C=i("InputSwitch"),M=i("Card"),v=i("DataConditions"),E=i("VisibilityConditions");return s(),$("div",aa,[o("div",ra,[a(b,{class:"kn-toolbar kn-toolbar--secondary"},{start:l(()=>[x(n(e.$t("documentExecution.documentDetails.drivers.title")),1)]),end:l(()=>[a(p,{label:e.$t("common.add"),class:"p-button-text p-button-rounded p-button-plain kn-white-color",onClick:e.addNewDriver},null,8,["label","onClick"])]),_:1}),o("div",na,[o("div",{style:T(e.mainDescriptor.style.absoluteScroll)},[e.loading?(s(),y(u,{key:0,class:"kn-progress-bar",mode:"indeterminate","data-test":"progress-bar"})):k("",!0),e.loading?k("",!0):(s(),y(A,{key:1,class:"kn-height-full",options:e.document.drivers,settings:e.driversDescriptor.knListSettings,onClick:t[0]||(t[0]=c=>e.selectDriver(c.item)),onDelete:t[1]||(t[1]=F(c=>e.deleteDriverConfirm(c),["stop"])),onMoveUp:t[2]||(t[2]=F(c=>e.movePriority(c.item,"up"),["stop"])),onMoveDown:t[3]||(t[3]=F(c=>e.movePriority(c.item,"down"),["stop"]))},null,8,["options","settings"]))],4)])]),o("div",{class:"p-col-8 p-sm-8 p-md-9 p-p-0 p-m-0",style:T(e.mainDescriptor.style.driverDetailsContainer)},[a(b,{class:"kn-toolbar kn-toolbar--secondary"},{start:l(()=>[x(n(e.$t("documentExecution.documentDetails.drivers.detailsTitle")),1)]),_:1}),e.loading?k("",!0):(s(),$("div",ia,[o("div",{style:T(e.mainDescriptor.style.absoluteScroll)},[o("div",la,[Object.keys(e.selectedDriver).length===0?(s(),$("div",da,[a(f,{severity:"info",class:"kn-width-full"},{default:l(()=>[x(n(e.$t("documentExecution.documentDetails.drivers.noDriverSelected")),1)]),_:1})])):(s(),y(M,{key:1},{content:l(()=>[o("form",sa,[o("div",ca,[o("span",pa,[a(w,{id:"label",class:I(["kn-material-input",{"p-invalid":e.v$.selectedDriver.label.$invalid&&e.v$.selectedDriver.label.$dirty}]),type:"text",maxLength:"40",modelValue:e.v$.selectedDriver.label.$model,"onUpdate:modelValue":t[4]||(t[4]=c=>e.v$.selectedDriver.label.$model=c),onBlur:t[5]||(t[5]=c=>e.v$.selectedDriver.label.$touch()),onChange:e.markSelectedDriverForChange},null,8,["modelValue","class","onChange"]),o("label",ba,n(e.$t("common.title"))+" * ",1)]),a(m,{class:"p-mt-1",vComp:e.v$.selectedDriver.label,additionalTranslateParams:{fieldName:e.$t("common.title")}},null,8,["vComp","additionalTranslateParams"])]),o("div",ka,[o("span",ua,[a(h,{id:"analytical",class:I(["kn-material-input",{"p-invalid":e.v$.selectedDriver.parameter.$invalid&&e.v$.selectedDriver.parameter.$dirty}]),modelValue:e.v$.selectedDriver.parameter.$model,"onUpdate:modelValue":t[6]||(t[6]=c=>e.v$.selectedDriver.parameter.$model=c),options:e.availableAnalyticalDrivers,optionLabel:"label",filter:!0,filterPlaceholder:e.$t("documentExecution.documentDetails.drivers.dropdownSearchHint"),onBlur:t[7]||(t[7]=c=>e.v$.selectedDriver.parameter.$touch()),onChange:e.changeDriverValue},{value:l(c=>[c.value?(s(),$("div",ma,[o("span",null,n(c.value.label),1)])):(s(),$("span",ga,n(e.$t("common.info.noDataFound")),1))]),option:l(c=>[o("div",ha,[o("span",null,n(c.option.label),1)])]),_:1},8,["modelValue","options","class","filterPlaceholder","onChange"]),o("label",va,n(e.$t("managers.businessModelManager.analyticalDriver")),1)]),a(m,{class:"p-mt-1",vComp:e.v$.selectedDriver.parameter,additionalTranslateParams:{fieldName:e.$t("managers.businessModelManager.analyticalDriver")}},null,8,["vComp","additionalTranslateParams"])]),o("div",fa,[o("span",wa,[a(w,{id:"parameterUrlName",class:I(["kn-material-input",{"p-invalid":e.v$.selectedDriver.parameterUrlName.$invalid&&e.v$.selectedDriver.parameterUrlName.$dirty}]),type:"text",maxLength:"20",modelValue:e.v$.selectedDriver.parameterUrlName.$model,"onUpdate:modelValue":t[8]||(t[8]=c=>e.v$.selectedDriver.parameterUrlName.$model=c),onBlur:t[9]||(t[9]=c=>e.v$.selectedDriver.parameterUrlName.$touch()),onChange:e.markSelectedDriverForChange},null,8,["modelValue","class","onChange"]),o("label",ya,n(e.$t("documentExecution.documentDetails.drivers.parameterUrlName"))+" * ",1)]),a(m,{class:"p-mt-1",vComp:e.v$.selectedDriver.parameterUrlName,additionalTranslateParams:{fieldName:e.$t("documentExecution.documentDetails.drivers.parameterUrlName")},specificTranslateKeys:{custom_unique:"managers.businessModelManager.driversUrlNotUnique"}},null,8,["vComp","additionalTranslateParams","specificTranslateKeys"])]),o("span",xa,[a(C,{id:"visible",modelValue:e.selectedDriver.visible,"onUpdate:modelValue":t[10]||(t[10]=c=>e.selectedDriver.visible=c),onChange:e.markSelectedDriverForChange},null,8,["modelValue","onChange"]),Da,o("label",Ca,n(e.$t("common.visible")),1)]),o("span",$a,[a(C,{id:"required",modelValue:e.selectedDriver.required,"onUpdate:modelValue":t[11]||(t[11]=c=>e.selectedDriver.required=c),onChange:e.markSelectedDriverForChange},null,8,["modelValue","onChange"]),Ma,o("label",Aa,n(e.$t("common.required")),1)]),o("span",Ea,[a(C,{id:"multivalue",modelValue:e.selectedDriver.multivalue,"onUpdate:modelValue":t[12]||(t[12]=c=>e.selectedDriver.multivalue=c),onChange:e.markSelectedDriverForChange},null,8,["modelValue","onChange"]),Ia,o("label",Ta,n(e.$t("managers.businessModelManager.multivalue")),1)])])]),_:1})),e.document.drivers.length>1&&e.selectedDriver.id?(s(),$("div",Sa,[a(v,{availableDrivers:e.document.drivers,selectedDocument:e.selectedDocument,selectedDriver:e.selectedDriver},null,8,["availableDrivers","selectedDocument","selectedDriver"]),e.selectedDocument.engine?(s(),y(E,{key:0,availableDrivers:e.document.drivers,selectedDocument:e.selectedDocument,selectedDriver:e.selectedDriver},null,8,["availableDrivers","selectedDocument","selectedDriver"])):k("",!0)])):k("",!0)])],4)]))],4)])}var Ua=z(oa,[["render",za]]);const Va={buttons:[{emits:"delete",icon:"fas fa-trash-alt",label:"common.delete"}],defaultSortField:"name",filterFields:["name"],interaction:{type:"event"},sortFields:["name"],textField:!1,titleField:"name"},Na={selectedParam:[{fieldName:"name",validators:[{key:"required",validator:{type:"output-params-validator"}}]}]};var de={knListSettings:Va,validations:Na};const Fa=S({name:"document-drivers",components:{KnListBox:W,Dropdown:O,KnValidationMessages:j,InlineMessage:P},props:{selectedDocument:{type:Object,required:!0},typeList:{type:Array,required:!0},dateFormats:{type:Array,required:!0}},emits:["driversChanged"],data(){return{v$:L(),mainDescriptor:V,driversDescriptor:N,outputParamDescriptor:de,selectedParam:{},document:{}}},created(){this.document=this.selectedDocument},validations(){const t={"output-params-validator":d=>Object.keys(this.selectedParam).length===0||d};return{selectedParam:X("selectedParam",de.validations.selectedParam,t)}},methods:{addParam(){this.selectedParam={numberOfErrors:1,biObjectId:this.document.id,formatCode:null,formatValue:null,isUserDefined:!0,type:this.typeList[0]?this.typeList[0]:{},tempId:this.document.outputParameters.length+1},this.document.outputParameters.push(this.selectedParam)},selectParam(e){this.selectedParam=e},markSelectedParamForChange(){this.selectedParam.isChanged=!0,this.selectedParam.numberOfErrors=this.v$.$errors.length},deleteParamConfirm(e){this.$confirm.require({header:this.$t("common.toast.deleteConfirmTitle"),message:this.$t("common.toast.deleteMessage"),icon:"pi pi-exclamation-triangle",accept:()=>this.deleteParam(e.item)})},async deleteParam(e){if(e.id)await this.$http.delete(`/knowage/restful-services/2.0/documentdetails/${this.selectedDocument.id}/outputparameters/${e.id}`,{headers:{"X-Disable-Errors":"true"}}).then(()=>{let t=this.document.outputParameters.findIndex(r=>r.id===e.id);this.document.outputParameters.splice(t,1),this.store.setInfo({title:this.$t("common.toast.deleteTitle"),msg:this.$t("common.toast.deleteSuccess")}),this.selectedParam={}}).catch(t=>{this.store.setError({title:this.$t("common.toast.errorTitle"),msg:t.message})});else{let t=this.document.outputParameters.findIndex(r=>r.tempId===e.tempId);this.document.outputParameters.splice(t,1),this.selectedParam={}}}}}),Oa={class:"p-grid p-m-0 kn-flex"},Pa={class:"p-col-4 p-sm-4 p-md-3 p-p-0 p-d-flex p-flex-column kn-flex"},La={id:"drivers-list-container",class:"kn-flex kn-relative"},Ba={id:"driver-details-container",class:"p-m-2 kn-flex kn-relative"},Ra={key:0},_a={class:"p-fluid p-formgrid p-grid p-m-2"},ja={class:"p-field p-col-12 p-mt-2"},Xa={class:"p-float-label"},qa={for:"title",class:"kn-material-input-label"},Ka={class:"p-field p-col-12"},Qa={class:"p-float-label"},Ja={for:"type",class:"kn-material-input-label"},Ya={key:0,class:"p-field p-col-12"},Ga={class:"p-float-label"},Za={for:"dateFormat",class:"kn-material-input-label"},Ha={key:1,class:"p-field p-col-12"},Wa={class:"p-float-label"},er={for:"title",class:"kn-material-input-label"};function tr(e,t,r,d,g,D){const p=i("Button"),b=i("Toolbar"),u=i("KnListBox"),A=i("InlineMessage"),f=i("InputText"),w=i("KnValidationMessages"),m=i("Dropdown"),h=i("Card");return s(),$("div",Oa,[o("div",Pa,[a(b,{class:"kn-toolbar kn-toolbar--secondary"},{start:l(()=>[x(n(e.$t("documentExecution.documentDetails.outputParams.title")),1)]),end:l(()=>[a(p,{label:e.$t("common.add"),class:"p-button-text p-button-rounded p-button-plain kn-white-color",onClick:e.addParam},null,8,["label","onClick"])]),_:1}),o("div",La,[o("div",{style:T(e.mainDescriptor.style.absoluteScroll)},[a(u,{class:"kn-height-full",options:e.document.outputParameters,settings:e.outputParamDescriptor.knListSettings,onClick:t[0]||(t[0]=C=>e.selectParam(C.item)),onDelete:t[1]||(t[1]=F(C=>e.deleteParamConfirm(C),["stop"]))},null,8,["options","settings"])],4)])]),o("div",{class:"p-col-8 p-sm-8 p-md-9 p-p-0 p-m-0",style:T(e.mainDescriptor.style.driverDetailsContainer)},[a(b,{class:"kn-toolbar kn-toolbar--secondary"},{start:l(()=>[x(n(e.$t("documentExecution.documentDetails.outputParams.paramDetails")),1)]),_:1}),o("div",Ba,[Object.keys(e.selectedParam).length===0?(s(),$("div",Ra,[a(A,{severity:"info",class:"kn-width-full"},{default:l(()=>[x(n(e.$t("documentExecution.documentDetails.outputParams.noParamSelected")),1)]),_:1})])):(s(),y(h,{key:1},{content:l(()=>[o("form",_a,[o("div",ja,[o("span",Xa,[a(f,{id:"title",class:I(["kn-material-input",{"p-invalid":e.v$.selectedParam.name.$invalid&&e.v$.selectedParam.name.$dirty}]),disabled:e.selectedParam.isUserDefined===null,modelValue:e.v$.selectedParam.name.$model,"onUpdate:modelValue":t[2]||(t[2]=C=>e.v$.selectedParam.name.$model=C),modelModifiers:{trim:!0},onBlur:t[3]||(t[3]=C=>e.v$.selectedParam.name.$touch()),onInput:e.markSelectedParamForChange},null,8,["disabled","modelValue","class","onInput"]),o("label",qa,n(e.$t("documentExecution.documentDetails.outputParams.paramName"))+" *",1)]),a(w,{class:"p-mt-1",vComp:e.v$.selectedParam.name,additionalTranslateParams:{fieldName:e.$t("documentExecution.documentDetails.outputParams.paramName")}},null,8,["vComp","additionalTranslateParams"])]),o("div",Ka,[o("span",Qa,[a(m,{id:"type",class:"kn-material-input",modelValue:e.selectedParam.type,"onUpdate:modelValue":t[4]||(t[4]=C=>e.selectedParam.type=C),options:e.typeList,optionLabel:"valueCd",disabled:e.selectedParam.isUserDefined===null,onChange:e.markSelectedParamForChange},null,8,["modelValue","options","disabled","onChange"]),o("label",Ja,n(e.$t("documentExecution.documentDetails.outputParams.paramType")),1)])]),e.selectedParam.type.valueCd==="DATE"?(s(),$("div",Ya,[o("span",Ga,[a(m,{id:"dateFormat",class:"kn-material-input",modelValue:e.selectedParam.formatCode,"onUpdate:modelValue":t[5]||(t[5]=C=>e.selectedParam.formatCode=C),options:e.dateFormats,optionLabel:"translatedValueName",optionValue:"valueCd",disabled:e.selectedParam.isUserDefined===null,onChange:e.markSelectedParamForChange},null,8,["modelValue","options","disabled","onChange"]),o("label",Za,n(e.$t("managers.datasetManagement.ckanDateFormat")),1)])])):k("",!0),e.selectedParam.type.valueCd==="DATE"&&e.selectedParam.formatCode==="CUSTOM"?(s(),$("div",Ha,[o("span",Wa,[a(f,{id:"title",class:"kn-material-input",modelValue:e.selectedParam.formatValue,"onUpdate:modelValue":t[6]||(t[6]=C=>e.selectedParam.formatValue=C),disabled:e.selectedParam.isUserDefined===null,onInput:e.markSelectedParamForChange},null,8,["modelValue","disabled","onInput"]),o("label",er,n(e.$t("documentExecution.documentDetails.outputParams.customValue"))+" *",1)])])):k("",!0)])]),_:1}))])],4)])}var or=z(Fa,[["render",tr]]);const ar=S({name:"data-lineage",components:{Dropdown:O,DataTable:K,Column:Q,InlineMessage:P},props:{selectedDocument:{type:Object,required:!0},metaSourceResource:{type:Array,required:!0},savedTables:{type:Array,required:!0}},emits:[],data(){return{mainDescriptor:V,dataSource:{},tablesList:[],selectedTables:[],loading:!1,filters:{global:[H]},globalFilterFields:["name"]}},setup(){return{store:U()}},created(){},methods:{async getTablesBySourceID(){this.loading=!0,this.$http.get(`/knowage/restful-services/2.0/metaSourceResource/${this.dataSource.sourceId}/metatables`).then(e=>{this.tablesList=e.data,this.setCheckedTables()}).finally(()=>this.loading=!1)},setCheckedTables(){for(var e=0;e<this.tablesList.length;e++)for(var t=0;t<this.savedTables.length;t++)this.tablesList[e].tableId==this.savedTables[t].tableId&&this.selectedTables.push(this.tablesList[e])},peristTable(e){this.$http.post(`/knowage/restful-services/2.0/metaDocumetRelationResource/${this.selectedDocument.id}`,e.data,{headers:{"X-Disable-Errors":"true"}}).then(()=>this.store.setInfo({title:this.$t("common.save"),msg:this.$t("documentExecution.documentDetails.dataLineage.persistOk")})).catch(()=>this.store.setError({title:this.$t("common.toast.errorTitle"),msg:this.$t("documentExecution.documentDetails.dataLineage.persistError")}))},deleteTable(e){this.$http.delete(`/knowage/restful-services/2.0/metaDocumetRelationResource/${this.selectedDocument.id}/${e.data.tableId}`,{headers:{"X-Disable-Errors":"true"}}).then(()=>this.store.setInfo({title:this.$t("common.save"),msg:this.$t("documentExecution.documentDetails.dataLineage.deleteOk")})).catch(()=>this.store.setError({title:this.$t("common.toast.errorTitle"),msg:this.$t("documentExecution.documentDetails.dataLineage.deleteError")}))}}}),rr={class:"p-grid p-m-0 kn-flex"},nr={class:"p-d-flex p-flex-column kn-flex"},ir={class:"kn-flex kn-relative"},lr={id:"driver-details-container",class:"p-m-2"},dr={class:"p-field p-col-12"},sr={class:"p-float-label"},cr={for:"dataSource",class:"kn-material-input-label"},pr={key:0},br={key:1},kr={class:"table-header p-d-flex p-ai-center"},ur={id:"search-container",class:"p-input-icon-left p-mr-3"},mr=o("i",{class:"pi pi-search"},null,-1);function gr(e,t,r,d,g,D){const p=i("Toolbar"),b=i("Dropdown"),u=i("InlineMessage"),A=i("ProgressBar"),f=i("InputText"),w=i("Column"),m=i("DataTable"),h=i("Card");return s(),$("div",rr,[o("div",nr,[a(p,{class:"kn-toolbar kn-toolbar--secondary"},{start:l(()=>[x(n(e.$t("documentExecution.documentDetails.dataLineage.title")),1)]),_:1}),o("div",ir,[o("div",{style:T(e.mainDescriptor.style.absoluteScroll)},[o("div",lr,[a(p,{class:"kn-toolbar kn-toolbar--default"},{start:l(()=>[x(n(e.$t("managers.datasetManagement.availableTables")),1)]),_:1}),a(h,null,{content:l(()=>[o("div",dr,[o("span",sr,[a(b,{id:"dataSource",class:"kn-material-input kn-width-full",modelValue:e.dataSource,"onUpdate:modelValue":t[0]||(t[0]=C=>e.dataSource=C),options:e.metaSourceResource,onChange:e.getTablesBySourceID,optionLabel:"name"},null,8,["modelValue","options","onChange"]),o("label",cr,n(e.$t("documentExecution.documentDetails.dataLineage.selectSource")),1)])]),e.metaSourceResource.length==0?(s(),$("div",pr,[a(u,{severity:"info",class:"kn-width-full"},{default:l(()=>[x(n(e.$t("documentExecution.documentDetails.dataLineage.noDatasources")),1)]),_:1})])):k("",!0),e.dataSource&&e.tablesList.length==0&&e.metaSourceResource.length!=0?(s(),$("div",br,[a(u,{severity:"info",class:"kn-width-full"},{default:l(()=>[x(n(e.$t("documentExecution.documentDetails.dataLineage.noTables")),1)]),_:1})])):k("",!0),e.loading?(s(),y(A,{key:2,class:"kn-progress-bar",mode:"indeterminate","data-test":"progress-bar"})):k("",!0),e.dataSource&&e.tablesList.length>0&&!e.loading?(s(),y(m,{key:3,class:"p-datatable-sm kn-table",value:e.tablesList,selection:e.selectedTables,"onUpdate:selection":t[2]||(t[2]=C=>e.selectedTables=C),dataKey:"tableId",responsiveLayout:"scroll",filters:e.filters,"onUpdate:filters":t[3]||(t[3]=C=>e.filters=C),globalFilterFields:e.globalFilterFields,onRowSelect:e.peristTable,onRowUnselect:e.deleteTable},{header:l(()=>[o("div",kr,[o("span",ur,[mr,a(f,{class:"kn-material-input",modelValue:e.filters.global.value,"onUpdate:modelValue":t[1]||(t[1]=C=>e.filters.global.value=C),placeholder:e.$t("common.search")},null,8,["modelValue","placeholder"])])])]),default:l(()=>[a(w,{class:"lineage-table-header",selectionMode:"multiple",headerStyle:e.mainDescriptor.style.tableHeader},null,8,["headerStyle"]),a(w,{field:"name",header:e.$t("managers.datasetManagement.flatTableName"),sortable:!0},null,8,["header"])]),_:1},8,["value","selection","filters","globalFilterFields","onRowSelect","onRowUnselect"])):k("",!0)]),_:1})])],4)])])])}var hr=z(ar,[["render",gr]]);const vr={avatar:{property:"active",values:{false:{icon:"fas fa-history",style:{"background-color":"#ffc107",color:"white"}},true:{icon:"fas fa-check",style:{"background-color":"#74a748",color:"white"}}}},buttons:[{emits:"setActive",icon:"fas fa-check-circle",label:"documentExecution.documentDetails.history.activeButton"},{emits:"download",icon:"fas fa-download",label:"documentExecution.documentDetails.history.downloadButton"},{emits:"delete",icon:"fas fa-trash-alt",label:"documentExecution.documentDetails.history.deleteButton"}],defaultSortField:"active",filterFields:["name"],interaction:{type:"event"},sortFields:["name","active"],textField:"creationDate",textFieldType:"date",titleField:"name"},fr={selectedParam:[{fieldName:"name",validators:[{key:"required"}]}]};var wr={knListSettings:vr,validations:fr};const yr=S({name:"document-drivers",components:{KnListBox:W,KnInputFile:se,VCodeMirror:fe,InlineMessage:P},props:{selectedDocument:{type:Object,required:!0}},computed:{showTemplateContent(){switch(this.selectedTemplateFileType){case"xml":return!0;case"xls":return!0;case"rptdesign":return!0;case"sbicockpit":return!0;case"json":return!0;case"sbigeoreport":return!0;default:return!1}},designerButtonVisible(){return this.selectedDocument.typeCode=="OLAP"||this.selectedDocument.typeCode=="KPI"||this.selectedDocument.engine=="knowagegisengine"},...Y(U,{user:"user"})},data(){return{mainDescriptor:V,driversDescriptor:N,historyDescriptor:wr,selectedTemplate:{},listOfTemplates:[],selectedTemplateFileType:null,selectedTemplateContent:"",loading:!1,triggerUpload:!1,uploading:!1,codeMirrorScriptType:{},scriptOptions:{readOnly:!0,mode:"",indentWithTabs:!0,smartIndent:!0,lineWrapping:!0,matchBrackets:!0,autofocus:!0,theme:"eclipse",lineNumbers:!0}}},setup(){return{store:U()}},created(){const e=setInterval(()=>{!this.$refs.codeMirrorScriptType||(this.codeMirrorScriptType=this.$refs.codeMirrorScriptType.cminstance,clearInterval(e))},200);this.getAllTemplates()},methods:{async getAllTemplates(){this.loading=!0,this.$http.get(`/knowage/restful-services/2.0/documentdetails/${this.selectedDocument.id}/templates`).then(e=>this.listOfTemplates=e.data).finally(()=>this.loading=!1)},async getSelectedTemplate(e){this.$http.get(`/knowage/restful-services/2.0/documentdetails/${this.selectedDocument.id}/templates/selected/${e}`,{headers:{Accept:"application/json, text/plain, */*","X-Disable-Errors":"true"}}).then(t=>{this.selectedTemplateFileType=="sbicockpit"||this.selectedTemplateFileType=="json"||this.selectedTemplateFileType=="sbigeoreport"?this.selectedTemplateContent=JSON.stringify(t.data,null,4):this.selectedTemplateContent=t.data})},changeCodemirrorMode(){let e="";switch(this.selectedTemplateFileType){case"xml":e="text/html";break;case"xls":e="text/html";break;case"rptdesign":e="text/html";break;case"sbicockpit":e="text/javascript";break;case"json":e="text/javascript";break;case"sbigeoreport":e="text/javascript"}setTimeout(()=>{this.codeMirrorScriptType.setOption("mode",e)},250)},setFileType(e){if(e&&e.name){let t=e.name.split(".");this.selectedTemplateFileType=t[t.length-1]}},selectTemplate(e){this.selectedTemplate=e,this.setFileType(e),this.changeCodemirrorMode(),this.getSelectedTemplate(e.id)},setUploadType(){this.triggerUpload=!1,setTimeout(()=>this.triggerUpload=!0,200)},startTemplateUpload(e){this.uploading=!0,this.uploadTemplate(e.target.files[0]),this.triggerUpload=!1,setTimeout(()=>this.uploading=!1,200)},async uploadTemplate(e){var t=new FormData;t.append("file",e),await this.$http.post(`/knowage/restful-services/2.0/documentdetails/${this.selectedDocument.id}/templates`,t,{headers:{"Content-Type":"multipart/form-data","X-Disable-Errors":"true"}}).then(async()=>{this.store.setInfo({title:this.$t("common.toast.success"),msg:this.$t("common.toast.uploadSuccess")}),await this.getAllTemplates(),this.selectTemplate(this.listOfTemplates[0])}).catch(()=>this.store.setError({title:this.$t("common.toast.errorTitle"),msg:this.$t("documentExecution.documentDetails.history.uploadError")})).finally(()=>this.triggerUpload=!1)},setActiveTemplate(e){this.$http.put(`/knowage/restful-services/2.0/documentdetails/${this.selectedDocument.id}/templates/${e.id}`,{headers:{"X-Disable-Errors":"true"}}).then(()=>{this.store.setInfo({title:this.$t("common.toast.success"),msg:this.$t("documentExecution.documentDetails.history.activeOk")}),this.getAllTemplates()}).catch(()=>this.store.setError({title:this.$t("common.toast.errorTitle"),msg:this.$t("documentExecution.documentDetails.history.activeError")}))},async downloadTemplate(e){let t=e.name.split(".");await this.$http.get(`/knowage/restful-services/2.0/documentdetails/${this.selectedDocument.id}/templates/${e.id}/${t[t.length-1]}/file`,{headers:{Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9","X-Disable-Errors":"true"}}).then(r=>{if(r.data.errors)this.store.setError({title:this.$t("common.error.downloading"),msg:this.$t("common.error.errorCreatingPackage")});else if(this.store.setInfo({title:this.$t("common.toast.success")}),r.headers){var d=r.headers["content-disposition"],g=d.match(/filename[^;\n=]*=((['"]).*?\2|[^;\n]*)/i);if(g&&g.length>1){var D=g[1],p=D.replaceAll('"',"");t[t.length-1]=="json"||t[t.length-1]=="sbicockpit"?le(JSON.stringify(r.data),p,"text/html; charset=UTF-8"):le(r.data,p,"text/html; charset=UTF-8")}}}).catch(r=>this.store.setError({title:this.$t("common.toast.errorTitle"),msg:r.message}))},deleteTemplateConfirm(e){this.$confirm.require({header:this.$t("common.toast.deleteConfirmTitle"),message:this.$t("common.toast.deleteMessage"),icon:"pi pi-exclamation-triangle",accept:()=>this.deleteTemplate(e)})},async deleteTemplate(e){await this.$http.delete(`/knowage/restful-services/2.0/documentdetails/${this.selectedDocument.id}/templates/${e.id}`,{headers:{Accept:"application/json, text/plain, */*","X-Disable-Errors":"true"}}).then(()=>{this.store.setInfo({title:this.$t("common.toast.deleteTitle"),msg:this.$t("common.toast.deleteSuccess")}),this.getAllTemplates()}).catch(t=>this.store.setError({title:this.$t("common.toast.errorTitle"),msg:t.message}))},openDesignerConfirm(){this.$confirm.require({header:this.$t("common.toast.warning"),message:this.$t("documentExecution.olap.openDesignerMsg"),icon:"pi pi-exclamation-triangle",accept:()=>{switch(this.selectedDocument.typeCode){case"KPI":this.openKpiDocumentDesigner();break;case"MAP":{this.openGis();break}default:this.openDesigner()}}})},async openDesigner(){if(this.listOfTemplates.length===0)this.$emit("openDesignerDialog");else{const e=this.findActiveTemplate(),t=R({length:16,type:"base64"});await ge(this.$http,this.user,t,this.selectedDocument,e,this.$router)}},findActiveTemplate(){let e=null;for(let t=0;t<this.listOfTemplates.length;t++)if(this.listOfTemplates[t].active){e=this.listOfTemplates[t];break}return e},openGis(){this.$router.push(`/gis/edit?documentId=${this.selectedDocument.id}`)},openKpiDocumentDesigner(){this.$router.push(`/kpi-edit/${this.selectedDocument.id}?from=documentDetail`)}}}),xr={class:"p-grid p-m-0 kn-flex"},Dr={class:"p-col-4 p-sm-4 p-md-3 p-p-0 p-d-flex p-flex-column kn-flex"},Cr={id:"drivers-list-container",class:"kn-flex kn-relative"},$r={id:"driver-details-container",class:"kn-flex kn-relative"},Mr={key:1};function Ar(e,t,r,d,g,D){const p=i("Button"),b=i("KnInputFile"),u=i("Toolbar"),A=i("ProgressBar"),f=i("KnListBox"),w=i("VCodeMirror"),m=i("InlineMessage");return s(),$("div",xr,[o("div",Dr,[a(u,{class:"kn-toolbar kn-toolbar--secondary"},{start:l(()=>[x(n(e.$t("documentExecution.documentDetails.history.listTitle")),1)]),end:l(()=>[a(p,{label:e.$t("common.add"),class:"p-button-text p-button-rounded p-button-plain kn-white-color",onClick:e.setUploadType},null,8,["label","onClick"]),e.uploading?k("",!0):(s(),y(b,{key:0,label:"",changeFunction:e.startTemplateUpload,triggerInput:e.triggerUpload},null,8,["changeFunction","triggerInput"]))]),_:1}),o("div",Cr,[o("div",{style:T(e.mainDescriptor.style.absoluteScroll)},[e.loading?(s(),y(A,{key:0,class:"kn-progress-bar",mode:"indeterminate","data-test":"progress-bar"})):k("",!0),e.loading?k("",!0):(s(),y(f,{key:1,class:"kn-height-full",options:e.listOfTemplates,settings:e.historyDescriptor.knListSettings,onClick:t[0]||(t[0]=h=>e.selectTemplate(h.item)),onSetActive:t[1]||(t[1]=F(h=>e.setActiveTemplate(h.item),["stop"])),onDownload:t[2]||(t[2]=F(h=>e.downloadTemplate(h.item),["stop"])),onDelete:t[3]||(t[3]=F(h=>e.deleteTemplateConfirm(h.item),["stop"]))},null,8,["options","settings"]))],4)])]),o("div",{class:"p-col-8 p-sm-8 p-md-9 p-p-0 p-m-0",style:T(e.mainDescriptor.style.driverDetailsContainer)},[a(u,{class:"kn-toolbar kn-toolbar--secondary"},{start:l(()=>[x(n(e.$t("documentExecution.documentDetails.history.template")),1)]),end:l(()=>[e.designerButtonVisible?(s(),y(p,{key:0,label:e.$t("documentExecution.olap.openDesigner"),class:"p-button-text p-button-rounded p-button-plain kn-white-color",onClick:e.openDesignerConfirm},null,8,["label","onClick"])):k("",!0)]),_:1}),o("div",$r,[o("div",{id:"codemirror-container",style:T(e.mainDescriptor.style.absoluteScroll)},[x(n(this.scriptOptions.mode)+" ",1),e.showTemplateContent?(s(),y(w,{key:0,ref:"codeMirrorScriptType",class:"kn-height-full",value:e.selectedTemplateContent,"onUpdate:value":t[4]||(t[4]=h=>e.selectedTemplateContent=h),options:e.scriptOptions,onKeyup:t[5]||(t[5]=h=>e.$emit("touched"))},null,8,["value","options"])):(s(),$("div",Mr,[a(m,{severity:"info",class:"p-m-2 kn-width-full"},{default:l(()=>[x(n(e.$t("documentExecution.documentDetails.history.templateHint")),1)]),_:1})]))],4)])],4)])}var Er=z(yr,[["render",Ar]]);const Ir=S({name:"data-lineage",components:{DataTable:K,Column:Q,InlineMessage:P},props:{selectedDocument:{type:Object,required:!0},allDocumentDetailsProp:{type:Array,required:!0}},emits:[],data(){return{mainDescriptor:V,savedSubreports:[],selectedSubreports:[],loading:!1,filters:{global:[H]},globalFilterFields:["name"]}},setup(){return{store:U()}},async created(){await this.getSelectedSubreports()},watch:{async allDocumentDetailsProp(){await this.getSelectedSubreports()}},methods:{async getSelectedSubreports(){var e,t;this.loading=!0,(e=this.selectedDocument)!=null&&e.id&&(await this.$http.get(`/knowage/restful-services/2.0/documentdetails/${(t=this.selectedDocument)==null?void 0:t.id}/subreports`).then(r=>this.savedSubreports=r.data),this.setCheckedTables()),this.loading=!1},setCheckedTables(){for(var e=0;e<this.allDocumentDetailsProp.length;e++)for(var t=0;t<this.savedSubreports.length;t++)this.allDocumentDetailsProp[e].id==this.savedSubreports[t].sub_rpt_id&&this.selectedSubreports.push(this.allDocumentDetailsProp[e])},peristTable(e){const t=e.data;delete t.dataSetLabel,delete t.creationDate,t.refreshSeconds=parseInt(t.refreshSeconds),this.$http.post(`/knowage/restful-services/2.0/documentdetails/${this.selectedDocument.id}/subreports`,t,{headers:{"X-Disable-Errors":"true"}}).then(()=>this.store.setInfo({title:this.$t("common.save"),msg:this.$t("documentExecution.documentDetails.subreports.persistOk")})).catch(()=>this.store.setError({title:this.$t("common.toast.errorTitle"),msg:this.$t("documentExecution.documentDetails.subreports.persistError")}))},deleteTable(e){this.$http.delete(`/knowage/restful-services/2.0/documentdetails/${this.selectedDocument.id}/subreports/${e.data.id}`,{headers:{"X-Disable-Errors":"true"}}).then(()=>this.store.setInfo({title:this.$t("common.save"),msg:this.$t("documentExecution.documentDetails.subreports.deleteOk")})).catch(()=>this.store.setError({title:this.$t("common.toast.errorTitle"),msg:this.$t("documentExecution.documentDetails.subreports.deleteError")}))}}}),Tr={class:"p-grid p-m-0 kn-flex"},Sr={class:"p-d-flex p-flex-column kn-flex"},zr={class:"kn-flex kn-relative"},Ur={id:"driver-details-container",class:"p-m-2"},Vr={class:"table-header p-d-flex p-ai-center"},Nr={id:"search-container",class:"p-input-icon-left p-mr-3"},Fr=o("i",{class:"pi pi-search"},null,-1);function Or(e,t,r,d,g,D){const p=i("Toolbar"),b=i("InlineMessage"),u=i("ProgressBar"),A=i("InputText"),f=i("Column"),w=i("DataTable"),m=i("Card");return s(),$("div",Tr,[o("div",Sr,[a(p,{class:"kn-toolbar kn-toolbar--secondary"},{start:l(()=>[x(n(e.$t("documentExecution.documentDetails.subreports.title")),1)]),_:1}),o("div",zr,[o("div",{style:T(e.mainDescriptor.style.absoluteScroll)},[o("div",Ur,[a(p,{class:"kn-toolbar kn-toolbar--default"},{start:l(()=>[x(n(e.$t("documentExecution.documentDetails.subreports.tableName")),1)]),_:1}),a(m,null,{content:l(()=>[a(b,{severity:"info"},{default:l(()=>[x(n(e.$t("documentExecution.documentDetails.subreports.info")),1)]),_:1}),e.loading?(s(),y(u,{key:0,class:"kn-progress-bar",mode:"indeterminate","data-test":"progress-bar"})):k("",!0),e.loading?k("",!0):(s(),y(w,{key:1,class:"p-datatable-sm kn-table",value:e.allDocumentDetailsProp,selection:e.selectedSubreports,"onUpdate:selection":t[1]||(t[1]=h=>e.selectedSubreports=h),dataKey:"id",responsiveLayout:"scroll",filters:e.filters,"onUpdate:filters":t[2]||(t[2]=h=>e.filters=h),globalFilterFields:e.globalFilterFields,loading:e.loading,onRowSelect:e.peristTable,onRowUnselect:e.deleteTable},{header:l(()=>[o("div",Vr,[o("span",Nr,[Fr,a(A,{class:"kn-material-input",modelValue:e.filters.global.value,"onUpdate:modelValue":t[0]||(t[0]=h=>e.filters.global.value=h),placeholder:e.$t("common.search")},null,8,["modelValue","placeholder"])])])]),default:l(()=>[a(f,{class:"lineage-table-header",selectionMode:"multiple",headerStyle:e.mainDescriptor.style.tableHeader},null,8,["headerStyle"]),a(f,{field:"label",header:e.$t("common.label"),sortable:!0},null,8,["header"]),a(f,{field:"name",header:e.$t("common.name"),sortable:!0},null,8,["header"]),a(f,{field:"description",header:e.$t("common.description"),sortable:!0},null,8,["header"])]),_:1},8,["value","selection","filters","globalFilterFields","loading","onRowSelect","onRowUnselect"]))]),_:1})])],4)])])])}var Pr=z(Ir,[["render",Or]]);const Lr={width:"20%"},Br=[{disabled:!0,label:"documentExecution.documentDetails.designerDialog.xmla",value:"xmla"},{label:"documentExecution.documentDetails.designerDialog.mondrian",value:"mondrian"}],Rr=[{field:"name",header:"common.name"},{field:"value",header:"common.value"}];var he={iconColumnStyle:Lr,typeOptions:Br,xmlaParametersColumns:Rr};const _r=S({name:"document-detail-xmla-form",components:{Column:Q,DataTable:K},props:{xmlModel:{type:Object}},data(){return{descriptor:he,model:{}}},watch:{xmlModel(){this.loadModel()}},created(){this.loadModel()},methods:{loadModel(){this.model=this.xmlModel},addParameter(){this.model.parameters.push({name:"",value:""})},deleteParameter(e){this.model.parameters.splice(e,1)}}}),jr={class:"p-m-4"},Xr={class:"p-fluid p-field p-col-4"},qr={class:"p-float-label"},Kr={for:"address",class:"kn-material-input-label"},Qr={class:"p-m-2 p-col-6"},Jr={class:"p-d-flex p-flex-row"},Yr={class:"kn-material-input-label"},Gr={class:"p-fluid"},Zr=o("i",{class:"pi pi-pencil edit-icon"},null,-1);function Hr(e,t,r,d,g,D){var f;const p=i("InputText"),b=i("Button"),u=i("Column"),A=i("DataTable");return s(),$("div",jr,[o("div",Xr,[o("span",qr,[a(p,{id:"address",class:"kn-material-input",modelValue:e.model.address,"onUpdate:modelValue":t[0]||(t[0]=w=>e.model.address=w)},null,8,["modelValue"]),o("label",Kr,n(e.$t("documentExecution.documentDetails.designerDialog.xmlaAddress")),1)])]),o("div",Qr,[o("div",Jr,[o("label",Yr,n(e.$t("documentExecution.documentDetails.designerDialog.xmlaParameters")),1),a(b,{id:"add-parameter-button",class:"kn-button kn-button--primary p-ml-auto",label:e.$t("documentExecution.documentDetails.designerDialog.addParameter"),onClick:e.addParameter},null,8,["label","onClick"])]),a(A,{value:(f=e.xmlModel)==null?void 0:f.parameters,class:"p-datatable-sm kn-table p-m-5",responsiveLayout:"stack",breakpoint:"960px"},{empty:l(()=>[x(n(e.$t("common.info.noDataFound")),1)]),default:l(()=>[(s(!0),$(Z,null,pe(e.descriptor.xmlaParametersColumns,w=>(s(),y(u,{class:"kn-truncated p-mr-2",key:w.header,field:w.field,header:e.$t(w.header)},{body:l(m=>[o("div",Gr,[a(p,{class:"kn-material-input p-inputtext-sm p-mr-2",modelValue:m.data[m.column.props.field],"onUpdate:modelValue":h=>m.data[m.column.props.field]=h,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"]),Zr])]),_:2},1032,["field","header"]))),128)),a(u,{style:T(e.descriptor.iconColumnStyle)},{body:l(w=>[a(b,{icon:"pi pi-trash",class:"p-button-link",onClick:m=>e.deleteParameter(w.index),"data-test":"delete-button-"+w.index},null,8,["onClick","data-test"])]),_:1},8,["style"])]),_:1},8,["value"])])])}var Wr=z(_r,[["render",Hr]]);const en=S({name:"document-detail-mondrian-form",components:{Dropdown:O},props:{sbiExecutionId:{type:String},mondrianModel:{type:Object},mondrianSchemas:{type:Array}},data(){return{model:{},selectedMondrianSchema:null,cubes:[],selectedCube:""}},watch:{mondrianModel(){this.loadModel()}},created(){this.loadModel()},methods:{...be(U,["setLoading"]),loadModel(){this.model=this.mondrianModel},onMondrianSchemaSelected(){!this.selectedMondrianSchema||(this.model.mondrianSchema=this.selectedMondrianSchema.name,this.model.mondrianSchemaId=this.selectedMondrianSchema.currentContentId,this.model.id=this.selectedMondrianSchema.id,this.loadCubes())},async loadCubes(){!this.selectedMondrianSchema||(this.setLoading(!0),await this.$http.get(`/knowagewhatifengine/restful-services/1.0/designer/allcubes/${this.selectedMondrianSchema.currentContentId}?SBI_EXECUTION_ID=${this.sbiExecutionId}`).then(e=>this.cubes=e.data).catch(()=>{}),this.setLoading(!1))},onCubeSelected(){!this.selectedCube||this.loadMDX()},async loadMDX(){!this.selectedMondrianSchema||!this.selectedCube||(this.setLoading(!0),await this.$http.get(`/knowagewhatifengine/restful-services/1.0/designer/cubes/getMDX/${this.selectedMondrianSchema.currentContentId}/${this.selectedCube}?SBI_EXECUTION_ID=${this.sbiExecutionId}`,{headers:{Accept:"application/json, text/plain, */*"}}).then(e=>{this.model.mdxQuery=e.data,this.model.mondrianMdxQuery=e.data}).catch(()=>{}),this.setLoading(!1))}}}),tn={class:"p-m-2"},on={class:"p-fluid p-formgrid p-grid"},an={class:"p-field p-col-4"},rn={class:"p-float-label"},nn={for:"mondrian-schema-select",class:"kn-material-input-label"},ln=o("div",{class:"p-col-8"},null,-1),dn={key:0,class:"p-field p-col-4"},sn={class:"p-float-label"},cn={for:"cube-select",class:"kn-material-input-label"};function pn(e,t,r,d,g,D){const p=i("Dropdown");return s(),$("div",tn,[o("div",on,[o("div",an,[o("span",rn,[a(p,{id:"mondrian-schema-select",class:"kn-material-input",modelValue:e.selectedMondrianSchema,"onUpdate:modelValue":t[0]||(t[0]=b=>e.selectedMondrianSchema=b),options:e.mondrianSchemas,optionLabel:"name",onChange:e.onMondrianSchemaSelected},null,8,["modelValue","options","onChange"]),o("label",nn,n(e.$t("documentExecution.documentDetails.designerDialog.selectMondrianSchema")),1)])]),ln,e.selectedMondrianSchema?(s(),$("div",dn,[o("span",sn,[a(p,{id:"cube-select",class:"kn-material-input",modelValue:e.selectedCube,"onUpdate:modelValue":t[1]||(t[1]=b=>e.selectedCube=b),options:e.cubes,onChange:e.onCubeSelected},null,8,["modelValue","options","onChange"]),o("label",cn,n(e.$t("documentExecution.documentDetails.designerDialog.selectCube")),1)])])):k("",!0)])])}var bn=z(en,[["render",pn]]);const kn=S({name:"document-detail-olap-designer-dialog",components:{Dialog:q,DocumentDetailXMLAForm:Wr,DocumentDetailMondrianForm:bn,Dropdown:O,ProgressSpinner:ke},props:{visible:{type:Boolean},selectedDocument:{type:Object}},emits:["designerStarted","close"],data(){return{descriptor:he,document:null,mondrianSchemas:[],type:"mondrian",xmlModel:{address:"",parameters:[]},mondrianModel:{},sbiExecutionId:"",loading:!1}},computed:{...Y(U,{user:"user"})},watch:{selectedDocument(){this.loadDocument()}},async created(){this.sbiExecutionId=R({length:16,type:"base64"}),this.loadDocument()},methods:{...be(U,["setLoading"]),async loadDocument(){this.document=this.selectedDocument?{...this.selectedDocument}:{},this.sbiExecutionId=R({length:16,type:"base64"}),this.initialize(),this.loadMondrianSchemaResources()},async initialize(){var g,D;if(!this.document||!this.user)return;const e=(g=this.user.locale)==null?void 0:g.split("_")[0],t=this.user.userUniqueIdentifier,r=(D=this.user.locale)==null?void 0:D.split("_")[1],d=new URLSearchParams;d.set("document",decodeURIComponent(""+this.document.id)),d.set("user_id",decodeURIComponent(t)),d.set("DOCUMENT_LABEL",decodeURIComponent(this.document.label)),d.set("SBI_COUNTRY",decodeURIComponent(r)),d.set("DOCUMENT_AUTHOR",decodeURIComponent(this.document.creationUser)),d.set("DOCUMENT_DESCRIPTION",decodeURIComponent(this.document.description)),d.set("SBI_LANGUAGE",decodeURIComponent(e)),d.set("DOCUMENT_NAME",decodeURIComponent(this.document.name)),d.set("NEW_SESSION",decodeURIComponent("TRUE")),d.set("SBI_EXECUTION_ID",decodeURIComponent(this.sbiExecutionId)),d.set("EDIT_MODE",decodeURIComponent("null")),d.set("timereloadurl",decodeURIComponent(""+new Date().getTime())),d.set("ENGINE","knowageolapengine"),this.setLoading(!0),await this.$http.post("/knowagewhatifengine/restful-services/olap/startolap/edit",d,{headers:{Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9"}}).then(()=>{}),this.setLoading(!1)},async loadMondrianSchemaResources(){this.setLoading(!0),await this.$http.get("/knowage/restful-services/2.0/mondrianSchemasResource").then(e=>this.mondrianSchemas=e.data),this.setLoading(!1)},closeDialog(){this.$emit("close"),this.type="xmla",this.xmlModel={address:"",parameters:[]},this.mondrianModel={}},async start(){const e=this.type==="xmla"?{...this.xmlModel}:{...this.mondrianModel};this.setLoading(!0),await this.$http.post(`/knowagewhatifengine/restful-services/1.0/designer/cubes?SBI_EXECUTION_ID=${this.sbiExecutionId}`,e,{headers:{Accept:"application/json, text/plain, */*"}}).then(()=>{var t;this.$emit("designerStarted",{...this.selectedDocument,sbiExecutionId:this.sbiExecutionId,reference:(t=this.mondrianModel)==null?void 0:t.mondrianSchema,artifactId:this.mondrianModel.mondrianSchemaId})}).catch(()=>{}),this.setLoading(!1)}}}),un={class:"p-fluid p-formgrid p-grid p-m-4"},mn={class:"p-field p-col-4"},gn={class:"p-float-label"},hn={key:0},vn={for:"type",class:"kn-material-input-label"};function fn(e,t,r,d,g,D){const p=i("Button"),b=i("Toolbar"),u=i("ProgressSpinner"),A=i("Dropdown"),f=i("DocumentDetailXMLAForm"),w=i("DocumentDetailMondrianForm"),m=i("Dialog");return s(),y(m,{class:"full-screen-dialog",visible:e.visible,modal:!1,closable:!1,position:"right",baseZIndex:1,autoZIndex:!0},{header:l(()=>[a(b,{class:"kn-toolbar kn-toolbar--primary p-col-12"},{start:l(()=>[o("span",null,n(e.$t("documentExecution.documentDetails.designerDialog.olapDesigner")),1)]),end:l(()=>[a(p,{class:"kn-button kn-button--primary olap-designer-toolbar-button",onClick:e.closeDialog},{default:l(()=>[x(n(e.$t("common.back")),1)]),_:1},8,["onClick"]),a(p,{class:"kn-button kn-button--primary olap-designer-toolbar-button",onClick:e.start},{default:l(()=>[x(n(e.$t("common.start")),1)]),_:1},8,["onClick"])]),_:1})]),default:l(()=>[e.loading?(s(),y(u,{key:0,class:"kn-progress-spinner"})):k("",!0),o("div",un,[o("div",mn,[o("span",gn,[a(A,{id:"type",class:"kn-material-input",modelValue:e.type,"onUpdate:modelValue":t[0]||(t[0]=h=>e.type=h),options:e.descriptor.typeOptions,optionValue:"value",optionDisabled:"disabled"},{value:l(h=>[h.value?(s(),$("div",hn,[o("span",null,n(e.$t(`documentExecution.documentDetails.designerDialog.${h.value}`)),1)])):k("",!0)]),option:l(h=>[o("div",null,[o("span",null,n(e.$t(h.option.label)),1)])]),_:1},8,["modelValue","options"]),o("label",vn,n(e.$t("documentExecution.documentDetails.designerDialog.templateType")),1)])])]),e.type==="xmla"?(s(),y(f,{key:1,class:"p-m-4",xmlModel:e.xmlModel},null,8,["xmlModel"])):(s(),y(w,{key:2,class:"p-m-4",sbiExecutionId:e.sbiExecutionId,mondrianModel:e.mondrianModel,mondrianSchemas:e.mondrianSchemas},null,8,["sbiExecutionId","mondrianModel","mondrianSchemas"]))]),_:1},8,["visible"])}var wn=z(kn,[["render",fn]]);const yn=S({name:"document-details",components:{InformationsTab:no,DriversTab:Ua,OutputParamsTab:or,DataLineageTab:hr,HistoryTab:Er,SubreportsTab:Pr,TabView:we,TabPanel:ye,Badge:xe,ProgressSpinner:ke,DocumentDetailOlapDesignerDialog:wn},props:{propDocId:{type:String},propFolderId:{type:String},propMode:{type:String},viewMode:{type:String},wholeItem:{type:Object}},emits:["closeDetails","documentSaved"],data(){return{v$:L(),mainDescriptor:V,loading:!1,docId:null,folderId:null,templateToUpload:null,imageToUpload:null,selectedDataset:{},selectedDocument:{},dataSources:[],analyticalDrivers:[],drivers:[],engines:[],templates:[],attributes:[],parTypes:[],dateFormats:[],metaSourceResource:[],savedTables:[],availableFolders:[],states:V.states,types:[],allDocumentDetails:[],savedSubreports:[],selectedSubreports:[],designerDialogVisible:!1}},computed:{invalidOutputParams(){return this.selectedDocument&&this.selectedDocument.outputParameters?this.selectedDocument.outputParameters.filter(e=>e.numberOfErrors>0).length:0},invalidDrivers(){return this.selectedDocument&&this.selectedDocument.drivers?this.selectedDocument.drivers.filter(e=>e.numberOfErrors>0).length:0},showDataLineageTab(){return this.store.$state.user.functionalities.includes("DataSourceManagement")}},watch:{async propDocId(){await this.isForEdit()}},setup(){return{store:U()}},async created(){this.viewMode!=="document-detail"&&this.$route.name!=="document-details-new-document"&&this.$route.name!=="document-details-edit-document"||await this.isForEdit()},activated(){this.resetNewDocumentData(),this.propFolderId&&(this.getFunctionalities(),this.getAnalyticalDrivers(),this.getDatasources(),this.getTypes(),this.getEngines(),this.getAttributes(),this.getParTypes(),this.getDateFormats(),this.getSavedTablesByDocumentID(),this.getDataset(),this.getDataSources())},methods:{async isForEdit(){this.propMode==="execution"?(this.docId=this.propDocId,this.folderId=this.propFolderId):this.$route.params.docId?this.docId=this.$route.params.docId:this.folderId=this.$route.params.folderId,await this.loadPage(this.docId)},resetNewDocumentData(){this.wholeItem&&!this.wholeItem.fromTab&&this.propFolderId&&(this.selectedDocument={...this.mainDescriptor.newDocument},this.selectedDocument.functionalities=[])},async loadPage(e){this.loading=!0,await Promise.all([await this.getSelectedDocumentById(e),this.getFunctionalities(),this.getAnalyticalDrivers(),this.getDatasources(),this.getTypes(),this.getEngines(),this.getAttributes(),this.getParTypes(),this.getDateFormats(),this.getSavedTablesByDocumentID(),this.getDataset(),this.getDataSources()]),this.loading=!1},async getSelectedDocumentById(e){e?await this.$http.get(`/knowage/restful-services/2.0/documents/${e}`).then(t=>this.selectedDocument=t.data):(this.selectedDocument={...this.mainDescriptor.newDocument},this.selectedDocument.functionalities=[])},async getFunctionalities(){await this.$http.get("/knowage/restful-services/2.0/folders?includeDocs=false").then(e=>{if(this.availableFolders=e.data,this.$route.params.folderId){let t=this.availableFolders.find(r=>r.id==parseInt(this.folderId));this.selectedDocument.functionalities.includes(t.path)||this.selectedDocument.functionalities.push(t.path)}})},async getAnalyticalDrivers(){await this.$http.get("/knowage/restful-services/2.0/analyticalDrivers").then(e=>this.analyticalDrivers=e.data)},async getDatasources(){await this.$http.get("/knowage/restful-services/2.0/datasources").then(e=>this.dataSources=e.data)},async getDocumentDrivers(){var e,t;(e=this.selectedDocument)!=null&&e.id&&await this.$http.get(`/knowage/restful-services/2.0/documentdetails/${(t=this.selectedDocument)==null?void 0:t.id}/drivers`).then(r=>this.drivers=r.data)},async getTemplates(){var e,t;(e=this.selectedDocument)!=null&&e.id&&await this.$http.get(`/knowage/restful-services/2.0/documentdetails/${(t=this.selectedDocument)==null?void 0:t.id}/templates`).then(r=>this.templates=r.data)},async getTypes(){await this.$http.get("/knowage/restful-services/1.0/document-detail/types").then(e=>this.types=e.data)},async getEngines(){await this.$http.get("/knowage/restful-services/1.0/document-detail/engines").then(e=>this.engines=e.data)},async getAttributes(){await this.$http.get("/knowage/restful-services/2.0/attributes").then(e=>this.attributes=e.data)},async getParTypes(){await this.$http.get("/knowage/restful-services/2.0/domains/listByCode/PAR_TYPE").then(e=>this.parTypes=e.data)},async getDateFormats(){await this.$http.get("/knowage/restful-services/2.0/domains/listByCode/DATE_FORMAT").then(e=>this.dateFormats=e.data)},async getDataSources(){await this.$http.get("/knowage/restful-services/2.0/metaSourceResource/").then(e=>this.metaSourceResource=e.data)},async getSavedTablesByDocumentID(){this.selectedDocument.id&&await this.$http.get(`/knowage/restful-services/2.0/metaDocumetRelationResource/document/${this.selectedDocument.id}`).then(e=>this.savedTables=e.data)},async getDataset(){var e,t;(e=this.selectedDocument)!=null&&e.dataSetId&&await this.$http.get(`/knowage/restful-services/1.0/datasets/dataset/id/${(t=this.selectedDocument)==null?void 0:t.dataSetId}`,{headers:{"X-Disable-Errors":"true"}}).then(r=>{this.selectedDataset=r.data[0]}).catch(r=>{this.store.setError({title:this.$t("common.toast.errorTitle"),msg:r.message})})},async getAllSubreports(){this.loading=!0,await this.$http.get("/knowage/restful-services/2.0/documentdetails/").then(e=>this.allDocumentDetails=e.data),this.loading=!1},setTemplateForUpload(e){this.templateToUpload=e},async uploadTemplate(e,t){if(this.templateToUpload){var r=new FormData;r.append("file",e),await this.$http.post(`/knowage/restful-services/2.0/documentdetails/${t}/templates`,r,{headers:{"Content-Type":"multipart/form-data","X-Disable-Errors":"true"}}).then(()=>this.templateToUpload=null).catch(()=>{this.store.setError({title:this.$t("common.toast.errorTitle"),msg:this.$t("documentExecution.documentDetails.history.uploadError")})})}},deleteImage(){this.$http.delete(`/knowage/restful-services/2.0/documentdetails/${this.selectedDocument.id}/image`,{headers:{Accept:"application/json, text/plain, */*","X-Disable-Errors":"true"}}).then(()=>this.loadPage(this.docId)).catch(()=>this.store.setError({title:this.$t("common.toast.errorTitle"),msg:this.$t("documentExecution.documentDetails.info.imageError")}))},setImageForUpload(e){this.imageToUpload=e},async uploadImage(e,t){if(this.imageToUpload){var r=new FormData;r.append("file",e),r.append("fileName",e.name),await this.$http.post(`/knowage/restful-services/2.0/documentdetails/${t}/image`,r,{headers:{"Content-Type":"multipart/form-data","X-Disable-Errors":"true"}}).then(()=>this.imageToUpload=null).catch(()=>{this.store.setError({title:this.$t("common.toast.errorTitle"),msg:this.$t("documentExecution.documentDetails.info.imageUploadError")})})}},async saveOutputParams(){this.selectedDocument.outputParameters&&this.selectedDocument.outputParameters.forEach(e=>{e.id?e.isChanged&&(delete e.numberOfErrors,delete e.isChanged,this.$http.put(`/knowage/restful-services/2.0/documentdetails/${this.selectedDocument.id}/outputparameters/${e.id}`,e,{headers:{Accept:"application/json, text/plain, */*","X-Disable-Errors":"true"}}).catch(()=>this.store.setError({title:this.$t("common.toast.errorTitle"),msg:this.$t("documentExecution.documentDetails.outputParams.persistError")}))):(delete e.numberOfErrors,delete e.tempId,delete e.isChanged,this.$http.post(`/knowage/restful-services/2.0/documentdetails/${this.selectedDocument.id}/outputparameters`,e,{headers:{Accept:"application/json, text/plain, */*","X-Disable-Errors":"true"}}).catch(()=>this.store.setError({title:this.$t("common.toast.errorTitle"),msg:this.$t("documentExecution.documentDetails.outputParams.persistError")})))})},async saveDrivers(){this.selectedDocument.drivers&&this.selectedDocument.drivers.forEach(e=>{e.modifiable=0,e.id?e.isChanged&&(delete e.numberOfErrors,delete e.isChanged,this.$http.put(`/knowage/restful-services/2.0/documentdetails/${this.selectedDocument.id}/drivers/${e.id}`,e,{headers:{Accept:"application/json, text/plain, */*","X-Disable-Errors":"true"}}).catch(()=>this.store.setError({title:this.$t("common.toast.errorTitle"),msg:this.$t("documentExecution.documentDetails.drivers.persistError")}))):(delete e.numberOfErrors,delete e.isChanged,this.$http.post(`/knowage/restful-services/2.0/documentdetails/${this.selectedDocument.id}/drivers`,e,{headers:{Accept:"application/json, text/plain, */*","X-Disable-Errors":"true"}}).catch(()=>this.store.setError({title:this.$t("common.toast.errorTitle"),msg:this.$t("documentExecution.documentDetails.drivers.persistError")})))})},saveRequest(e){return this.selectedDocument.id?this.$http.put(`/knowage/restful-services/2.0/documentdetails/${e.id}`,e,{headers:{Accept:"application/json, text/plain, */*","X-Disable-Errors":"true"}}):this.$http.post("/knowage/restful-services/2.0/documentdetails",e,{headers:{Accept:"application/json, text/plain, */*","X-Disable-Errors":"true"}})},async saveDocument(){this.loading=!0;let e={...this.selectedDocument};const t=this.propFolderId;delete e.drivers,delete e.outputParameters,delete e.dataSetLabel,await this.saveRequest(e).then(async r=>{await this.saveOutputParams(),await this.saveDrivers(),await this.uploadTemplate(this.templateToUpload,r.data.id),await this.uploadImage(this.imageToUpload,r.data.id),this.store.setInfo({title:this.$t("common.save"),msg:this.$t("common.toast.updateSuccess")}),setTimeout(()=>{const d=`/document-details/${r.data.id}`;this.selectedDocument.id||this.$router.push(d),this.$emit("documentSaved",{...r.data,folderId:t}),this.loadPage(r.data.id)},200)}).catch(r=>{this.store.setError({title:this.$t("common.toast.errorTitle"),msg:r.message}),this.loading=!1})},closeDocument(){this.$emit("closeDetails")},onTabChange(e){e.index===5&&this.getAllSubreports()},openDesignerDialog(){this.designerDialogVisible=!0},onDesignerStart(e){this.$router.push(`/olap-designer/${e.sbiExecutionId}?olapId=${e.id}&olapName=${e.name}&olapLabel=${e.label}&noTemplate=${!0}&reference=${e.reference}&engine=${e.engine}&artifactId=${e.artifactId}`)}}}),xn={key:0,id:"document-details-container",class:"p-d-flex p-flex-column kn-flex kn-height-full"},Dn={class:"document-details-tab-container p-d-flex p-flex-column kn-flex"};function Cn(e,t,r,d,g,D){const p=i("Button"),b=i("Toolbar"),u=i("ProgressSpinner"),A=i("InformationsTab"),f=i("TabPanel"),w=i("Badge"),m=i("DriversTab"),h=i("OutputParamsTab"),C=i("DataLineageTab"),M=i("HistoryTab"),v=i("SubreportsTab"),E=i("TabView"),c=i("DocumentDetailOlapDesignerDialog"),ee=G("tooltip");return e.viewMode==="document-detail"||e.$route.name==="document-details-new-document"||e.$route.name==="document-details-edit-document"?(s(),$("div",xn,[a(b,{class:"kn-toolbar kn-toolbar--primary p-p-0 p-m-0 p-col-12"},{start:l(()=>[x(n(e.$t("documentExecution.documentDetails.title")),1)]),end:l(()=>[_(a(p,{icon:"pi pi-save",class:"p-button-text p-button-rounded p-button-plain",onClick:e.saveDocument,disabled:e.invalidDrivers>0||e.invalidOutputParams>0||e.v$.$invalid},null,8,["onClick","disabled"]),[[ee,e.$t("common.save"),void 0,{bottom:!0}]]),e.propMode==="execution"?_((s(),y(p,{key:0,icon:"pi pi-times",class:"p-button-text p-button-rounded p-button-plain",onClick:e.closeDocument},null,8,["onClick"])),[[ee,e.$t("common.close"),void 0,{bottom:!0}]]):k("",!0)]),_:1}),e.loading?(s(),y(u,{key:0,class:"doc-details-spinner",style:T(e.mainDescriptor.style.spinnerStyle)},null,8,["style"])):k("",!0),o("div",Dn,[a(E,{class:"document-details-tabview p-d-flex p-flex-column kn-flex",onTabChange:e.onTabChange},{default:l(()=>{var J,te,oe,ae,re,ne,ie;return[a(f,null,{header:l(()=>[o("span",null,n(e.$t("documentExecution.documentDetails.info.infoTitle")),1)]),default:l(()=>[e.loading?k("",!0):(s(),y(A,{key:0,selectedDocument:e.selectedDocument,availableFolders:e.availableFolders,documentTypes:e.types,documentEngines:e.engines,availableDatasources:e.dataSources,availableStates:e.states,selectedDataset:e.selectedDataset,availableTemplates:e.templates,availableAttributes:e.attributes,onSetTemplateForUpload:e.setTemplateForUpload,onSetImageForUpload:e.setImageForUpload,onDeleteImage:e.deleteImage,onOpenDesignerDialog:e.openDesignerDialog},null,8,["selectedDocument","availableFolders","documentTypes","documentEngines","availableDatasources","availableStates","selectedDataset","availableTemplates","availableAttributes","onSetTemplateForUpload","onSetImageForUpload","onDeleteImage","onOpenDesignerDialog"]))]),_:1}),(J=this.selectedDocument)!=null&&J.id?(s(),y(f,{key:0},{header:l(()=>[o("span",{class:I({"details-warning-color":e.invalidDrivers})},n(e.$t("documentExecution.documentDetails.drivers.title")),3),e.invalidDrivers>0?(s(),y(w,{key:0,value:e.invalidDrivers,class:"p-ml-2",severity:"danger"},null,8,["value"])):k("",!0)]),default:l(()=>[a(m,{selectedDocument:e.selectedDocument,availableDrivers:e.drivers,availableAnalyticalDrivers:e.analyticalDrivers},null,8,["selectedDocument","availableDrivers","availableAnalyticalDrivers"])]),_:1})):k("",!0),(te=this.selectedDocument)!=null&&te.id?(s(),y(f,{key:1},{header:l(()=>[o("span",{class:I({"details-warning-color":e.invalidOutputParams})},n(e.$t("documentExecution.documentDetails.outputParams.title")),3),e.invalidOutputParams>0?(s(),y(w,{key:0,value:e.invalidOutputParams,class:"p-ml-2",severity:"danger"},null,8,["value"])):k("",!0)]),default:l(()=>[a(h,{selectedDocument:e.selectedDocument,typeList:e.parTypes,dateFormats:e.dateFormats},null,8,["selectedDocument","typeList","dateFormats"])]),_:1})):k("",!0),((oe=this.selectedDocument)==null?void 0:oe.id)&&e.showDataLineageTab?(s(),y(f,{key:2},{header:l(()=>[o("span",null,n(e.$t("documentExecution.documentDetails.dataLineage.title")),1)]),default:l(()=>[a(C,{selectedDocument:e.selectedDocument,metaSourceResource:e.metaSourceResource,savedTables:e.savedTables},null,8,["selectedDocument","metaSourceResource","savedTables"])]),_:1})):k("",!0),(ae=this.selectedDocument)!=null&&ae.id?(s(),y(f,{key:3},{header:l(()=>[o("span",null,n(e.$t("documentExecution.documentDetails.history.title")),1)]),default:l(()=>[a(M,{selectedDocument:e.selectedDocument,onOpenDesignerDialog:e.openDesignerDialog},null,8,["selectedDocument","onOpenDesignerDialog"])]),_:1})):k("",!0),((re=this.selectedDocument)==null?void 0:re.id)&&((ne=this.selectedDocument)==null?void 0:ne.typeCode)=="REPORT"&&((ie=this.selectedDocument)==null?void 0:ie.engine)=="knowagejasperreporte"?(s(),y(f,{key:4},{header:l(()=>[o("span",null,n(e.$t("documentExecution.documentDetails.subreports.title")),1)]),default:l(()=>[a(v,{selectedDocument:e.selectedDocument,allDocumentDetailsProp:e.allDocumentDetails},null,8,["selectedDocument","allDocumentDetailsProp"])]),_:1})):k("",!0)]}),_:1},8,["onTabChange"])]),e.designerDialogVisible?(s(),y(c,{key:1,visible:e.designerDialogVisible,selectedDocument:e.selectedDocument,onClose:t[0]||(t[0]=J=>e.designerDialogVisible=!1),onDesignerStarted:e.onDesignerStart},null,8,["visible","selectedDocument","onDesignerStarted"])):k("",!0)])):k("",!0)}var Fn=z(yn,[["render",Cn]]);export{Fn as default};
//# sourceMappingURL=DocumentDetails-8e77fd31.js.map
