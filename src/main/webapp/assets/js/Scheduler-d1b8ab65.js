import{_ as p,d as g,X as f,s as J,r as a,o as n,c as j,a as l,f as i,w as r,g as $,t as k,h as w,A as D,V as d}from"./index-1e676509.js";import{K as N}from"./KnListBox-94855720.js";import"./menu.esm-6bee86d0.js";const y={badgeField:"numberOfDocuments",badgeSeverity:"info",buttons:[{emits:"clone",icon:"far fa-copy",label:"common.clone"},{emits:"delete",icon:"far fa-trash-alt",label:"common.delete"}],defaultSortField:"jobName",filterFields:["jobName"],interaction:{parameterLabel:"jobName",parameterValue:"jobName",type:"event"},sortFields:["jobName"],titleField:"jobName",tooltipField:"jobDescription"};var B={knListSettings:y};const S=g({name:"scheduler",components:{FabButton:f,KnListBox:N},data(){return{schedulerDescriptor:B,jobs:[],selectedJob:null,loading:!1}},setup(){return{store:J()}},async created(){await this.loadPage()},methods:{async loadPage(){this.$route.query.id?await this.loadSelectJob(this.$route.query.id):(this.selectedJob={jobName:"",jobDescription:"",documents:[],triggers:[],edit:!1},await this.loadJobs())},async loadJobs(){this.loading=!0,this.jobs=[];let e=[];await this.$http.get("/knowage/restful-services/scheduleree/listAllJobs/").then(t=>e=t.data.root),e.forEach(t=>{t.jobGroup==="BIObjectExecutions"&&this.jobs.push({...t,numberOfDocuments:t.documents.length})}),this.loading=!1},showJobDetail(e,t){this.selectedJob=e&&e.item?{...e.item,edit:!0}:{jobName:"",jobDescription:"",documents:[],triggers:[]},t&&this.selectedJob&&(this.selectedJob.jobName=this.$t("common.copyOf")+" "+this.selectedJob.jobName,this.selectedJob.edit=!1);const o=e&&e.item?`/scheduler/edit-package-schedule?id=${e.item.jobName}&clone=${t}`:"/scheduler/new-package-schedule";this.$router.push(o)},async deleteJobConfirm(e){this.$confirm.require({message:this.$t("common.toast.deleteMessage"),header:this.$t("common.toast.deleteTitle"),icon:"pi pi-exclamation-triangle",accept:async()=>{await this.deleteJob(e.item.jobName)}})},async deleteJob(e){this.loading=!0;let t=null;await this.$http.post(`/knowage/restful-services/scheduleree/deleteJob?jobGroup=BIObjectExecutions&jobName=${e}`).then(o=>{this.store.setInfo({title:this.$t("common.toast.deleteTitle"),msg:this.$t("common.toast.deleteSuccess")}),t=o.data}).catch(o=>{this.store.setError({title:this.$t("common.toast.deleteTitle"),msg:o==null?void 0:o.message})}),(t==null?void 0:t.resp)==="ok"&&(await this.loadJobs(),this.selectedJob=null,this.$router.push("/scheduler")),this.loading=!1},async loadSelectJob(e){await this.loadJobs(),this.selectedJob=this.jobs.find(t=>t.jobName===e),this.selectedJob&&(this.selectedJob.edit=!0)},closeDetail(){this.selectedJob=null}}}),v={class:"kn-page"},C={class:"kn-page-content p-grid p-m-0"},F={class:"kn-list--column p-col-4 p-sm-4 p-md-3 p-p-0"},T={class:"p-col-8 p-sm-8 p-md-9 p-p-0 p-m-0 kn-page"};function _(e,t,o,L,V,E){const c=a("FabButton"),m=a("Toolbar"),b=a("ProgressBar"),u=a("KnListBox"),h=a("router-view");return n(),j("div",v,[l("div",C,[l("div",F,[i(m,{class:"kn-toolbar kn-toolbar--primary"},{start:r(()=>[$(k(e.$t("managers.scheduler.title")),1)]),end:r(()=>[i(c,{icon:"fas fa-plus",onClick:t[0]||(t[0]=s=>e.showJobDetail(null,!1)),"data-test":"progress-bar"})]),_:1}),e.loading?(n(),w(b,{key:0,class:"kn-progress-bar",mode:"indeterminate"})):D("",!0),i(u,{options:e.jobs,settings:e.schedulerDescriptor.knListSettings,onClick:t[1]||(t[1]=s=>e.showJobDetail(s,!1)),onClone:t[2]||(t[2]=d(s=>e.showJobDetail(s,!0),["stop"])),onDelete:d(e.deleteJobConfirm,["stop"])},null,8,["options","settings","onDelete"])]),l("div",T,[i(h,{selectedJob:e.selectedJob,onClosed:t[3]||(t[3]=s=>e.touched=!1),onDocumentSaved:e.loadSelectJob,onClose:e.closeDetail,onTriggerSaved:e.loadPage},null,8,["selectedJob","onDocumentSaved","onClose","onTriggerSaved"])])])])}var q=p(S,[["render",_]]);export{q as default};
//# sourceMappingURL=Scheduler-d1b8ab65.js.map
