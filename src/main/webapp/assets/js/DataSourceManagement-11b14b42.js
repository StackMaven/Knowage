import{_ as w,d as _,X as F,a4 as T,j as A,s as B,r as s,y as M,o as n,c as j,a as o,f as i,w as r,g,t as l,h as c,A as d,z as I,D as P,V as S}from"./index-1e676509.js";import{d as u}from"./DataSourceDescriptor-f31a2fca.js";const N=_({name:"datasources-management",components:{FabButton:F,Listbox:T,Avatar:A},data(){return{dataSourceDescriptor:u,datasources:[],selDatasource:{},listOfAvailableDatabases:[],user:{},loading:!1,touched:!1}},setup(){return{store:B()}},async created(){await this.getAllDatasources(),await this.getAllDatabases(),await this.getCurrentUser()},methods:{async getAllDatabases(){return this.$http.get("/knowage/restful-services/2.0/databases").then(e=>{this.listOfAvailableDatabases=e.data}).finally(()=>this.loading=!1)},async getCurrentUser(){return this.$http.get("/knowage/restful-services/2.0/currentuser").then(e=>{this.user=e.data}).finally(()=>this.loading=!1)},async getAllDatasources(){this.loading=!0,await this.$http.get("/knowage/restful-services/2.0/datasources").then(e=>{this.datasources=e.data,this.convertToSeconds(this.datasources)}).finally(()=>this.loading=!1)},convertToSeconds(e){Array.prototype.forEach.call(e,t=>{t.hasOwnProperty("jdbcPoolConfiguration")&&(t.jdbcPoolConfiguration.maxWait/=1e3,t.jdbcPoolConfiguration.timeBetweenEvictionRuns/=1e3,t.jdbcPoolConfiguration.minEvictableIdleTimeMillis/=1e3,t.jdbcPoolConfiguration.maxIdle===null&&(t.jdbcPoolConfiguration.maxIdle=u.newDataSourceValues.jdbcPoolConfiguration.maxIdle),t.jdbcPoolConfiguration.validationQueryTimeout===null&&(t.jdbcPoolConfiguration.validationQueryTimeout=u.newDataSourceValues.jdbcPoolConfiguration.validationQueryTimeout))})},showForm(e){const t=e.value?`/datasource-management/${e.value.dsId}`:"/datasource-management/new-datasource";this.touched?this.$confirm.require({message:this.$t("common.toast.unsavedChangesMessage"),header:this.$t("common.toast.unsavedChangesHeader"),icon:"pi pi-exclamation-triangle",accept:()=>{this.touched=!1,this.$router.push(t),this.selDatasource=e.value}}):(this.$router.push(t),this.selDatasource=e.value)},deleteDatasourceConfirm(e){this.$confirm.require({message:this.$t("common.toast.deleteMessage"),header:this.$t("common.toast.deleteTitle"),icon:"pi pi-exclamation-triangle",accept:()=>this.deleteDatasource(e)})},async deleteDatasource(e){await this.$http.delete("/knowage/restful-services/2.0/datasources/"+e).then(()=>{this.store.setInfo({title:this.$t("common.toast.deleteTitle"),msg:this.$t("common.toast.deleteSuccess")}),this.$router.push("/datasource-management"),this.getAllDatasources()}).catch(t=>{this.store.setError({title:"Delete error",msg:t.message})})},reloadPage(){this.touched=!1,this.$router.push("/datasource-management"),this.getAllDatasources()},onFormClose(){this.touched=!1}}}),V={class:"kn-page-content p-grid p-m-0"},E={class:"kn-list--column p-col-4 p-sm-4 p-md-3 p-p-0"},L={class:"kn-list-item","data-test":"list-item"},O={class:"kn-list-item-text"},z={class:"kn-list-item-text-secondary"},Q={class:"p-col-8 p-sm-8 p-md-9 p-p-0 p-m-0 p-d-flex p-flex-column kn-height-full-vertical"};function q(e,t,U,H,K,R){const f=s("FabButton"),b=s("Toolbar"),v=s("ProgressBar"),D=s("Avatar"),y=s("Button"),C=s("Listbox"),$=s("router-view"),k=M("tooltip");return n(),j("div",V,[o("div",E,[i(b,{class:"kn-toolbar kn-toolbar--primary"},{start:r(()=>[g(l(e.$t("managers.dataSourceManagement.title")),1)]),end:r(()=>[i(f,{icon:"fas fa-plus",onClick:e.showForm,"data-test":"open-form-button"},null,8,["onClick"])]),_:1}),e.loading?(n(),c(v,{key:0,mode:"indeterminate",class:"kn-progress-bar","data-test":"progress-bar"})):d("",!0),e.loading?d("",!0):(n(),c(C,{key:1,class:"kn-list--column",options:e.datasources,optionLabel:"label",filter:!0,filterPlaceholder:e.$t("common.search"),filterMatchMode:"contains",filterFields:e.dataSourceDescriptor.filterFields,emptyFilterMessage:e.$t("common.info.noDataFound"),onChange:e.showForm,"data-test":"datasource-list"},{empty:r(()=>[g(l(e.$t("common.info.noDataFound")),1)]),option:r(a=>{var m,p,h;return[o("div",L,[I(i(D,{icon:(m=e.dataSourceDescriptor.iconTypesMap[a.option.dialectName])==null?void 0:m.dbIcon,shape:"circle",size:"medium",style:P((p=e.dataSourceDescriptor.iconTypesMap[a.option.dialectName])==null?void 0:p.style)},null,8,["icon","style"]),[[k,(h=e.dataSourceDescriptor.iconTypesMap[a.option.dialectName])==null?void 0:h.tooltip]]),o("div",O,[o("span",null,l(a.option.label),1),o("span",z,l(a.option.descr),1)]),a.option.owner==this.user.userId||this.user.isSuperadmin?(n(),c(y,{key:0,icon:"far fa-trash-alt",class:"p-button-text p-button-rounded p-button-plain",onClick:S(W=>e.deleteDatasourceConfirm(a.option.dsId),["stop"]),"data-test":"delete-button"},null,8,["onClick"])):d("",!0)])]}),_:1},8,["options","filterPlaceholder","filterFields","emptyFilterMessage","onChange"]))]),o("div",Q,[i($,{selectedDatasource:e.selDatasource,databases:e.listOfAvailableDatabases,user:e.user,onTouched:t[0]||(t[0]=a=>e.touched=!0),onClosed:e.onFormClose,onInserted:e.reloadPage},null,8,["selectedDatasource","databases","user","onClosed","onInserted"])])])}var J=w(N,[["render",q]]);export{J as default};
//# sourceMappingURL=DataSourceManagement-11b14b42.js.map
