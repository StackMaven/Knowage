import{d as w,l as T,n as C,q as O,s as I,W as N,_ as $,r as t,y as F,o as d,c as v,f as s,w as a,g as h,t as m,D as S,a as b,z as j,B as _,i as A,h as k,A as J,C as M,V as W}from"./index-1e676509.js";import{f as B}from"./filterHelper-a723991a.js";const E={style:{width:"80vw"}};var P={dialog:E};const U=["name","dateCreation"],H={style:{"text-align":"end",width:"5%"}},L={message:{"align-items":"center",display:"flex","justify-content":"center","text-align":"center"}};var R={globalFilterFields:U,iconColumn:H,styles:L};const Y=w({name:"workspace-schedulation-old-schedulations-table",components:{Column:T,DataTable:C,Message:O},props:{propSchedulations:{type:Array}},data(){return{workspaceSchedulationOldSchedulationsTableDescriptor:R,schedulations:[],filters:{global:[B]},user:null}},watch:{propSchedulations(){this.loadSchedulations()}},setup(){return{store:I()}},created(){this.user=this.store.$state.user,this.loadSchedulations()},methods:{loadSchedulations(){this.schedulations=this.propSchedulations},getFormattedDate(e,o){return N(e,o)},downloadSnapshot(e){var n;const o=`/knowage/servlet/AdapterHTTP?NEW_SESSION=TRUE&user_id=${(n=this.user)==null?void 0:n.userUniqueIdentifier}&ACTION_NAME=GET_SNAPSHOT_CONTENT&SNAPSHOT_ID=${e.id}&LIGHT_NAVIGATOR_DISABLED=TRUE&OBJECT_ID=${e.biobjId}`;window.open(o,"_blank")}}}),G={class:"table-header p-d-flex p-ai-center"},q={id:"search-container",class:"p-input-icon-left p-mr-3"},z=b("i",{class:"pi pi-search"},null,-1);function K(e,o,n,f,g,D){const r=t("Message"),c=t("InputText"),i=t("Column"),u=t("Button"),p=t("DataTable"),y=F("tooltip");return d(),v(_,null,[s(r,{class:"p-m-2",severity:"info",closable:!1,style:S(e.workspaceSchedulationOldSchedulationsTableDescriptor.styles.message)},{default:a(()=>[h(m(e.$t("workspace.schedulation.oldSchedulationsMessage")),1)]),_:1},8,["style"]),s(p,{value:e.schedulations,id:"old-chedulations-table",class:"p-datatable-sm kn-table",dataKey:"id",filters:e.filters,"onUpdate:filters":o[1]||(o[1]=l=>e.filters=l),globalFilterFields:e.workspaceSchedulationOldSchedulationsTableDescriptor.globalFilterFields,paginator:e.schedulations.length>20,rows:20,responsiveLayout:"stack",breakpoint:"600px"},{empty:a(()=>[s(r,{class:"p-m-2",severity:"info",closable:!1,style:S(e.workspaceSchedulationOldSchedulationsTableDescriptor.styles.message)},{default:a(()=>[h(m(e.$t("common.info.noDataFound")),1)]),_:1},8,["style"])]),header:a(()=>[b("div",G,[b("span",q,[z,s(c,{class:"kn-material-input",modelValue:e.filters.global.value,"onUpdate:modelValue":o[0]||(o[0]=l=>e.filters.global.value=l),type:"text",placeholder:e.$t("common.search")},null,8,["modelValue","placeholder"])])])]),default:a(()=>[s(i,{class:"kn-truncated",field:"name",header:e.$t("common.packages"),key:"name",sortable:!0},null,8,["header"]),s(i,{class:"kn-truncated",field:"dateCreation",header:e.$t("common.time"),key:"dateCreation",sortable:!0},{body:a(l=>[h(m(e.getFormattedDate(l.data.dateCreation,"MMM DD, YYYY h:mm:ss A")),1)]),_:1},8,["header"]),s(i,{style:S(e.workspaceSchedulationOldSchedulationsTableDescriptor.iconColumn.style)},{body:a(l=>[j(s(u,{icon:"pi pi-download",class:"p-button-link",onClick:V=>e.downloadSnapshot(l.data)},null,8,["onClick"]),[[y,e.$t("common.download"),void 0,{top:!0}]])]),_:1},8,["style"])]),_:1},8,["value","filters","globalFilterFields","paginator"])],64)}var Q=$(Y,[["render",K]]);const X=w({name:"workspace-schedulation-old-schedulations-dialog",components:{Dialog:A,WorkspaceSchedulationOldSchedulationsTable:Q},props:{visible:{type:Boolean},selectedJob:{type:Object}},emits:["close"],data(){return{workspaceSchedulationOldSchedulationsDialogDescriptor:P,job:null,schedulations:[],loading:!1}},watch:{selectedJob(){this.loadJob()}},created(){this.loadJob()},methods:{async loadJob(){this.loading=!0,this.job={...this.selectedJob},await this.loadAllSchedulers(),this.loading=!1},closeDialog(){this.$emit("close")},async loadAllSchedulers(){if(this.schedulations=[],this.job&&this.job.documents)for(let e=0;e<this.job.documents.length;e++){let o=await this.getDocumentId(this.job.documents[e].name);o&&this.loadDocumentSchedulers(o,this.job.jobName)}},async getDocumentId(e){let o=null;return await this.$http.get(`/knowage/restful-services/2.0/workspace/scheduler/${e}`).then(n=>{o=n.data}),o},async loadDocumentSchedulers(e,o){await this.$http.get(`/knowage/restful-services/1.0/documentsnapshot/getSnapshotsForSchedulationAndDocument?id=${e}&scheduler=${o}`).then(n=>{var f;(f=n.data)==null||f.schedulers.forEach(g=>this.schedulations.push({...g,urlPath:n.data.urlPath}))})}}}),Z={class:"p-d-flex p-flex-row p-jc-end"};function x(e,o,n,f,g,D){const r=t("Toolbar"),c=t("ProgressBar"),i=t("WorkspaceSchedulationOldSchedulationsTable"),u=t("Button"),p=t("Dialog");return d(),k(p,{class:"p-fluid kn-dialog--toolbar--primary",contentStyle:e.workspaceSchedulationOldSchedulationsDialogDescriptor.dialog.style,visible:e.visible,modal:!0,closable:!1},{header:a(()=>[s(r,{class:"kn-toolbar kn-toolbar--primary p-p-0 p-m-0 p-col-12"},{start:a(()=>[h(m(e.$t("workspace.schedulation.executedSchedulations")),1)]),_:1})]),footer:a(()=>[b("div",Z,[s(u,{class:"kn-button kn-button--primary",onClick:e.closeDialog},{default:a(()=>[h(m(e.$t("common.cancel")),1)]),_:1},8,["onClick"])])]),default:a(()=>[e.loading?(d(),k(c,{key:0,mode:"indeterminate",class:"kn-progress-bar"})):J("",!0),s(i,{propSchedulations:e.schedulations},null,8,["propSchedulations"])]),_:1},8,["contentStyle","visible"])}var ee=$(X,[["render",x]]);const oe=[{field:"jobName",header:"common.name"},{field:"jobDescription",header:"common.description"}],te={width:"3rem"},se=["jobName","jobDescription"],ae={style:{"text-align":"end",width:"5%"}},le={message:{"align-items":"center",display:"flex","justify-content":"center","text-align":"center"}};var ne={columns:oe,expanderHeaderStyle:te,globalFilterFields:se,iconColumn:ae,styles:le};const ie=w({name:"workspace-schedulation-table",components:{Column:T,DataTable:C,Message:O},props:{propJobs:{type:Array}},emits:["viewOldSchedulationsClick"],data(){return{workspaceSchedulationTableDescriptor:ne,jobs:[],filters:{global:[B]}}},watch:{propJobs(){this.loadJobs()}},created(){this.loadJobs()},methods:{loadJobs(){this.jobs=this.propJobs},viewRanSchedulations(e){this.$emit("viewOldSchedulationsClick",e)}}}),re={class:"table-header p-d-flex p-ai-center"},de={id:"search-container",class:"p-input-icon-left p-mr-3"},ce=b("i",{class:"pi pi-search"},null,-1);function ue(e,o,n,f,g,D){const r=t("InputText"),c=t("Message"),i=t("Column"),u=t("Button"),p=t("DataTable"),y=F("tooltip");return d(),k(p,{value:e.jobs,id:"jobs-table",class:"p-datatable-sm kn-table",dataKey:"jobName",filters:e.filters,"onUpdate:filters":o[1]||(o[1]=l=>e.filters=l),globalFilterFields:e.workspaceSchedulationTableDescriptor.globalFilterFields,responsiveLayout:"stack",breakpoint:"600px"},{header:a(()=>[b("div",re,[b("span",de,[ce,s(r,{class:"kn-material-input",modelValue:e.filters.global.value,"onUpdate:modelValue":o[0]||(o[0]=l=>e.filters.global.value=l),type:"text",placeholder:e.$t("common.search"),"data-test":"search-input"},null,8,["modelValue","placeholder"])])])]),empty:a(()=>[s(c,{class:"p-m-2",severity:"info",closable:!1,style:S(e.workspaceSchedulationTableDescriptor.styles.message)},{default:a(()=>[h(m(e.$t("common.info.noDataFound")),1)]),_:1},8,["style"])]),default:a(()=>[(d(!0),v(_,null,M(e.workspaceSchedulationTableDescriptor.columns,l=>(d(),k(i,{class:"kn-truncated",field:l.field,header:e.$t(l.header),key:l.field,sortable:!0},null,8,["field","header"]))),128)),s(i,{style:S(e.workspaceSchedulationTableDescriptor.iconColumn.style)},{body:a(l=>[j(s(u,{icon:"fa fa-eye",class:"p-button-link",onClick:W(V=>e.viewRanSchedulations(l.data),["stop"])},null,8,["onClick"]),[[y,e.$t("workspace.schedulation.ranSchedulations"),void 0,{left:!0}]])]),_:1},8,["style"])]),_:1},8,["value","filters","globalFilterFields"])}var pe=$(ie,[["render",ue]]);const he=w({name:"workspace-schedulation-view",components:{WorkspaceSchedulationOldSchedulationsDialog:ee,WorkspaceSchedulationTable:pe},emits:["showMenu"],data(){return{jobs:[],selectedSchedulations:{},schedulationsDialogVisible:!1,selectedJob:null,loading:!1}},async created(){await this.loadJobs()},methods:{async loadJobs(){this.loading=!0,await this.$http.get("/knowage/restful-services/scheduleree/listAllJobs").then(e=>this.jobs=e.data.root),this.loading=!1},viewOldSchedulations(e){this.selectedJob=e,this.schedulationsDialogVisible=!0},closeOldSchedulationsDialog(){this.schedulationsDialogVisible=!1,this.selectedJob=null}}});function me(e,o,n,f,g,D){const r=t("Button"),c=t("Toolbar"),i=t("ProgressBar"),u=t("WorkspaceSchedulationTable"),p=t("WorkspaceSchedulationOldSchedulationsDialog");return d(),v(_,null,[s(c,{class:"kn-toolbar kn-toolbar--secondary"},{start:a(()=>[s(r,{id:"showSidenavIcon",icon:"fas fa-bars",class:"p-button-text p-button-rounded p-button-plain",onClick:o[0]||(o[0]=y=>e.$emit("showMenu"))}),h(" "+m(e.$t("workspace.schedulation.title")),1)]),_:1}),e.loading?(d(),k(i,{key:0,mode:"indeterminate",class:"kn-progress-bar"})):J("",!0),s(u,{class:"kn-overflow p-m-2",propJobs:e.jobs,onViewOldSchedulationsClick:e.viewOldSchedulations,"data-test":"schedulation-table"},null,8,["propJobs","onViewOldSchedulationsClick"]),s(p,{visible:e.schedulationsDialogVisible,selectedJob:e.selectedJob,onClose:e.closeOldSchedulationsDialog},null,8,["visible","selectedJob","onClose"])],64)}var ge=$(he,[["render",me]]);export{ge as default};
//# sourceMappingURL=WorkspaceSchedulationView-4dfa3eaf.js.map
