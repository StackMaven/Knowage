{"version":3,"file":"NewsManagement-315cc9b2.js","sources":["../../../../modules/managers/newsManagement/NewsManagement.vue"],"sourcesContent":["<template>\r\n    <div class=\"kn-page\">\r\n        <div class=\"kn-page-content p-grid p-m-0\">\r\n            <div class=\"kn-list--column p-col-4 p-sm-4 p-md-3 p-p-0\">\r\n                <Toolbar class=\"kn-toolbar kn-toolbar--primary\">\r\n                    <template #start>\r\n                        {{ $t('managers.newsManagement.title') }}\r\n                    </template>\r\n                    <template #end>\r\n                        <FabButton icon=\"fas fa-plus\" @click=\"showForm\" data-test=\"open-form-button\" />\r\n                    </template>\r\n                </Toolbar>\r\n                <ProgressBar mode=\"indeterminate\" class=\"kn-progress-bar\" v-if=\"loading\" data-test=\"progress-bar\" />\r\n                <Listbox\r\n                    v-if=\"!loading\"\r\n                    class=\"kn-list--column\"\r\n                    :options=\"newsList\"\r\n                    listStyle=\"max-height:calc(100% - 62px)\"\r\n                    :filter=\"true\"\r\n                    :filterPlaceholder=\"$t('common.search')\"\r\n                    optionLabel=\"name\"\r\n                    filterMatchMode=\"contains\"\r\n                    :filterFields=\"newsManagementDescriptor.filterFields\"\r\n                    :emptyFilterMessage=\"$t('managers.newsManagement.noResults')\"\r\n                    @change=\"showForm\"\r\n                    data-test=\"news-list\"\r\n                >\r\n                    <template #empty>{{ $t('common.info.noDataFound') }}</template>\r\n                    <template #option=\"slotProps\">\r\n                        <div class=\"kn-list-item\" data-test=\"list-item\">\r\n                            <Avatar :icon=\"newsManagementDescriptor.iconTypesMap[slotProps.option.type].className\" shape=\"circle\" size=\"medium\" />\r\n                            <div class=\"kn-list-item-text\">\r\n                                <span>{{ slotProps.option.title }}</span>\r\n                                <span class=\"kn-list-item-text-secondary\">{{ slotProps.option.description }}</span>\r\n                            </div>\r\n                            <Button icon=\"far fa-trash-alt\" class=\"p-button-link p-button-sm\" @click.stop=\"deleteNewsConfirm(slotProps.option)\" data-test=\"delete-button\" />\r\n                        </div>\r\n                    </template>\r\n                </Listbox>\r\n            </div>\r\n\r\n            <div class=\"p-col-8 p-sm-8 p-md-9 p-p-0 p-m-0\">\r\n                <router-view @touched=\"touched = true\" @closed=\"touched = false\" @inserted=\"pageReload\" />\r\n            </div>\r\n        </div>\r\n    </div>\r\n</template>\r\n\r\n<script lang=\"ts\">\r\nimport { defineComponent } from 'vue'\r\nimport { iNews } from './NewsManagement'\r\nimport Avatar from 'primevue/avatar'\r\nimport { AxiosResponse } from 'axios'\r\nimport FabButton from '@/components/UI/KnFabButton.vue'\r\nimport Listbox from 'primevue/listbox'\r\nimport newsManagementDescriptor from './NewsManagementDescriptor.json'\r\nimport WEB_SOCKET from '@/services/webSocket.js'\r\nimport mainStore from '../../../App.store'\r\n\r\nexport default defineComponent({\r\n    name: 'news-management',\r\n    components: {\r\n        Avatar,\r\n        FabButton,\r\n        Listbox\r\n    },\r\n    data() {\r\n        return {\r\n            newsManagementDescriptor,\r\n            newsList: [] as iNews[],\r\n            touched: false,\r\n            loading: false\r\n        }\r\n    },\r\n    setup() {\r\n        const store = mainStore()\r\n        return { store }\r\n    },\r\n    async created() {\r\n        await this.loadAllNews()\r\n    },\r\n    methods: {\r\n        async loadAllNews() {\r\n            this.loading = true\r\n            this.newsList = []\r\n            await this.$http\r\n                .get(import.meta.env.VITE_RESTFUL_SERVICES_PATH + '2.0/news')\r\n                .then((response: AxiosResponse<any>) => {\r\n                    response.data.map((news: iNews) => {\r\n                        this.newsList.push({ ...news, newsType: this.setNewsType(news.type) })\r\n                    })\r\n                })\r\n                .finally(() => (this.loading = false))\r\n        },\r\n        showForm(event: any) {\r\n            const path = event.value ? `/news-management/${event.value.id}` : '/news-management/new-news'\r\n            if (!this.touched) {\r\n                this.$router.push(path)\r\n            } else {\r\n                this.$confirm.require({\r\n                    message: this.$t('common.toast.unsavedChangesMessage'),\r\n                    header: this.$t('common.toast.unsavedChangesHeader'),\r\n                    icon: 'pi pi-exclamation-triangle',\r\n                    accept: () => {\r\n                        this.touched = false\r\n                        this.$router.push(path)\r\n                    }\r\n                })\r\n            }\r\n        },\r\n        deleteNewsConfirm(news) {\r\n            this.$confirm.require({\r\n                message: this.$t('common.toast.deleteMessage'),\r\n                header: this.$t('common.toast.deleteTitle'),\r\n                icon: 'pi pi-exclamation-triangle',\r\n                accept: () => {\r\n                    this.touched = false\r\n                    this.onDeleteNewsConfirm(news)\r\n                }\r\n            })\r\n        },\r\n        async onDeleteNewsConfirm(news) {\r\n            const response = await this.deleteNews(news)\r\n            if (response) this.deleteNewsWebSocket(news)\r\n        },\r\n        async deleteNews(news) {\r\n            let responseOk = false\r\n            await this.$http.delete(import.meta.env.VITE_RESTFUL_SERVICES_PATH + '2.0/news/' + news.id).then(() => {\r\n                this.store.setInfo({\r\n                    title: this.$t('common.toast.deleteTitle'),\r\n                    msg: this.$t('common.toast.deleteSuccess')\r\n                })\r\n                responseOk = true\r\n                this.$router.push('/news-management')\r\n                this.loadAllNews()\r\n            })\r\n            return responseOk\r\n        },\r\n        deleteNewsWebSocket(news) {\r\n            WEB_SOCKET.send(JSON.stringify(news))\r\n        },\r\n        pageReload() {\r\n            this.touched = false\r\n            this.loadAllNews()\r\n        },\r\n        setNewsType(type: number) {\r\n            switch (type) {\r\n                case 1:\r\n                    return 'News'\r\n                case 2:\r\n                    return 'Notification'\r\n                case 3:\r\n                    return 'Warning'\r\n            }\r\n        }\r\n    }\r\n})\r\n</script>\r\n"],"names":["Avatar","FabButton","Listbox","mainStore","_openBlock","_createElementBlock","_createElementVNode","_createVNode","_withCtx","_createBlock","_createCommentVNode","_toDisplayString"],"mappings":"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"}