import{d as V,i as R,s as L,_ as B,r as s,o as c,h as C,w as i,f as r,a,t as l,c as y,A as x,D as T,l as j,n as X,g as A,a5 as K,C as F,B as I,G as U,a4 as H,V as Q,z as N,Y as ne,W as Qe,q as Ke,y as ee,a6 as Ge,a7 as Ae,X as Je,v as pe,u as be,ai as Ye,ad as le,a9 as He,aK as We,p as Ze,b as eo,ae as oo,a8 as to,aj as ao,k as ro,E as no}from"./index-1e676509.js";import{K as ae,u as G,c as re}from"./KnValidatonMessages-ebe48c72.js";import{s as se}from"./checkbox.esm-fa6c8259.js";import{s as ve}from"./inputswitch.esm-80317a38.js";import{f as Y}from"./filterHelper-a723991a.js";import{s as io}from"./contextmenu.esm-4301c9fe.js";import{s as we,a as ye}from"./accordiontab.esm-2c1b3232.js";import{s as Ve}from"./multiselect.esm-ce4000f7.js";import{s as lo}from"./textarea.esm-32051d54.js";import{K as so}from"./KnCalculatedField-ab0b2f81.js";import{s as Be}from"./chip.esm-057ba1f1.js";import{K as co}from"./KnHint-6d455703.js";import{s as po}from"./menu.esm-6bee86d0.js";import{s as bo}from"./radiobutton.esm-c3e6fa9b.js";const ko={style:{height:"100vh",width:"100vw"}},uo={style:{height:"100%",width:"100%"}};var mo={dialog:ko,iframe:uo};const go={businessModel:[{fieldName:"name",validators:[{key:"required"},{key:"regex",validator:{type:"extendedAlphanumericRegex"}}]},{fieldName:"description",validators:[{key:"regex",validator:{type:"extendedAlphanumericRegex"}}]},{fieldName:"category",validators:[{key:"required"}]},{fieldName:"dataSourceLabel",validators:[{key:"required"}]},{fieldName:"tablePrefixLike",validators:[{key:"regex",validator:{type:"extendedAlphanumericRegex"}}]},{fieldName:"tablePrefixNotLike",validators:[{key:"regex",validator:{type:"extendedAlphanumericRegex"}}]}]};var $e={validations:go};const fo={style:{width:"60vw"}};var ho={dialog:fo};const vo=V({name:"generate-datamart-card",components:{Checkbox:se,Dialog:R,InputSwitch:ve},props:{businessModel:{type:Object,required:!0},user:{type:Object,required:!0}},emits:["generated","close"],watch:{businessModel(){this.loadBusinessModel()}},setup(){return{store:L()}},async created(){this.loadBusinessModel(),this.loadUser(),await this.loadModelInfo()},data(){return{generateDatamartCardDescriptor:ho,showAdvancedOptions:!1,model:{},currentUser:{},modelName:"",schemaName:"",catalogName:"",isGeneratedForRegistry:!1,includeSources:!1}},methods:{loadBusinessModel(){this.model=this.businessModel,this.modelName=this.businessModel.name},loadUser(){this.currentUser=this.user},async loadModelInfo(){await this.$http.get(`/knowagemeta/restful-services/1.0/metaWeb/modelInfos/${this.businessModel.id}?user_id=${this.user.userUniqueIdentifier}`).then(e=>{e.data.schemaName&&(this.schemaName=e.data.schemaName),e.data.catalogName&&(this.catalogName=e.data.catalogName)})},generateDatamart(){const e=`/knowagemeta/restful-services/1.0/metaWeb/buildModel/${this.businessModel.id}?user_id=${this.user.userId}&model=${encodeURIComponent(this.modelName)}&schema=${this.schemaName}&catalog=${this.catalogName}&registry=${this.isGeneratedForRegistry}&includeSources=${this.includeSources}`;this.$http.get(e).then(()=>{this.store.setInfo({title:this.$t("common.toast.createTitle"),msg:this.$t("common.toast.success")}),this.$emit("generated")})},closeTemplate(){this.$emit("close")}}}),wo={class:"p-m-5"},yo={for:"advanced-options",class:"kn-material-input-label"},xo={key:0,class:"p-fluid p-m-2"},Mo={class:"p-field"},Co={class:"p-float-label"},Ao={for:"modelName",class:"kn-material-input-label"},$o={class:"p-field"},Do={class:"p-float-label"},Eo={for:"schemaName",class:"kn-material-input-label"},To={class:"p-field"},zo={class:"p-float-label"},Vo={for:"catalogName",class:"kn-material-input-label"},Bo={class:"p-d-flex p-mt-4"},So={class:"p-field-checkbox p-mr-3"},Io={class:"p-field-checkbox"};function No(e,o,t,n,d,h){const k=s("InputSwitch"),m=s("InputText"),f=s("Checkbox"),p=s("Button"),b=s("Dialog");return c(),C(b,{style:T(e.generateDatamartCardDescriptor.dialog.style),visible:!0,modal:!0,class:"p-fluid kn-dialog--toolbar--primary",header:e.$t("managers.businessModelManager.generateDatamart"),closable:!1,"aria-label":"Generate Datamart Options"},{footer:i(()=>[r(p,{class:"kn-button kn-button--secondary",label:e.$t("common.close"),onClick:e.closeTemplate},null,8,["label","onClick"]),r(p,{class:"kn-button kn-button--primary",label:e.$t("common.save"),onClick:e.generateDatamart},null,8,["label","onClick"])]),default:i(()=>[a("p",null,l(e.$t("managers.businessModelManager.generateDatamartHint")),1),a("div",wo,[r(k,{id:"advanced-options",class:"p-mr-2",modelValue:e.showAdvancedOptions,"onUpdate:modelValue":o[0]||(o[0]=g=>e.showAdvancedOptions=g)},null,8,["modelValue"]),a("label",yo,l(e.$t("managers.businessModelManager.showAdvancedOptions")),1)]),e.showAdvancedOptions?(c(),y("form",xo,[a("div",Mo,[a("span",Co,[r(m,{id:"modelName",class:"kn-material-input",type:"text",modelValue:e.modelName,"onUpdate:modelValue":o[1]||(o[1]=g=>e.modelName=g),modelModifiers:{trim:!0}},null,8,["modelValue"]),a("label",Ao,l(e.$t("managers.businessModelManager.modelName")),1)])]),a("div",$o,[a("span",Do,[r(m,{id:"schemaName",class:"kn-material-input",type:"text",modelValue:e.schemaName,"onUpdate:modelValue":o[2]||(o[2]=g=>e.schemaName=g),modelModifiers:{trim:!0}},null,8,["modelValue"]),a("label",Eo,l(e.$t("managers.businessModelManager.schemaName")),1)])]),a("div",To,[a("span",zo,[r(m,{id:"catalogName",class:"kn-material-input",type:"text",modelValue:e.catalogName,"onUpdate:modelValue":o[3]||(o[3]=g=>e.catalogName=g),modelModifiers:{trim:!0}},null,8,["modelValue"]),a("label",Vo,l(e.$t("managers.businessModelManager.catalogName")),1)])]),a("div",Bo,[a("span",So,[r(f,{modelValue:e.isGeneratedForRegistry,"onUpdate:modelValue":o[4]||(o[4]=g=>e.isGeneratedForRegistry=g),binary:!0,"aria-label":"Generate for Registry"},null,8,["modelValue"]),a("label",null,l(e.$t("managers.businessModelManager.forRegistry")),1)]),a("span",Io,[r(f,{modelValue:e.includeSources,"onUpdate:modelValue":o[5]||(o[5]=g=>e.includeSources=g),binary:!0,"aria-label":"Include Sources"},null,8,["modelValue"]),a("label",null,l(e.$t("managers.businessModelManager.includeSources")),1)])])])):x("",!0)]),_:1},8,["style","header"])}var Uo=B(vo,[["render",No]]);const _o={style:{display:"flex",flex:1,"flex-direction":"column"}},Oo=["value"];var Fo={dialog:_o,globalFilterFields:Oo};const Ro=V({name:"metaweb-select-dialog",components:{Checkbox:se,Column:j,DataTable:X,Dialog:R},props:{visible:{type:Boolean},selectedBusinessModel:{type:Object}},emits:["close","metaSelected"],data(){return{metawebSelectDialogDescriptor:Fo,businessModel:null,datasourceStructure:null,rows:[],selected:{},allPhysicalSelected:!1,allBusinessSelected:!1,filters:{global:[Y]},filteredRows:[],loading:!1}},watch:{async businessModel(){await this.loadData()},async visible(e){e&&(this.loading=!0,await this.loadDatasourceStructure(),this.loadRows(),this.loading=!1)}},setup(){return{store:L()}},async created(){await this.loadData()},methods:{async loadData(){this.loading=!0,this.loadBusinessModel(),await this.loadDatasourceStructure(),this.loadRows(),this.loading=!1},loadBusinessModel(){this.businessModel=this.selectedBusinessModel},async loadDatasourceStructure(){var e;if((e=this.businessModel)!=null&&e.dataSourceId){let o=`2.0/datasources/structure/${this.businessModel.dataSourceId}?`;const t={};this.businessModel.tablePrefixLike&&(t.tablePrefixLike=this.businessModel.tablePrefixLike),this.businessModel.tablePrefixNotLike&&(t.tablePrefixNotLike=this.businessModel.tablePrefixNotLike),await this.$http.get("/knowage/restful-services/"+o,{params:t}).then(n=>this.datasourceStructure=n.data)}},loadRows(){this.rows=[],this.datasourceStructure&&Object.keys(this.datasourceStructure).forEach(e=>{this.rows.push({value:e}),this.selected[e]={physical:!1,business:!1}})},setChecked(e,o){o==="business"&&this.selected[e.value].business?this.selected[e.value].physical=!0:o==="physical"&&!this.selected[e.value].physical&&(this.selected[e.value].business=!1)},setAllChecked(e){Object.keys(this.selected).forEach(o=>{this.checkIfTheSelectedIsInFilteredRows(o)&&(e==="business"?(this.selected[o].business=this.allBusinessSelected,this.allBusinessSelected&&(this.selected[o].physical=!0,this.allPhysicalSelected=!0)):(this.selected[o].physical=this.allPhysicalSelected,this.allPhysicalSelected||(this.selected[o].business=!1,this.allBusinessSelected=!1)))})},checkIfTheSelectedIsInFilteredRows(e){return this.filteredRows.findIndex(t=>t.value===e)!==-1},closeDialog(){this.$emit("close"),this.filters.global.value="",this.selected={},this.allPhysicalSelected=!1,this.allBusinessSelected=!1},async onContinue(){if(!this.checkIfPhysicalModelIsSelected()){this.store.setError({title:this.$t("common.error.generic"),msg:this.$t("metaweb.selectDialog.noPhysicalModelsSelectedError")});return}await this.sendCheckedMetaweb()},async sendCheckedMetaweb(){var t,n;this.loading=!0;const e=[],o=[];this.prepareDataForPost(e,o),await this.$http.post("/knowagemeta/restful-services/1.0/metaWeb/create",{datasourceId:""+((t=this.businessModel)==null?void 0:t.dataSourceId),physicalModels:e,businessModels:o,modelName:(n=this.businessModel)==null?void 0:n.name}).then(d=>{this.$emit("metaSelected",d.data)}).catch(()=>{}),this.loading=!1},prepareDataForPost(e,o){Object.keys(this.selected).forEach(t=>{this.selected[t].physical&&e.push(t),this.selected[t].business&&o.push(t)})},checkIfPhysicalModelIsSelected(){let e=!1;const o=Object.keys(this.selected);for(let t=0;t<o.length;t++)if(this.selected[o[t]].physical){e=!0;break}return e},onRowsFiltered(e){this.filteredRows=e.filteredValue,this.allPhysicalSelected=!0,this.allBusinessSelected=!0,this.filteredRows.length===0&&(this.allPhysicalSelected=!1,this.allBusinessSelected=!1);for(let o=0;o<this.filteredRows.length;o++)this.selected[this.filteredRows[o].value].physical||(this.allPhysicalSelected=!1),this.selected[this.filteredRows[o].value].business||(this.allBusinessSelected=!1)}}}),Lo={class:"table-header p-d-flex"},Po={class:"p-input-icon-left p-mr-3 p-col-12"},qo=a("i",{class:"pi pi-search"},null,-1);function jo(e,o,t,n,d,h){const k=s("Button"),m=s("Toolbar"),f=s("ProgressBar"),p=s("InputText"),b=s("Column"),g=s("Checkbox"),M=s("DataTable"),u=s("Dialog");return c(),C(u,{id:"metaweb-select-dialog",class:"metaweb-dialog remove-padding p-fluid kn-dialog--toolbar--primary",contentStyle:e.metawebSelectDialogDescriptor.dialog.style,visible:e.visible,modal:!1,closable:!1,position:"right",baseZIndex:1,autoZIndex:!0},{header:i(()=>[r(m,{class:"kn-toolbar kn-toolbar--primary p-p-0 p-m-0 p-col-12"},{start:i(()=>{var v;return[A(l((v=e.businessModel)==null?void 0:v.name),1)]}),end:i(()=>[r(k,{class:"metaweb-select-dialog-button kn-button p-button-text p-m-2",label:e.$t("common.close"),onClick:e.closeDialog},null,8,["label","onClick"]),r(k,{class:"metaweb-select-dialog-button kn-button p-button-text",label:e.$t("common.continue"),onClick:e.onContinue},null,8,["label","onClick"])]),_:1})]),default:i(()=>[e.loading?(c(),C(f,{key:0,mode:"indeterminate",class:"kn-progress-bar"})):(c(),C(M,{key:1,value:e.rows,class:"p-datatable-sm kn-table p-ml-1",scrollable:!0,scrollHeight:"100%",filters:e.filters,"onUpdate:filters":o[5]||(o[5]=v=>e.filters=v),globalFilterFields:e.metawebSelectDialogDescriptor.globalFilterFields,onFilter:e.onRowsFiltered},{empty:i(()=>[A(l(e.$t("common.info.noDataFound")),1)]),header:i(()=>[a("div",Lo,[a("span",Po,[qo,r(p,{class:"kn-material-input",modelValue:e.filters.global.value,"onUpdate:modelValue":o[0]||(o[0]=v=>e.filters.global.value=v),placeholder:e.$t("common.search")},null,8,["modelValue","placeholder"])])])]),default:i(()=>[r(b,{field:"value",header:e.$t("metaweb.selectDialog.tableName"),style:{flex:"5"}},null,8,["header"]),r(b,{header:e.$t("metaweb.physicalModel.title")},{header:i(()=>[r(g,{class:"p-mr-2",modelValue:e.allPhysicalSelected,"onUpdate:modelValue":o[1]||(o[1]=v=>e.allPhysicalSelected=v),binary:!0,onChange:o[2]||(o[2]=v=>e.setAllChecked("physical"))},null,8,["modelValue"])]),body:i(v=>[r(g,{modelValue:e.selected[v.data.value].physical,"onUpdate:modelValue":E=>e.selected[v.data.value].physical=E,binary:!0,onChange:E=>e.setChecked(v.data,"physical")},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1},8,["header"]),r(b,{header:e.$t("metaweb.businessModel.title")},{header:i(()=>[r(g,{class:"p-mr-2",modelValue:e.allBusinessSelected,"onUpdate:modelValue":o[3]||(o[3]=v=>e.allBusinessSelected=v),binary:!0,onChange:o[4]||(o[4]=v=>e.setAllChecked("business"))},null,8,["modelValue"])]),body:i(v=>[r(g,{modelValue:e.selected[v.data.value].business,"onUpdate:modelValue":E=>e.selected[v.data.value].business=E,binary:!0,onChange:E=>e.setChecked(v.data,"business")},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1},8,["header"])]),_:1},8,["value","filters","globalFilterFields","onFilter"]))]),_:1},8,["contentStyle","visible"])}var Xo=B(Ro,[["render",jo]]);const Qo={absoluteScroll:{height:"100%",left:0,"overflow-x":"hidden","overflow-y":"auto",position:"absolute",top:0,width:"100%"},chip:{"font-size":"0.8rem"},columnMain:{flex:"10"},columnTrash:{flex:"1"},flex:{display:"flex",flex:1,"flex-direction":"column"},flex3:{flex:3}},Ko=[{comment:"",dataType:"VARCHAR",decimalDigits:0,defaultValue:null,description:null,id:null,markedDeleted:!1,name:"category_id",nullable:!1,octectLength:30,partOfCompositePrimaryKey:!1,position:1,primaryKey:!0,properties:[{"structural.deleted":{propertyType:{admissibleValues:[],defaultValue:"false",description:"Specify if this column was deleted after a db update",id:"structural.deleted",name:"Deleted"},value:"false"}}],radix:10,size:30,tableName:"category",typeName:"VARCHAR",uniqueName:null},{comment:"",dataType:"VARCHAR",decimalDigits:0,defaultValue:null,description:null,id:null,markedDeleted:!1,name:"category_id",nullable:!1,octectLength:30,partOfCompositePrimaryKey:!1,position:1,primaryKey:!0,properties:[{"structural.deleted":{propertyType:{admissibleValues:[],defaultValue:"false",description:"Specify if this column was deleted after a db update",id:"structural.deleted",name:"Deleted"},value:"false"}}],radix:10,size:30,tableName:"category",typeName:"VARCHAR",uniqueName:null},{comment:"",dataType:"VARCHAR",decimalDigits:0,defaultValue:null,description:null,id:null,markedDeleted:!1,name:"category_id",nullable:!1,octectLength:30,partOfCompositePrimaryKey:!1,position:1,primaryKey:!0,properties:[{"structural.deleted":{propertyType:{admissibleValues:[],defaultValue:"false",description:"Specify if this column was deleted after a db update",id:"structural.deleted",name:"Deleted"},value:"false"}}],radix:10,size:30,tableName:"category",typeName:"VARCHAR",uniqueName:null},{comment:"",dataType:"VARCHAR",decimalDigits:0,defaultValue:null,description:null,id:null,markedDeleted:!1,name:"category_id",nullable:!1,octectLength:30,partOfCompositePrimaryKey:!1,position:1,primaryKey:!0,properties:[{"structural.deleted":{propertyType:{admissibleValues:[],defaultValue:"false",description:"Specify if this column was deleted after a db update",id:"structural.deleted",name:"Deleted"},value:"false"}}],radix:10,size:30,tableName:"category",typeName:"VARCHAR",uniqueName:null},{comment:"",dataType:"VARCHAR",decimalDigits:0,defaultValue:null,description:null,id:null,markedDeleted:!1,name:"category_parent",nullable:!0,octectLength:30,partOfCompositePrimaryKey:!1,position:2,primaryKey:!1,properties:[{"structural.deleted":{propertyType:{admissibleValues:[],defaultValue:"false",description:"Specify if this column was deleted after a db update",id:"structural.deleted",name:"Deleted"},value:"false"}}],radix:10,size:30,tableName:"category",typeName:"VARCHAR",uniqueName:null},{comment:"",dataType:"VARCHAR",decimalDigits:0,defaultValue:null,description:null,id:null,markedDeleted:!1,name:"category_description",nullable:!1,octectLength:30,partOfCompositePrimaryKey:!1,position:3,primaryKey:!1,properties:[{"structural.deleted":{propertyType:{admissibleValues:[],defaultValue:"false",description:"Specify if this column was deleted after a db update",id:"structural.deleted",name:"Deleted"},value:"false"}}],radix:10,size:30,tableName:"category",typeName:"VARCHAR",uniqueName:null},{comment:"",dataType:"VARCHAR",decimalDigits:0,defaultValue:null,description:null,id:null,markedDeleted:!1,name:"category_rollup",nullable:!0,octectLength:30,partOfCompositePrimaryKey:!1,position:4,primaryKey:!1,properties:[{"structural.deleted":{propertyType:{admissibleValues:[],defaultValue:"false",description:"Specify if this column was deleted after a db update",id:"structural.deleted",name:"Deleted"},value:"false"}}],radix:10,size:30,tableName:"category",typeName:"VARCHAR",uniqueName:null}];var Se={style:Qo,test:Ko};const Go=["name"],Jo={absolute:{position:"absolute"},bsDialog:{height:"80%","max-height":"80%","min-width":"80%"},globalFilterFields:["name"],mainList:{height:"100%"},summaryItemFirst:{"flex-basis":"50%","flex-grow":1,"flex-shrink":1},summaryItemMiddle:{"flex-basis":"10%","flex-grow":1,"flex-shrink":1},summaryItemSecond:{"flex-basis":"50%","flex-grow":1,"flex-shrink":1,"text-align":"end"},summaryItemWidth:{width:"50%"},tableCell:{"flex-basis":"100%"}},Yo={tmpBnssView:[{fieldName:"name",validators:[{key:"required",validator:{type:"bv-dialog-required"}}]}],tmpBusinessModel:[{fieldName:"name",validators:[{key:"required",validator:{type:"bm-dialog-required"}}]}]};var J={filterFields:Go,style:Jo,validations:Yo};const Ho=[{label:"common.name",name:"name"},{label:"common.description",name:"description"}];var Wo={businessModelInfo:Ho};const Zo=V({name:"metaweb-business-property-list-tab",components:{Accordion:we,AccordionTab:ye,Dropdown:K,MultiSelect:Ve},props:{selectedBusinessModel:{type:Object},roles:{type:Array},propMeta:{type:Object}},emits:["metaUpdated"],data(){return{metawebBusinessPropertyListTabDescriptor:Wo,meta:null,businessModel:null,categories:[],roleOptions:[]}},computed:{profileAttributes(){return this.store.$state.user.attributes?Object.keys(this.store.$state.user.attributes):[]}},watch:{selectedBusinessModel(){this.loadMeta(),this.loadBusinessModel()},roles(){this.loadRoleOptions()}},setup(){return{store:L()}},created(){this.loadMeta(),this.loadBusinessModel()},methods:{loadMeta(){this.meta=this.propMeta},loadBusinessModel(){this.businessModel=this.selectedBusinessModel,this.loadCategories()},loadRoleOptions(){this.roleOptions=this.roles},loadCategories(){var e;if(this.categories={},this.businessModel)for(let o=0;o<this.businessModel.properties.length;o++){const t=(e=this.businessModel)==null?void 0:e.properties[o],n=Object.keys(t)[0],d=n==null?void 0:n.split(".");this.categories[d[0]]||(this.categories[d[0]]=[]),this.categories[d[0]].push({...t[n],type:n})}},updateCategoryValue(e){var o,t;(t=(o=this.businessModel)==null?void 0:o.properties)==null||t.forEach(n=>{const d=Object.keys(n)[0];d===e.type&&(n[d].value=e.value)}),this.$emit("metaUpdated")}}}),et={class:"p-grid"},ot={class:"p-field"},tt=["for"],at={key:0,class:"p-col-6"},rt={class:"p-field"},nt={class:"kn-material-input-label"},it={class:"p-grid"},lt={key:0,class:"p-fluid"},st={class:"p-field"},dt={class:"kn-material-input-label"},ct={key:1,class:"p-fluid"},pt={class:"p-field"},bt={class:"kn-material-input-label"},kt={key:2,class:"p-fluid"},ut={class:"p-field"},mt={class:"kn-material-input-label"},gt={key:3,class:"p-fluid"},ft={class:"p-field"},ht={class:"kn-material-input-label"},vt={key:4,class:"p-fluid"},wt={class:"p-field"},yt={class:"kn-material-input-label"};function xt(e,o,t,n,d,h){const k=s("InputText"),m=s("AccordionTab"),f=s("Dropdown"),p=s("MultiSelect"),b=s("Accordion");return e.businessModel?(c(),C(b,{key:0,multiple:!0,activeIndex:[0,1]},{default:i(()=>[r(m,null,{header:i(()=>[a("span",null,l(e.$t("metaweb.physicalModel.misc")),1)]),default:i(()=>[a("div",et,[(c(!0),y(I,null,F(e.metawebBusinessPropertyListTabDescriptor.businessModelInfo,(g,M)=>(c(),y("div",{class:"p-col-6",key:M},[a("div",ot,[a("label",{for:g.name,class:"kn-material-input-label"},l(e.$t(g.label)),9,tt),r(k,{class:"kn-material-input",modelValue:e.businessModel[g.name],"onUpdate:modelValue":u=>e.businessModel[g.name]=u,id:g.name,"data-test":"input-name"},null,8,["modelValue","onUpdate:modelValue","id"])])]))),128)),e.businessModel.physicalTable&&e.meta?(c(),y("div",at,[a("div",rt,[a("label",nt,l(e.$t("metaweb.businessModel.physicalTable")),1),r(k,{class:"kn-material-input",modelValue:e.meta.physicalModels[e.businessModel.physicalTable.physicalTableIndex].name,"onUpdate:modelValue":o[0]||(o[0]=g=>e.meta.physicalModels[e.businessModel.physicalTable.physicalTableIndex].name=g),disabled:!0},null,8,["modelValue"])])])):x("",!0)])]),_:1}),(c(!0),y(I,null,F(Object.keys(e.categories),(g,M)=>(c(),C(m,{key:M},{header:i(()=>[a("span",null,l(g),1)]),default:i(()=>[a("div",it,[(c(!0),y(I,null,F(e.categories[g],(u,v)=>(c(),y("div",{class:"p-col-6",key:v},[u.propertyType.admissibleValues.length!==0?(c(),y("div",lt,[a("div",st,[a("label",dt,l(u.propertyType.name),1),r(f,{class:"kn-material-input",modelValue:u.value,"onUpdate:modelValue":E=>u.value=E,options:u.propertyType.admissibleValues,onChange:E=>e.updateCategoryValue(u)},null,8,["modelValue","onUpdate:modelValue","options","onChange"])])])):x("",!0),u.propertyType.admissibleValues.length===0&&u.type!=="structural.attribute"&&u.type!=="structural.sqlFilter"&&u.type!=="behavioural.notEnabledRoles"?(c(),y("div",ct,[a("div",pt,[a("label",bt,l(u.propertyType.name),1),r(k,{class:"kn-material-input",modelValue:u.value,"onUpdate:modelValue":E=>u.value=E,disabled:u.type==="physical.physicaltable",onChange:E=>e.updateCategoryValue(u)},null,8,["modelValue","onUpdate:modelValue","disabled","onChange"])])])):x("",!0),u.type==="structural.attribute"?(c(),y("div",kt,[a("div",ut,[a("label",mt,l(u.propertyType.name),1),r(f,{class:"kn-material-input",modelValue:u.value,"onUpdate:modelValue":E=>u.value=E,options:e.profileAttributes,onChange:E=>e.updateCategoryValue(u)},null,8,["modelValue","onUpdate:modelValue","options","onChange"])])])):x("",!0),u.type==="behavioural.notEnabledRoles"?(c(),y("div",gt,[a("div",ft,[a("label",ht,l(u.propertyType.name),1),r(p,{class:"kn-material-input",modelValue:u.value,"onUpdate:modelValue":E=>u.value=E,options:e.roleOptions,onChange:E=>e.updateCategoryValue(u)},null,8,["modelValue","onUpdate:modelValue","options","onChange"])])])):x("",!0),e.businessModel.physicalColumn&&g==="physical"?(c(),y("div",vt,[a("div",wt,[a("label",yt,l(e.$t("metaweb.businessModel.physicalColumn")),1),r(k,{class:"kn-material-input",modelValue:e.businessModel.physicalColumn.name,"onUpdate:modelValue":o[1]||(o[1]=E=>e.businessModel.physicalColumn.name=E),disabled:!0},null,8,["modelValue"])])])):x("",!0)]))),128))])]),_:2},1024))),128))]),_:1})):x("",!0)}var Mt=B(Zo,[["render",xt]]);/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */var Ct=globalThis&&globalThis.__extends||function(){var e=function(o,t){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,d){n.__proto__=d}||function(n,d){for(var h in d)d.hasOwnProperty(h)&&(n[h]=d[h])},e(o,t)};return function(o,t){e(o,t);function n(){this.constructor=o}o.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),At=Object.prototype.hasOwnProperty;function ue(e,o){return At.call(e,o)}function me(e){if(Array.isArray(e)){for(var o=new Array(e.length),t=0;t<o.length;t++)o[t]=""+t;return o}if(Object.keys)return Object.keys(e);var n=[];for(var d in e)ue(e,d)&&n.push(d);return n}function q(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function ge(e){for(var o=0,t=e.length,n;o<t;){if(n=e.charCodeAt(o),n>=48&&n<=57){o++;continue}return!1}return!0}function W(e){return e.indexOf("/")===-1&&e.indexOf("~")===-1?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function Ie(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function fe(e){if(e===void 0)return!0;if(e){if(Array.isArray(e)){for(var o=0,t=e.length;o<t;o++)if(fe(e[o]))return!0}else if(typeof e=="object"){for(var n=me(e),d=n.length,h=0;h<d;h++)if(fe(e[n[h]]))return!0}}return!1}function De(e,o){var t=[e];for(var n in o){var d=typeof o[n]=="object"?JSON.stringify(o[n],null,2):o[n];typeof d!="undefined"&&t.push(n+": "+d)}return t.join(`
`)}var Ne=function(e){Ct(o,e);function o(t,n,d,h,k){var m=this.constructor,f=e.call(this,De(t,{name:n,index:d,operation:h,tree:k}))||this;return f.name=n,f.index=d,f.operation=h,f.tree=k,Object.setPrototypeOf(f,m.prototype),f.message=De(t,{name:n,index:d,operation:h,tree:k}),f}return o}(Error),S=Ne,$t=q,te={add:function(e,o,t){return e[o]=this.value,{newDocument:t}},remove:function(e,o,t){var n=e[o];return delete e[o],{newDocument:t,removed:n}},replace:function(e,o,t){var n=e[o];return e[o]=this.value,{newDocument:t,removed:n}},move:function(e,o,t){var n=de(t,this.path);n&&(n=q(n));var d=Z(t,{op:"remove",path:this.from}).removed;return Z(t,{op:"add",path:this.path,value:d}),{newDocument:t,removed:n}},copy:function(e,o,t){var n=de(t,this.from);return Z(t,{op:"add",path:this.path,value:q(n)}),{newDocument:t}},test:function(e,o,t){return{newDocument:t,test:ie(e[o],this.value)}},_get:function(e,o,t){return this.value=e[o],{newDocument:t}}},Dt={add:function(e,o,t){return ge(o)?e.splice(o,0,this.value):e[o]=this.value,{newDocument:t,index:o}},remove:function(e,o,t){var n=e.splice(o,1);return{newDocument:t,removed:n[0]}},replace:function(e,o,t){var n=e[o];return e[o]=this.value,{newDocument:t,removed:n}},move:te.move,copy:te.copy,test:te.test,_get:te._get};function de(e,o){if(o=="")return e;var t={op:"_get",path:o};return Z(e,t),t.value}function Z(e,o,t,n,d,h){if(t===void 0&&(t=!1),n===void 0&&(n=!0),d===void 0&&(d=!0),h===void 0&&(h=0),t&&(typeof t=="function"?t(o,0,e,o.path):ce(o,0)),o.path===""){var k={newDocument:e};if(o.op==="add")return k.newDocument=o.value,k;if(o.op==="replace")return k.newDocument=o.value,k.removed=e,k;if(o.op==="move"||o.op==="copy")return k.newDocument=de(e,o.from),o.op==="move"&&(k.removed=e),k;if(o.op==="test"){if(k.test=ie(e,o.value),k.test===!1)throw new S("Test operation failed","TEST_OPERATION_FAILED",h,o,e);return k.newDocument=e,k}else{if(o.op==="remove")return k.removed=e,k.newDocument=null,k;if(o.op==="_get")return o.value=e,k;if(t)throw new S("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",h,o,e);return k}}else{n||(e=q(e));var m=o.path||"",f=m.split("/"),p=e,b=1,g=f.length,M=void 0,u=void 0,v=void 0;for(typeof t=="function"?v=t:v=ce;;){if(u=f[b],u&&u.indexOf("~")!=-1&&(u=Ie(u)),d&&(u=="__proto__"||u=="prototype"&&b>0&&f[b-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(t&&M===void 0&&(p[u]===void 0?M=f.slice(0,b).join("/"):b==g-1&&(M=o.path),M!==void 0&&v(o,0,e,M)),b++,Array.isArray(p)){if(u==="-")u=p.length;else{if(t&&!ge(u))throw new S("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",h,o,e);ge(u)&&(u=~~u)}if(b>=g){if(t&&o.op==="add"&&u>p.length)throw new S("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",h,o,e);var k=Dt[o.op].call(o,p,u,e);if(k.test===!1)throw new S("Test operation failed","TEST_OPERATION_FAILED",h,o,e);return k}}else if(b>=g){var k=te[o.op].call(o,p,u,e);if(k.test===!1)throw new S("Test operation failed","TEST_OPERATION_FAILED",h,o,e);return k}if(p=p[u],t&&b<g&&(!p||typeof p!="object"))throw new S("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",h,o,e)}}}function _(e,o,t,n,d){if(n===void 0&&(n=!0),d===void 0&&(d=!0),t&&!Array.isArray(o))throw new S("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");n||(e=q(e));for(var h=new Array(o.length),k=0,m=o.length;k<m;k++)h[k]=Z(e,o[k],t,!0,d,k),e=h[k].newDocument;return h.newDocument=e,h}function Et(e,o,t){var n=Z(e,o);if(n.test===!1)throw new S("Test operation failed","TEST_OPERATION_FAILED",t,o,e);return n.newDocument}function ce(e,o,t,n){if(typeof e!="object"||e===null||Array.isArray(e))throw new S("Operation is not an object","OPERATION_NOT_AN_OBJECT",o,e,t);if(te[e.op]){if(typeof e.path!="string")throw new S("Operation `path` property is not a string","OPERATION_PATH_INVALID",o,e,t);if(e.path.indexOf("/")!==0&&e.path.length>0)throw new S('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",o,e,t);if((e.op==="move"||e.op==="copy")&&typeof e.from!="string")throw new S("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",o,e,t);if((e.op==="add"||e.op==="replace"||e.op==="test")&&e.value===void 0)throw new S("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",o,e,t);if((e.op==="add"||e.op==="replace"||e.op==="test")&&fe(e.value))throw new S("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",o,e,t);if(t){if(e.op=="add"){var d=e.path.split("/").length,h=n.split("/").length;if(d!==h+1&&d!==h)throw new S("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",o,e,t)}else if(e.op==="replace"||e.op==="remove"||e.op==="_get"){if(e.path!==n)throw new S("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",o,e,t)}else if(e.op==="move"||e.op==="copy"){var k={op:"_get",path:e.from,value:void 0},m=Ue([k],t);if(m&&m.name==="OPERATION_PATH_UNRESOLVABLE")throw new S("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",o,e,t)}}}else throw new S("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",o,e,t)}function Ue(e,o,t){try{if(!Array.isArray(e))throw new S("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(o)_(q(o),q(e),t||!0);else{t=t||ce;for(var n=0;n<e.length;n++)t(e[n],n,o,void 0)}}catch(d){if(d instanceof S)return d;throw d}}function ie(e,o){if(e===o)return!0;if(e&&o&&typeof e=="object"&&typeof o=="object"){var t=Array.isArray(e),n=Array.isArray(o),d,h,k;if(t&&n){if(h=e.length,h!=o.length)return!1;for(d=h;d--!==0;)if(!ie(e[d],o[d]))return!1;return!0}if(t!=n)return!1;var m=Object.keys(e);if(h=m.length,h!==Object.keys(o).length)return!1;for(d=h;d--!==0;)if(!o.hasOwnProperty(m[d]))return!1;for(d=h;d--!==0;)if(k=m[d],!ie(e[k],o[k]))return!1;return!0}return e!==e&&o!==o}var Tt=Object.freeze(Object.defineProperty({__proto__:null,JsonPatchError:S,deepClone:$t,getValueByPointer:de,applyOperation:Z,applyPatch:_,applyReducer:Et,validator:ce,validate:Ue,_areEquals:ie},Symbol.toStringTag,{value:"Module"}));/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2021 Joachim Wester
 * MIT license
 */var xe=new WeakMap,zt=function(){function e(o){this.observers=new Map,this.obj=o}return e}(),Vt=function(){function e(o,t){this.callback=o,this.observer=t}return e}();function Bt(e){return xe.get(e)}function St(e,o){return e.observers.get(o)}function It(e,o){e.observers.delete(o.callback)}function Nt(e,o){o.unobserve()}function he(e,o){var t=[],n,d=Bt(e);if(!d)d=new zt(e),xe.set(e,d);else{var h=St(d,o);n=h&&h.observer}if(n)return n;if(n={},d.value=q(e),o){n.callback=o,n.next=null;var k=function(){z(n)},m=function(){clearTimeout(n.next),n.next=setTimeout(k)};typeof window!="undefined"&&(window.addEventListener("mouseup",m),window.addEventListener("keyup",m),window.addEventListener("mousedown",m),window.addEventListener("keydown",m),window.addEventListener("change",m))}return n.patches=t,n.object=e,n.unobserve=function(){z(n),clearTimeout(n.next),It(d,n),typeof window!="undefined"&&(window.removeEventListener("mouseup",m),window.removeEventListener("keyup",m),window.removeEventListener("mousedown",m),window.removeEventListener("keydown",m),window.removeEventListener("change",m))},d.observers.set(o,new Vt(o,n)),n}function z(e,o){o===void 0&&(o=!1);var t=xe.get(e.object);Me(t.value,e.object,e.patches,"",o),e.patches.length&&_(t.value,e.patches);var n=e.patches;return n.length>0&&(e.patches=[],e.callback&&e.callback(n)),n}function Me(e,o,t,n,d){if(o!==e){typeof o.toJSON=="function"&&(o=o.toJSON());for(var h=me(o),k=me(e),m=!1,f=k.length-1;f>=0;f--){var p=k[f],b=e[p];if(ue(o,p)&&!(o[p]===void 0&&b!==void 0&&Array.isArray(o)===!1)){var g=o[p];typeof b=="object"&&b!=null&&typeof g=="object"&&g!=null&&Array.isArray(b)===Array.isArray(g)?Me(b,g,t,n+"/"+W(p),d):b!==g&&(d&&t.push({op:"test",path:n+"/"+W(p),value:q(b)}),t.push({op:"replace",path:n+"/"+W(p),value:q(g)}))}else Array.isArray(e)===Array.isArray(o)?(d&&t.push({op:"test",path:n+"/"+W(p),value:q(b)}),t.push({op:"remove",path:n+"/"+W(p)}),m=!0):(d&&t.push({op:"test",path:n,value:e}),t.push({op:"replace",path:n,value:o}))}if(!(!m&&h.length==k.length))for(var f=0;f<h.length;f++){var p=h[f];!ue(e,p)&&o[p]!==void 0&&t.push({op:"add",path:n+"/"+W(p),value:q(o[p])})}}}function Ut(e,o,t){t===void 0&&(t=!1);var n=[];return Me(e,o,n,"",t),n}var _t=Object.freeze(Object.defineProperty({__proto__:null,unobserve:Nt,observe:he,generate:z,compare:Ut},Symbol.toStringTag,{value:"Module"}));Object.assign({},Tt,_t,{JsonPatchError:Ne,deepClone:q,escapePathComponent:W,unescapePathComponent:Ie});const Ot=V({name:"document-drivers",components:{Dialog:R,Dropdown:K,DataTable:X,Column:j,KnValidationMessages:ae},emits:["closeDialog"],props:{physicalModels:Array,showBusinessClassDialog:Boolean,meta:Object,observer:{type:Object}},computed:{buttonDisabled(){return!!(this.v$.$invalid||this.tmpBusinessModel.selectedColumns.length===0)}},data(){return{bsDescriptor:J,v$:G(),metaObserve:{},tmpBusinessModel:{physicalModel:null,selectedColumns:[],name:"",description:""},filters:{global:[Y]}}},created(){this.loadMeta()},watch:{meta(){this.loadMeta()}},validations(){const o={"bm-dialog-required":n=>!this.showBusinessClassDialog||n};return{tmpBusinessModel:re("tmpBusinessModel",J.validations.tmpBusinessModel,o)}},methods:{async loadMeta(){this.meta&&(this.metaObserve=this.meta)},resetPhModel(){this.tmpBusinessModel.selectedColumns=[]},closeDialog(){this.$emit("closeDialog"),this.tmpBusinessModel={physicalModel:{columns:[]},selectedColumns:[],name:"",description:""}},async saveBusinessClass(){let e={selectedColumns:[]};e.name=this.tmpBusinessModel.name,e.description=this.tmpBusinessModel.description,e.physicalModel=this.tmpBusinessModel.physicalModel.name,this.tmpBusinessModel.selectedColumns.forEach(t=>{e.selectedColumns.push(t.name)});const o={data:e,diff:z(this.observer)};await this.$http.post("/knowagemeta/restful-services/1.0/metaWeb/addBusinessClass",o).then(async t=>{this.metaObserve=_(this.metaObserve,t.data),z(this.observer),this.closeDialog()}).catch(()=>{})}}}),Ft={ref:"bcForm",class:"p-fluid p-formgrid p-grid p-mt-4 p-mx-2 kn-flex-0"},Rt={class:"p-field p-col-12 p-md-6"},Lt={class:"p-float-label"},Pt={for:"name",class:"kn-material-input-label"},qt={class:"p-field p-col-12 p-md-6"},jt={class:"p-float-label"},Xt={for:"desc",class:"kn-material-input-label"},Qt={class:"p-field p-col-12"},Kt={class:"p-float-label"},Gt={for:"driver",class:"kn-material-input-label"},Jt={class:"kn-relative kn-flex"},Yt={class:"kn-height-full kn-width-full kn-absolute"},Ht={class:"table-header p-d-flex"},Wt={class:"p-input-icon-left p-mr-3 p-col-12"},Zt=a("i",{class:"pi pi-search"},null,-1);function ea(e,o,t,n,d,h){const k=s("Toolbar"),m=s("InputText"),f=s("KnValidationMessages"),p=s("Dropdown"),b=s("Column"),g=s("DataTable"),M=s("Button"),u=s("Dialog");return c(),C(u,{class:"bsdialog",style:T(e.bsDescriptor.style.bsDialog),visible:e.showBusinessClassDialog,modal:!0,closable:!1},{header:i(()=>[r(k,{class:"kn-toolbar kn-toolbar--primary kn-width-full"},{start:i(()=>[A(l(e.$t("metaweb.businessModel.newBusiness")),1)]),_:1})]),footer:i(()=>[r(M,{class:"p-button-text kn-button",label:e.$t("common.cancel"),onClick:e.closeDialog},null,8,["label","onClick"]),r(M,{class:"kn-button kn-button--primary",label:e.$t("common.save"),disabled:e.buttonDisabled,onClick:e.saveBusinessClass},null,8,["label","disabled","onClick"])]),default:i(()=>[a("form",Ft,[a("div",Rt,[a("span",Lt,[r(m,{id:"name",class:U(["kn-material-input",{"p-invalid":e.v$.tmpBusinessModel.name.$invalid&&e.v$.tmpBusinessModel.name.$dirty}]),modelValue:e.v$.tmpBusinessModel.name.$model,"onUpdate:modelValue":o[0]||(o[0]=v=>e.v$.tmpBusinessModel.name.$model=v),modelModifiers:{trim:!0},onBlur:o[1]||(o[1]=v=>e.v$.tmpBusinessModel.name.$touch()),onChange:o[2]||(o[2]=v=>e.$emit("touched"))},null,8,["modelValue","class"]),a("label",Pt,l(e.$t("common.name"))+" *",1)]),r(f,{class:"p-mt-1",vComp:e.v$.tmpBusinessModel.name,additionalTranslateParams:{fieldName:e.$t("common.name")}},null,8,["vComp","additionalTranslateParams"])]),a("div",qt,[a("span",jt,[r(m,{id:"desc",class:"kn-material-input",modelValue:e.tmpBusinessModel.description,"onUpdate:modelValue":o[3]||(o[3]=v=>e.tmpBusinessModel.description=v)},null,8,["modelValue"]),a("label",Xt,l(e.$t("common.description")),1)])]),a("div",Qt,[a("span",Kt,[r(p,{id:"driver",class:"kn-material-input",modelValue:e.tmpBusinessModel.physicalModel,"onUpdate:modelValue":o[4]||(o[4]=v=>e.tmpBusinessModel.physicalModel=v),filter:!0,options:e.physicalModels,optionLabel:"name"},null,8,["modelValue","options"]),a("label",Gt,l(e.$t("metaweb.businessModel.physTable")),1)])])],512),a("div",Jt,[a("div",Yt,[e.tmpBusinessModel.physicalModel?(c(),C(g,{key:0,value:e.tmpBusinessModel.physicalModel.columns,class:"p-datatable-sm kn-table p-ml-2",selection:e.tmpBusinessModel.selectedColumns,"onUpdate:selection":o[6]||(o[6]=v=>e.tmpBusinessModel.selectedColumns=v),scrollable:!0,scrollHeight:e.bsDescriptor.style.mainList,dataKey:"position",filters:e.filters,"onUpdate:filters":o[7]||(o[7]=v=>e.filters=v),globalFilterFields:e.bsDescriptor.globalFilterFields},{empty:i(()=>[A(l(e.$t("common.info.noDataFound")),1)]),header:i(()=>[a("div",Ht,[a("span",Wt,[Zt,r(m,{class:"kn-material-input",modelValue:e.filters.global.value,"onUpdate:modelValue":o[5]||(o[5]=v=>e.filters.global.value=v),placeholder:e.$t("common.search")},null,8,["modelValue","placeholder"])])])]),default:i(()=>[r(b,{selectionMode:"multiple"}),r(b,{field:"name",header:e.$t("common.name"),style:T(e.bsDescriptor.style.tableCell)},null,8,["header","style"])]),_:1},8,["value","selection","scrollHeight","filters","globalFilterFields"])):x("",!0)])])]),_:1},8,["style","visible"])}var oa=B(Ot,[["render",ea]]);const ta=V({components:{DataTable:X,Column:j,KnValidationMessages:ae},props:{physicalModels:Array,showBusinessViewDialog:Boolean,bnssViewObject:Object},data(){return{bsDescriptor:J,v$:G(),tmpBnssView:{},filters:{global:[Y]}}},created(){this.tmpBnssView=this.bnssViewObject},watch:{bnssViewObject(){this.tmpBnssView=this.bnssViewObject}},validations(){const o={"bv-dialog-required":n=>!this.showBusinessViewDialog||n};return{tmpBnssView:re("tmpBnssView",J.validations.tmpBnssView,o)}}}),aa={ref:"bcForm",class:"p-fluid p-formgrid p-grid p-mt-4 p-mx-2 kn-flex-0"},ra={class:"p-field p-col-12 p-md-6"},na={class:"p-float-label"},ia={for:"name",class:"kn-material-input-label"},la={class:"p-field p-col-12 p-md-6"},sa={class:"p-float-label"},da={for:"desc",class:"kn-material-input-label"},ca={class:"kn-relative kn-flex"},pa={class:"table-header p-d-flex"},ba={class:"p-input-icon-left p-mr-3 p-col-12"},ka=a("i",{class:"pi pi-search"},null,-1);function ua(e,o,t,n,d,h){const k=s("InputText"),m=s("KnValidationMessages"),f=s("Column"),p=s("DataTable");return c(),y(I,null,[a("form",aa,[a("div",ra,[a("span",na,[r(k,{id:"name",class:U(["kn-material-input",{"p-invalid":e.v$.tmpBnssView.name.$invalid&&e.v$.tmpBnssView.name.$dirty}]),modelValue:e.v$.tmpBnssView.name.$model,"onUpdate:modelValue":o[0]||(o[0]=b=>e.v$.tmpBnssView.name.$model=b),modelModifiers:{trim:!0},onBlur:o[1]||(o[1]=b=>e.v$.tmpBnssView.name.$touch()),onChange:o[2]||(o[2]=b=>e.$emit("touched"))},null,8,["modelValue","class"]),a("label",ia,l(e.$t("common.name"))+" *",1)]),r(m,{class:"p-mt-1",vComp:e.v$.tmpBnssView.name,additionalTranslateParams:{fieldName:e.$t("common.name")}},null,8,["vComp","additionalTranslateParams"])]),a("div",la,[a("span",sa,[r(k,{id:"desc",class:"kn-material-input",modelValue:e.tmpBnssView.description,"onUpdate:modelValue":o[3]||(o[3]=b=>e.tmpBnssView.description=b)},null,8,["modelValue"]),a("label",da,l(e.$t("common.description")),1)])])],512),a("div",ca,[a("div",{class:"kn-height-full kn-width-full",style:T(e.bsDescriptor.style.absolute)},[r(p,{class:"p-datatable-sm kn-table p-ml-2",value:e.physicalModels,selection:e.tmpBnssView.physicalModels,"onUpdate:selection":o[5]||(o[5]=b=>e.tmpBnssView.physicalModels=b),scrollable:!0,scrollHeight:"100%",filters:e.filters,"onUpdate:filters":o[6]||(o[6]=b=>e.filters=b),globalFilterFields:e.bsDescriptor.globalFilterFields},{empty:i(()=>[A(l(e.$t("metaweb.businessModel.")),1)]),header:i(()=>[a("div",pa,[a("span",ba,[ka,r(k,{class:"kn-material-input",modelValue:e.filters.global.value,"onUpdate:modelValue":o[4]||(o[4]=b=>e.filters.global.value=b),placeholder:e.$t("common.search")},null,8,["modelValue","placeholder"])])])]),default:i(()=>[r(f,{selectionMode:"multiple"}),r(f,{field:"name",header:e.$t("common.name"),style:{"flex-basis":"100%"}},null,8,["header"])]),_:1},8,["value","selection","filters","globalFilterFields"])],4)])],64)}var ma=B(ta,[["render",ua]]);const ga=V({components:{Listbox:H},props:{sourceArray:{type:Array,required:!0},targetArray:{type:Array,required:!0},useMultipleTablesFromSameSource:Boolean},emits:["dropEnd","relationshipDeleted"],data(){return{bussinessModelDescriptor:J,sourceModel:[],targetModel:[],associatedItem:"",expandSummary:!0}},created(){this.setAssociatedItem(),this.targetModel=this.targetArray,this.sourceModel=this.sourceArray},watch:{targetArray(){this.targetModel=this.targetArray},sourceArray(){this.sourceModel=this.sourceArray}},methods:{setAssociatedItem(){this.associatedItem||(this.associatedItem="links")},onDragStart(e,o){e.dataTransfer.setData("text",o.split("-")[1]),e.dataTransfer.dropEffect="move",e.dataTransfer.effectAllowed="move",this.$refs[`${o}`].classList.add("associator-dragging")},removeDragClass(e){this.$refs[`${e}`].classList.remove("associator-dragging")},setDropzoneClass(e,o){e?this.$refs[`${o}`].classList.add("associator-hover"):this.$refs[`${o}`].classList.remove("associator-hover")},setDropErrorClass(e){this.$refs[`${e}`].classList.add("associator-drop-error"),setTimeout(()=>{this.$refs[`${e}`].classList.remove("associator-drop-error")},500)},beforeDrop(e,o){if(o.links){for(var t=0;t<o.links.length;t++)if(e.tableName===o.links[t].tableName)return!1}return!0},onDrop(e,o,t){e.preventDefault(),e.stopPropagation(),this.$refs[`${o}`].classList.remove("associator-hover");var n=e.dataTransfer.getData("text"),d=!0;this.useMultipleTablesFromSameSource&&(d=this.beforeDrop(this.sourceModel[n],t)),d!=!1?(t[this.associatedItem]==null&&(t[this.associatedItem]=[]),t[this.associatedItem].indexOf(this.sourceModel[n])!=-1?this.setDropErrorClass(o):(t[this.associatedItem].push(this.sourceModel[n]),this.$emit("dropEnd",e,this.sourceModel[n],t))):this.setDropErrorClass(o)},deleteRelationship(e,o){o==null?e[this.associatedItem]=[]:e[this.associatedItem].splice(o,1),this.$emit("relationshipDeleted")}}}),fa={id:"associator-container",class:"p-grid p-m-2"},ha={id:"source-list-container",class:"p-col p-d-flex p-flex-column kn-flex"},va={class:"kn-relative kn-flex"},wa=["id","onDragstart","onDragend"],ya=a("i",{class:"pi pi-bars"},null,-1),xa={class:"kn-list-item-text"},Ma={id:"target-list-container",class:"p-col p-d-flex p-flex-column kn-flex"},Ca={class:"kn-relative kn-flex"},Aa=["id","onDrop","onDragenter","onDragleave"],$a={class:"associator-block-hover p-d-flex p-flex-row p-ai-center kn-width-full"},Da={class:"kn-truncated kn-flex-05"},Ea={key:0,class:"fas fa-link kn-flex-05"},Ta={class:"kn-truncated"};function za(e,o,t,n,d,h){const k=s("Toolbar"),m=s("Listbox"),f=s("Button");return c(),y("div",fa,[a("div",ha,[r(k,{class:"kn-toolbar kn-toolbar--secondary"},{start:i(()=>[A(l(e.$t("metaweb.businessModel.sourceAttr")),1)]),_:1}),a("div",va,[r(m,{class:"associator-list kn-list data-condition-list kn-absolute kn-height-full kn-width-full",options:e.sourceModel},{empty:i(()=>[A(l(e.$t("metaweb.businessModel.sourceHint")),1)]),option:i(p=>[a("div",{id:"source-"+p.index,ref:"source-"+p.index,class:"kn-list-item kn-draggable",draggable:"true",onDragstart:b=>e.onDragStart(b,"source-"+p.index),onDragend:b=>e.removeDragClass("source-"+p.index)},[ya,a("div",xa,[a("span",null,l(p.option.name),1)])],40,wa)]),_:1},8,["options"])])]),a("div",Ma,[r(k,{class:"kn-toolbar kn-toolbar--secondary"},{start:i(()=>[A(l(e.$t("metaweb.businessModel.targetAttr")),1)]),_:1}),a("div",Ca,[r(m,{class:"associator-list kn-list data-condition-list kn-absolute kn-height-full kn-width-full",options:e.targetModel},{empty:i(()=>[A(l(e.$t("metaweb.businessModel.targetHint")),1)]),option:i(p=>[a("div",{class:"associator-target-list-item",id:"target-"+p.index,ref:"target-"+p.index,onDrop:b=>e.onDrop(b,"target-"+p.index,p.option),onDragover:o[0]||(o[0]=Q(()=>{},["prevent"])),onDragenter:Q(b=>e.setDropzoneClass(!0,"target-"+p.index),["prevent"]),onDragleave:Q(b=>e.setDropzoneClass(!1,"target-"+p.index),["prevent"])},[a("div",$a,[a("span",Da,l(p.option.name),1),p.option[e.associatedItem]&&p.option[e.associatedItem].length>0?(c(),y("i",Ea)):x("",!0),p.option[e.associatedItem]&&p.option[e.associatedItem].length>0?(c(),y("div",{key:1,class:U(["p-d-flex p-flex-column kn-flex",{"p-mb-1":p.option[e.associatedItem].length>1}])},[(c(!0),y(I,null,F(p.option[e.associatedItem],(b,g)=>(c(),y("span",{class:"p-d-flex p-flex-row p-ai-center",key:g},[a("span",Ta,l(b.name),1),p.option[e.associatedItem].length>1?(c(),C(f,{key:0,icon:"fas fa-times",class:"associator-enable-hover p-button-text p-button-rounded p-button-plain",onClick:Q(M=>e.deleteRelationship(p.option,b),["stop"])},null,8,["onClick"])):x("",!0)]))),128))],2)):x("",!0),p.option[e.associatedItem]&&p.option[e.associatedItem].length>0?(c(),C(f,{key:2,icon:"far fa-trash-alt kn-flex-0",class:"associator-enable-hover p-button-text p-button-rounded p-button-plain",onClick:Q(b=>e.deleteRelationship(p.option),["stop"])},null,8,["onClick"])):x("",!0)])],40,Aa)]),_:1},8,["options"])])])])}var Ce=B(ga,[["render",za]]);const Va=V({components:{Dialog:R,StepOne:ma,TableAssociator:Ce,Dropdown:K,Listbox:H},emits:["closeDialog"],props:{showBusinessViewDialog:Boolean,meta:{type:Object,required:!0},observer:{type:Object},selectedBusinessModel:{type:Object,required:!0},editMode:Boolean},computed:{buttonDisabled(){return!!(this.v$.$invalid||this.tmpBnssView.physicalModels.length<2)}},data(){return{bsDescriptor:J,v$:G(),tmpBnssView:{physicalModels:[],name:"",description:""},metaObserve:{},wizardStep:1,expandSummary:!0,summary:[],sourceTable:{columns:[]},targetTable:{columns:[]},physicalModels:[]}},created(){this.loadMeta(),this.setEditModeData()},watch:{meta(){this.loadMeta(),this.setEditModeData()}},methods:{async loadMeta(){this.meta&&(this.metaObserve=this.meta),this.meta&&(this.physicalModels=JSON.parse(JSON.stringify(this.meta.physicalModels)))},closeDialog(){this.tmpBnssView=null,this.targetTable=null,this.sourceTable=null,this.$emit("closeDialog")},nextStep(){this.wizardStep++},previousStep(){this.wizardStep--},getItemIndex(e,o){for(var t=0;t<e.length;t++)if(e[t].name===o)return t;return-1},setEditModeData(){if(this.editMode==!0){this.wizardStep=2;for(var e=0;e<this.selectedBusinessModel.physicalTables.length;e++){var o={};o=JSON.parse(JSON.stringify(this.meta.physicalModels[this.selectedBusinessModel.physicalTables[e].physicalTableIndex])),this.tmpBnssView.physicalModels.push(o)}for(var t=0;t<this.tmpBnssView.physicalModels.length;t++)for(var n=0;n<this.tmpBnssView.physicalModels[t].columns.length;n++)this.tmpBnssView.physicalModels[t].columns[n].$parent=this.tmpBnssView.physicalModels[t];for(var d=0;d<this.selectedBusinessModel.joinRelationships.length;d++)for(var h=this.selectedBusinessModel.joinRelationships[d],k=this.tmpBnssView.physicalModels[this.getItemIndex(this.tmpBnssView.physicalModels,h.destinationTable.name)],m=this.tmpBnssView.physicalModels[this.getItemIndex(this.tmpBnssView.physicalModels,h.sourceTable.name)],f=0;f<h.destinationColumns.length;f++){var p=k.columns[this.getItemIndex(k.columns,h.destinationColumns[f].name)],b=m.columns[this.getItemIndex(m.columns,h.sourceColumns[f].name)];p.hasOwnProperty("links")||(p.links=[]),p.links.push(b)}this.updateSummary()}},updateSummary(){this.summary=[];for(var e=0;e<this.tmpBnssView.physicalModels.length;e++)for(var o=0;o<this.tmpBnssView.physicalModels[e].columns.length;o++)this.tmpBnssView.physicalModels[e].columns[o].hasOwnProperty("links")&&this.tmpBnssView.physicalModels[e].columns[o].links.length>0?this.summary.push(this.tmpBnssView.physicalModels[e].columns[o]):this.tmpBnssView.physicalModels[e].columns[o].hasOwnProperty("links")&&this.tmpBnssView.physicalModels[e].columns[o].links.length>0&&delete this.tmpBnssView.physicalModels[e].columns[o].links},async saveBusinessView(){var e={};this.editMode?e.viewUniqueName=this.selectedBusinessModel.uniqueName:(e.name=this.tmpBnssView.name,e.description=this.tmpBnssView.description,e.sourceBusinessClass=this.tmpBnssView.sourceBusinessClass,e.physicaltable=[]),e.relationships={};for(var o=0;o<this.tmpBnssView.physicalModels.length;o++){var t=this.tmpBnssView.physicalModels[o];this.editMode||e.physicaltable.push(t.name);for(var n=0;n<this.tmpBnssView.physicalModels[o].columns.length;n++)if(this.tmpBnssView.physicalModels[o].columns[n].hasOwnProperty("links")&&this.tmpBnssView.physicalModels[o].columns[n].links.length>0){e.relationships.hasOwnProperty(t.name)||(e.relationships[t.name]={});var d=e.relationships[t.name],h=this.tmpBnssView.physicalModels[o].columns[n];d.hasOwnProperty(h.name)||(d[h.name]={});for(var k=d[h.name],m=0;m<h.links.length;m++){k.hasOwnProperty(h.links[m].tableName)||(k[h.links[m].tableName]=[]);var f=k[h.links[m].tableName];f.push(h.links[m].name)}}}const p={data:e,diff:[]};await this.$http.post("/knowagemeta/restful-services/1.0/metaWeb/addBusinessView",p).then(async b=>{this.metaObserve=_(this.metaObserve,b.data),z(this.observer)}).catch(()=>{}).finally(()=>this.closeDialog())},deleteRelationship(e,o){o==null?e.links=[]:e.links.splice(o,1),this.updateSummary()}}}),Ba={key:1,ref:"bvForm",class:"p-fluid p-formgrid p-grid p-mt-4 p-mx-2 kn-flex-0"},Sa={class:"p-field p-col-12 p-md-6"},Ia={class:"p-float-label"},Na={for:"source",class:"kn-material-input-label"},Ua={class:"p-field p-col-12 p-md-6"},_a={class:"p-float-label"},Oa={for:"target",class:"kn-material-input-label"},Fa={key:3,id:"summary-container",class:"p-m-3 p-d-flex p-flex-column kn-flex-05"},Ra={class:"kn-relative kn-flex"},La={class:"associator-block-hover p-d-flex p-flex-row p-ai-center kn-width-full"},Pa={class:"kn-truncated kn-flex-05 p-ml-2"},qa={key:0,class:"fas fa-link kn-flex-05"},ja={class:"kn-truncated"};function Xa(e,o,t,n,d,h){const k=s("Toolbar"),m=s("StepOne"),f=s("Dropdown"),p=s("TableAssociator"),b=s("Button"),g=s("Listbox"),M=s("Dialog");return c(),C(M,{class:"bsdialog",style:T(e.bsDescriptor.style.bsDialog),visible:e.showBusinessViewDialog,modal:!0,closable:!1},{header:i(()=>[r(k,{class:"kn-toolbar kn-toolbar--primary kn-width-full"},{start:i(()=>[A(l(e.$t("metaweb.businessModel.newView")),1)]),_:1})]),footer:i(()=>[r(b,{class:"p-button-text kn-button",label:e.$t("common.cancel"),onClick:e.closeDialog},null,8,["label","onClick"]),e.wizardStep==2&&!e.editMode?(c(),C(b,{key:0,class:"kn-button kn-button--secondary",label:e.$t("common.back"),disabled:e.buttonDisabled||e.summary.length>0,onClick:e.previousStep},null,8,["label","disabled","onClick"])):x("",!0),e.wizardStep==1?(c(),C(b,{key:1,class:"kn-button kn-button--primary",label:e.$t("common.next"),disabled:e.buttonDisabled,onClick:e.nextStep},null,8,["label","disabled","onClick"])):x("",!0),e.wizardStep==2?(c(),C(b,{key:2,class:"kn-button kn-button--primary",label:e.$t("common.save"),disabled:e.buttonDisabled,onClick:e.saveBusinessView},null,8,["label","disabled","onClick"])):x("",!0)]),default:i(()=>[e.wizardStep===1?(c(),C(m,{key:0,physicalModels:e.physicalModels,showBusinessViewDialog:e.showBusinessViewDialog,bnssViewObject:e.tmpBnssView},null,8,["physicalModels","showBusinessViewDialog","bnssViewObject"])):x("",!0),e.wizardStep===2?(c(),y("form",Ba,[a("div",Sa,[a("span",Ia,[r(f,{id:"source",class:"kn-material-input",modelValue:e.sourceTable,"onUpdate:modelValue":o[0]||(o[0]=u=>e.sourceTable=u),options:e.tmpBnssView.physicalModels,optionLabel:"name"},null,8,["modelValue","options"]),a("label",Na,l(e.$t("metaweb.businessModel.sourceTable")),1)])]),a("div",Ua,[a("span",_a,[r(f,{id:"target",class:"kn-material-input",modelValue:e.targetTable,"onUpdate:modelValue":o[1]||(o[1]=u=>e.targetTable=u),options:e.tmpBnssView.physicalModels,optionLabel:"name"},null,8,["modelValue","options"]),a("label",Oa,l(e.$t("metaweb.businessModel.targetTable")),1)])])],512)):x("",!0),e.wizardStep===2?(c(),C(p,{key:2,class:"kn-flex",sourceArray:e.sourceTable.columns,targetArray:e.targetTable.columns,useMultipleTablesFromSameSource:!0,onDrop:e.updateSummary,onRelationshipDeleted:e.updateSummary},null,8,["sourceArray","targetArray","onDrop","onRelationshipDeleted"])):x("",!0),e.wizardStep===2?(c(),y("div",Fa,[r(k,{class:"kn-toolbar kn-toolbar--primary"},{start:i(()=>[A(l(e.$t("metaweb.businessModel.summary")),1)]),end:i(()=>[e.expandSummary?(c(),C(b,{key:1,icon:"fas fa-chevron-down",class:"p-button-text p-button-rounded p-button-plain",style:{color:"white"},onClick:o[3]||(o[3]=u=>e.expandSummary=!1)})):(c(),C(b,{key:0,icon:"fas fa-chevron-right",class:"p-button-text p-button-rounded p-button-plain",style:{color:"white"},onClick:o[2]||(o[2]=u=>e.expandSummary=!0)}))]),_:1}),a("div",Ra,[N(r(g,{class:"kn-list data-condition-list kn-absolute kn-height-full kn-width-full kn-overflow",options:e.summary},{empty:i(()=>[A(l(e.$t("metaweb.businessModel.summaryHint")),1)]),option:i(u=>[a("div",La,[a("span",Pa,l(u.option.name),1),u.option.links&&u.option.links.length>0?(c(),y("i",qa)):x("",!0),u.option.links&&u.option.links.length>0?(c(),y("div",{key:1,class:U(["p-d-flex p-flex-column kn-flex",{"p-mb-1":u.option.links.length>1}])},[(c(!0),y(I,null,F(u.option.links,(v,E)=>(c(),y("span",{class:"p-d-flex p-flex-row p-ai-center",key:E},[a("span",ja,l(v.name),1),u.option.links.length>1?(c(),C(b,{key:0,icon:"fas fa-times",class:"associator-enable-hover p-button-text p-button-rounded p-button-plain",onClick:Q(w=>e.deleteRelationship(u.option,v),["stop"])},null,8,["onClick"])):x("",!0)]))),128))],2)):x("",!0),u.option.links&&u.option.links.length>0?(c(),C(b,{key:2,icon:"far fa-trash-alt kn-flex-0",class:"associator-enable-hover p-button-text p-button-rounded p-button-plain",onClick:Q(v=>e.deleteRelationship(u.option),["stop"])},null,8,["onClick"])):x("",!0)])]),_:1},8,["options"]),[[ne,e.expandSummary]])])])):x("",!0)]),_:1},8,["style","visible"])}var _e=B(Va,[["render",Xa]]);const Qa=[{field:"name",header:"common.name"},{field:"identifier",header:"metaweb.businessModel.primaryKey"},{field:"visible",header:"common.visibility"},{field:"type",header:"common.type"},{field:"description",header:"common.description"},{field:"personal",header:"metaweb.businessModel.personal"},{field:"decrypt",header:"metaweb.businessModel.decrypt"},{field:"subjectId",header:"metaweb.businessModel.subjectId"}],Ka={width:"10%"},Ga={width:"3rem"},Ja=["attribute","measure"];var Ya={columns:Qa,iconColumnStyle:Ka,reorderColumnStyle:Ga,typeOptions:Ja};const Ha={style:{height:"80%","max-height":"80%","max-width":"80%","min-width":"80%"}},Wa=["attribute","measure"];var Za={dialog:Ha,typeOptions:Wa};const er=V({name:"metaweb-attribute-detail-dialog",components:{Dialog:R,Dropdown:K,MultiSelect:Ve},props:{visible:{type:Boolean},selectedAttribute:{type:Object},roles:{type:Array}},emits:["close","save"],data(){return{metawebAttributeDetailDialogDescriptor:Za,attribute:null,properties:{},roleOptions:[],columnType:"",loading:!1}},computed:{profileAttributes(){return this.store.$state.user.attributes?Object.keys(this.store.$state.user.attributes):[]}},watch:{selectedAttribute(){this.loadAttribute()},roles(){this.loadRoleOptions()},visible(){this.loadAttribute(),this.loadRoleOptions()}},setup(){return{store:L()}},created(){this.loadAttribute(),this.loadRoleOptions()},methods:{loadAttribute(){this.selectedAttribute&&(this.attribute={...this.selectedAttribute,physicalColumn:{...this.selectedAttribute.physicalColumn},properties:this.getDeepCopyProperties(this.selectedAttribute.properties)}),this.getAttributeType(),this.loadAttributeProperties()},loadRoleOptions(){this.roleOptions=this.roles},getAttributeType(){if(this.attribute)for(let e=0;e<this.attribute.properties.length;e++){const o=this.attribute.properties[e],t=Object.keys(o)[0];t==="structural.columntype"&&(this.columnType=o[t].value)}},getDeepCopyProperties(e){const o=[];return e.forEach(t=>{const n=Object.keys(t)[0],d={};d[n]={...t[n]},o.push(d)}),o},loadAttributeProperties(){var e,o,t;this.attribute&&((e=this.attribute.properties)==null||e.forEach(n=>{const d=Object.keys(n)[0];this.properties[d]=n[d]})),((o=this.properties["behavioural.notEnabledRoles"])==null?void 0:o.value)&&typeof this.properties["behavioural.notEnabledRoles"].value=="string"&&(this.properties["behavioural.notEnabledRoles"].value=(t=this.properties["behavioural.notEnabledRoles"].value)==null?void 0:t.split(";"))},onTypeChange(){if(this.attribute)for(let e=0;e<this.attribute.properties.length;e++){const o=this.attribute.properties[e],t=Object.keys(o)[0];t==="structural.columntype"&&(o[t].value=this.columnType)}},updateAttribute(e){if(this.attribute)for(let o=0;o<this.attribute.properties.length;o++){const t=this.attribute.properties[o],n=Object.keys(t)[0];if(n===e){t[n].value=this.properties[n].value;break}}},closeDialog(){this.$emit("close")},saveAttribute(){var e;if(this.attribute)for(let o=0;o<this.attribute.properties.length;o++){const t=this.attribute.properties[o],n=Object.keys(t)[0];if(n==="behavioural.notEnabledRoles"&&Array.isArray(t[n].value)){t[n].value=(e=t[n].value)==null?void 0:e.join(";");break}}this.$emit("save",this.attribute)},getFormattedDate(e,o){return Qe(e,o)}}}),or={key:1,ref:"attribute-form",class:"p-mt-4 p-mx-4 kn-flex-0"},tr={class:"p-fluid p-formgrid p-grid"},ar={class:"p-field p-col-12 p-md-12"},rr={class:"p-float-label"},nr={for:"name",class:"kn-material-input-label"},ir={class:"p-field p-col-12 p-md-12"},lr={class:"p-float-label"},sr={for:"name",class:"kn-material-input-label"},dr={class:"p-field p-col-12 p-md-12"},cr={class:"p-float-label"},pr={for:"type",class:"kn-material-input-label"},br={class:"kn-material-input-label"},kr={class:"p-fluid p-formgrid p-grid p-mt-4"},ur={class:"p-field p-col-12 p-md-6 p-mt-2"},mr={class:"p-float-label"},gr={class:"kn-material-input-label"},fr={class:"p-field p-col-12 p-md-6 p-mt-2"},hr={class:"p-float-label"},vr={class:"kn-material-input-label"},wr={class:"p-field p-col-12 p-md-6 p-mt-2"},yr={class:"p-float-label"},xr={class:"kn-material-input-label"},Mr={class:"p-field p-col-12 p-md-6 p-mt-2"},Cr={class:"p-float-label"},Ar={class:"kn-material-input-label"},$r={class:"p-field p-col-12 p-md-6 p-mt-2"},Dr={class:"p-float-label"},Er={class:"kn-material-input-label"},Tr={key:0,class:"p-field p-col-12 p-md-6 p-mt-2"},zr={class:"p-float-label"},Vr={for:"physicalColumn",class:"kn-material-input-label"},Br={class:"p-field p-col-12 p-md-6 p-mt-2"},Sr={class:"p-float-label"},Ir={class:"kn-material-input-label"},Nr={key:1,class:"p-field p-col-12 p-md-6 p-mt-2"},Ur={class:"p-float-label"},_r={class:"kn-material-input-label"},Or={key:2,class:"p-field p-col-12 p-md-6 p-mt-2"},Fr={class:"p-float-label"},Rr={class:"kn-material-input-label"},Lr={class:"p-field p-col-12 p-md-6 p-mt-2"},Pr={class:"p-float-label"},qr={class:"kn-material-input-label"};function jr(e,o,t,n,d,h){const k=s("Toolbar"),m=s("ProgressBar"),f=s("InputText"),p=s("Dropdown"),b=s("MultiSelect"),g=s("Button"),M=s("Dialog");return c(),C(M,{id:"metaweb-attribute-detail-dialog",class:"p-fluid kn-dialog--toolbar--primary",style:T(e.metawebAttributeDetailDialogDescriptor.dialog.style),visible:e.visible,modal:!0,closable:!1},{header:i(()=>[r(k,{class:"kn-toolbar kn-toolbar--primary p-p-0 p-m-2 p-col-12"},{start:i(()=>[A(l(e.$t("metaweb.businessModel.attributesDetail.title")),1)]),_:1})]),footer:i(()=>[r(g,{class:"kn-button kn-button--primary",onClick:e.closeDialog},{default:i(()=>[A(l(e.$t("common.cancel")),1)]),_:1},8,["onClick"]),r(g,{class:"kn-button kn-button--primary",onClick:e.saveAttribute},{default:i(()=>[A(l(e.$t("common.save")),1)]),_:1},8,["onClick"])]),default:i(()=>[e.loading?(c(),C(m,{key:0,mode:"indeterminate",class:"kn-progress-bar"})):x("",!0),e.attribute?(c(),y("div",or,[a("div",tr,[a("div",ar,[a("span",rr,[r(f,{id:"name",class:"kn-material-input",modelValue:e.attribute.name,"onUpdate:modelValue":o[0]||(o[0]=u=>e.attribute.name=u),modelModifiers:{trim:!0}},null,8,["modelValue"]),a("label",nr,l(e.$t("common.name")),1)])]),a("div",ir,[a("span",lr,[r(f,{id:"name",class:"kn-material-input",modelValue:e.attribute.description,"onUpdate:modelValue":o[1]||(o[1]=u=>e.attribute.description=u),modelModifiers:{trim:!0}},null,8,["modelValue"]),a("label",sr,l(e.$t("common.description")),1)])]),a("div",dr,[a("span",cr,[r(p,{class:"kn-material-input",modelValue:e.columnType,"onUpdate:modelValue":o[2]||(o[2]=u=>e.columnType=u),options:e.metawebAttributeDetailDialogDescriptor.typeOptions,onChange:o[3]||(o[3]=u=>e.onTypeChange())},null,8,["modelValue","options"]),a("label",pr,l(e.$t("common.type")),1)])])]),a("label",br,l(e.$t("metaweb.businessModel.attributesDetail.structural")),1),a("div",kr,[a("div",ur,[a("span",mr,[r(p,{class:"kn-material-input",modelValue:e.properties["structural.aggtype"].value,"onUpdate:modelValue":o[4]||(o[4]=u=>e.properties["structural.aggtype"].value=u),options:e.properties["structural.aggtype"].propertyType.admissibleValues,onChange:o[5]||(o[5]=u=>e.updateAttribute("structural.aggtyp"))},null,8,["modelValue","options"]),a("label",gr,l(e.properties["structural.aggtype"].propertyType.name),1),a("small",null,l(e.properties["structural.aggtype"].propertyType.description),1)])]),a("div",fr,[a("span",hr,[r(p,{class:"kn-material-input",modelValue:e.properties["structural.datatype"].value,"onUpdate:modelValue":o[6]||(o[6]=u=>e.properties["structural.datatype"].value=u),options:e.properties["structural.datatype"].propertyType.admissibleValues,onChange:o[7]||(o[7]=u=>e.updateAttribute("structural.datatype"))},null,8,["modelValue","options"]),a("label",vr,l(e.properties["structural.datatype"].propertyType.name),1),a("small",null,l(e.properties["structural.datatype"].propertyType.description),1)])]),a("div",wr,[a("span",yr,[r(b,{class:"kn-material-input",modelValue:e.properties["behavioural.notEnabledRoles"].value,"onUpdate:modelValue":o[8]||(o[8]=u=>e.properties["behavioural.notEnabledRoles"].value=u),options:e.roleOptions,optionLabel:"name",optionValue:"name",filter:!0,onChange:o[9]||(o[9]=u=>e.updateAttribute("behavioural.notEnabledRoles"))},null,8,["modelValue","options"]),a("label",xr,l(e.properties["behavioural.notEnabledRoles"].propertyType.name),1),a("small",null,l(e.properties["behavioural.notEnabledRoles"].propertyType.description),1)])]),a("div",Mr,[a("span",Cr,[r(p,{class:"kn-material-input",modelValue:e.properties["structural.attribute"].value,"onUpdate:modelValue":o[10]||(o[10]=u=>e.properties["structural.attribute"].value=u),options:e.profileAttributes,onChange:o[11]||(o[11]=u=>e.updateAttribute("structural.attribute"))},null,8,["modelValue","options"]),a("label",Ar,l(e.properties["structural.attribute"].propertyType.name),1),a("small",null,l(e.properties["structural.attribute"].propertyType.description),1)])]),a("div",$r,[a("span",Dr,[r(f,{class:"kn-material-input",modelValue:e.properties["physical.physicaltable"].value,"onUpdate:modelValue":o[12]||(o[12]=u=>e.properties["physical.physicaltable"].value=u),modelModifiers:{trim:!0},disabled:!0},null,8,["modelValue"]),a("label",Er,l(e.properties["physical.physicaltable"].propertyType.name),1),a("small",null,l(e.properties["physical.physicaltable"].propertyType.description),1)])]),e.attribute.physicalColumn?(c(),y("div",Tr,[a("span",zr,[r(f,{id:"physicalColumn",class:"kn-material-input",modelValue:e.attribute.physicalColumn.name,"onUpdate:modelValue":o[13]||(o[13]=u=>e.attribute.physicalColumn.name=u),modelModifiers:{trim:!0},disabled:!0},null,8,["modelValue"]),a("label",Vr,l(e.$t("metaweb.businessModel.physicalColumn")),1),a("small",null,l(e.$t("metaweb.businessModel.physicalColumnHint")),1)])])):x("",!0),a("div",Br,[a("span",Sr,[r(p,{class:"kn-material-input",modelValue:e.properties["structural.filtercondition"].value,"onUpdate:modelValue":o[14]||(o[14]=u=>e.properties["structural.filtercondition"].value=u),options:e.properties["structural.filtercondition"].propertyType.admissibleValues,onChange:o[15]||(o[15]=u=>e.updateAttribute("structural.filtercondition"))},null,8,["modelValue","options"]),a("label",Ir,l(e.properties["structural.filtercondition"].propertyType.name),1),a("small",null,l(e.properties["structural.filtercondition"].propertyType.description),1)])]),e.properties["structural.datatype"].value==="DATE"||e.properties["structural.datatype"].value==="TIMESTAMP"||e.properties["structural.datatype"].value==="TIME"?(c(),y("div",Nr,[a("span",Ur,[r(p,{class:"kn-material-input",modelValue:e.properties["structural.dateformat"].value,"onUpdate:modelValue":o[16]||(o[16]=u=>e.properties["structural.dateformat"].value=u),options:e.properties["structural.dateformat"].propertyType.admissibleValues,onChange:o[17]||(o[17]=u=>e.updateAttribute("structural.dateformat"))},{option:i(u=>[a("span",null,l(e.getFormattedDate(new Date,u.option)),1)]),value:i(u=>[a("span",null,l(e.getFormattedDate(new Date,u.value)),1)]),_:1},8,["modelValue","options"]),a("label",_r,l(e.properties["structural.dateformat"].propertyType.name),1),a("small",null,l(e.properties["structural.datatype"].value==="TIME"?e.properties["structural.format"].propertyType.description:e.properties["structural.dateformat"].propertyType.description),1)])])):x("",!0),["INTEGER","DOUBLE","DECIMAL","BIGINT","FLOAT"].indexOf(e.properties["structural.datatype"].value)!==-1?(c(),y("div",Or,[a("span",Fr,[r(p,{class:"kn-material-input",modelValue:e.properties["structural.format"].value,"onUpdate:modelValue":o[18]||(o[18]=u=>e.properties["structural.format"].value=u),options:e.properties["structural.format"].propertyType.admissibleValues,onChange:o[19]||(o[19]=u=>e.updateAttribute("structural.format"))},null,8,["modelValue","options"]),a("label",Rr,l(e.properties["structural.format"].propertyType.name),1),a("small",null,l(e.properties["structural.format"].propertyType.description),1)])])):x("",!0),a("div",Lr,[a("span",Pr,[r(f,{class:"kn-material-input",modelValue:e.properties["structural.customFunction"].value,"onUpdate:modelValue":o[20]||(o[20]=u=>e.properties["structural.customFunction"].value=u),modelModifiers:{trim:!0},onChange:o[21]||(o[21]=u=>e.updateAttribute("structural.customFunction"))},null,8,["modelValue"]),a("label",qr,l(e.properties["structural.customFunction"].propertyType.name),1),a("small",null,l(e.properties["structural.customFunction"].propertyType.description),1)])])])],512)):x("",!0)]),_:1},8,["style","visible"])}var Xr=B(er,[["render",jr]]);const Qr={style:{height:"60%","max-height":"60%","max-width":"40%","min-width":"40%"}},Kr={message:{"align-items":"center",display:"flex","justify-content":"center","text-align":"center"}};var Gr={dialog:Qr,styles:Kr};const Jr=V({name:"metaweb-attribute-detail-dialog",components:{Checkbox:se,Dialog:R,Listbox:H,Message:Ke},props:{visible:{type:Boolean},unusedFields:{type:Object}},emits:["close","save"],data(){return{metawebAttributeUnusedFieldDialogDescriptor:Gr,fields:[],selectedUnusedFields:[],loading:!1}},watch:{unusedFields(){this.loadFields()}},created(){this.loadFields()},methods:{loadFields(){this.fields=this.unusedFields},closeDialog(){this.$emit("close"),this.selectedUnusedFields=[]},save(){this.$emit("save",this.selectedUnusedFields)}}}),Yr={class:"p-m-2"};function Hr(e,o,t,n,d,h){const k=s("Toolbar"),m=s("ProgressBar"),f=s("Message"),p=s("Checkbox"),b=s("Listbox"),g=s("Button"),M=s("Dialog");return c(),C(M,{id:"metaweb-attribute-unused-field-dialog",class:"p-fluid kn-dialog--toolbar--primary",style:T(e.metawebAttributeUnusedFieldDialogDescriptor.dialog.style),visible:e.visible,modal:!0,closable:!1},{header:i(()=>[r(k,{class:"kn-toolbar kn-toolbar--primary p-p-0 p-m-2 p-col-12"},{start:i(()=>[A(l(e.$t("metaweb.businessModel.addUnusedFields")),1)]),_:1})]),footer:i(()=>[r(g,{class:"kn-button kn-button--primary",onClick:e.closeDialog},{default:i(()=>[A(l(e.$t("common.cancel")),1)]),_:1},8,["onClick"]),r(g,{class:"kn-button kn-button--primary",onClick:e.save},{default:i(()=>[A(l(e.$t("common.save")),1)]),_:1},8,["onClick"])]),default:i(()=>[e.loading?(c(),C(m,{key:0,mode:"indeterminate",class:"kn-progress-bar"})):x("",!0),e.fields.length===0?(c(),C(f,{key:1,class:"p-m-4",severity:"info",closable:!1,style:T(e.metawebAttributeUnusedFieldDialogDescriptor.styles.message)},{default:i(()=>[A(l(e.$t("metaweb.businessModel.noUnusedFields")),1)]),_:1},8,["style"])):(c(),C(b,{key:2,class:"metaweb-unused-fields-listbox p-m-4",options:e.fields},{option:i(u=>[a("div",Yr,[r(p,{class:"p-mr-2",modelValue:e.selectedUnusedFields,"onUpdate:modelValue":o[0]||(o[0]=v=>e.selectedUnusedFields=v),value:u.option},null,8,["modelValue","value"]),a("span",null,l(u.option.name),1)])]),_:1},8,["options"]))]),_:1},8,["style","visible"])}var Wr=B(Jr,[["render",Hr]]);const Zr=V({name:"metaweb-attributes-tab",components:{Checkbox:se,Column:j,DataTable:X,Dropdown:K,MetawebAttributeDetailDialog:Xr,MetawebAttributeUnusedFieldDialog:Wr},props:{selectedBusinessModel:{type:Object},propMeta:{type:Object},observer:{type:Object},roles:{type:Array}},emits:["loading","metaUpdated"],data(){return{metawebAttributesTabDescriptor:Ya,meta:null,businessModel:null,columnsVisibility:{},columnsType:{},columnsPersonal:{},columnsDecrypt:{},columnsSubjectId:{},attributeDetailDialogVisible:!1,selectedAttribute:null,unusedFieldDialogVisible:!1,unusedFields:[],metaObserver:null,propertyKeys:[],loading:!1}},watch:{selectedBusinessModel(){this.loadMeta(),this.loadBusinessModel()}},setup(){return{store:L()}},created(){this.loadMeta(),this.loadBusinessModel()},methods:{loadMeta(){this.meta=this.propMeta},loadBusinessModel(){this.businessModel=this.selectedBusinessModel,this.formatBusinessModel()},formatBusinessModel(){var e;this.businessModel&&((e=this.businessModel.columns)==null||e.forEach(o=>{for(let t=0;t<o.properties.length;t++){const n=o.properties[t],d=Object.keys(n)[0];this.propertyKeys.includes(d)||this.propertyKeys.push(d),d==="structural.visible"?this.columnsVisibility[o.uniqueName]=n[d].value==="true":d==="structural.columntype"?this.columnsType[o.uniqueName]=n[d].value:d==="structural.personal"?this.columnsPersonal[o.uniqueName]=n[d].value==="true":d==="structural.decrypt"?this.columnsDecrypt[o.uniqueName]=n[d].value==="true":d==="structural.subjectId"&&(this.columnsSubjectId[o.uniqueName]=n[d].value==="true")}}))},async onRowReorder(e){var t;this.loading=!0;const o={data:{businessModelUniqueName:(t=this.businessModel)==null?void 0:t.uniqueName,index:e.dragIndex,direction:e.dropIndex-e.dragIndex},diff:z(this.observer)};await this.$http.post("/knowagemeta/restful-services/1.0/metaWeb/moveBusinessColumn",o).then(n=>{this.meta=_(this.meta,n.data).newDocument}).catch(()=>{}).finally(()=>z(this.observer)),this.loading=!1},onChange(e,o){for(let t=0;t<e.properties.length;t++){const n=e.properties[t],d=Object.keys(n)[0];d==="structural.visible"&&o==="visibility"?n[d].value=this.columnsVisibility[e.uniqueName]:d==="structural.columntype"&&o==="type"?n[d].value=this.columnsType[e.uniqueName]:d==="structural.personal"&&o==="personal"?n[d].value=this.columnsPersonal[e.uniqueName]:d==="structural.decrypt"&&o==="decrypt"?n[d].value=this.columnsDecrypt[e.uniqueName]:d==="structural.subjectId"&&o==="subjectId"&&(n[d].value=this.columnsSubjectId[e.uniqueName])}this.$emit("metaUpdated")},openAttributeDialog(e){this.selectedAttribute=e,this.attributeDetailDialogVisible=!0},onAttributeSave(e){if(this.selectedAttribute=e,this.businessModel){const o=this.businessModel.columns.findIndex(t=>{var n;return t.uniqueName===((n=this.selectedAttribute)==null?void 0:n.uniqueName)});o!==-1&&(this.businessModel.columns[o]=this.selectedAttribute)}this.formatBusinessModel(),this.$emit("metaUpdated"),this.attributeDetailDialogVisible=!1},deleteBusinessColumnConfirm(e){this.$confirm.require({message:this.$t("documentExecution.dossier.deleteConfirm"),header:this.$t("documentExecution.dossier.deleteTitle"),icon:"pi pi-exclamation-triangle",accept:async()=>await this.deleteBusinessColumn(e)})},async deleteBusinessColumn(e){var t;this.loading=!0;const o={data:{businessColumnUniqueName:e.uniqueName,businessModelUniqueName:(t=this.businessModel)==null?void 0:t.uniqueName},diff:z(this.observer)};await this.$http.post("/knowagemeta/restful-services/1.0/metaWeb/deleteBusinessColumn",o).then(n=>{this.meta=_(this.meta,n.data).newDocument,this.store.setInfo({title:this.$t("common.toast.deleteTitle"),msg:this.$t("common.toast.deleteSuccess")}),z(this.observer)}).catch(()=>{}),this.loading=!1},openUnusedFieldsDialog(){var e,o;if(this.businessModel&&this.businessModel.physicalTable){this.unusedFields=[];const n=[...((o=this.meta)==null?void 0:o.physicalModels[(e=this.businessModel)==null?void 0:e.physicalTable.physicalTableIndex]).columns];for(let d=0;d<n.length;d++){const h=n[d];h.markedDeleted||this.businessModel.columns.findIndex(m=>m.uniqueName===h.name)===-1&&this.unusedFields.push(h)}}this.unusedFieldDialogVisible=!0},async saveUnusedFields(e){this.loading=!0;const t={data:{columns:e.map(n=>{var d;return{businessModelUniqueName:(d=this.businessModel)==null?void 0:d.uniqueName,physicalColumnName:n.name,physicalTableName:n.tableName}})},diff:z(this.observer)};await this.$http.post("/knowagemeta/restful-services/1.0/metaWeb/createBusinessColumn",t).then(n=>{this.meta=_(this.meta,n.data).newDocument,this.unusedFieldDialogVisible=!1}).catch(()=>{}).finally(()=>z(this.observer)),this.loading=!1}}}),en={class:"p-d-flex p-flex-row"},on={key:7},tn={class:"p-d-flex p-flex-row p-jc-end"};function an(e,o,t,n,d,h){const k=s("Column"),m=s("Checkbox"),f=s("Dropdown"),p=s("InputText"),b=s("Button"),g=s("DataTable"),M=s("MetawebAttributeDetailDialog"),u=s("MetawebAttributeUnusedFieldDialog");return c(),y("div",null,[e.businessModel?(c(),C(g,{key:0,class:"p-datatable-sm kn-table p-m-2",value:e.businessModel.columns,loading:e.loading,responsiveLayout:"stack",breakpoint:"960px",onRowReorder:e.onRowReorder},{default:i(()=>[r(k,{rowReorder:!0,headerStyle:e.metawebAttributesTabDescriptor.reorderColumnStyle,reorderableColumn:!1},null,8,["headerStyle"]),(c(!0),y(I,null,F(e.metawebAttributesTabDescriptor.columns,(v,E)=>(c(),C(k,{class:"kn-truncated",key:E,field:v.field,header:e.$t(v.header)},{body:i(w=>[a("div",en,[v.field==="identifier"?(c(),C(m,{key:0,modelValue:w.data[w.column.props.field],"onUpdate:modelValue":$=>w.data[w.column.props.field]=$,binary:!0,onChange:o[0]||(o[0]=$=>e.$emit("metaUpdated"))},null,8,["modelValue","onUpdate:modelValue"])):v.field==="visible"?(c(),C(m,{key:1,modelValue:e.columnsVisibility[w.data.uniqueName],"onUpdate:modelValue":$=>e.columnsVisibility[w.data.uniqueName]=$,binary:!0,onChange:$=>e.onChange(w.data,"visibility")},null,8,["modelValue","onUpdate:modelValue","onChange"])):v.field==="personal"?(c(),C(m,{key:2,modelValue:e.columnsPersonal[w.data.uniqueName],"onUpdate:modelValue":$=>e.columnsPersonal[w.data.uniqueName]=$,binary:!0,onChange:$=>e.onChange(w.data,"personal")},null,8,["modelValue","onUpdate:modelValue","onChange"])):v.field==="decrypt"?(c(),C(m,{key:3,modelValue:e.columnsDecrypt[w.data.uniqueName],"onUpdate:modelValue":$=>e.columnsDecrypt[w.data.uniqueName]=$,binary:!0,onChange:$=>e.onChange(w.data,"decrypt")},null,8,["modelValue","onUpdate:modelValue","onChange"])):v.field==="subjectId"?(c(),C(m,{key:4,modelValue:e.columnsSubjectId[w.data.uniqueName],"onUpdate:modelValue":$=>e.columnsSubjectId[w.data.uniqueName]=$,binary:!0,onChange:$=>e.onChange(w.data,"subjectId")},null,8,["modelValue","onUpdate:modelValue","onChange"])):v.field==="type"?(c(),C(f,{key:5,class:"kn-material-input",modelValue:e.columnsType[w.data.uniqueName],"onUpdate:modelValue":$=>e.columnsType[w.data.uniqueName]=$,options:e.metawebAttributesTabDescriptor.typeOptions,onChange:$=>e.onChange(w.data,"type")},null,8,["modelValue","onUpdate:modelValue","options","onChange"])):v.field==="name"?(c(),C(p,{key:6,modelValue:w.data[w.column.props.field],"onUpdate:modelValue":$=>w.data[w.column.props.field]=$,class:"kn-material-input p-inputtext-sm p-p-2",onBlur:o[1]||(o[1]=$=>e.$emit("metaUpdated"))},null,8,["modelValue","onUpdate:modelValue"])):(c(),y("span",on,l(w.data[w.column.props.field]),1))])]),_:2},1032,["field","header"]))),128)),r(k,{style:T(e.metawebAttributesTabDescriptor.iconColumnStyle)},{header:i(()=>[r(b,{class:"kn-button kn-button--primary p-button-link p-jc-center",onClick:e.openUnusedFieldsDialog,"data-test":"add-button"},{default:i(()=>[A(l(e.$t("common.add")),1)]),_:1},8,["onClick"])]),body:i(v=>[a("div",tn,[r(b,{icon:"far fa-edit",class:"p-button-link",onClick:E=>e.openAttributeDialog(v.data),"data-test":"open-icon-"+v.data.name},null,8,["onClick","data-test"]),r(b,{icon:"pi pi-trash",class:"p-button-link",onClick:E=>e.deleteBusinessColumnConfirm(v.data),"data-test":"delete-icon-"+v.data.name},null,8,["onClick","data-test"])])]),_:1},8,["style"])]),_:1},8,["value","loading","onRowReorder"])):x("",!0),r(M,{visible:e.attributeDetailDialogVisible,selectedAttribute:e.selectedAttribute,roles:e.roles,onClose:o[2]||(o[2]=v=>e.attributeDetailDialogVisible=!1),onSave:e.onAttributeSave},null,8,["visible","selectedAttribute","roles","onSave"]),r(u,{visible:e.unusedFieldDialogVisible,unusedFields:e.unusedFields,onClose:o[3]||(o[3]=v=>e.unusedFieldDialogVisible=!1),onSave:e.saveUnusedFields},null,8,["visible","unusedFields","onSave"])])}var rn=B(Zr,[["render",an]]);const nn=[{name:"1..N to 1",value:"many-to-one"},{name:"0..N to 1",value:"optional-many-to-one"}],ln=["name"],sn={iconColumnStyle:{width:"10%"}},dn={dataSend:[{fieldName:"name",validators:[{key:"required",validator:{type:"inbound-dialog-required"}}]},{fieldName:"cardinality",validators:[{key:"required",validator:{type:"inbound-dialog-required"}}]}]};var Ee={cardinality:nn,filterFields:ln,style:sn,validations:dn};const cn=V({name:"metaweb-attributes-tab",components:{TableAssociator:Ce,DataTable:X,Column:j,Dialog:R,Dropdown:K,KnValidationMessages:ae},props:{selectedBusinessModel:{type:Object,required:!0},propMeta:{type:Object,required:!0},observer:{type:Object,required:!0}},emits:["loading"],computed:{leftHasLinks(){var e=0;return this.simpleLeft.forEach(o=>{o.links.length>0&&(e+=1)}),!(e>0)},buttonDisabled(){return!!(this.v$.$invalid||this.leftHasLinks)}},data(){return{bsDescriptor:J,irDescriptor:Ee,meta:null,dataSend:{},simpleLeft:[],simpleRight:[],v$:G(),rightElement:null,inboundDialogVisible:!1,inboundRelationships:[],sourceBusinessClassOptions:[],businessModel:null,filters:{global:[Y]}}},watch:{selectedBusinessModel:{handler(){this.loadData()},deep:!0}},created(){this.loadData()},validations(){const o={"inbound-dialog-required":n=>!this.inboundDialogVisible||n};return{dataSend:re("dataSend",Ee.validations.dataSend,o)}},methods:{loadData(){this.meta=this.propMeta,this.businessModel=this.selectedBusinessModel,this.simpleLeft=this.tableToSimpleBound(this.businessModel),this.populateInboundRelationships(),this.populateSourceBusinessClassOptions()},populateInboundRelationships(){var e;this.inboundRelationships=(e=this.selectedBusinessModel)==null?void 0:e.relationships.filter(o=>{var t;return((t=this.selectedBusinessModel)==null?void 0:t.uniqueName)!=o.sourceTableName})},populateSourceBusinessClassOptions(){this.sourceBusinessClassOptions=[],this.propMeta.businessModels.forEach(e=>this.sourceBusinessClassOptions.push(e)),this.propMeta.businessViews.forEach(e=>this.sourceBusinessClassOptions.push(e))},createColumnString(e){var o=[];return e.forEach(t=>{o.push(t.name)},this),o.join(", ")},closeDialog(){this.dataSend={},this.rightElement=null,this.simpleRight=[],this.simpleLeft=this.tableToSimpleBound(this.businessModel),this.inboundDialogVisible=!1},alterTableToSimpleBound(e){this.simpleRight=this.tableToSimpleBound(e)},tableToSimpleBound(e){var o=[];return e&&e.columns&&e.columns.forEach(function(t){t.hasOwnProperty("referencedColumns")||o.push({name:t.name,uname:t.uniqueName,links:[]})}),o},async createInbound(){var o;this.dataSend.sourceColumns=[],this.dataSend.destinationColumns=[],this.dataSend.sourceTableName=this.rightElement.uniqueName,this.dataSend.destinationTableName=(o=this.businessModel)==null?void 0:o.uniqueName,this.simpleLeft.forEach(t=>{t.links.length>0&&(this.dataSend.destinationColumns.push(t.uname),this.dataSend.sourceColumns.push(t.links[0].uname))});const e={data:this.dataSend,diff:z(this.observer)};await this.$http.post("/knowagemeta/restful-services/1.0/metaWeb/addBusinessRelation",e).then(t=>{this.meta=_(this.meta,t.data).newDocument,this.closeDialog(),this.populateInboundRelationships()}).catch(()=>{}).finally(()=>z(this.observer))},async deleteInbound(e){const o={data:e,diff:z(this.observer)};await this.$http.post("/knowagemeta/restful-services/1.0/metaWeb/deleteBusinessRelation",o).then(t=>{this.meta=_(this.meta,t.data).newDocument,this.populateInboundRelationships()}).catch(()=>{}).finally(()=>z(this.observer))}}}),pn={class:"table-header p-d-flex"},bn={class:"p-input-icon-left p-mr-3 p-col-12"},kn=a("i",{class:"pi pi-search"},null,-1),un={id:"inbound-form",class:"p-fluid p-formgrid p-grid p-mt-4 p-mx-2 kn-flex-0"},mn={class:"p-field p-col-12 p-md-6"},gn={class:"p-float-label"},fn={for:"name",class:"kn-material-input-label"},hn={class:"p-field p-col-12 p-md-6"},vn={class:"p-float-label"},wn={for:"source",class:"kn-material-input-label"},yn={class:"p-field p-col-12 p-md-6"},xn={class:"p-float-label"},Mn={for:"source",class:"kn-material-input-label"},Cn={class:"p-field p-col-12 p-md-6"},An={class:"p-float-label"},$n={for:"target",class:"kn-material-input-label"};function Dn(e,o,t,n,d,h){const k=s("InputText"),m=s("Column"),f=s("Button"),p=s("DataTable"),b=s("Toolbar"),g=s("KnValidationMessages"),M=s("Dropdown"),u=s("TableAssociator"),v=s("Dialog"),E=ee("tooltip");return c(),y(I,null,[r(p,{value:e.inboundRelationships,class:"p-datatable-sm kn-table p-ml-2",responsiveLayout:"stack",breakpoint:"960px",filters:e.filters,"onUpdate:filters":o[2]||(o[2]=w=>e.filters=w),globalFilterFields:e.irDescriptor.globalFilterFields},{empty:i(()=>[A(l(e.$t("common.info.noDataFound")),1)]),header:i(()=>[a("div",pn,[a("span",bn,[kn,r(k,{class:"kn-material-input",modelValue:e.filters.global.value,"onUpdate:modelValue":o[0]||(o[0]=w=>e.filters.global.value=w),placeholder:e.$t("common.search")},null,8,["modelValue","placeholder"])])])]),default:i(()=>[r(m,{field:"name",header:e.$t("common.name"),sortable:!0},null,8,["header"]),r(m,{field:"sourceTableName",header:e.$t("metaweb.businessModel.sourceTable"),sortable:!0},null,8,["header"]),r(m,{header:e.$t("metaweb.physicalModel.sourceColumns"),sortable:!0},{body:i(w=>[N((c(),y("span",null,[A(l(e.createColumnString(w.data.sourceColumns)),1)])),[[E,e.createColumnString(w.data.sourceColumns),void 0,{top:!0}]])]),_:1},8,["header"]),r(m,{field:"destinationTableName",header:e.$t("metaweb.businessModel.targetTable"),sortable:!0},null,8,["header"]),r(m,{header:e.$t("metaweb.physicalModel.targetColumns"),sortable:!0},{body:i(w=>[N((c(),y("span",null,[A(l(e.createColumnString(w.data.destinationColumns)),1)])),[[E,e.createColumnString(w.data.destinationColumns),void 0,{top:!0}]])]),_:1},8,["header"]),r(m,{style:T(e.irDescriptor.style.iconColumnStyle),class:"p-text-right"},{header:i(()=>[r(f,{label:e.$t("common.add"),class:"p-button-link p-text-right",onClick:o[1]||(o[1]=w=>e.inboundDialogVisible=!0)},null,8,["label"])]),body:i(w=>[r(f,{icon:"pi pi-trash",class:"p-button-link",onClick:$=>e.deleteInbound(w.data)},null,8,["onClick"])]),_:1},8,["style"])]),_:1},8,["value","filters","globalFilterFields"]),r(v,{class:"bsdialog",style:T(e.bsDescriptor.style.bsDialog),visible:e.inboundDialogVisible,modal:!0,closable:!1},{header:i(()=>[r(b,{class:"kn-toolbar kn-toolbar--primary kn-width-full"},{start:i(()=>[A(l(e.$t("metaweb.businessModel.tabView.inbound")),1)]),_:1})]),footer:i(()=>[r(f,{class:"p-button-text kn-button",label:e.$t("common.cancel"),onClick:e.closeDialog},null,8,["label","onClick"]),r(f,{class:"kn-button kn-button--primary",label:e.$t("common.create"),disabled:e.buttonDisabled,onClick:e.createInbound},null,8,["label","disabled","onClick"])]),default:i(()=>[a("form",un,[a("div",mn,[a("span",gn,[r(k,{id:"name",class:U(["kn-material-input",{"p-invalid":e.v$.dataSend.name.$invalid&&e.v$.dataSend.name.$dirty}]),modelValue:e.v$.dataSend.name.$model,"onUpdate:modelValue":o[3]||(o[3]=w=>e.v$.dataSend.name.$model=w),modelModifiers:{trim:!0},onBlur:o[4]||(o[4]=w=>e.v$.dataSend.name.$touch()),onChange:o[5]||(o[5]=w=>e.$emit("touched"))},null,8,["modelValue","class"]),a("label",fn,l(e.$t("metaweb.businessModel.inbound.name"))+" *",1)]),r(g,{class:"p-mt-1",vComp:e.v$.dataSend.name,additionalTranslateParams:{fieldName:e.$t("metaweb.businessModel.inbound.name")}},null,8,["vComp","additionalTranslateParams"])]),a("div",hn,[a("span",vn,[r(M,{id:"source",class:U(["kn-material-input",{"p-invalid":e.v$.dataSend.cardinality.$invalid&&e.v$.dataSend.cardinality.$dirty}]),modelValue:e.v$.dataSend.cardinality.$model,"onUpdate:modelValue":o[6]||(o[6]=w=>e.v$.dataSend.cardinality.$model=w),optionLabel:"name",optionValue:"value",options:e.irDescriptor.cardinality,onBlur:o[7]||(o[7]=w=>e.v$.dataSend.cardinality.$touch())},null,8,["modelValue","options","class"]),a("label",wn,l(e.$t("kpi.kpiDefinition.cardinalityTtitle"))+" *",1)]),r(g,{class:"p-mt-1",vComp:e.v$.dataSend.cardinality,additionalTranslateParams:{fieldName:e.$t("kpi.kpiDefinition.cardinalityTtitle")}},null,8,["vComp","additionalTranslateParams"])]),a("div",yn,[a("span",xn,[r(M,{id:"source",class:"kn-material-input",modelValue:e.rightElement,"onUpdate:modelValue":o[8]||(o[8]=w=>e.rightElement=w),options:e.sourceBusinessClassOptions,optionLabel:"name",onChange:o[9]||(o[9]=w=>e.alterTableToSimpleBound(w.value))},null,8,["modelValue","options"]),a("label",Mn,l(e.$t("metaweb.businessModel.inbound.sourceBc")),1)])]),a("div",Cn,[a("span",An,[r(k,{id:"target",class:"kn-material-input",modelValue:e.businessModel.name,"onUpdate:modelValue":o[10]||(o[10]=w=>e.businessModel.name=w),disabled:!0},null,8,["modelValue"]),a("label",$n,l(e.$t("metaweb.businessModel.inbound.targetBc")),1)])])]),r(u,{class:"kn-flex",sourceArray:e.simpleRight,targetArray:e.simpleLeft,useMultipleTablesFromSameSource:!1,onDrop:e.onDrop,onRelationshipDeleted:e.onDelete},null,8,["sourceArray","targetArray","onDrop","onRelationshipDeleted"])]),_:1},8,["style","visible"])],64)}var En=B(cn,[["render",Dn]]);const Tn=[{name:"1..N to 1",value:"many-to-one"},{name:"0..N to 1",value:"optional-many-to-one"}],zn=["name"],Vn={iconColumnStyle:{width:"10%"}},Bn={dataSend:[{fieldName:"name",validators:[{key:"required",validator:{type:"outbound-dialog-required"}}]},{fieldName:"cardinality",validators:[{key:"required",validator:{type:"outbound-dialog-required"}}]}]};var Te={cardinality:Tn,filterFields:zn,style:Vn,validations:Bn};const Sn=V({name:"metaweb-attributes-tab",components:{TableAssociator:Ce,DataTable:X,Column:j,Dialog:R,Dropdown:K,KnValidationMessages:ae},props:{selectedBusinessModel:{type:Object,required:!0},propMeta:{type:Object,required:!0},observer:{type:Object,required:!0}},emits:["loading"],computed:{leftHasLinks(){var e=0;return this.simpleRight.forEach(o=>{o.links.length>0&&(e+=1)}),!(e>0)},buttonDisabled(){return!!(this.v$.$invalid||this.leftHasLinks)}},data(){return{v$:G(),businessModel:null,meta:null,inboundRelationships:[],orDescriptor:Te,bsDescriptor:J,inboundDialogVisible:!1,sourceBusinessClassOptions:[],dataSend:{},simpleLeft:[],simpleRight:[],rightElement:null,filters:{global:[Y]}}},watch:{selectedBusinessModel:{handler(){this.loadData()},deep:!0}},created(){this.loadData()},validations(){const o={"outbound-dialog-required":n=>!this.inboundDialogVisible||n};return{dataSend:re("dataSend",Te.validations.dataSend,o)}},methods:{loadData(){this.meta=this.propMeta,this.businessModel=this.selectedBusinessModel,this.simpleLeft=this.tableToSimpleBound(this.businessModel),this.populateInboundRelationships(),this.populateSourceBusinessClassOptions()},populateInboundRelationships(){var e;this.inboundRelationships=(e=this.selectedBusinessModel)==null?void 0:e.relationships.filter(o=>{var t;return((t=this.selectedBusinessModel)==null?void 0:t.uniqueName)===o.sourceTableName})},populateSourceBusinessClassOptions(){this.sourceBusinessClassOptions=[],this.propMeta.businessModels.forEach(e=>this.sourceBusinessClassOptions.push(e)),this.propMeta.businessViews.forEach(e=>this.sourceBusinessClassOptions.push(e))},createColumnString(e){var o=[];return e.forEach(t=>{o.push(t.name)},this),o.join(", ")},closeDialog(){this.dataSend={},this.rightElement=null,this.simpleRight=[],this.simpleLeft=this.tableToSimpleBound(this.businessModel),this.inboundDialogVisible=!1},alterTableToSimpleBound(e){this.simpleRight=this.tableToSimpleBound(e)},tableToSimpleBound(e){var o=[];return e&&e.columns&&e.columns.forEach(function(t){t.hasOwnProperty("referencedColumns")||o.push({name:t.name,uname:t.uniqueName,links:[]})}),o},async createOutbound(){var o;this.dataSend.sourceColumns=[],this.dataSend.destinationColumns=[],this.dataSend.sourceTableName=(o=this.businessModel)==null?void 0:o.uniqueName,this.dataSend.destinationTableName=this.rightElement.uniqueName,this.simpleRight.forEach(t=>{t.links.length>0&&(this.dataSend.destinationColumns.push(t.uname),this.dataSend.sourceColumns.push(t.links[0].uname))});const e={data:this.dataSend,diff:z(this.observer)};await this.$http.post("/knowagemeta/restful-services/1.0/metaWeb/addBusinessRelation",e).then(t=>{this.meta=_(this.meta,t.data),this.closeDialog(),this.populateInboundRelationships()}).catch(()=>{}).finally(()=>z(this.observer))},async deleteOutbound(e){const o={data:e,diff:z(this.observer)};await this.$http.post("/knowagemeta/restful-services/1.0/metaWeb/deleteBusinessRelation",o).then(t=>{this.meta=_(this.meta,t.data),this.populateInboundRelationships()}).catch(()=>{}).finally(()=>z(this.observer))}}}),In={class:"table-header p-d-flex"},Nn={class:"p-input-icon-left p-mr-3 p-col-12"},Un=a("i",{class:"pi pi-search"},null,-1),_n={id:"inbound-form",class:"p-fluid p-formgrid p-grid p-mt-4 p-mx-2 kn-flex-0"},On={class:"p-field p-col-12 p-md-6"},Fn={class:"p-float-label"},Rn={for:"name",class:"kn-material-input-label"},Ln={class:"p-field p-col-12 p-md-6"},Pn={class:"p-float-label"},qn={for:"source",class:"kn-material-input-label"},jn={class:"p-field p-col-12 p-md-6"},Xn={class:"p-float-label"},Qn={for:"target",class:"kn-material-input-label"},Kn={class:"p-field p-col-12 p-md-6"},Gn={class:"p-float-label"},Jn={for:"source",class:"kn-material-input-label"};function Yn(e,o,t,n,d,h){const k=s("InputText"),m=s("Column"),f=s("Button"),p=s("DataTable"),b=s("Toolbar"),g=s("KnValidationMessages"),M=s("Dropdown"),u=s("TableAssociator"),v=s("Dialog"),E=ee("tooltip");return c(),y(I,null,[r(p,{value:e.inboundRelationships,class:"p-datatable-sm kn-table p-ml-2",responsiveLayout:"stack",breakpoint:"960px",filters:e.filters,"onUpdate:filters":o[2]||(o[2]=w=>e.filters=w),globalFilterFields:e.orDescriptor.globalFilterFields},{empty:i(()=>[A(l(e.$t("common.info.noDataFound")),1)]),header:i(()=>[a("div",In,[a("span",Nn,[Un,r(k,{class:"kn-material-input",modelValue:e.filters.global.value,"onUpdate:modelValue":o[0]||(o[0]=w=>e.filters.global.value=w),placeholder:e.$t("common.search")},null,8,["modelValue","placeholder"])])])]),default:i(()=>[r(m,{field:"name",header:e.$t("common.name"),sortable:!0},null,8,["header"]),r(m,{field:"sourceTableName",header:e.$t("metaweb.businessModel.sourceTable"),sortable:!0},null,8,["header"]),r(m,{class:"kn-truncated",header:e.$t("metaweb.physicalModel.sourceColumns"),sortable:!0},{body:i(w=>[N((c(),y("span",null,[A(l(e.createColumnString(w.data.sourceColumns)),1)])),[[E,e.createColumnString(w.data.sourceColumns),void 0,{top:!0}]])]),_:1},8,["header"]),r(m,{field:"destinationTableName",header:e.$t("metaweb.businessModel.targetTable"),sortable:!0},null,8,["header"]),r(m,{header:e.$t("metaweb.physicalModel.targetColumns"),sortable:!0},{body:i(w=>[N((c(),y("span",null,[A(l(e.createColumnString(w.data.destinationColumns)),1)])),[[E,e.createColumnString(w.data.destinationColumns),void 0,{top:!0}]])]),_:1},8,["header"]),r(m,{style:T(e.orDescriptor.style.iconColumnStyle),class:"p-text-right"},{header:i(()=>[r(f,{label:e.$t("common.add"),class:"p-button-link p-text-right",onClick:o[1]||(o[1]=w=>e.inboundDialogVisible=!0)},null,8,["label"])]),body:i(w=>[r(f,{icon:"pi pi-trash",class:"p-button-link",onClick:$=>e.deleteOutbound(w.data)},null,8,["onClick"])]),_:1},8,["style"])]),_:1},8,["value","filters","globalFilterFields"]),r(v,{class:"bsdialog",style:T(e.bsDescriptor.style.bsDialog),visible:e.inboundDialogVisible,modal:!0,closable:!1},{header:i(()=>[r(b,{class:"kn-toolbar kn-toolbar--primary kn-width-full"},{start:i(()=>[A(l(e.$t("metaweb.businessModel.tabView.outbound")),1)]),_:1})]),footer:i(()=>[r(f,{class:"p-button-text kn-button",label:e.$t("common.cancel"),onClick:e.closeDialog},null,8,["label","onClick"]),r(f,{class:"kn-button kn-button--primary",label:e.$t("common.create"),disabled:e.buttonDisabled,onClick:e.createOutbound},null,8,["label","disabled","onClick"])]),default:i(()=>[a("form",_n,[a("div",On,[a("span",Fn,[r(k,{id:"name",class:U(["kn-material-input",{"p-invalid":e.v$.dataSend.name.$invalid&&e.v$.dataSend.name.$dirty}]),modelValue:e.v$.dataSend.name.$model,"onUpdate:modelValue":o[3]||(o[3]=w=>e.v$.dataSend.name.$model=w),modelModifiers:{trim:!0},onBlur:o[4]||(o[4]=w=>e.v$.dataSend.name.$touch()),onChange:o[5]||(o[5]=w=>e.$emit("touched"))},null,8,["modelValue","class"]),a("label",Rn,l(e.$t("metaweb.businessModel.inbound.name"))+" *",1)]),r(g,{class:"p-mt-1",vComp:e.v$.dataSend.name,additionalTranslateParams:{fieldName:e.$t("metaweb.businessModel.inbound.name")}},null,8,["vComp","additionalTranslateParams"])]),a("div",Ln,[a("span",Pn,[r(M,{id:"source",class:U(["kn-material-input",{"p-invalid":e.v$.dataSend.cardinality.$invalid&&e.v$.dataSend.cardinality.$dirty}]),modelValue:e.v$.dataSend.cardinality.$model,"onUpdate:modelValue":o[6]||(o[6]=w=>e.v$.dataSend.cardinality.$model=w),optionLabel:"name",optionValue:"value",options:e.orDescriptor.cardinality,onBlur:o[7]||(o[7]=w=>e.v$.dataSend.cardinality.$touch())},null,8,["modelValue","options","class"]),a("label",qn,l(e.$t("kpi.kpiDefinition.cardinalityTtitle"))+" *",1)]),r(g,{class:"p-mt-1",vComp:e.v$.dataSend.cardinality,additionalTranslateParams:{fieldName:e.$t("kpi.kpiDefinition.cardinalityTtitle")}},null,8,["vComp","additionalTranslateParams"])]),a("div",jn,[a("span",Xn,[r(k,{id:"target",class:"kn-material-input",modelValue:e.businessModel.name,"onUpdate:modelValue":o[8]||(o[8]=w=>e.businessModel.name=w),disabled:!0},null,8,["modelValue"]),a("label",Qn,l(e.$t("metaweb.businessModel.inbound.targetBc")),1)])]),a("div",Kn,[a("span",Gn,[r(M,{id:"source",class:"kn-material-input",modelValue:e.rightElement,"onUpdate:modelValue":o[9]||(o[9]=w=>e.rightElement=w),options:e.sourceBusinessClassOptions,optionLabel:"name",onChange:o[10]||(o[10]=w=>e.alterTableToSimpleBound(w.value))},null,8,["modelValue","options"]),a("label",Jn,l(e.$t("metaweb.businessModel.inbound.sourceBc")),1)])])]),r(u,{class:"kn-flex",sourceArray:e.simpleLeft,targetArray:e.simpleRight,useMultipleTablesFromSameSource:!1,onDrop:e.onDrop,onRelationshipDeleted:e.onDelete},null,8,["sourceArray","targetArray","onDrop","onRelationshipDeleted"])]),_:1},8,["style","visible"])],64)}var Hn=B(Sn,[["render",Yn]]);const Wn=["name"],Zn={width:"10%"};var ei={globalFilterFields:Wn,iconColumnStyle:Zn};const oi={style:{height:"80%","max-height":"80%","max-width":"80%","min-width":"80%"}},ti=["name"],ai={width:"3%"};var ri={dialog:oi,globalFilterFields:ti,selectColumnStyle:ai};const ni=V({name:"metaweb-add-physical-table-dialog",components:{Column:j,DataTable:X,Dialog:R},props:{visible:{type:Boolean},physicalTables:{type:Array},propLoading:{type:Boolean},roles:{type:Array}},emits:["close","save"],data(){return{metawebAddPhysicalTableDialogDescriptor:ri,rows:[],selectedTables:[],filters:{global:[Y]},loading:!1}},watch:{physicalTables(){this.loadTables()},propLoading(){this.setLoading()}},created(){this.loadTables(),this.setLoading()},methods:{loadTables(){this.selectedTables=[],this.rows=this.physicalTables},setLoading(){this.loading=this.propLoading},closeDialog(){this.selectedTables=[],this.$emit("close")},save(){this.$emit("save",[...this.selectedTables])}}}),ii={class:"table-header p-d-flex"},li={class:"p-input-icon-left p-mr-3 p-col-12"},si=a("i",{class:"pi pi-search"},null,-1);function di(e,o,t,n,d,h){const k=s("Toolbar"),m=s("ProgressBar"),f=s("InputText"),p=s("Column"),b=s("DataTable"),g=s("Button"),M=s("Dialog");return c(),C(M,{id:"metaweb-add-physical-table-dialog",style:T(e.metawebAddPhysicalTableDialogDescriptor.dialog.style),visible:e.visible,modal:!0,closable:!1},{header:i(()=>[r(k,{class:"kn-toolbar kn-toolbar--primary kn-width-full"},{start:i(()=>[A(l(e.$t("metaweb.businessModel.addPhysicalTables")),1)]),_:1})]),footer:i(()=>[r(g,{class:"kn-button kn-button--primary",onClick:e.closeDialog},{default:i(()=>[A(l(e.$t("common.cancel")),1)]),_:1},8,["onClick"]),r(g,{class:"kn-button kn-button--primary",onClick:e.save},{default:i(()=>[A(l(e.$t("common.save")),1)]),_:1},8,["onClick"])]),default:i(()=>[e.loading?(c(),C(m,{key:0,mode:"indeterminate",class:"kn-progress-bar"})):x("",!0),r(b,{value:e.rows,class:"p-datatable-sm kn-table p-m-2",selection:e.selectedTables,"onUpdate:selection":o[1]||(o[1]=u=>e.selectedTables=u),dataKey:"name",filters:e.filters,"onUpdate:filters":o[2]||(o[2]=u=>e.filters=u),globalFilterFields:e.metawebAddPhysicalTableDialogDescriptor.globalFilterFields},{empty:i(()=>[A(l(e.$t("common.info.noDataFound")),1)]),header:i(()=>[a("div",ii,[a("span",li,[si,r(f,{class:"kn-material-input",modelValue:e.filters.global.value,"onUpdate:modelValue":o[0]||(o[0]=u=>e.filters.global.value=u),placeholder:e.$t("common.search")},null,8,["modelValue","placeholder"])])])]),default:i(()=>[r(p,{selectionMode:"multiple",style:T(e.metawebAddPhysicalTableDialogDescriptor.selectColumnStyle)},null,8,["style"]),r(p,{field:"name",header:e.$t("common.name")},null,8,["header"])]),_:1},8,["value","selection","filters","globalFilterFields"])]),_:1},8,["style","visible"])}var ci=B(ni,[["render",di]]);const pi=V({name:"metaweb-physical-table-tab",props:{selectedBusinessModel:{type:Object},propMeta:{type:Object},observer:{type:Object}},components:{Column:j,DataTable:X,MetawebAddPhysicalTableDialog:ci},data(){return{metawebPhysicalTableTabDescriptor:ei,meta:null,businessModel:null,physicalTables:[],filters:{global:[Y]},availablePhysicalTables:[],addTableDialogVisible:!1,loading:!1}},watch:{selectedBusinessModel(){this.loadData()}},setup(){return{store:L()}},created(){this.loadData()},methods:{loadData(){this.loadMeta(),this.loadBusinessModel()},loadMeta(){this.meta=this.propMeta},loadBusinessModel(){this.businessModel=this.selectedBusinessModel,this.loadPhysicalTables()},loadPhysicalTables(){var e;this.physicalTables=[],this.businessModel&&((e=this.businessModel.physicalTables)==null||e.forEach(o=>this.physicalTables.push(this.meta.physicalModels[o.physicalTableIndex])))},openAddPhysicalTableDialog(){var o,t;this.availablePhysicalTables=[...this.meta.physicalModels];const e=(t=(o=this.businessModel)==null?void 0:o.physicalTables)==null?void 0:t.map(n=>n.physicalTableIndex).sort();if(e)for(let n=e.length-1;n>=0;n--)this.availablePhysicalTables.splice(e[n],1);this.addTableDialogVisible=!0},deletePhysicalTableConfirm(e){this.$confirm.require({message:this.$t("documentExecution.dossier.deleteConfirm"),header:this.$t("documentExecution.dossier.deleteTitle"),icon:"pi pi-exclamation-triangle",accept:async()=>await this.deletePhysicalTable(e)})},async deletePhysicalTable(e){var t;this.loading=!0;const o={data:{viewUniqueName:(t=this.businessModel)==null?void 0:t.uniqueName,physicalTable:e.name}};await this.$http.post("/knowagemeta/restful-services/1.0/metaWeb/deletePhysicalColumnfromBusinessView",o).then(n=>{this.meta=_(this.meta,n.data).newDocument,this.loadData(),this.store.setInfo({title:this.$t("common.toast.deleteTitle"),msg:this.$t("common.toast.deleteSuccess")}),z(this.observer)}).catch(()=>{}),this.loading=!1},async addNewPhysicalTables(e){var t;this.loading=!0;const o={data:{viewUniqueName:(t=this.businessModel)==null?void 0:t.uniqueName,physicalTables:e.map(n=>n.name)},diff:z(this.observer)};await this.$http.post("/knowagemeta/restful-services/1.0/metaWeb/addPhysicalColumnToBusinessView",o).then(n=>{this.meta=_(this.meta,n.data).newDocument,this.loadData(),this.store.setInfo({title:this.$t("common.toast.createTitle"),msg:this.$t("common.toast.createSuccess")}),this.addTableDialogVisible=!1,z(this.observer)}).catch(()=>{}),this.loading=!1}}}),bi={class:"table-header"},ki={class:"p-input-icon-left"},ui=a("i",{class:"pi pi-search"},null,-1),mi={class:"p-d-flex p-flex-row p-jc-end"};function gi(e,o,t,n,d,h){const k=s("InputText"),m=s("Column"),f=s("Button"),p=s("DataTable"),b=s("MetawebAddPhysicalTableDialog"),g=ee("tooltip");return c(),y("div",null,[e.businessModel?(c(),C(p,{key:0,class:"p-datatable-sm kn-table p-m-2",value:e.physicalTables,filters:e.filters,"onUpdate:filters":o[1]||(o[1]=M=>e.filters=M),globalFilterFields:e.metawebPhysicalTableTabDescriptor.globalFilterFields,loading:e.loading,editMode:"cell",responsiveLayout:"stack",breakpoint:"960px"},{header:i(()=>[a("div",bi,[a("span",ki,[ui,r(k,{class:"kn-material-input",type:"text",modelValue:e.filters.global.value,"onUpdate:modelValue":o[0]||(o[0]=M=>e.filters.global.value=M),placeholder:e.$t("common.search"),badge:"0","data-test":"search-input"},null,8,["modelValue","placeholder"])])])]),empty:i(()=>[A(l(e.$t("common.info.noDataFound")),1)]),default:i(()=>[r(m,{class:"kn-truncated",header:e.$t("common.name")},{body:i(M=>[N((c(),y("span",null,[A(l(M.data.name),1)])),[[g,M.data.name,void 0,{top:!0}]])]),_:1},8,["header"]),r(m,{style:T(e.metawebPhysicalTableTabDescriptor.iconColumnStyle)},{header:i(()=>[r(f,{class:"kn-button kn-button--primary p-button-link p-jc-center",onClick:e.openAddPhysicalTableDialog},{default:i(()=>[A(l(e.$t("common.add")),1)]),_:1},8,["onClick"])]),body:i(M=>[a("div",mi,[N(r(f,{icon:"pi pi-trash",class:"p-button-link",onClick:u=>e.deletePhysicalTableConfirm(M.data)},null,8,["onClick"]),[[g,e.$t("common.delete"),void 0,{top:!0}]])])]),_:1},8,["style"])]),_:1},8,["value","filters","globalFilterFields","loading"])):x("",!0),r(b,{visible:e.addTableDialogVisible,physicalTables:e.availablePhysicalTables,propLoading:e.loading,onClose:o[2]||(o[2]=M=>e.addTableDialogVisible=!1),onSave:e.addNewPhysicalTables},null,8,["visible","physicalTables","propLoading","onSave"])])}var fi=B(pi,[["render",gi]]);const hi=V({name:"metaweb-attributes-tab",components:{DataTable:X,Column:j,MetawebBusinessViewDialog:_e},props:{selectedBusinessModel:{type:Object,required:!0},propMeta:{type:Object},observer:{type:Object}},emits:["loading"],computed:{},data(){return{v$:G(),businessModel:null,showBusinessViewDialog:!1}},watch:{selectedBusinessModel(){this.loadData()}},created(){this.loadData()},validations(){},methods:{loadData(){this.businessModel=this.selectedBusinessModel}}}),vi={class:"kn-truncated kn-flex-05 p-ml-2 p-text-right"},wi=a("i",{class:"fas fa-link kn-flex-05","aria-hidden":"true"},null,-1),yi={class:"kn-truncated kn-flex-05 p-ml-2 p-text-left"},xi=a("br",null,null,-1);function Mi(e,o,t,n,d,h){const k=s("Button"),m=s("Column"),f=s("DataTable"),p=s("MetawebBusinessViewDialog");return c(),y(I,null,[r(f,{value:e.businessModel.joinRelationships,class:"p-datatable-sm kn-table p-ml-2",responsiveLayout:"scroll",breakpoint:"400px"},{default:i(()=>[r(m,{class:"p-text-center"},{header:i(()=>[r(k,{label:e.$t("metaweb.businessModel.editJoin"),class:"p-button-link p-text-right",onClick:o[0]||(o[0]=b=>e.showBusinessViewDialog=!0)},null,8,["label"])]),body:i(b=>[(c(!0),y(I,null,F(b.data.sourceColumns,(g,M)=>(c(),y("span",{key:M,class:"associator-block-hover p-d-flex p-flex-row p-ai-center kn-width-full"},[a("span",vi,l(b.data.sourceTable.name)+"."+l(g.name),1),wi,a("span",yi,l(b.data.destinationTable.name)+"."+l(b.data.destinationColumns[M].name),1),xi]))),128))]),_:1})]),_:1},8,["value"]),e.showBusinessViewDialog?(c(),C(p,{key:0,selectedBusinessModel:e.selectedBusinessModel,physicalModels:e.propMeta.physicalModels,meta:e.propMeta,observer:e.observer,editMode:!0,showBusinessViewDialog:e.showBusinessViewDialog,onCloseDialog:o[1]||(o[1]=b=>e.showBusinessViewDialog=!1)},null,8,["selectedBusinessModel","physicalModels","meta","observer","showBusinessViewDialog"])):x("",!0)],64)}var Ci=B(hi,[["render",Mi]]);const Ai=V({name:"metaweb-filter-tab",components:{Textarea:lo},props:{selectedBusinessModel:{type:Object},propMeta:{type:Object}},emits:["metaUpdated"],data(){return{meta:null,businessModel:null}},watch:{selectedBusinessModel(){this.loadMeta(),this.loadBusinessModel()}},created(){this.loadMeta(),this.loadBusinessModel()},methods:{loadMeta(){this.meta=this.propMeta},loadBusinessModel(){this.businessModel=this.selectedBusinessModel},updateMeta(){setTimeout(()=>{this.$emit("metaUpdated")},250)}}}),$i={key:0},Di={key:0,class:"p-d-flex p-flex-row p-m-4"},Ei={class:"p-mr-2"},Ti={class:"fa fa-question-circle"},zi={class:"p-fluid p-field kn-flex"},Vi={class:"kn-material-input-label"};function Bi(e,o,t,n,d,h){const k=s("Textarea"),m=ee("tooltip");return e.businessModel?(c(),y("div",$i,[(c(!0),y(I,null,F(e.businessModel.properties,(f,p)=>(c(),y("div",{key:p},[f["structural.sqlFilter"]?(c(),y("div",Di,[a("div",Ei,[N(a("i",Ti,null,512),[[m,e.$t("metaweb.filterHelpMessage"),void 0,{top:!0}]])]),a("div",zi,[a("label",Vi,l(e.$t("common.sqlExpression")),1),r(k,{class:"kn-material-input",modelValue:f["structural.sqlFilter"].value,"onUpdate:modelValue":b=>f["structural.sqlFilter"].value=b,onBlur:e.updateMeta},null,8,["modelValue","onUpdate:modelValue","onBlur"])])])):x("",!0)]))),128))])):x("",!0)}var Si=B(Ai,[["render",Bi]]);const Ii=["LLLL","llll","LLL","lll","DD/MM/YYYY HH:mm:SS","DD/MM/YYYY HH:mm","LL","ll","L","l"],Ni=[{label:"Attribute",name:"ATTRIBUTE"},{label:"Measure",name:"MEASURE"}],Ui={iconColumnStyle:{width:"10%"}},_i=[{label:"String",name:"STRING"},{label:"Number",name:"NUMBER"},{label:"Date",name:"DATE"}];var Oi={admissibleDateFormats:Ii,columnTypes:Ni,style:Ui,types:_i};const Fi=[{category:"AGGREGATION",formula:"sum(expr1, expr2, \u2026, exprN)",help:"dataPreparation.sum",label:"SUM",name:"SUM"},{category:"AGGREGATION",formula:"min(expr)",help:"dataPreparation.min",label:"MIN",name:"MIN"},{category:"AGGREGATION",formula:"max(expr)",help:"dataPreparation.max",label:"MAX",name:"MAX"},{category:"AGGREGATION",formula:"COUNT(column_name)",help:"dataPreparation.count",label:"COUNT",name:"COUNT"},{category:"AGGREGATION",formula:"avg(expr)",help:"dataPreparation.avg",label:"AVG",name:"AVG"},{category:"String",formula:"concat(col1, col2, ..., colN)",help:"dataPreparation.concat",label:"concat",name:"concat"},{category:"String",formula:"length(expr)",help:"dataPreparation.lenght",label:"Lenght",name:"Lenght"},{category:"String",formula:"lower(str)",help:"dataPreparation.lower",label:"Lower",name:"Lower"},{category:"String",formula:"upper(str)",help:"dataPreparation.upper",label:"upper",name:"upper"},{category:"String",formula:"trim(str)",help:"dataPreparation.trim",label:"trim",name:"trim"},{category:"String",formula:"substring(str, pos[, len])",help:"dataPreparation.substring",label:"substring",name:"substring"},{category:"SQL",formula:"CASE WHEN expr1 THEN expr2 [WHEN expr3 THEN expr4]* [ELSE expr5] END",help:"dataPreparation.case",label:"case",name:"case"},{category:"TIME",formula:"current_date()",help:"dataPreparation.current_date",label:"CURRENT_DATE",name:"CURRENT_DATE"},{category:"TIME",formula:"current_time()",help:"dataPreparation.current_time",label:"CURRENT_TIME",name:"CURRENT_TIME"},{category:"TIME",formula:"second(datetime_expression)",help:"dataPreparation.second",label:"second",name:"second"},{category:"TIME",formula:"hour(datetime_expression)",help:"dataPreparation.hour",label:"hour",name:"hour"},{category:"TIME",formula:"year(date_expression)",help:"dataPreparation.year",label:"year",name:"year"},{category:"TIME",formula:"month(date_expression)",help:"dataPreparation.month",label:"month",name:"month"},{category:"TIME",formula:"day(date_expression)",help:"dataPreparation.day",label:"day",name:"day"},{category:"TIME",formula:"get_quarter(date_expression)",help:"dataPreparation.get_quarter",label:"get_quarter",name:"get_quarter"},{category:"TIME",formula:"get_week(date_expression)",help:"dataPreparation.get_week",label:"get_week",name:"get_week"},{category:"TIME",formula:"get_day_of_the_week(date_expression)",help:"dataPreparation.get_day_of_the_week",label:"get_day_of_the_week",name:"get_day_of_the_week"},{category:"TIME",formula:"add_days(date_expression,number_of_days)",help:"dataPreparation.add_days",label:"add_days",name:"add_days"},{category:"TIME",formula:"add_hours(date_expression,number_of_hours)",help:"dataPreparation.add_hours",label:"add_hours",name:"add_hours"},{category:"TIME",formula:"add_months(date_expression,number_of_months)",help:"dataPreparation.add_months",label:"add_months",name:"add_months"},{category:"TIME",formula:"add_years(date_expression,number_of_years)",help:"dataPreparation.add_years",label:"add_years",name:"add_years"},{category:"TIME",formula:"subtract_days(date_expression,number_of_days)",help:"dataPreparation.subtract_days",label:"subtract_days",name:"subtract_days"},{category:"TIME",formula:"subtract_hours(date_expression,number_of_hours)",help:"dataPreparation.subtract_hours",label:"subtract_hours",name:"subtract_hours"},{category:"TIME",formula:"subtract_months(date_expression,number_of_months)",help:"dataPreparation.subtract_months",label:"subtract_months",name:"subtract_months"},{category:"TIME",formula:"subtract_years(date_expression,number_of_years)",help:"dataPreparation.subtract_years",label:"subtract_years",name:"subtract_years"},{category:"TIME",formula:"datediff_in_days(starting_date,ending_date)",help:"dataPreparation.datediff_in_days",label:"datediff_in_days",name:"datediff_in_days"},{category:"TIME",formula:"datediff_in_hours(starting_date,ending_date)",help:"dataPreparation.datediff_in_hours",label:"datediff_in_hours",name:"datediff_in_hours"},{category:"TIME",formula:"datediff_in_minutes(starting_date,ending_date)  ",help:"dataPreparation.datediff_in_minutes",label:"datediff_in_minutes",name:"datediff_in_minutes"},{category:"SPATIAL",formula:"distance(geom1, geom2, tol, unit)",help:"dataPreparation.distance",label:"distance",name:"distance"},{category:"SPATIAL",formula:"centroid(geom1, tol)",help:"dataPreparation.centroid",label:"Centroid",name:"Centroid"},{category:"SPATIAL",formula:"length_spa(geom, tol, unit)",help:"dataPreparation.length_spa",label:"length_spa",name:"length_spa"},{category:"SPATIAL",formula:"relate(geom1, mask, geom2, tol))",help:"dataPreparation.relate",label:"Relate",name:"Relate"},{category:"SPATIAL",formula:"intersection(geom1,  geom2, tol))",help:"dataPreparation.intersection",label:"Intersection",name:"Intersection"}],Ri=[{code:"string",label:"string"},{code:"numeric",label:"numeric"},{code:"date",label:"date"}],Li={label:"category"},Pi="dataPreparation.formula",qi="dataPreparation.hint",ji=[{fieldName:"colName",validators:[{key:"required"},{key:"maximumCharacters",validator:{params:{max:100},type:"maxLength"}},{key:"regex",validator:{type:"extendedAlphanumericRegex"}}]},{fieldName:"formula",validators:[{key:"required"},{key:"maximumCharacters",validator:{params:{max:1e3},type:"maxLength"}}]}];var ke={availableFunctions:Fi,availableOutputTypes:Ri,category:Li,formula:Pi,hint:qi,validations:ji};const Xi=V({name:"metaweb-filter-tab",components:{DataTable:X,Column:j,KnCalculatedField:so,Dropdown:K},props:{selectedBusinessModel:{type:Object},propMeta:{type:Object},propCustomFunctions:{type:Array},observer:{type:Object,required:!0}},emits:["metaUpdated"],data(){return{moment:Ge,descriptor:Oi,calcFieldDescriptor:ke,meta:null,businessModel:null,calcFieldDialogVisible:!1,readOnly:!1,selectedCalcField:{},calcFieldColumns:[],calcFieldFunctions:[]}},computed:{isGeographicBm(){var o,t;let e=!1;return(t=(o=this.businessModel)==null?void 0:o.properties)==null||t.forEach(n=>{const d=Object.keys(n)[0];d==="structural.tabletype"&&n[d].value==="geographic dimension"&&(e=!0)}),e}},watch:{selectedBusinessModel:{handler(){this.loadMeta(),this.loadBusinessModel(),this.calcFieldFunctions=this.createCalcFieldFunctions(ke.availableFunctions,this.propCustomFunctions)},deep:!0}},created(){this.loadMeta(),this.loadBusinessModel(),this.calcFieldFunctions=this.createCalcFieldFunctions(ke.availableFunctions,this.propCustomFunctions)},methods:{loadMeta(){this.meta=this.propMeta},loadBusinessModel(){this.businessModel=this.selectedBusinessModel},updateMeta(){setTimeout(()=>{this.$emit("metaUpdated")},250)},createCalcFieldColumns(){var e;this.calcFieldColumns=[],(e=this.businessModel)==null||e.simpleBusinessColumns.forEach(o=>{this.calcFieldColumns.push({fieldAlias:o.name,fieldLabel:o.name})})},editCalcField(e){this.createCalcFieldColumns(),this.selectedCalcField=this.formatCalcFieldForComponent(e),this.calcFieldDialogVisible=!0},formatCalcFieldForComponent(e){let o={};o.alias=e.name,o.uniqueName=e.uniqueName;for(var t=0;t<e.properties.length;t++){var n=Object.keys(e.properties[t])[0];n==="structural.datatype"&&(o.type=e.properties[t][n].value.toUpperCase()),n==="structural.expression"&&(o.expression=e.properties[t][n].value),n==="structural.columntype"&&(o.nature=e.properties[t][n].value.toUpperCase())}return o},addCalcField(){this.createCalcFieldColumns(),this.selectedCalcField={alias:"",expression:"",format:void 0,nature:"ATTRIBUTE",type:"STRING"},this.calcFieldDialogVisible=!0},onCalcFieldSave(e){var t;let o={expression:e.formula,dataType:this.selectedCalcField.type,columnType:this.selectedCalcField.nature.toLowerCase(),name:e.colName,sourceTableName:(t=this.businessModel)==null?void 0:t.uniqueName,editMode:!1};o.dataType=="DATE"&&(o.format=this.selectedCalcField.format),this.selectedCalcField.uniqueName&&(o.uniquename=this.selectedCalcField.uniqueName,o.editMode=!0),this.createCalcField(o),this.calcFieldDialogVisible=!1},async createCalcField(e){const o={data:e,diff:z(this.observer)};await this.$http.post("/knowagemeta/restful-services/1.0/metaWeb/setCalculatedField",o).then(t=>{this.meta=_(this.meta,t.data).newDocument}).catch(()=>{}).finally(()=>z(this.observer))},async deleteCalcField(e){var n;const t={data:{name:e.name,sourceTableName:(n=this.businessModel)==null?void 0:n.uniqueName},diff:z(this.observer)};await this.$http.post("/knowagemeta/restful-services/1.0/metaWeb/deleteCalculatedField",t).then(d=>{this.meta=_(this.meta,d.data).newDocument}).catch(()=>{}).finally(()=>z(this.observer))},createCalcFieldFunctions(e,o){let t=Ae(e);return o&&o.forEach(n=>{t.push(n)}),this.isGeographicBm||(t=Ae(t).filter(d=>d.category!=="SPATIAL")),t}}}),Qi={class:"p-float-label"},Ki={for:"type",class:"kn-material-input-label"},Gi={key:0,class:"p-field p-col-3"},Ji={class:"p-float-label"},Yi={for:"type",class:"kn-material-input-label"},Hi={class:"p-float-label"},Wi={for:"columnType",class:"kn-material-input-label"};function Zi(e,o,t,n,d,h){const k=s("Column"),m=s("Button"),f=s("DataTable"),p=s("Dropdown"),b=s("KnCalculatedField");return c(),y(I,null,[r(f,{value:e.businessModel.calculatedBusinessColumns,class:"p-datatable-sm kn-table p-ml-2",responsiveLayout:"stack",breakpoint:"960px"},{empty:i(()=>[A(l(e.$t("common.info.noDataFound")),1)]),default:i(()=>[r(k,{field:"name",header:e.$t("common.name"),sortable:!0},null,8,["header"]),r(k,{style:T(e.descriptor.style.iconColumnStyle),class:"p-text-right"},{header:i(()=>[r(m,{label:e.$t("common.add"),class:"p-button-link p-text-right",onClick:e.addCalcField},null,8,["label","onClick"])]),body:i(g=>[r(m,{icon:"far fa-edit",class:"p-button-link",onClick:M=>e.editCalcField(g.data)},null,8,["onClick"]),r(m,{icon:"pi pi-trash",class:"p-button-link",onClick:M=>e.deleteCalcField(g.data)},null,8,["onClick"])]),_:1},8,["style"])]),_:1},8,["value"]),e.calcFieldDialogVisible?(c(),C(b,{key:0,template:e.selectedCalcField,"onUpdate:template":o[3]||(o[3]=g=>e.selectedCalcField=g),visibility:e.calcFieldDialogVisible,"onUpdate:visibility":o[4]||(o[4]=g=>e.calcFieldDialogVisible=g),fields:e.calcFieldColumns,descriptor:e.calcFieldDescriptor,propCalcFieldFunctions:e.calcFieldFunctions,source:"QBE",readOnly:!1,valid:!0,onSave:e.onCalcFieldSave,onCancel:o[5]||(o[5]=g=>e.calcFieldDialogVisible=!1)},{additionalInputs:i(()=>[a("div",{class:U(["p-field",[e.selectedCalcField.type==="DATE"?"p-col-3":"p-col-4"]])},[a("span",Qi,[r(p,{id:"type",class:"kn-material-input",modelValue:e.selectedCalcField.type,"onUpdate:modelValue":o[0]||(o[0]=g=>e.selectedCalcField.type=g),options:e.descriptor.types,optionLabel:"label",optionValue:"name"},null,8,["modelValue","options"]),a("label",Ki,l(e.$t("components.knCalculatedField.type")),1)])],2),e.selectedCalcField.type==="DATE"?(c(),y("div",Gi,[a("span",Ji,[r(p,{id:"type",class:"kn-material-input",modelValue:e.selectedCalcField.format,"onUpdate:modelValue":o[1]||(o[1]=g=>e.selectedCalcField.format=g),options:e.descriptor.admissibleDateFormats},{value:i(()=>[a("span",null,l(e.selectedCalcField.format?e.moment().format(e.selectedCalcField.format):""),1)]),option:i(g=>[a("span",null,l(e.moment().format(g.option)),1)]),_:1},8,["modelValue","options"]),a("label",Yi,l(e.$t("managers.datasetManagement.ckanDateFormat")),1)])])):x("",!0),a("div",{class:U(["p-field",[e.selectedCalcField.type==="DATE"?"p-col-3":"p-col-4"]])},[a("span",Hi,[r(p,{id:"columnType",class:"kn-material-input",modelValue:e.selectedCalcField.nature,"onUpdate:modelValue":o[2]||(o[2]=g=>e.selectedCalcField.nature=g),options:e.descriptor.columnTypes,optionLabel:"label",optionValue:"name"},null,8,["modelValue","options"]),a("label",Wi,l(e.$t("managers.functionsCatalog.columnType")),1)])],2)]),_:1},8,["template","visibility","fields","descriptor","propCalcFieldFunctions","onSave"])):x("",!0)],64)}var el=B(Xi,[["render",Zi]]);const ol=V({name:"metaweb-business-model",components:{Chip:Be,Column:j,DataTable:X,CalculatedField:el,MetawebJoinRelationships:Ci,OutboundRelationships:Hn,BusinessClassDialog:oa,BusinessViewDialog:_e,KnFabButton:Je,TabView:pe,TabPanel:be,Menu:io,MetawebBusinessPropertyListTab:Mt,MetawebAttributesTab:rn,InboundRelationships:En,MetawebPhysicalTableTab:fi,MetawebFilterTab:Si},props:{propMeta:{type:Object},observer:{type:Object},metaUpdated:{type:Boolean},businessModelId:Number},emits:["loading","metaUpdated"],computed:{},data(){return{bmDescriptor:J,mainDescriptor:Se,meta:null,menuButtons:[],customFunctions:[],showBusinessClassDialog:!1,showBusinessViewDialog:!1,selectedBusinessModel:{},roles:[],loading:!1}},watch:{propMeta(){this.loadMeta()},metaUpdated(){this.loadMeta()}},setup(){return{store:L()}},created(){this.loadMeta(),this.createMenuItems(),this.loadRoles(),this.loadCustomFunctions()},methods:{showMenu(e){this.$refs.optionsMenu.toggle(e)},createMenuItems(){this.menuButtons=[],this.menuButtons.push({key:"0",label:this.$t("metaweb.businessModel.newBusiness"),command:()=>this.showBusinessClass()},{key:"1",label:this.$t("metaweb.businessModel.newView"),command:()=>this.showBusinessView()})},loadMeta(){this.meta=this.propMeta},selectBusinessModel(e){this.selectedBusinessModel=e.data},showBusinessClass(){this.showBusinessClassDialog=!0},showBusinessView(){this.showBusinessViewDialog=!0},async deleteFromList(e){const o={data:{name:e.uniqueName},diff:z(this.observer)};let t="";e.joinRelationships?t="/knowagemeta/restful-services/1.0/metaWeb/deleteBusinessView":t="/knowagemeta/restful-services/1.0/metaWeb/deleteBusinessClass",await this.$http.post(t,o).then(n=>{this.meta=_(this.meta,n.data).newDocument,this.store.setInfo({title:this.$t("common.toast.deleteTitle"),msg:this.$t("common.toast.deleteSuccess")}),z(this.observer)}).catch(()=>{})},async loadRoles(){this.loading=!0,await this.$http.get("/knowage/restful-services/2.0/roles").then(e=>this.roles=e.data),this.loading=!1},async loadCustomFunctions(){this.loading=!0,await this.$http.get(`/knowage/restful-services/2.0/configs/KNOWAGE.CUSTOMIZED_DATABASE_FUNCTIONS/${this.businessModelId}`).then(e=>{e.data.data&&e.data.data.length>0?this.customFunctions=e.data.data.map(o=>({category:"CUSTOM",formula:o.value,label:o.label,name:o.name,help:"dataPreparation.custom"})):this.customFunctions=null}),this.loading=!1},async onRowReorder(e){this.loading=!0;const o={data:{index:e.dragIndex,direction:e.dropIndex-e.dragIndex},diff:z(this.observer)};await this.$http.post("/knowagemeta/restful-services/1.0/metaWeb/moveBusinessClass",o).then(t=>{this.meta=_(this.meta,t.data).newDocument}).catch(()=>{}).finally(()=>z(this.observer)),this.loading=!1}}}),tl={key:0,class:"p-grid p-m-0 kn-flex"},al={id:"CONTAINER ELEMENT LIST",class:"p-col-4 p-sm-4 p-md-3 p-p-0 p-d-flex p-flex-column kn-flex"},rl={class:"p-d-flex p-flex-column kn-flex"},nl={class:"kn-relative kn-flex"},il={class:"kn-height-full kn-width-full kn-absolute"},ll={key:1,class:"p-d-flex p-flex-column kn-flex"},sl={class:"kn-relative kn-flex"},dl={class:"kn-height-full kn-width-full kn-absolute"},cl={key:0},pl={key:0,class:"metaweb-tab-container p-d-flex p-flex-column kn-flex"};function bl(e,o,t,n,d,h){const k=s("ProgressBar"),m=s("KnFabButton"),f=s("Toolbar"),p=s("Column"),b=s("Chip"),g=s("Button"),M=s("DataTable"),u=s("MetawebBusinessPropertyListTab"),v=s("TabPanel"),E=s("MetawebAttributesTab"),w=s("CalculatedField"),$=s("InboundRelationships"),P=s("OutboundRelationships"),oe=s("MetawebFilterTab"),D=s("MetawebJoinRelationships"),Re=s("MetawebPhysicalTableTab"),Le=s("TabView"),Pe=s("Menu"),qe=s("BusinessClassDialog"),je=s("BusinessViewDialog");return c(),y(I,null,[e.meta?(c(),y("div",tl,[a("div",al,[e.loading?(c(),C(k,{key:0,mode:"indeterminate",class:"kn-progress-bar","data-test":"progress-bar"})):x("",!0),a("div",rl,[r(f,{class:"kn-toolbar kn-toolbar--default"},{start:i(()=>[a("span",null,l(e.$t("metaweb.businessModel.businessClass")),1)]),end:i(()=>[r(m,{icon:"fas fa-plus",onClick:e.showMenu},null,8,["onClick"])]),_:1}),a("div",nl,[a("div",il,[r(M,{class:"p-datatable-sm metaweb-table kn-table metaweb-right-border",loading:e.loading,scrollable:!0,scrollHeight:"100%",value:e.meta.businessModels,onRowClick:e.selectBusinessModel,onRowReorder:e.onRowReorder,"data-test":"bm-table"},{default:i(()=>[r(p,{rowReorder:!0,reorderableColumn:!1}),r(p,{style:T(e.mainDescriptor.style.columnMain)},{body:i(O=>[a("span",null,l(O.data.name),1),r(b,{label:O.data.columns.length+" "+e.$t("metaweb.businessModel.tabView.attributes"),class:"p-ml-2",style:T(e.mainDescriptor.style.chip)},null,8,["label","style"])]),_:1},8,["style"]),r(p,{style:T(e.mainDescriptor.style.columnTrash)},{body:i(O=>[r(g,{icon:"pi pi-trash",class:"p-button-link",onClick:Xe=>e.deleteFromList(O.data)},null,8,["onClick"])]),_:1},8,["style"])]),_:1},8,["loading","value","onRowClick","onRowReorder"])])])]),e.meta.businessViews.length>0?(c(),y("div",ll,[r(f,{class:"kn-toolbar kn-toolbar--default"},{start:i(()=>[a("span",null,l(e.$t("metaweb.businessModel.businessView")),1)]),_:1}),a("div",sl,[a("div",dl,[r(M,{class:"p-datatable-sm metaweb-table kn-table metaweb-right-border",loading:e.loading,scrollable:!0,scrollHeight:"100%",value:e.meta.businessViews,onRowClick:e.selectBusinessModel,onRowReorder:e.onRowReorder},{default:i(()=>[r(p,{rowReorder:!0,reorderableColumn:!1}),r(p,{style:T(e.mainDescriptor.style.columnMain)},{body:i(O=>[a("span",null,l(O.data.name),1),r(b,{label:O.data.columns.length+" "+e.$t("metaweb.businessModel.tabView.attributes"),class:"p-ml-2",style:T(e.mainDescriptor.style.chip)},null,8,["label","style"])]),_:1},8,["style"]),r(p,{style:T(e.mainDescriptor.style.columnTrash)},{body:i(O=>[r(g,{icon:"pi pi-trash",class:"p-button-link",onClick:Xe=>e.deleteFromList(O.data)},null,8,["onClick"])]),_:1},8,["style"])]),_:1},8,["loading","value","onRowClick","onRowReorder"])])])])):x("",!0)]),a("div",{id:"CONTAINER ELEMENT DETAILS",class:"p-col-8 p-sm-8 p-md-9 p-p-0 p-m-0 p-d-flex p-flex-column",style:T(e.mainDescriptor.style.flex3)},[r(f,{class:"kn-toolbar kn-toolbar--secondary"},{start:i(()=>[e.selectedBusinessModel?(c(),y("span",cl,l(e.selectedBusinessModel.name),1)):x("",!0)]),_:1}),Object.keys(e.selectedBusinessModel).length!==0?(c(),y("div",pl,[r(Le,{class:"metaweb-tabview p-d-flex p-flex-column kn-flex",scrollable:""},{default:i(()=>[r(v,null,{header:i(()=>[a("span",null,l(e.$t("metaweb.businessModel.tabView.propertyTitle")),1)]),default:i(()=>[a("div",{style:T(e.mainDescriptor.style.absoluteScroll)},[r(u,{selectedBusinessModel:e.selectedBusinessModel,roles:e.roles,propMeta:e.meta,onMetaUpdated:o[0]||(o[0]=O=>e.$emit("metaUpdated"))},null,8,["selectedBusinessModel","roles","propMeta"])],4)]),_:1}),r(v,null,{header:i(()=>[a("span",null,l(e.$t("metaweb.businessModel.tabView.attributes")),1)]),default:i(()=>[a("div",{style:T(e.mainDescriptor.style.absoluteScroll)},[r(E,{selectedBusinessModel:e.selectedBusinessModel,propMeta:e.meta,observer:e.observer,roles:e.roles,onMetaUpdated:o[1]||(o[1]=O=>e.$emit("metaUpdated"))},null,8,["selectedBusinessModel","propMeta","observer","roles"])],4)]),_:1}),r(v,null,{header:i(()=>[a("span",null,l(e.$t("metaweb.businessModel.tabView.calcField")),1)]),default:i(()=>[a("div",{style:T(e.mainDescriptor.style.absoluteScroll)},[r(w,{selectedBusinessModel:e.selectedBusinessModel,propMeta:e.meta,propCustomFunctions:e.customFunctions,onMetaUpdated:o[2]||(o[2]=O=>e.$emit("metaUpdated")),observer:e.observer},null,8,["selectedBusinessModel","propMeta","propCustomFunctions","observer"])],4)]),_:1}),r(v,null,{header:i(()=>[a("span",null,l(e.$t("metaweb.businessModel.tabView.inbound")),1)]),default:i(()=>[a("div",{style:T(e.mainDescriptor.style.absoluteScroll)},[r($,{selectedBusinessModel:e.selectedBusinessModel,propMeta:e.meta,observer:e.observer},null,8,["selectedBusinessModel","propMeta","observer"])],4)]),_:1}),r(v,null,{header:i(()=>[a("span",null,l(e.$t("metaweb.businessModel.tabView.outbound")),1)]),default:i(()=>[a("div",{style:T(e.mainDescriptor.style.absoluteScroll)},[r(P,{selectedBusinessModel:e.selectedBusinessModel,propMeta:e.meta,observer:e.observer},null,8,["selectedBusinessModel","propMeta","observer"])],4)]),_:1}),r(v,null,{header:i(()=>[a("span",null,l(e.$t("metaweb.businessModel.tabView.filter")),1)]),default:i(()=>[a("div",{style:T(e.mainDescriptor.style.absoluteScroll)},[r(oe,{selectedBusinessModel:e.selectedBusinessModel,propMeta:e.meta,onMetaUpdated:o[3]||(o[3]=O=>e.$emit("metaUpdated"))},null,8,["selectedBusinessModel","propMeta"])],4)]),_:1}),e.selectedBusinessModel.joinRelationships!=null?(c(),C(v,{key:0},{header:i(()=>[a("span",null,l(e.$t("metaweb.businessModel.tabView.joinRelationships")),1)]),default:i(()=>[a("div",{style:T(e.mainDescriptor.style.absoluteScroll)},[r(D,{selectedBusinessModel:e.selectedBusinessModel,propMeta:e.meta,observer:e.observer},null,8,["selectedBusinessModel","propMeta","observer"])],4)]),_:1})):x("",!0),e.selectedBusinessModel.joinRelationships!=null?(c(),C(v,{key:1},{header:i(()=>[a("span",null,l(e.$t("metaweb.businessModel.physicalTable")),1)]),default:i(()=>[a("div",{style:T(e.mainDescriptor.style.absoluteScroll)},[r(Re,{selectedBusinessModel:e.selectedBusinessModel,propMeta:e.meta,observer:e.observer},null,8,["selectedBusinessModel","propMeta","observer"])],4)]),_:1})):x("",!0)]),_:1})])):x("",!0)],4)])):x("",!0),r(Pe,{id:"optionsMenu",ref:"optionsMenu",model:e.menuButtons},null,8,["model"]),e.showBusinessClassDialog?(c(),C(qe,{key:1,meta:e.meta,observer:e.observer,physicalModels:e.meta.physicalModels,showBusinessClassDialog:e.showBusinessClassDialog,onCloseDialog:o[4]||(o[4]=O=>e.showBusinessClassDialog=!1)},null,8,["meta","observer","physicalModels","showBusinessClassDialog"])):x("",!0),e.showBusinessViewDialog?(c(),C(je,{key:2,meta:e.meta,observer:e.observer,showBusinessViewDialog:e.showBusinessViewDialog,onCloseDialog:o[5]||(o[5]=O=>e.showBusinessViewDialog=!1)},null,8,["meta","observer","showBusinessViewDialog"])):x("",!0)],64)}var kl=B(ol,[["render",bl]]);const ul=["name"],ml="flex";var gl={globalFilterFields:ul,scrollHeight:ml};const fl=V({name:"metaweb-foreign-key-tab",components:{Column:j,DataTable:X},props:{propForeignKeys:{type:Array}},data(){return{metawebForeignKeyTabDescriptor:gl,foreignKeys:[],filters:{global:[Y]}}},watch:{propForeignKeys(){this.loadForeignKeys()}},created(){this.loadForeignKeys()},methods:{loadForeignKeys(){this.foreignKeys=this.propForeignKeys},getColumns(e,o){const t=[];for(let n=0;n<e[o].length;n++)t.push(e[o][n].tableName+"."+e[o][n].name);return t.join(",")}}}),hl={class:"card",style:{height:"calc(100vh - 165px)"}},vl={class:"table-header p-d-flex p-ai-center"},wl={id:"search-container",class:"p-input-icon-left p-mr-3"},yl=a("i",{class:"pi pi-search"},null,-1);function xl(e,o,t,n,d,h){const k=s("InputText"),m=s("Column"),f=s("DataTable"),p=ee("tooltip");return c(),y("div",hl,[r(f,{value:e.foreignKeys,class:"p-datatable-sm kn-table",dataKey:"id",filters:e.filters,"onUpdate:filters":o[1]||(o[1]=b=>e.filters=b),globalFilterFields:e.metawebForeignKeyTabDescriptor.globalFilterFields,responsiveLayout:"stack",breakpoint:"600px",scrollable:!0,scrollHeight:e.metawebForeignKeyTabDescriptor.scrollHeight},{empty:i(()=>[A(l(e.$t("common.info.noDataFound")),1)]),header:i(()=>[a("div",vl,[a("span",wl,[yl,r(k,{class:"kn-material-input",modelValue:e.filters.global.value,"onUpdate:modelValue":o[0]||(o[0]=b=>e.filters.global.value=b),placeholder:e.$t("common.search")},null,8,["modelValue","placeholder"])])])]),default:i(()=>[r(m,{class:"kn-truncated",field:"name",header:e.$t("common.name"),key:"name",sortable:!0},{body:i(b=>[N((c(),y("span",null,[A(l(b.data.name),1)])),[[p,b.data.name,void 0,{top:!0}]])]),_:1},8,["header"]),r(m,{class:"kn-truncated",header:e.$t("metaweb.physicalModel.sourceColumns"),sortable:!0},{body:i(b=>[N((c(),y("span",null,[A(l(e.getColumns(b.data,"sourceColumns")),1)])),[[p,e.getColumns(b.data,"sourceColumns"),void 0,{top:!0}]])]),_:1},8,["header"]),r(m,{class:"kn-truncated",header:e.$t("metaweb.physicalModel.targetColumns"),sortable:!0},{body:i(b=>[N((c(),y("span",null,[A(l(e.getColumns(b.data,"destinationColumns")),1)])),[[p,e.getColumns(b.data,"destinationColumns"),void 0,{top:!0}]])]),_:1},8,["header"])]),_:1},8,["value","filters","globalFilterFields","scrollHeight"])])}var Ml=B(fl,[["render",xl]]);const Cl=V({name:"metaweb-physical-model-list",components:{Accordion:we,AccordionTab:ye,Listbox:H},props:{propMeta:{type:Object}},emits:["selected"],data(){return{meta:null,selectedPhysicalModel:null}},watch:{propMeta(){this.loadMeta()}},created(){this.loadMeta()},methods:{loadMeta(){this.meta=this.propMeta},emitSelectedItem(){this.$emit("selected",this.selectedPhysicalModel)},setSelected(e){this.selectedPhysicalModel=this.meta.physicalModels[e],this.$emit("selected",this.selectedPhysicalModel)}}}),Al={class:"p-d-flex p-flex-row metaweb-physical-model-accordion-header"},$l=["data-test"],Dl={class:"p-ml-auto p-mr-2"};function El(e,o,t,n,d,h){const k=s("Listbox"),m=s("AccordionTab"),f=s("Accordion");return e.meta?(c(),C(f,{key:0,multiple:!0,onTabOpen:o[1]||(o[1]=p=>e.setSelected(p.index)),onTabClose:o[2]||(o[2]=p=>e.setSelected(p.index))},{default:i(()=>[(c(!0),y(I,null,F(e.meta.physicalModels,(p,b)=>(c(),C(m,{key:b},{header:i(()=>[a("div",Al,[a("span",{"data-test":"physical-model-tab-"+p.name},l(p.name),9,$l),a("span",Dl,l(p.columns.length+" "+e.$t("common.properties")),1)])]),default:i(()=>[r(k,{class:"metaweb-physical-model-column-listbox",modelValue:e.selectedPhysicalModel,"onUpdate:modelValue":o[0]||(o[0]=g=>e.selectedPhysicalModel=g),options:p.columns,onChange:e.emitSelectedItem},{option:i(g=>[a("div",null,[a("i",{class:U([g.option.primaryKey?"fa fa-key gold-key":"fa fa-columns","p-mr-2"])},null,2),a("span",null,l(g.option.name),1)])]),_:2},1032,["modelValue","options","onChange"])]),_:2},1024))),128))]),_:1})):x("",!0)}var Tl=B(Cl,[["render",El]]);const zl=[{label:"common.name",name:"name"},{label:"common.description",name:"description"},{label:"common.comment",name:"comment"},{label:"metaweb.physicalModel.dataType",name:"dataType"},{label:"metaweb.physicalModel.decimalDigits",name:"decimalDigits"},{label:"metaweb.physicalModel.typeName",name:"typeName"},{label:"common.size",name:"size"},{label:"metaweb.physicalModel.octectLength",name:"octectLength"},{label:"metaweb.physicalModel.radix",name:"radix"},{label:"metaweb.physicalModel.defaultValue",name:"defaultValue"},{label:"metaweb.physicalModel.nullable",name:"nullable"},{label:"metaweb.physicalModel.position",name:"position"},{label:"common.table.table",name:"table"}];var Vl={physicalModelInfo:zl};const Bl=V({name:"metaweb-property-list-tab",components:{Accordion:we,AccordionTab:ye},props:{selectedPhysicalModel:{type:Object}},data(){return{metawebPropertyListTabDescriptor:Vl,physicalModel:null,categories:[]}},watch:{selectedPhysicalModel(){this.loadPhysicalModel()}},created(){this.loadPhysicalModel()},methods:{loadPhysicalModel(){this.physicalModel=this.selectedPhysicalModel,this.loadCategories()},loadCategories(){var e;if(this.categories={},this.physicalModel)for(let o=0;o<this.physicalModel.properties.length;o++){const t=(e=this.physicalModel)==null?void 0:e.properties[o],n=Object.keys(t)[0],d=n==null?void 0:n.split(".");this.categories[d[0]]||(this.categories[d[0]]=[]),this.categories[d[0]].push(t[n])}}}}),Sl={class:"p-grid"},Il={class:"p-fluid"},Nl={class:"p-field"},Ul=["for"],_l={class:"p-grid"},Ol={class:"p-fluid"},Fl={class:"p-field"},Rl={class:"kn-material-input-label"};function Ll(e,o,t,n,d,h){const k=s("InputText"),m=s("AccordionTab"),f=s("Accordion");return e.physicalModel?(c(),C(f,{key:0,multiple:!0,activeIndex:[0]},{default:i(()=>[r(m,null,{header:i(()=>[a("span",null,l(e.$t("metaweb.physicalModel.misc")),1)]),default:i(()=>[a("div",Sl,[(c(!0),y(I,null,F(e.metawebPropertyListTabDescriptor.physicalModelInfo,(p,b)=>(c(),y("div",{class:"p-col-6",key:b},[a("div",Il,[a("div",Nl,[a("label",{for:p.name,class:"kn-material-input-label"},l(e.$t(p.label)),9,Ul),r(k,{class:"kn-material-input",modelValue:e.physicalModel[p.name],"onUpdate:modelValue":g=>e.physicalModel[p.name]=g,id:p.name,disabled:!0,"data-test":"input-"+p.label},null,8,["modelValue","onUpdate:modelValue","id","data-test"])])])]))),128))])]),_:1}),(c(!0),y(I,null,F(Object.keys(e.categories),(p,b)=>(c(),C(m,{key:b},{header:i(()=>[a("span",null,l(p),1)]),default:i(()=>[a("div",_l,[(c(!0),y(I,null,F(e.categories[p],(g,M)=>(c(),y("div",{class:"p-col-6",key:M},[a("div",Ol,[a("div",Fl,[a("label",Rl,l(g.propertyType.name),1),r(k,{class:"kn-material-input",modelValue:g.value,"onUpdate:modelValue":u=>g.value=u,disabled:!0,"data-test":"input-"+g.propertyType.name},null,8,["modelValue","onUpdate:modelValue","data-test"])])])]))),128))])]),_:2},1024))),128))]),_:1})):x("",!0)}var Pl=B(Bl,[["render",Ll]]);const ql={style:{width:"80vw"}},jl=["value"],Xl={width:"3%"};var Oe={dialog:ql,globalFilterFields:jl,selectColumnStyle:Xl};const Ql=V({name:"metaweb-update-changed-lists",components:{Listbox:H},props:{changedItem:{type:Object}},data(){return{data:null}},watch:{changedItem(){this.loadData()}},async created(){this.loadData()},methods:{loadData(){this.data=this.changedItem}}}),Kl={key:0},Gl={class:"p-m-2 p-my-4"},Jl={class:"kn-material-input-label"},Yl={class:"p-mx-2 p-my-4"},Hl={class:"kn-material-input-label"};function Wl(e,o,t,n,d,h){const k=s("Listbox");return e.data?(c(),y("div",Kl,[a("div",Gl,[a("label",Jl,l(e.data.missingColumns.length>0?e.$t("metaweb.updatePhysicalModel.addNewColumns"):e.$t("metaweb.updatePhysicalModel.noNewColumns")),1),e.data.missingColumns.length>0?(c(),C(k,{key:0,class:"metaweb-update-changed-list",options:e.data.missingColumns,disabled:!0},null,8,["options"])):x("",!0)]),a("div",Yl,[a("label",Hl,l(e.data.removingItems.length>0?e.$t("metaweb.updatePhysicalModel.deletedColumns"):e.$t("metaweb.updatePhysicalModel.noDeletedColumns")),1),e.data.removingItems.length>0?(c(),C(k,{key:0,class:"metaweb-update-changed-list",options:e.data.removingItems,disabled:!0},null,8,["options"])):x("",!0)])])):x("",!0)}var Zl=B(Ql,[["render",Wl]]);const es=V({name:"metaweb-update-changed-lists",components:{Column:j,DataTable:X},props:{changedItem:{type:Object}},emits:["selected"],data(){return{metawebPhysicalModelUpdateDialogDescriptor:Oe,data:null,rows:[],selectedTables:[],filters:{global:[Y]}}},watch:{changedItem(){this.loadData()}},async created(){this.loadData()},methods:{loadData(){this.data=this.changedItem,this.loadRows()},loadRows(){var e,o;this.rows=[],(o=(e=this.data)==null?void 0:e.missingTables)==null||o.forEach(t=>this.rows.push({value:t}))},onTablesSelect(){this.$emit("selected",this.selectedTables)}}}),os={key:0},ts={class:"p-m-2 p-my-4"},as={class:"kn-material-input-label"},rs={class:"table-header p-d-flex"},ns={class:"p-input-icon-left p-mr-3 p-col-12"},is=a("i",{class:"pi pi-search"},null,-1);function ls(e,o,t,n,d,h){const k=s("InputText"),m=s("Column"),f=s("DataTable");return e.data?(c(),y("div",os,[a("div",ts,[a("label",as,l(e.data.missingTables.length>0?e.$t("metaweb.updatePhysicalModel.newTables"):e.$t("metaweb.updatePhysicalModel.noNewTables")),1),r(f,{value:e.rows,class:"p-datatable-sm kn-table",selection:e.selectedTables,"onUpdate:selection":o[1]||(o[1]=p=>e.selectedTables=p),dataKey:"value",filters:e.filters,"onUpdate:filters":o[2]||(o[2]=p=>e.filters=p),globalFilterFields:e.metawebPhysicalModelUpdateDialogDescriptor.globalFilterFields,onRowSelect:e.onTablesSelect,onRowUnselect:e.onTablesSelect,onRowSelectAll:e.onTablesSelect,onRowUnselectAll:e.onTablesSelect},{empty:i(()=>[A(l(e.$t("common.info.noDataFound")),1)]),header:i(()=>[a("div",rs,[a("span",ns,[is,r(k,{class:"kn-material-input",modelValue:e.filters.global.value,"onUpdate:modelValue":o[0]||(o[0]=p=>e.filters.global.value=p),placeholder:e.$t("common.search")},null,8,["modelValue","placeholder"])])])]),default:i(()=>[r(m,{selectionMode:"multiple",style:T(e.metawebPhysicalModelUpdateDialogDescriptor.selectColumnStyle)},null,8,["style"]),r(m,{field:"value",header:e.data.missingTables.length>0?e.$t("metaweb.updatePhysicalModel.newTables"):e.$t("metaweb.updatePhysicalModel.noNewTables")},null,8,["header"])]),_:1},8,["value","selection","filters","globalFilterFields","onRowSelect","onRowUnselect","onRowSelectAll","onRowUnselectAll"])])])):x("",!0)}var ss=B(es,[["render",ls]]);const ds=V({name:"metaweb-physical-model-update-dialog",components:{Dialog:R,MetawebUpdateChangedLists:Zl,MetawebUpdatePhysicalTablesSelect:ss},props:{visible:{type:Boolean},changedItem:{type:Object}},emits:["close","updated"],data(){return{metawebPhysicalModelUpdateDialogDescriptor:Oe,data:null,tables:[],step:0,loading:!1}},watch:{changedItem(){this.loadData()}},setup(){return{store:L()}},async created(){this.loadData()},methods:{loadData(){this.data=this.changedItem},closeDialog(){this.$emit("close"),this.step=0,this.tables=[]},onTablesSelect(e){this.tables=e.map(o=>o.value)},async save(){this.step===0?this.step=1:await this.updatePhysicalModel()},async updatePhysicalModel(){this.loading=!0,await this.$http.post("/knowagemeta/restful-services/1.0/metaWeb/updatePhysicalModel",{tables:this.tables}).then(e=>{this.store.setInfo({title:this.$t("common.toast.updateTitle"),msg:this.$t("common.toast.updateSuccess")}),this.$emit("updated",e.data),this.tables=[],this.step=0}).catch(()=>{}),this.loading=!1}}}),cs={class:"p-d-flex p-flex-row p-jc-end"};function ps(e,o,t,n,d,h){const k=s("Toolbar"),m=s("ProgressBar"),f=s("MetawebUpdateChangedLists"),p=s("MetawebUpdatePhysicalTablesSelect"),b=s("Button"),g=s("Dialog");return c(),C(g,{class:"p-fluid kn-dialog--toolbar--primary",contentStyle:e.metawebPhysicalModelUpdateDialogDescriptor.dialog.style,visible:e.visible,modal:!0,closable:!1},{header:i(()=>[r(k,{class:"kn-toolbar kn-toolbar--primary p-p-0 p-m-0 p-col-12"},{start:i(()=>[A(l(e.$t("metaweb.updatePhysicalModel.title")),1)]),_:1})]),footer:i(()=>[a("div",cs,[r(b,{class:"kn-button kn-button--primary",onClick:e.closeDialog},{default:i(()=>[A(l(e.$t("common.cancel")),1)]),_:1},8,["onClick"]),r(b,{class:"kn-button kn-button--primary",onClick:e.save},{default:i(()=>[A(l(e.step===0?e.$t("common.next")+" >":e.$t("common.save")),1)]),_:1},8,["onClick"])])]),default:i(()=>[e.loading?(c(),C(m,{key:0,mode:"indeterminate",class:"kn-progress-bar"})):x("",!0),e.step===0?(c(),C(f,{key:1,changedItem:e.data},null,8,["changedItem"])):(c(),C(p,{key:2,changedItem:e.data,onSelected:e.onTablesSelect},null,8,["changedItem","onSelected"]))]),_:1},8,["contentStyle","visible"])}var bs=B(ds,[["render",ps]]);const ks={mainList:{height:"100%"},mainListContainer:{height:"100%","overflow-x":"hidden","overflow-y":"auto",position:"absolute",width:"100%"}};var us={style:ks};const ms=V({name:"metaweb-physical-model",components:{MetawebForeignKeyTab:Ml,MetawebPhysicalModelList:Tl,MetawebPropertyListTab:Pl,MetawebPhysicalModelUpdateDialog:bs,TabView:pe,TabPanel:be},props:{propMeta:{type:Object},observer:{type:Object}},emits:["loading"],data(){return{physDescriptor:us,meta:null,selectedPhysicalModel:null,updateDialogVisible:!1,changedItem:null}},watch:{propMeta(){this.loadMeta()}},created(){this.loadMeta()},methods:{loadMeta(){this.meta=this.propMeta},onSelectedItem(e){this.selectedPhysicalModel=e},async openUpdateDialog(){this.$emit("loading",!0),await this.$http.get("/knowagemeta/restful-services/1.0/metaWeb/updatePhysicalModel").then(e=>this.changedItem=e.data),this.updateDialogVisible=!0,this.$emit("loading",!1)},onPhysicalModelUpdate(e){this.meta=_(this.meta,e).newDocument,z(this.observer),this.updateDialogVisible=!1}}}),gs={class:"p-grid p-m-0 kn-flex"},fs={class:"p-col-4 p-sm-4 p-md-3 p-p-0 p-d-flex p-flex-column kn-flex"},hs={class:"kn-flex kn-relative"},vs={class:"p-col-8 p-sm-8 p-md-9 p-p-0 p-m-0 p-d-flex p-flex-column"},ws={"data-test":"physical-model-name"},ys={key:0,class:"metaweb-tab-container p-d-flex p-flex-column kn-flex"};function xs(e,o,t,n,d,h){const k=s("Button"),m=s("Toolbar"),f=s("MetawebPhysicalModelList"),p=s("MetawebPropertyListTab"),b=s("TabPanel"),g=s("MetawebForeignKeyTab"),M=s("TabView"),u=s("MetawebPhysicalModelUpdateDialog");return c(),y("div",gs,[a("div",fs,[r(m,{class:"kn-toolbar kn-toolbar--primary"},{start:i(()=>[A(l(e.$t("metaweb.physicalModel.tables")),1)]),end:i(()=>[r(k,{class:"p-button-text p-button-rounded p-button-plain p-button-sm",onClick:e.openUpdateDialog},{default:i(()=>[A(l(e.$t("metaweb.physicalModel.updatePhysicalModel")),1)]),_:1},8,["onClick"])]),_:1}),a("div",hs,[a("div",{class:"metaweb-right-border",style:T(e.physDescriptor.style.mainListContainer)},[r(f,{style:T(e.physDescriptor.style.mainList),propMeta:e.meta,onSelected:e.onSelectedItem},null,8,["style","propMeta","onSelected"])],4)])]),a("div",vs,[r(m,{class:"kn-toolbar kn-toolbar--secondary"},{start:i(()=>{var v;return[a("span",ws,l((v=e.selectedPhysicalModel)==null?void 0:v.name),1)]}),_:1}),e.selectedPhysicalModel?(c(),y("div",ys,[r(M,{class:"metaweb-tabview p-d-flex p-flex-column kn-flex",scrollable:"","data-test":"tab-view"},{default:i(()=>{var v;return[r(b,null,{header:i(()=>[a("span",null,l(e.$t("metaweb.physicalModel.propertyList")),1)]),default:i(()=>[r(p,{class:"p-m-2",selectedPhysicalModel:e.selectedPhysicalModel},null,8,["selectedPhysicalModel"])]),_:1}),((v=e.selectedPhysicalModel)==null?void 0:v.type)==="TABLE"?(c(),C(b,{key:0},{header:i(()=>[a("span",null,l(e.$t("metaweb.physicalModel.foreignKey")),1)]),default:i(()=>[r(g,{class:"p-m-2",propForeignKeys:e.selectedPhysicalModel.foreignKeys},null,8,["propForeignKeys"])]),_:1})):x("",!0)]}),_:1})])):x("",!0)]),r(u,{visible:e.updateDialogVisible,changedItem:e.changedItem,onClose:o[0]||(o[0]=v=>e.updateDialogVisible=!1),onUpdated:e.onPhysicalModelUpdate},null,8,["visible","changedItem","onUpdated"])])}var Ms=B(ms,[["render",xs]]);const Cs={style:{height:"80%","max-height":"80%","max-width":"80%","min-width":"80%"}};var As={dialog:Cs};const $s=V({name:"metaweb-invalid-relationships-dialog",components:{Chip:Be,Dialog:R},props:{visible:{type:Boolean},propIncorrectRelationships:{type:Array}},emits:["close","save"],data(){return{metawebInvalidRelationshipsDialogDescriptor:As,incorrectRelationships:[]}},watch:{propIncorrectRelationships(){this.loadIncorrectRelationships()}},created(){this.loadIncorrectRelationships()},methods:{loadIncorrectRelationships(){this.incorrectRelationships=this.propIncorrectRelationships},closeDialog(){this.$emit("close")},save(){this.$emit("save")}}}),Ds={class:"p-m-4"},Es={class:"p-d-flex p-flex-column p-m-2"},Ts=a("i",{class:"fa fa-arrow-right","aria-hidden":"true"},null,-1);function zs(e,o,t,n,d,h){const k=s("Toolbar"),m=s("Chip"),f=s("Button"),p=s("Dialog");return c(),C(p,{id:"metaweb-inccorect-relationships-dialog",class:"p-fluid kn-dialog--toolbar--primary",style:T(e.metawebInvalidRelationshipsDialogDescriptor.dialog.style),visible:e.visible,modal:!0,closable:!1,baseZIndex:10,autoZIndex:!0},{header:i(()=>[r(k,{class:"kn-toolbar kn-toolbar--primary p-p-0 p-m-2 p-col-12"},{start:i(()=>[A(l(e.$t("common.warning")),1)]),_:1})]),footer:i(()=>[r(f,{class:"kn-button kn-button--primary",onClick:e.closeDialog},{default:i(()=>[A(l(e.$t("common.cancel")),1)]),_:1},8,["onClick"]),r(f,{class:"kn-button kn-button--primary",onClick:e.save},{default:i(()=>[A(l(e.$t("common.save")),1)]),_:1},8,["onClick"])]),default:i(()=>[a("div",Ds,[a("h3",null,l(e.$t("metaweb.incorrectRelationships.title")),1),a("p",null,l(e.$t("metaweb.incorrectRelationships.warningMessage.partOne")),1),a("p",null,l(e.$t("metaweb.incorrectRelationships.warningMessage.partTwo")),1),a("p",null,l(e.$t("metaweb.incorrectRelationships.warningMessage.partThree")),1)]),a("div",Es,[(c(!0),y(I,null,F(e.incorrectRelationships,(b,g)=>(c(),y("div",{key:g,class:"p-m-4"},[a("h2",null,l(b.businessRelationshipName),1),a("div",null,[A(l(b.sourceTableName)+" ",1),Ts,A(" "+l(b.destinationTableName),1)]),r(m,{class:"p-m-2"},{default:i(()=>[A(l(e.$t("metaweb.incorrectRelationships.requiredColumns")+": "+b.requiredNumberOfColumns),1)]),_:2},1024)]))),128))])]),_:1},8,["style","visible"])}var Vs=B($s,[["render",zs]]);const Bs=V({name:"metaweb",components:{BusinessModelTab:kl,MetawebPhysicalModel:Ms,TabView:pe,TabPanel:be,Dialog:R,MetawebInvalidRelationshipsDialog:Vs},props:{visible:{type:Boolean},propMeta:{type:Object},businessModel:{type:Object}},emits:["closeMetaweb","modelGenerated"],data(){return{v$:G(),mainDescriptor:Se,meta:null,observer:null,metaUpdated:!1,invalidRelationshipsDialogVisible:!1,incorrectRelationships:[],loading:!1}},computed:{},watch:{propMeta(){this.loadMeta()}},created(){this.loadMeta()},methods:{...Ye(L,["setInfo"]),loadMeta(){this.meta=this.propMeta,this.meta&&(this.observer=he(this.meta))},setLoading(e){this.loading=e},async metadataSave(){await this.checkRelationships(!0)},onMetaUpdated(){this.checkRelationships(!1)},async checkRelationships(e){var t,n;this.loading=!0;const o={data:{name:(t=this.businessModel)==null?void 0:t.name,id:(n=this.businessModel)==null?void 0:n.id},diff:z(this.observer)};await this.$http.post("/knowagemeta/restful-services/1.0/metaWeb/checkRelationships",o).then(async d=>{this.observer=_(this.observer,d.data).newDocument,this.observer=he(this.meta),this.metaUpdated=!this.metaUpdated,e&&(d.data.incorrectRelationships.length===0?await this.generateModel():(this.invalidRelationshipsDialogVisible=!0,this.incorrectRelationships=d.data.incorrectRelationships))}).catch(()=>{}),this.loading=!1},async generateModel(){var o,t;const e={data:{name:(o=this.businessModel)==null?void 0:o.name,id:(t=this.businessModel)==null?void 0:t.id},diff:z(this.observer)};await this.$http.post("/knowagemeta/restful-services/1.0/metaWeb/generateModel",e).then(()=>{this.setInfo({title:this.$t("common.toast.createTitle"),msg:this.$t("common.toast.success")}),this.$emit("modelGenerated")}).catch(()=>{}).finally(()=>this.invalidRelationshipsDialogVisible=!1)},closeMetawebConfirm(){this.$confirm.require({header:this.$t("metaweb.exitFromMeta"),accept:()=>{this.$emit("closeMetaweb"),this.meta=null,this.observer=null,this.incorrectRelationships=[]}})}}}),Ss={class:"metaweb-tab-container p-d-flex p-flex-column kn-flex"};function Is(e,o,t,n,d,h){const k=s("Button"),m=s("Toolbar"),f=s("ProgressBar"),p=s("BusinessModelTab"),b=s("TabPanel"),g=s("MetawebPhysicalModel"),M=s("TabView"),u=s("MetawebInvalidRelationshipsDialog"),v=s("Dialog"),E=ee("tooltip");return c(),C(v,{class:"metaweb-dialog remove-padding p-fluid kn-dialog--toolbar--primary",contentStyle:e.mainDescriptor.style.flex,visible:e.visible,modal:!1,closable:!1,position:"right",baseZIndex:1,autoZIndex:!0},{header:i(()=>[r(m,{class:"kn-toolbar kn-toolbar--primary p-p-0 p-m-0 p-col-12"},{start:i(()=>[A(l(e.$t("metaweb.title")),1)]),end:i(()=>[N(r(k,{icon:"pi pi-save",class:"p-button-text p-button-rounded p-button-plain",onClick:e.metadataSave},null,8,["onClick"]),[[E,e.$t("common.save"),void 0,{bottom:!0}]]),N(r(k,{icon:"pi pi-times",class:"p-button-text p-button-rounded p-button-plain",onClick:e.closeMetawebConfirm},null,8,["onClick"]),[[E,e.$t("common.close"),void 0,{bottom:!0}]])]),_:1})]),default:i(()=>[a("div",Ss,[e.loading?(c(),C(f,{key:0,class:"kn-progress-bar",mode:"indeterminate","data-test":"progress-bar"})):x("",!0),r(M,{class:"metaweb-tabview p-d-flex p-flex-column kn-flex"},{default:i(()=>[r(b,null,{header:i(()=>[a("span",null,l(e.$t("metaweb.businessModel.title")),1)]),default:i(()=>[r(p,{businessModelId:e.businessModel.dataSourceId,propMeta:e.meta,observer:e.observer,metaUpdated:e.metaUpdated,onMetaUpdated:e.onMetaUpdated},null,8,["businessModelId","propMeta","observer","metaUpdated","onMetaUpdated"])]),_:1}),r(b,null,{header:i(()=>[a("span",null,l(e.$t("metaweb.physicalModel.title")),1)]),default:i(()=>[r(g,{propMeta:e.meta,observer:e.observer,onLoading:e.setLoading},null,8,["propMeta","observer","onLoading"])]),_:1})]),_:1})]),r(u,{visible:e.invalidRelationshipsDialogVisible,propIncorrectRelationships:e.incorrectRelationships,onClose:o[0]||(o[0]=w=>e.invalidRelationshipsDialogVisible=!1),onSave:e.generateModel},null,8,["visible","propIncorrectRelationships","onSave"])]),_:1},8,["contentStyle","visible"])}var Ns=B(Bs,[["render",Is]]);const Us=V({name:"business-model-details-card",components:{Card:le,Dialog:R,Dropdown:K,GenerateDatamartCard:Uo,InputSwitch:ve,KnInputFile:He,KnValidationMessages:ae,KnOverlaySpinnerPanel:We,MetawebSelectDialog:Xo,Metaweb:Ns},props:{selectedBusinessModel:{type:Object,required:!0},domainCategories:{type:Array,required:!0},datasourcesMeta:{type:Array,required:!0},user:{type:Object},toGenerate:{type:Boolean},readonly:{type:Boolean},businessModelVersions:{type:Array}},emits:["fieldChanged","fileUploaded","datamartGenerated","modelGenerated"],watch:{selectedBusinessModel(){this.v$.$reset(),this.loadBusinessModel()},domainCategories(){this.loadCategories()},datasourcesMeta(){this.loadDatasources()}},computed:{metaModelUrl(){var e;return`/knowagemeta/restful-services/1.0/pages/edit?datasourceId=${this.businessModel.dataSourceId}&user_id=${(e=this.user)==null?void 0:e.userUniqueIdentifier}&bmId=${this.businessModel.id}&bmName=${this.businessModel.name}`}},setup(){return{store:L()}},created(){this.loadBusinessModel(),this.loadCategories(),this.loadDatasources()},data(){return{businessModelDetailsCardDescriptor:mo,businessModelDetailsCardValidation:$e,businessModel:{},categories:[],datasources:[],metaWebVisible:!1,generateDatamartVisible:!1,metawebSelectDialogVisible:!1,metawebDialogVisible:!1,meta:null,touched:!1,v$:G(),loading:!1,prefixesTouched:!1,saveConfirmVisible:!1}},validations(){return{businessModel:re("businessModel",$e.validations.businessModel)}},methods:{loadBusinessModel(){this.businessModel={...this.selectedBusinessModel}},loadCategories(){this.categories=this.domainCategories},loadDatasources(){this.datasources=this.datasourcesMeta},uploadFile(e){this.$emit("fileUploaded",e.target.files[0])},onFieldChange(e,o){(e==="tablePrefixLike"||e==="tablePrefixNotLike")&&(this.prefixesTouched=!0),this.$emit("fieldChanged",{fieldName:e,value:o})},onLockedChange(){this.$emit("fieldChanged",{fieldName:"modelLocked",value:this.businessModel.modelLocked})},onSmartViewChange(){this.$emit("fieldChanged",{fieldName:"smartView",value:this.businessModel.smartView})},async goToMetaWeb(){var e;this.prefixesTouched?this.saveConfirmVisible=!0:(this.loading=!0,await this.createSession(),((e=this.businessModelVersions)==null?void 0:e.length)===0?this.metawebSelectDialogVisible=!0:await this.loadModelFromSession(),this.loading=!1)},onDatamartGenerated(){this.$emit("datamartGenerated")},onMetaSelect(e){this.meta=e,this.metawebSelectDialogVisible=!1,this.metawebDialogVisible=!0},async loadModelFromSession(){await this.$http.get("/knowagemeta/restful-services/1.0/metaWeb/model").then(e=>{this.meta=e.data,this.metawebDialogVisible=!0}).catch(()=>{})},async createSession(){var o,t,n;let e=`/1.0/pages/edit?datasourceId=${(o=this.businessModel)==null?void 0:o.dataSourceId}&user_id=${this.store.$state.user.userUniqueIdentifier}&bmId=${(t=this.businessModel)==null?void 0:t.id}&bmName=${(n=this.businessModel)==null?void 0:n.name}`;this.businessModel.tablePrefixLike&&(e+=`&tablePrefixLike=${this.businessModel.tablePrefixLike}`),this.businessModel.tablePrefixNotLike&&(e+=`&tablePrefixNotLike=${this.businessModel.tablePrefixNotLike}`),await this.$http.get("/knowagemeta/restful-services"+e,{headers:{Accept:"application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9"}}).then(()=>{}).catch(()=>{})}}}),_s={class:"p-fluid p-m-5"},Os={class:"p-field"},Fs={class:"p-float-label"},Rs={for:"label",class:"kn-material-input-label"},Ls={class:"p-field"},Ps={class:"p-float-label"},qs={for:"description",class:"kn-material-input-label"},js={class:"p-field"},Xs={for:"category",class:"kn-material-input-label"},Qs={key:0},Ks={class:"p-field"},Gs={for:"dataSourceLabel",class:"kn-material-input-label"},Js={key:0},Ys={class:"p-d-flex p-flex-row"},Hs={class:"input-container"},Ws={for:"upload",class:"kn-material-input-label"},Zs={class:"input-container p-d-flex p-flex-row"},ed={class:"p-m-2"},od={class:"p-m-2"},td={class:"input-container"},ad={class:"p-d-flex p-flex-row"},rd={key:0,class:"p-mr-2"},nd={for:"enable-metadata",class:"kn-material-input-label"},id={for:"model-lock",class:"kn-material-input-label"},ld={class:"p-mt-2"},sd={for:"smart-view",class:"kn-material-input-label"},dd={key:0,class:"p-mt-5"},cd={class:"fa fa-info-circle"},pd={class:"p-fluid p-m-5"},bd={class:"p-field p-d-flex"},kd={class:"kn-flex"},ud={class:"p-float-label p-mr-2"},md={for:"label",class:"kn-material-input-label"},gd={class:"kn-flex"},fd={class:"p-float-label"},hd={for:"label",class:"kn-material-input-label"};function vd(e,o,t,n,d,h){const k=s("Toolbar"),m=s("InputText"),f=s("KnValidationMessages"),p=s("Dropdown"),b=s("KnInputFile"),g=s("Button"),M=s("InputSwitch"),u=s("GenerateDatamartCard"),v=s("MetawebSelectDialog"),E=s("Metaweb"),w=s("KnOverlaySpinnerPanel"),$=s("Dialog"),P=s("Card"),oe=ee("tooltip");return c(),C(P,null,{header:i(()=>[r(k,{class:"kn-toolbar kn-toolbar--primary"},{start:i(()=>[A(l(e.$t("managers.businessModelManager.details")),1)]),_:1})]),content:i(()=>[a("form",_s,[a("div",Os,[a("span",Fs,[r(m,{id:"name",class:U(["kn-material-input",{"p-invalid":e.v$.businessModel.name.$invalid&&e.v$.businessModel.name.$dirty}]),type:"text",modelValue:e.v$.businessModel.name.$model,"onUpdate:modelValue":o[0]||(o[0]=D=>e.v$.businessModel.name.$model=D),modelModifiers:{trim:!0},maxLength:"100",disabled:e.businessModel.id,onBlur:o[1]||(o[1]=D=>e.v$.businessModel.name.$touch()),onInput:o[2]||(o[2]=D=>e.onFieldChange("name",D.target.value)),"data-test":"name-input"},null,8,["modelValue","class","disabled"]),a("label",Rs,l(e.$t("common.name"))+" * ",1)]),r(f,{vComp:e.v$.businessModel.name,additionalTranslateParams:{fieldName:e.$t("common.name")}},null,8,["vComp","additionalTranslateParams"])]),a("div",Ls,[a("span",Ps,[r(m,{id:"description",class:U(["kn-material-input",{"p-invalid":e.v$.businessModel.description.$invalid&&e.v$.businessModel.description.$dirty}]),type:"text",modelValue:e.v$.businessModel.description.$model,"onUpdate:modelValue":o[3]||(o[3]=D=>e.v$.businessModel.description.$model=D),modelModifiers:{trim:!0},maxLength:"500",onBlur:o[4]||(o[4]=D=>e.v$.businessModel.description.$touch()),onInput:o[5]||(o[5]=D=>e.onFieldChange("description",D.target.value)),disabled:e.readonly,"data-test":"description-input"},null,8,["modelValue","class","disabled"]),a("label",qs,l(e.$t("managers.businessModelManager.description")),1)]),r(f,{vComp:e.v$.businessModel.description,additionalTranslateParams:{fieldName:e.$t("managers.businessModelManager.description")}},null,8,["vComp","additionalTranslateParams"])]),a("div",js,[a("span",null,[a("label",Xs,l(e.$t("common.category"))+" * ",1),r(p,{id:"category",class:U(["kn-material-input",{"p-invalid":e.v$.businessModel.category.$invalid&&e.v$.businessModel.category.$dirty}]),modelValue:e.v$.businessModel.category.$model,"onUpdate:modelValue":o[6]||(o[6]=D=>e.v$.businessModel.category.$model=D),options:e.categories,placeholder:e.$t("common.category"),disabled:e.readonly,onBeforeShow:o[7]||(o[7]=D=>e.v$.businessModel.category.$touch()),onChange:o[8]||(o[8]=D=>e.onFieldChange("category",D.value.VALUE_ID))},{value:i(D=>[D.value?(c(),y("div",Qs,[a("span",null,l(D.value.VALUE_NM),1)])):x("",!0)]),option:i(D=>[a("div",null,[a("span",null,l(D.option.VALUE_NM),1)])]),_:1},8,["class","modelValue","options","placeholder","disabled"])]),r(f,{vComp:e.v$.businessModel.category,additionalTranslateParams:{fieldName:e.$t("managers.businessModelManager.analyticalDriver")}},null,8,["vComp","additionalTranslateParams"])]),a("div",Ks,[a("span",null,[a("label",Gs,l(e.$t("managers.businessModelManager.dataSource"))+" * ",1),r(p,{id:"dataSourceLabel",class:U(["kn-material-input",{"p-invalid":e.v$.businessModel.dataSourceLabel.$invalid&&e.v$.businessModel.dataSourceLabel.$dirty}]),modelValue:e.v$.businessModel.dataSourceLabel.$model,"onUpdate:modelValue":o[9]||(o[9]=D=>e.v$.businessModel.dataSourceLabel.$model=D),options:e.datasources,placeholder:e.$t("managers.businessModelManager.dataSourceLabelPlaceholder"),disabled:e.readonly,onBeforeShow:o[10]||(o[10]=D=>e.v$.businessModel.dataSourceLabel.$touch()),onChange:o[11]||(o[11]=D=>e.onFieldChange("dataSourceLabel",D.value))},{value:i(D=>[D.value?(c(),y("div",Js,[a("span",null,l(D.value),1)])):x("",!0)]),option:i(D=>[a("div",null,[a("span",null,l(D.option),1)])]),_:1},8,["class","modelValue","options","placeholder","disabled"])]),r(f,{vComp:e.v$.businessModel.dataSourceLabel,additionalTranslateParams:{fieldName:e.$t("managers.businessModelManager.dataSource")}},null,8,["vComp","additionalTranslateParams"])]),a("div",Ys,[N(a("div",Hs,[a("label",Ws,l(e.$t("managers.businessModelManager.uploadFile"))+":",1),r(b,{changeFunction:e.uploadFile,visibility:!0},null,8,["changeFunction"])],512),[[ne,!e.metaWebVisible&&!e.readonly]]),a("div",Zs,[a("div",ed,[N(r(g,{class:"kn-button kn-button--primary",label:e.$t("managers.businessModelManager.metaWeb"),onClick:e.goToMetaWeb,"data-test":"metaweb-button"},null,8,["label","onClick"]),[[ne,e.metaWebVisible]])]),N(a("div",od,[N(r(g,{class:"kn-button kn-button--primary",label:e.$t("managers.businessModelManager.generate"),onClick:o[12]||(o[12]=D=>e.generateDatamartVisible=!0),"data-test":"generate-button"},null,8,["label"]),[[ne,e.metaWebVisible]])],512),[[ne,e.toGenerate]])]),a("div",td,[a("div",ad,[e.selectedBusinessModel.id?(c(),y("div",rd,[r(M,{id:"enable-metadata",class:"p-mr-2",modelValue:e.metaWebVisible,"onUpdate:modelValue":o[13]||(o[13]=D=>e.metaWebVisible=D),disabled:e.readonly,"data-test":"metaweb-switch"},null,8,["modelValue","disabled"]),a("label",nd,l(e.$t("managers.businessModelManager.enableMetaweb")),1)])):x("",!0),a("div",null,[r(M,{id:"model-lock",class:"p-mr-2",modelValue:e.businessModel.modelLocked,"onUpdate:modelValue":o[14]||(o[14]=D=>e.businessModel.modelLocked=D),disabled:e.readonly,onChange:e.onLockedChange},null,8,["modelValue","disabled","onChange"]),a("label",id,l(e.businessModel.modelLocked?e.$t("managers.businessModelManager.unlockModel"):e.$t("managers.businessModelManager.lockModel")),1)])]),a("div",ld,[r(M,{id:"smart-view",class:"p-mr-2",modelValue:e.businessModel.smartView,"onUpdate:modelValue":o[15]||(o[15]=D=>e.businessModel.smartView=D),disabled:e.readonly,onChange:e.onSmartViewChange},null,8,["modelValue","disabled","onChange"]),N((c(),y("label",sd,[A(l(e.businessModel.smartView?e.$t("managers.businessModelManager.smartView"):e.$t("managers.businessModelManager.advancedView")),1)])),[[oe,e.$t("managers.businessModelManager.smartViewTooltip"),void 0,{bottom:!0}]])])])]),e.metaWebVisible?(c(),y("div",dd,[r(k,{class:"kn-toolbar kn-toolbar--secondary"},{start:i(()=>[A(l(e.$t("managers.businessModelManager.configurationTablePrefixTitle")),1)]),end:i(()=>[N(a("i",cd,null,512),[[oe,e.$t("managers.businessModelManager.prefixTooltip"),void 0,{bottom:!0}]])]),_:1}),a("div",pd,[a("div",bd,[a("div",kd,[a("span",ud,[N(r(m,{id:"tablePrefixLike",class:U(["kn-material-input",{"p-invalid":e.v$.businessModel.tablePrefixLike.$invalid&&e.v$.businessModel.tablePrefixLike.$dirty}]),type:"text",modelValue:e.v$.businessModel.tablePrefixLike.$model,"onUpdate:modelValue":o[16]||(o[16]=D=>e.v$.businessModel.tablePrefixLike.$model=D),modelModifiers:{trim:!0},maxLength:"500",disabled:e.readonly,onBlur:o[17]||(o[17]=D=>e.v$.businessModel.tablePrefixLike.$touch()),onInput:o[18]||(o[18]=D=>e.onFieldChange("tablePrefixLike",D.target.value)),"data-test":"prefix-input"},null,8,["modelValue","class","disabled"]),[[oe,e.$t("managers.businessModelManager.tablePrefixLikeExampleTooltip"),void 0,{bottom:!0}]]),a("label",md,l(e.$t("managers.businessModelManager.tablePrefixLike")),1)]),r(f,{vComp:e.v$.businessModel.tablePrefixLike,additionalTranslateParams:{fieldName:e.$t("managers.businessModelManager.tablePrefixLike")}},null,8,["vComp","additionalTranslateParams"])]),a("div",gd,[a("span",fd,[N(r(m,{id:"tablePrefixNotLike",class:U(["kn-material-input",{"p-invalid":e.v$.businessModel.tablePrefixNotLike.$invalid&&e.v$.businessModel.tablePrefixNotLike.$dirty}]),type:"text",modelValue:e.v$.businessModel.tablePrefixNotLike.$model,"onUpdate:modelValue":o[19]||(o[19]=D=>e.v$.businessModel.tablePrefixNotLike.$model=D),modelModifiers:{trim:!0},maxLength:"500",disabled:e.readonly,onBlur:o[20]||(o[20]=D=>e.v$.businessModel.tablePrefixNotLike.$touch()),onInput:o[21]||(o[21]=D=>e.onFieldChange("tablePrefixNotLike",D.target.value)),"data-test":"prefix-not-like-input"},null,8,["modelValue","class","disabled"]),[[oe,e.$t("managers.businessModelManager.tablePrefixNotLikeExampleTooltip"),void 0,{bottom:!0}]]),a("label",hd,l(e.$t("managers.businessModelManager.tablePrefixNotLike")),1)]),r(f,{vComp:e.v$.businessModel.tablePrefixNotLike,additionalTranslateParams:{fieldName:e.$t("managers.businessModelManager.tablePrefixNotLike")}},null,8,["vComp","additionalTranslateParams"])])])])])):x("",!0)]),e.generateDatamartVisible?(c(),C(u,{key:0,businessModel:e.selectedBusinessModel,user:e.user,onClose:o[22]||(o[22]=D=>e.generateDatamartVisible=!1),onGenerated:e.onDatamartGenerated},null,8,["businessModel","user","onGenerated"])):x("",!0),r(v,{visible:e.metawebSelectDialogVisible,selectedBusinessModel:e.selectedBusinessModel,onClose:o[23]||(o[23]=D=>e.metawebSelectDialogVisible=!1),onMetaSelected:e.onMetaSelect},null,8,["visible","selectedBusinessModel","onMetaSelected"]),r(E,{visible:e.metawebDialogVisible,propMeta:e.meta,businessModel:e.businessModel,onCloseMetaweb:o[24]||(o[24]=D=>e.metawebDialogVisible=!1),onModelGenerated:o[25]||(o[25]=D=>e.$emit("modelGenerated"))},null,8,["visible","propMeta","businessModel"]),r(w,{id:"metaweb-spinner",visibility:e.loading},null,8,["visibility"]),r($,{visible:e.saveConfirmVisible,modal:!0,closable:!1},{footer:i(()=>[r(g,{class:"kn-button kn-button--primary",onClick:o[26]||(o[26]=D=>e.saveConfirmVisible=!1)},{default:i(()=>[A(l(e.$t("common.ok")),1)]),_:1})]),default:i(()=>[A(l(e.$t("managers.businessModelManager.saveRequired"))+" ",1)]),_:1},8,["visible"])]),_:1})}var wd=B(Us,[["render",vd]]);const yd={style:{"min-width":"60%"}},xd={filterOperation:{style:{margin:"0.5rem",width:"50%"}},logicOperator:{style:{margin:"0.5rem",width:"20%"}},parFather:{style:{margin:"0.5rem",width:"30%"}}},Md=[{name:"AND",value:"AND"},{name:"OR",value:"OR"}],Cd={insert:{toastTitle:"common.toast.createTitle"},success:"common.toast.success",update:{toastTitle:"common.toast.updateTitle"}},Ad=[{name:"equal",value:"equal"},{name:"greater",value:"greater"},{name:"greaterequal",value:"greaterequal"},{name:"less",value:"less"},{name:"lessequal",value:"lessequal"},{name:"contains",value:"contains"},{name:"not contains",value:"not contains"},{name:"starts with",value:"starts with"},{name:"ends with",value:"ends with"}];var $d={conditionDialog:yd,input:xd,logicOperator:Md,operation:Cd,operations:Ad};const Dd={driver:[{fieldName:"label",validators:[{key:"required"},{key:"regex",validator:{type:"extendedAlphanumericRegex"}}]},{fieldName:"parameter",validators:[{key:"required"}]},{fieldName:"parameterUrlName",validators:[{key:"required"},{key:"regex",validator:{type:"alphanumericNoSpaces"}},{key:"custom_unique",validator:{type:"custom-unique"}}]}]};var ze={validations:Dd};const Ed=V({name:"business-model-driver-detail-card",components:{Card:le,Checkbox:se,Dialog:R,Dropdown:K,InputSwitch:ve,KnHint:co,KnValidationMessages:ae,Listbox:H},props:{businessModelId:{type:Number},selectedDriver:{value:[Object,null],required:!0},formVisible:{type:Boolean},driverOptions:{type:Array,required:!0},businessModelDrivers:{type:Array,required:!0},readonly:{type:Boolean}},emits:["touched"],watch:{async selectedDriver(){this.loadSelectedDriver(),this.driver&&(await this.loadDataDependencies(),this.driver.parameter&&(await this.loadModes(),await this.loadLovs()))},driverOptions(){this.loadAnalyticalDrivers()},businessModelDrivers(){this.loadBusinessModelDrivers()}},setup(){return{store:L()}},async created(){this.loadSelectedDriver(),this.loadAnalyticalDrivers(),this.loadBusinessModelDrivers(),this.selectedDriver&&(await this.loadDataDependencies(),await this.loadModes(),await this.loadLovs())},data(){return{businessModelDriverDetailDescriptor:$d,businessModelDriverDetailValidationDescriptor:ze,driver:null,drivers:[],oldDropdownValue:null,analyticalDrivers:[],condition:{},conditions:[],originalModalities:[],lovs:[],modes:[],selectedModes:[],modesToDelete:[],modalities:{},touched:!1,conditionFormVisible:!1,operation:"insert",errorMessage:"",displayWarning:!1,v$:G()}},validations(){const e={"custom-unique":t=>this.urlNotUnique(t)};return{driver:re("driver",ze.validations.driver,e)}},methods:{loadSelectedDriver(){this.oldDropdownValue=null,this.driver=this.selectedDriver,this.driver&&(this.driver.parameter&&(this.oldDropdownValue=this.driver.parameter),this.driver.id||(this.v$.driver.label.$touch(),this.v$.driver.parameter.$touch(),this.v$.driver.parameterUrlName.$touch()))},loadAnalyticalDrivers(){this.analyticalDrivers=this.driverOptions},loadBusinessModelDrivers(){this.drivers=this.businessModelDrivers},async loadDataDependencies(){this.conditions=[],this.driver&&this.driver.id&&await this.$http.get(`/knowage/restful-services/2.0/businessmodels/${this.businessModelId}/datadependencies?driverId=${this.driver.id}`).then(e=>e.data.forEach(o=>{const t=this.conditions.findIndex(n=>n.parFatherId===o.parFatherId&&n.filterOperation==o.filterOperation&&n.logicOperator==o.logicOperator);o.modalities=[],o.modalities.push({conditionId:o.id,useModeId:o.useModeId,filterColumn:o.filterColumn}),t>-1?this.conditions[t].modalities.push({conditionId:o.id,useModeId:o.useModeId,filterColumn:o.filterColumn}):this.conditions.push(o)}))},async loadModes(){var e,o;await this.$http.get(`/knowage/restful-services/2.0/analyticalDrivers/${(o=(e=this.driver)==null?void 0:e.parameter)==null?void 0:o.id}/modes`).then(t=>this.modes=t.data)},async loadLovs(){var e,o;await this.$http.get(`/knowage/restful-services/2.0/analyticalDrivers/${(o=(e=this.driver)==null?void 0:e.parameter)==null?void 0:o.id}/lovs`).then(t=>this.lovs=t.data)},getLovs(e){const o=this.lovs.findIndex(t=>t.id===e);if(o>-1){const t=JSON.parse(this.lovs[o].lovProviderJSON);return t.QUERY?t.QUERY["VISIBLE-COLUMNS"].split(","):[]}},isModeActive(e){return this.selectedModes.findIndex(t=>t===e)===-1},urlNotUnique(e){return this.drivers.findIndex(t=>{var n;return t.parameterUrlName===e&&t.id!=((n=this.driver)==null?void 0:n.id)})===-1},showAnalyticalDropdownConfirm(){this.oldDropdownValue&&this.$confirm.require({message:this.$t("managers.businessModelManager.analyticalDropdownConfirm"),header:this.$t("common.toast.deleteTitle"),icon:"pi pi-exclamation-triangle",accept:()=>this.deleteAllConditions(),reject:()=>this.resetDrodpwonValue()}),this.setChanged()},resetDrodpwonValue(){this.driver&&(this.driver.parameter=this.oldDropdownValue)},async saveCondition(e){await this.$http.post(`/knowage/restful-services/2.0/businessmodels/${this.businessModelId}/datadependencies`,e).finally(()=>this.conditionFormVisible=!1)},async handleSubmit(){this.condition.id&&(this.operation="update");const e=Object.keys(this.modalities);for(let o=0;o<this.selectedModes.length;o++)for(let t=0;t<e.length;t++)if(this.selectedModes[o]===+e[t]){const n={...this.condition,parFatherId:""+this.condition.parFatherId,parFatherUrlName:this.getDriverProperty(this.condition.parFatherId,"parameterUrlName"),parId:this.selectedDriver.id,useModeId:+e[t],filterColumn:this.modalities[this.selectedModes[o]]};if(this.operation==="update"){const d=this.originalModalities.findIndex(h=>h.conditionId===n.id);d>-1&&this.originalModalities.splice(d,1)}n.prog||(n.prog=0),n.prog++,delete n.parFather,delete n.modalities,await this.sendRequest(`/knowage/restful-services/2.0/businessmodels/${this.businessModelId}/datadependencies`,n).then(d=>{d.data.errors?(this.errorMessage=d.data.errors[0].message,this.displayWarning=!0):this.store.setInfo({title:this.$t(this.businessModelDriverDetailDescriptor.operation[this.operation].toastTitle),msg:this.$t(this.businessModelDriverDetailDescriptor.operation.success)})})}this.originalModalities.forEach(o=>{this.deleteCondition({...this.condition,id:o.conditionId,parFatherId:this.condition.parFatherId,parFatherUrlName:this.selectedDriver.parameterUrlName,parId:this.selectedDriver.id,useModeId:o.useModeId,filterColumn:o.filterColumn})}),this.originalModalities=[],this.loadData()},sendRequest(e,o){return this.operation==="insert"?this.$http.post(e,o):this.$http.put(e,o)},showForm(e){this.originalModalities=[],this.selectedModes=[],e.value?(this.condition={...e.value,parFather:this.selectedDriver},this.condition.modalities.forEach(o=>{this.originalModalities.push(o),this.selectedModes.push(o.useModeId),this.modalities[o.useModeId]=o.filterColumn})):this.condition={parFather:this.drivers[0],filterOperation:"equal",logicOperator:"AND"},this.conditionFormVisible=!0},setChanged(){this.driver&&(this.driver.status="CHANGED",this.driver.numberOfErrors=this.v$.$errors.length)},closeForm(){this.conditionFormVisible=!1},showConditionDeleteDialog(e){this.$confirm.require({message:this.$t("common.toast.deleteMessage"),header:this.$t("common.toast.deleteConfirmTitle"),icon:"pi pi-exclamation-triangle",accept:()=>this.deleteConditions(e)})},async deleteConditions(e){e.modalities.forEach(o=>{this.deleteCondition({...e,id:o.conditionId,useModeId:o.useModeId,filterColumn:o.filterColumn})})},async deleteCondition(e){delete e.parFather,delete e.modalities,await this.$http.post(`/knowage/restful-services/2.0/businessmodels/${this.businessModelId}/datadependencies/delete`,e).then(()=>{this.store.setInfo({title:this.$t("common.toast.deleteTitle"),msg:this.$t("common.toast.deleteSuccess")}),this.loadData()})},deleteAllConditions(){var e;this.setChanged(),this.oldDropdownValue=(e=this.driver)==null?void 0:e.parameter,this.conditions.forEach(o=>this.deleteCondition(o))},loadData(){this.loadDataDependencies(),this.loadModes(),this.loadLovs(),this.selectedModes=[],this.condition={},this.operation="insert",this.conditionFormVisible=!1},getDriverProperty(e,o){const t=this.drivers.findIndex(n=>n.id===e);return t!==-1?this.drivers[t][o]:""}}}),Fe=e=>(Ze("data-v-42a0f834"),e=e(),eo(),e),Td={key:1,class:"p-fluid p-m-5"},zd={class:"p-field"},Vd={class:"p-float-label"},Bd={for:"label",class:"kn-material-input-label"},Sd={class:"p-field"},Id={for:"parameter",class:"kn-material-input-label"},Nd={key:0},Ud={class:"p-field"},_d={class:"p-float-label"},Od={for:"parameterUrlName",class:"kn-material-input-label"},Fd={class:"p-field p-mt-2"},Rd=Fe(()=>a("i",{class:"fa fa-list p-mr-2"},null,-1)),Ld={for:"driver-multivalue ",class:"kn-material-input-label"},Pd={class:"kn-list--column"},qd={class:"p-col"},jd={class:"kn-list-item"},Xd={class:"kn-list-item-text"},Qd={key:1},Kd={id:"operationInfo"},Gd={class:"p-fluid p-m-5"},Jd={class:"p-field p-d-flex"},Yd={class:"p-float-label"},Hd={key:0},Wd={for:"parFather",class:"kn-material-input-label"},Zd={class:"p-float-label"},ec={for:"filterOperation",class:"kn-material-input-label"},oc={class:"p-float-label"},tc={for:"logicOperator",class:"kn-material-input-label"},ac=Fe(()=>a("hr",null,null,-1)),rc={class:"p-d-flex p-ai-center"},nc={class:"mode-inputs"},ic={class:"mode-inputs"},lc={class:"kn-material-input-label"},sc={key:0};function dc(e,o,t,n,d,h){const k=s("Toolbar"),m=s("KnHint"),f=s("InputText"),p=s("KnValidationMessages"),b=s("Dropdown"),g=s("InputSwitch"),M=s("Card"),u=s("Button"),v=s("Listbox"),E=s("Checkbox"),w=s("Dialog");return c(),y(I,null,[r(M,null,{header:i(()=>[r(k,{class:"kn-toolbar kn-toolbar--primary"},{start:i(()=>[A(l(e.$t("managers.businessModelManager.driversDetails")),1)]),_:1})]),content:i(()=>[e.selectedDriver?(c(),y("form",Td,[a("div",zd,[a("span",Vd,[r(f,{id:"label",class:U(["kn-material-input",{"p-invalid":e.v$.driver.label.$invalid&&e.v$.driver.label.$dirty}]),type:"text",modelValue:e.v$.driver.label.$model,"onUpdate:modelValue":o[0]||(o[0]=$=>e.v$.driver.label.$model=$),modelModifiers:{trim:!0},maxLength:"40",onBlur:o[1]||(o[1]=$=>e.v$.driver.label.$touch()),onInput:e.setChanged,disabled:e.readonly,"data-test":"label-input"},null,8,["modelValue","class","onInput","disabled"]),a("label",Bd,l(e.$t("managers.businessModelManager.driverTitle"))+" * ",1)]),r(p,{vComp:e.v$.driver.label,additionalTranslateParams:{fieldName:e.$t("managers.businessModelManager.driverTitle")}},null,8,["vComp","additionalTranslateParams"])]),a("div",Sd,[a("span",null,[a("label",Id,l(e.$t("managers.businessModelManager.analyticalDriver"))+" * ",1),r(b,{id:"parameter",class:U(["kn-material-input",{"p-invalid":e.v$.driver.parameter.$invalid&&e.v$.driver.parameter.$dirty}]),modelValue:e.v$.driver.parameter.$model,"onUpdate:modelValue":o[2]||(o[2]=$=>e.v$.driver.parameter.$model=$),options:e.analyticalDrivers,placeholder:e.$t("managers.businessModelManager.analyticalDriverPlaceholder"),filter:!0,filterMatchMode:"contains",filterFields:["label"],disabled:e.readonly,onBeforeShow:o[3]||(o[3]=$=>e.v$.driver.parameter.$touch()),onChange:e.showAnalyticalDropdownConfirm},{value:i($=>[$.value?(c(),y("div",Nd,[a("span",null,l($.value.label),1)])):x("",!0)]),option:i($=>[a("div",null,[a("span",null,l($.option.label),1)])]),_:1},8,["class","modelValue","options","placeholder","disabled","onChange"])]),r(p,{vComp:e.v$.driver.parameter,additionalTranslateParams:{fieldName:e.$t("managers.businessModelManager.analyticalDriver")}},null,8,["vComp","additionalTranslateParams"])]),a("div",Ud,[a("span",_d,[r(f,{id:"parameterUrlName",class:U(["kn-material-input",{"p-invalid":e.v$.driver.parameterUrlName.$invalid&&e.v$.driver.parameterUrlName.$dirty}]),type:"text",modelValue:e.v$.driver.parameterUrlName.$model,"onUpdate:modelValue":o[4]||(o[4]=$=>e.v$.driver.parameterUrlName.$model=$),modelModifiers:{trim:!0},maxLength:"20",disabled:e.readonly,onBlur:o[5]||(o[5]=$=>e.v$.driver.parameterUrlName.$touch()),onInput:e.setChanged,"data-test":"parameterUrlName-input"},null,8,["modelValue","class","disabled","onInput"]),a("label",Od,l(e.$t("managers.businessModelManager.driversUrl"))+" * ",1)]),r(p,{vComp:e.v$.driver.parameterUrlName,additionalTranslateParams:{fieldName:e.$t("managers.businessModelManager.driversUrl")},specificTranslateKeys:{custom_unique:"managers.businessModelManager.driversUrlNotUnique"}},null,8,["vComp","additionalTranslateParams","specificTranslateKeys"])]),a("div",Fd,[r(g,{id:"driver-multivalue ",class:"p-mr-2",modelValue:e.driver.multivalue,"onUpdate:modelValue":o[6]||(o[6]=$=>e.driver.multivalue=$),disabled:e.readonly,onChange:e.setChanged},null,8,["modelValue","disabled","onChange"]),Rd,a("label",Ld,l(e.$t("managers.businessModelManager.multivalue")),1)])])):(c(),C(m,{key:0,title:"managers.businessModelManager.drivers",hint:"managers.businessModelManager.noDriverSelected","data-test":"driver-hint"},null,8,["title","hint"]))]),_:1}),e.selectedDriver?(c(),C(M,{key:0},{header:i(()=>[r(k,{class:"kn-toolbar kn-toolbar--primary"},{start:i(()=>[A(l(e.$t("managers.businessModelManager.driverDataConditions")),1)]),end:i(()=>[r(u,{class:"kn-button p-button-text",onClick:e.showForm,disabled:e.modes.length===0||!e.driver.id||e.readonly},{default:i(()=>[A(l(e.$t("managers.businessModelManager.addCondition")),1)]),_:1},8,["onClick","disabled"])]),_:1})]),content:i(()=>[a("div",Pd,[a("div",qd,[r(v,{class:"kn-list",options:e.conditions,listStyle:"max-height:calc(100% - 62px)",onChange:e.showForm},{empty:i(()=>[A(l(e.$t("common.info.noDataFound")),1)]),option:i($=>[a("div",jd,[a("div",Xd,[a("span",null,l($.option.filterOperation+" "+e.$t("managers.businessModelManager.value")+" "+$.option.parFatherUrlName),1)]),r(u,{icon:"far fa-trash-alt",class:"p-button-link p-button-sm",disabled:e.readonly,onClick:Q(P=>e.showConditionDeleteDialog($.option),["stop"])},null,8,["disabled","onClick"])])]),_:1},8,["options","onChange"])])])]),_:1})):x("",!0),e.conditionFormVisible?(c(),y("div",Qd,[r(w,{class:"p-fluid kn-dialog--toolbar--primary",style:T(e.businessModelDriverDetailDescriptor.conditionDialog.style),visible:!0,modal:!0,header:e.$t("managers.businessModelManager.driverDataConditions"),closable:!1},{footer:i(()=>[r(u,{class:"kn-button kn-button--secondary",label:e.$t("common.close"),onClick:e.closeForm},null,8,["label","onClick"]),r(u,{class:"kn-button kn-button--primary",label:e.$t("common.save"),disabled:e.readonly,onClick:e.handleSubmit},null,8,["label","disabled","onClick"])]),default:i(()=>[a("div",Kd,[a("p",null,l(e.$t("managers.businessModelManager.operationInfo",{driver:e.driver.label})),1)]),a("form",Gd,[a("div",Jd,[a("div",{style:T(e.businessModelDriverDetailDescriptor.input.parFather.style)},[a("span",Yd,[r(b,{id:"parFather",class:"kn-material-input",modelValue:e.condition.parFatherId,"onUpdate:modelValue":o[7]||(o[7]=$=>e.condition.parFatherId=$),options:e.drivers,placeholder:" ",optionValue:"id",disabled:e.readonly},{value:i($=>[$.value?(c(),y("div",Hd,[a("span",null,l(e.getDriverProperty($.value,"label")),1)])):x("",!0)]),option:i($=>[a("div",null,[a("span",null,l($.option.label),1)])]),_:1},8,["modelValue","options","disabled"]),a("label",Wd,l(e.$t("managers.businessModelManager.driverDepends")),1)])],4),a("div",{style:T(e.businessModelDriverDetailDescriptor.input.filterOperation.style)},[a("span",Zd,[r(b,{id:"filterOperation",class:"kn-material-input",modelValue:e.condition.filterOperation,"onUpdate:modelValue":o[8]||(o[8]=$=>e.condition.filterOperation=$),options:e.businessModelDriverDetailDescriptor.operations,optionLabel:"name",optionValue:"value",disabled:e.readonly},null,8,["modelValue","options","disabled"]),a("label",ec,l(e.$t("managers.businessModelManager.filterOperator")),1)])],4),a("div",{style:T(e.businessModelDriverDetailDescriptor.input.logicOperator.style)},[a("span",oc,[r(b,{id:"logicOperator",class:"kn-material-input",modelValue:e.condition.logicOperator,"onUpdate:modelValue":o[9]||(o[9]=$=>e.condition.logicOperator=$),options:e.businessModelDriverDetailDescriptor.logicOperator,optionLabel:"name",optionValue:"value",disabled:e.readonly},null,8,["modelValue","options","disabled"]),a("label",tc,l(e.$t("managers.businessModelManager.logicOperator")),1)])],4)]),(c(!0),y(I,null,F(e.modes,$=>(c(),y("div",{key:$.useID},[ac,a("p",null,l(e.$t("managers.businessModelManager.modality")+": "+$.name),1),a("div",rc,[a("div",nc,[r(E,{class:"p-mr-2",value:$.useID,modelValue:e.selectedModes,"onUpdate:modelValue":o[10]||(o[10]=P=>e.selectedModes=P),disabled:e.readonly},null,8,["value","modelValue","disabled"]),a("label",null,l(e.$t("managers.businessModelManager.check")),1)]),a("div",ic,[a("label",lc,l(e.$t("managers.businessModelManager.lovsColumn")),1),r(b,{id:"parFather",class:"kn-material-input",modelValue:e.modalities[$.useID],"onUpdate:modelValue":P=>e.modalities[$.useID]=P,options:e.getLovs($.idLov),placeholder:e.$t("managers.businessModelManager.lovsColumnSelect"),disabled:e.isModeActive($.useID)||e.readonly},{value:i(P=>[P.value?(c(),y("div",sc,[a("span",null,l(P.value),1)])):x("",!0)]),option:i(P=>[a("div",null,[a("span",null,l(P.option),1)])]),_:2},1032,["modelValue","onUpdate:modelValue","options","placeholder","disabled"])])])]))),128))])]),_:1},8,["style","header"])])):x("",!0),r(w,{header:"Error",visible:e.displayWarning,"onUpdate:visible":o[12]||(o[12]=$=>e.displayWarning=$)},{footer:i(()=>[r(u,{label:"Ok",icon:"pi pi-check",onClick:o[11]||(o[11]=$=>e.displayWarning=!1)})]),default:i(()=>[a("p",null,l(e.errorMessage),1)]),_:1},8,["visible"])],64)}var cc=B(Ed,[["render",dc],["__scopeId","data-v-42a0f834"]]);const pc=V({name:"business-model-drivers-card",components:{BuisnessModelDriverDetail:cc,Card:le,Listbox:H},props:{id:{type:Number,required:!0},drivers:{type:Array,required:!0},driversOptions:{type:Array,required:!0},readonly:{type:Boolean}},emits:["delete"],data(){return{businessModelDrivers:[],driversForDelete:[],analyticalDrivers:[],selectedDriver:null,formVisible:!1}},watch:{drivers(){this.selectedDriver=null,this.loadDrivers()},driversOptions(){this.loadAnalyticalDrivers()}},created(){this.loadDrivers(),this.loadAnalyticalDrivers()},methods:{loadDrivers(){this.businessModelDrivers=this.drivers},loadAnalyticalDrivers(){this.analyticalDrivers=this.driversOptions},showForm(e){e.value?this.selectedDriver=e.value:(this.selectedDriver={biMetaModelID:this.id,modifiable:0,priority:this.businessModelDrivers.length+1,required:!0,visible:!0,multivalue:!1,numberOfErrors:1},this.businessModelDrivers.push(this.selectedDriver)),this.selectedDriver&&this.selectedDriver.parameter&&(this.selectedDriver.parameter=this.analyticalDrivers.find(o=>{var t,n;return o.id===((n=(t=this.selectedDriver)==null?void 0:t.parameter)==null?void 0:n.id)})),this.formVisible=!0},movePriority(e,o){const t=this.businessModelDrivers.findIndex(n=>n.id===e);if(o==="UP"){this.businessModelDrivers[t-1].priority++,this.businessModelDrivers[t-1].status="CHANGED",this.businessModelDrivers[t].priority--,this.businessModelDrivers[t].status="CHANGED";const n=this.businessModelDrivers[t-1];this.businessModelDrivers[t-1]=this.businessModelDrivers[t],this.businessModelDrivers[t]=n}else{this.businessModelDrivers[t+1].priority--,this.businessModelDrivers[t+1].status="CHANGED",this.businessModelDrivers[t].priority++,this.businessModelDrivers[t].status="CHANGED";const n=this.businessModelDrivers[t+1];this.businessModelDrivers[t+1]=this.businessModelDrivers[t],this.businessModelDrivers[t]=n}},deleteDriverConfirm(e){this.$confirm.require({message:this.$t("common.toast.deleteMessage"),header:this.$t("common.toast.deleteTitle"),icon:"pi pi-exclamation-triangle",accept:()=>this.deleteDriver(e)})},deleteDriver(e){this.businessModelDrivers[e].id&&this.driversForDelete.push(this.businessModelDrivers[e]),this.businessModelDrivers.splice(e,1),this.$emit("delete",this.driversForDelete),this.selectedDriver=null}}}),bc={class:"kn-page-content p-grid p-m-0"},kc={class:"kn-list-item"},uc={class:"kn-list-item-text"},mc={class:"kn-list-item-text-secondary kn-truncated"},gc={class:"p-col-6 p-p-0 p-m-0"};function fc(e,o,t,n,d,h){const k=s("Button"),m=s("Toolbar"),f=s("Listbox"),p=s("Card"),b=s("BuisnessModelDriverDetail");return c(),y("div",bc,[r(p,{class:"p-col-6 p-p-0"},{header:i(()=>[r(m,{class:"kn-toolbar kn-toolbar--primary"},{start:i(()=>[A(l(e.$t("managers.businessModelManager.drivers")),1)]),end:i(()=>[r(k,{class:"kn-button p-button-text",disabled:e.readonly,onClick:e.showForm},{default:i(()=>[A(l(e.$t("managers.businessModelManager.add")),1)]),_:1},8,["disabled","onClick"])]),_:1})]),content:i(()=>[r(f,{class:"kn-list",options:e.businessModelDrivers,listStyle:"max-height:calc(100% - 62px)",onChange:e.showForm,"data-test":"driver-list"},{empty:i(()=>[A(l(e.$t("common.info.noDataFound")),1)]),option:i(g=>[a("div",kc,[a("div",uc,[a("span",{class:U({"driver-invalid":g.option.numberOfErrors>0})},l(g.option.label),3),a("span",mc,l(g.option.parameterUrlName),1)]),g.option.id!==e.businessModelDrivers[0].id&&!e.readonly?(c(),C(k,{key:0,icon:"fa fa-arrow-up",class:"p-button-link p-button-sm",onClick:Q(M=>e.movePriority(g.option.id,"UP"),["stop"])},null,8,["onClick"])):x("",!0),g.option.id!==e.businessModelDrivers[e.businessModelDrivers.length-1].id&&!e.readonly?(c(),C(k,{key:1,icon:"fa fa-arrow-down",class:"p-button-link p-button-sm",onClick:Q(M=>e.movePriority(g.option.id,"DOWN"),["stop"])},null,8,["onClick"])):x("",!0),e.readonly?x("",!0):(c(),C(k,{key:2,icon:"far fa-trash-alt",class:"p-button-link p-button-sm",onClick:Q(M=>e.deleteDriverConfirm(g.index),["stop"])},null,8,["onClick"]))])]),_:1},8,["options","onChange"])]),_:1}),a("div",gc,[r(b,{businessModelId:e.id,selectedDriver:e.selectedDriver,formVisible:e.formVisible,driverOptions:e.analyticalDrivers,businessModelDrivers:e.businessModelDrivers,readonly:e.readonly},null,8,["businessModelId","selectedDriver","formVisible","driverOptions","businessModelDrivers","readonly"])])])}var hc=B(pc,[["render",fc],["__scopeId","data-v-29936c97"]]);const vc=V({name:"business-models-versions-card",components:{Card:le,Listbox:H,Menu:po,RadioButton:bo},props:{id:{type:Number},versions:{type:Array,required:!0},readonly:{type:Boolean}},emits:["touched","deleted"],watch:{versions(){this.loadVersions()}},setup(){return{store:L()}},created(){this.loadVersions()},data(){return{businessModelVersions:[],items:[],previousActiveVersion:{active:!1},activeVersion:{active:!1}}},methods:{loadVersions(){this.businessModelVersions=[],this.versions.forEach(e=>{e.active&&(this.previousActiveVersion=e,this.activeVersion=e),this.businessModelVersions.push(e)})},creationDate(e){return oo(e,{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})},toggle(e,o){this.createMenuItems(o),this.$refs.menu.toggle(e)},createMenuItems(e){this.items=[],e.hasContent&&!e.hasLog&&this.items.push({label:this.$t("managers.businessModelManager.downloadJar"),icon:"fa fa-file-archive-o",command:()=>this.downloadFile(e.id,"JAR")}),e.hasLog&&this.items.push({label:this.$t("managers.businessModelManager.downloadLog"),icon:"fa fa-file-text-o",command:()=>this.downloadFile(e.id,"LOG")}),e.hasFileModel&&this.items.push({label:this.$t("managers.businessModelManager.downloadModel"),icon:"fa fa-file-code-o",command:()=>this.downloadFile(e.id,"SBIMODEL")}),this.readonly||this.items.push({label:this.$t("common.delete"),icon:"far fa-trash-alt",command:()=>this.deleteVersionConfirm(e.id)})},setActive(){this.previousActiveVersion.active=!1,this.previousActiveVersion=this.activeVersion,this.activeVersion.active=!0,this.$emit("touched")},async downloadFile(e,o){await this.$http.get(`/knowage/restful-services/2.0/businessmodels/${this.id}/versions/${e}/${o}/file`,{responseType:"arraybuffer",headers:{Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9"}}).then(t=>{if(t.data.errors)this.store.setError({title:this.$t("common.error.downloading"),msg:this.$t("common.error.errorCreatingPackage")});else{if(t.headers){const d=t.headers["content-disposition"].match(/filename[^;\n=]*=((['"]).*?\2|[^;\n]*)/i);if(d&&d.length>1){const k=d[1].replaceAll('"',"");to(t.data,k,t.headers["content-type"])}}this.store.setInfo({title:this.$t("common.toast.success")})}})},deleteVersionConfirm(e){this.$confirm.require({message:this.$t("common.toast.deleteMessage"),header:this.$t("common.toast.deleteTitle"),icon:"pi pi-exclamation-triangle",accept:()=>{this.deleteVersion(e)}})},async deleteVersion(e){await this.$http.delete(`/knowage/restful-services/2.0/businessmodels/${this.id}/versions/${e}/`).then(()=>{this.store.setInfo({title:this.$t("common.toast.deleteTitle"),msg:this.$t("common.toast.deleteSuccess")}),this.$emit("deleted")})}}}),wc=["data-test"],yc={class:"kn-list-item-text"},xc={class:"kn-list-item-text-secondary"},Mc={class:"kn-list-item-text"};function Cc(e,o,t,n,d,h){const k=s("Toolbar"),m=s("RadioButton"),f=s("Button"),p=s("Menu"),b=s("Listbox"),g=s("Card");return c(),C(g,{class:"p-m-2"},{header:i(()=>[r(k,{class:"kn-toolbar kn-toolbar--primary"},{start:i(()=>[A(l(e.$t("managers.businessModelManager.savedVersions")),1)]),_:1})]),content:i(()=>[r(b,{class:"kn-list",options:e.businessModelVersions,"data-test":"versions-list"},{empty:i(()=>[A(l(e.$t("managers.businessModelManager.noSavedVersions")),1)]),option:i(M=>[a("div",{class:"kn-list-item","data-test":"version-"+M.option.id},[r(m,{name:"active",value:M.option,modelValue:e.activeVersion,"onUpdate:modelValue":o[0]||(o[0]=u=>e.activeVersion=u),disabled:e.readonly,onChange:e.setActive},null,8,["value","modelValue","disabled","onChange"]),a("div",yc,[a("span",null,l(M.option.fileName),1),a("span",xc,l(e.creationDate(M.option.creationDate)),1)]),a("div",Mc,[a("span",null,l(M.option.creationUser),1)]),r(f,{class:"p-button-link p-button-sm",icon:"fa fa-ellipsis-v",onClick:u=>e.toggle(u,M.option),"aria-haspopup":"true","aria-controls":"overlay_menu"},null,8,["onClick"]),r(p,{ref:"menu",model:e.items,popup:!0},null,8,["model"])],8,wc)]),_:1},8,["options"])]),_:1})}var Ac=B(vc,[["render",Cc]]);const $c=V({name:"metadata-card",components:{Card:le,ProgressSpinner:ao},props:{id:{type:Number,required:!1}},data(){return{importing:!1}},setup(){return{store:L()}},methods:{confirmImport(){this.$confirm.require({message:this.$t("managers.businessModelManager.importConfirm"),header:this.$t("managers.businessModelManager.importMetadata"),icon:"pi pi-exclamation-triangle",accept:()=>this.importMetadata()})},async importMetadata(){this.importing=!0,await this.$http.post(`/knowage/restful-services/2.0/metadata/${this.id}/bmExtract/`,void 0,{headers:{"X-Disable-Errors":"true"}}).then(()=>this.store.setInfo({title:this.$t("common.toast.createTitle"),msg:this.$t("common.toast.success")})).catch(e=>this.store.setError({title:this.$t("common.error.generic"),msg:e.message})).finally(()=>this.importing=!1)}}}),Dc={class:"p-m-5"},Ec={key:0,class:"p-mt-5"},Tc={id:"import-metadata-spinner"},zc={id:"import-progress-message",class:"p-d-flex p-jc-center p-ai-center"};function Vc(e,o,t,n,d,h){const k=s("Toolbar"),m=s("Button"),f=s("ProgressSpinner"),p=s("ProgressBar"),b=s("Card");return c(),C(b,{class:"p-m-2"},{header:i(()=>[r(k,{class:"kn-toolbar kn-toolbar--primary"},{start:i(()=>[A(l(e.$t("managers.businessModelManager.metadata")),1)]),_:1})]),content:i(()=>[a("div",Dc,[r(m,{id:"metadata-button",class:"p-jc-center",onClick:e.confirmImport},{default:i(()=>[A(l(e.$t("managers.businessModelManager.importMetadata")),1)]),_:1},8,["onClick"]),e.importing?(c(),y("div",Ec,[a("div",Tc,[r(f)]),r(p,{mode:"indeterminate",class:"kn-progress-bar"}),a("div",zc,l(e.$t("managers.businessModelManager.importProgress")),1)])):x("",!0)])]),_:1})}var Bc=B($c,[["render",Vc],["__scopeId","data-v-2e97926f"]]);const Sc=V({name:"business-model-catalogue-detail",components:{Badge:ro,BusinessModelDetailsCard:wd,BusinessModelDriversCard:hc,BusinessModelVersionsCard:Ac,MetadataCard:Bc,TabView:pe,TabPanel:be},props:{id:{type:Number,required:!1}},emits:["touched","closed","inserted"],data(){return{user:null,selectedBusinessModel:{},businessModelVersions:[],analyticalDrivers:[],drivers:[],driversForDelete:[],categories:[],datasources:[],toGenerate:!1,uploadedFile:null,loading:!1,touched:!1,uploadingError:!1,v$:G()}},computed:{buttonDisabled(){return this.invalidDrivers>0||!this.selectedBusinessModel.name||!this.selectedBusinessModel.category||!this.selectedBusinessModel.dataSourceLabel||this.readonly},invalidDrivers(){return this.drivers.filter(e=>e.numberOfErrors>0).length},readonly(){return this.selectedBusinessModel.id&&this.selectedBusinessModel.modelLocked&&this.user&&this.selectedBusinessModel.modelLocked&&this.selectedBusinessModel.modelLocker&&this.selectedBusinessModel.modelLocker!==this.user.userId}},watch:{async id(){await this.loadPage()}},setup(){return{store:L()}},async created(){await this.loadUser(),await this.loadPage()},methods:{async loadUser(){await this.$http.get("/knowage/restful-services/2.0/currentuser").then(e=>this.user=e.data)},async loadSelectedBusinessModelData(){this.id?(await this.loadSelectedBusinessModel(),await this.loadVersions(),await this.loadDrivers(),this.formatBusinessModelAnalyticalDriver()):(this.selectedBusinessModel={modelLocked:!1,smartView:!1},this.businessModelVersions=[],this.drivers=[],this.analyticalDrivers=[])},async loadSelectedBusinessModel(){await this.$http.get(`/knowage/restful-services/2.0/businessmodels/${this.id}`).then(e=>this.selectedBusinessModel=e.data)},async loadVersions(){await this.$http.get(`/knowage/restful-services/2.0/businessmodels/${this.id}/versions/`).then(e=>{this.businessModelVersions=e.data.versions,this.toGenerate=e.data.togenerate})},async loadDrivers(){this.drivers=[],await this.$http.get(`/knowage/restful-services/2.0/businessmodels/${this.id}/drivers`).then(e=>e.data.forEach(o=>{this.drivers.push({...o,status:"NOT_CHANGED",numberOfErrors:0})}))},async loadAnalyticalDrivers(){await this.$http.get("/knowage/restful-services/2.0/analyticalDrivers/").then(e=>this.analyticalDrivers=e.data)},async loadCategories(){await this.$http.get("/knowage/restful-services/domains/listValueDescriptionByType?DOMAIN_TYPE=BM_CATEGORY").then(e=>this.categories=e.data)},async loadDatasources(){this.datasources=[],await this.$http.get("/knowage/restful-services/2.0/datasources/?type=meta").then(e=>e.data.forEach(o=>this.datasources.push(o.label)))},formatBusinessModelAnalyticalDriver(){var o;if((o=this.selectedBusinessModel.category)!=null&&o.VALUE_NM)return;const e=this.categories.findIndex(t=>t.VALUE_ID===this.selectedBusinessModel.category);this.selectedBusinessModel={...this.selectedBusinessModel,category:this.categories[e]}},setDriversForDelete(e){this.driversForDelete=e},async handleSubmit(){if(this.loading=!0,this.selectedBusinessModel.id?await this.updateBusinessModel():await this.saveBusinessModel(),this.uploadingError){this.loading=!1;return}if(this.selectedBusinessModel.id&&this.uploadedFile&&!this.uploadingError&&await this.uploadFile(),this.businessModelVersions.length>0&&!this.uploadingError){const e=this.businessModelVersions.find(o=>o.active===!0);this.saveActiveVersion(e)}this.driversForDelete.forEach(e=>{this.uploadingError||this.deleteDriver(e.id)}),this.drivers.forEach(e=>{e.status==="CHANGED"&&!this.uploadingError&&(delete e.status,delete e.numberOfErrors,e.id?this.updateDriver(e):this.saveDriver(e))}),this.uploadingError||(this.store.setInfo({title:this.$t("common.toast.updateTitle"),msg:this.$t("common.toast.success")}),this.$router.replace(`/business-model-catalogue/${this.selectedBusinessModel.id}`)),this.loadPage(),this.touched=!1,this.$emit("inserted"),this.uploadingError=!1,this.loading=!1},setUploadingError(e,o){this.uploadingError=!0,this.store.setError({title:this.$t("common.toast."+e),msg:o})},async saveBusinessModel(){await this.$http.post("/knowage/restful-services/2.0/businessmodels/",{...this.selectedBusinessModel,modelLocker:this.user.userId}).then(e=>{e.data.errors?this.setUploadingError("createTitle",e.data.errors[0].message):(this.selectedBusinessModel=e.data,this.formatBusinessModelAnalyticalDriver())}).catch(()=>{this.uploadingError=!0})},async updateBusinessModel(){this.selectedBusinessModel.category.VALUE_ID&&(this.selectedBusinessModel.category=this.selectedBusinessModel.category.VALUE_ID),await this.$http.put(`/knowage/restful-services/2.0/businessmodels/${this.selectedBusinessModel.id}`,{...this.selectedBusinessModel,modelLocker:this.user.userId}).then(e=>{e.data.errors?this.setUploadingError("updateTitle",e.data.errors[0].message):this.selectedBusinessModel=e.data}).catch(()=>{this.uploadingError=!0}).finally(()=>this.formatBusinessModelAnalyticalDriver())},saveActiveVersion(e){this.$http.put(`/knowage/restful-services/2.0/businessmodels/${this.id}/versions/${e.id}/`).then(o=>{o.data.errors&&this.setUploadingError("updateTitle",o.data.errors[0].message)})},async uploadFile(){const e=new FormData;e.append("file",this.uploadedFile),await this.$http.post(`/knowage/restful-services/2.0/businessmodels/${this.selectedBusinessModel.id}/versions`,e,{headers:{"Content-Type":"multipart/form-data"}}).then(o=>{o.data.errors?this.store.setError({title:this.$t("managers.businessModelManager.toast.uploadFile"),msg:o.data.errors}):(this.store.setInfo({title:this.$t("managers.businessModelManager.uploadFile"),msg:this.$t("managers.businessModelManager.uploadFileSuccess")}),this.uploadedFile=null)})},saveDriver(e){this.$http.post(`/knowage/restful-services/2.0/businessmodels/${this.id}/drivers`,{...e,parID:e.parameter.id}).then(o=>{o.data.errors&&this.setUploadingError("saveTitle",o.data.errors[0].message)})},updateDriver(e){this.$http.put(`/knowage/restful-services/2.0/businessmodels/${this.id}/drivers/${e.id}`,{...e,parID:e.parameter.id}).then(o=>{o.data.errors&&this.setUploadingError("updateTitle",o.data.errors[0].message)})},deleteDriver(e){this.$http.delete(`/knowage/restful-services/2.0/businessmodels/${this.id}/drivers/${e}`).then(o=>{o.data.errors&&this.setUploadingError("deleteTitle",o.data.errors[0].message)})},async loadPage(){this.loading=!0,await this.loadAnalyticalDrivers(),await this.loadCategories(),await this.loadDatasources(),await this.loadSelectedBusinessModelData(),this.loading=!1},onFieldChange(e){this.selectedBusinessModel[e.fieldName]=e.value,e.fieldName==="modelLocked"&&(this.selectedBusinessModel.modelLocker=this.user.userId),this.touched=!0,this.$emit("touched")},setDirty(){this.$emit("touched")},closeTemplate(){this.$router.push("/business-model-catalogue"),this.$emit("closed")}}});function Ic(e,o,t,n,d,h){const k=s("Button"),m=s("Toolbar"),f=s("ProgressBar"),p=s("BusinessModelDetailsCard"),b=s("TabPanel"),g=s("MetadataCard"),M=s("BusinessModelVersionsCard"),u=s("Badge"),v=s("BusinessModelDriversCard"),E=s("TabView");return c(),y(I,null,[r(m,{class:"kn-toolbar kn-toolbar--primary p-m-0"},{start:i(()=>[A(l(e.selectedBusinessModel.name),1)]),end:i(()=>[r(k,{icon:"pi pi-save",class:"p-button-text p-button-rounded p-button-plain",disabled:e.buttonDisabled,onClick:e.handleSubmit,"data-test":"submit-button"},null,8,["disabled","onClick"]),r(k,{icon:"pi pi-times",class:"p-button-text p-button-rounded p-button-plain",onClick:e.closeTemplate,"data-test":"close-button"},null,8,["onClick"])]),_:1}),e.loading?(c(),C(f,{key:0,mode:"indeterminate",class:"kn-progress-bar"})):(c(),C(E,{key:1,class:"tabview-custom kn-page-content"},{default:i(()=>[r(b,null,{header:i(()=>[a("span",null,l(e.$t("managers.businessModelManager.details")),1)]),default:i(()=>[r(p,{selectedBusinessModel:e.selectedBusinessModel,domainCategories:e.categories,datasourcesMeta:e.datasources,user:e.user,toGenerate:e.toGenerate,readonly:e.readonly,businessModelVersions:e.businessModelVersions,onFieldChanged:e.onFieldChange,onFileUploaded:o[0]||(o[0]=w=>e.uploadedFile=w),onDatamartGenerated:e.loadPage,onModelGenerated:e.loadVersions},null,8,["selectedBusinessModel","domainCategories","datasourcesMeta","user","toGenerate","readonly","businessModelVersions","onFieldChanged","onDatamartGenerated","onModelGenerated"])]),_:1}),r(b,null,{header:i(()=>[a("span",null,l(e.$t("managers.businessModelManager.metadata")),1)]),default:i(()=>{var w;return[((w=e.businessModelVersions)==null?void 0:w.length)>0&&!e.readonly?(c(),C(g,{key:0,id:e.selectedBusinessModel.id},null,8,["id"])):x("",!0)]}),_:1}),r(b,null,{header:i(()=>[a("span",null,l(e.$t("managers.businessModelManager.savedVersions")),1)]),default:i(()=>[r(M,{id:e.selectedBusinessModel.id,versions:e.businessModelVersions,readonly:e.readonly,onTouched:e.setDirty,onDeleted:e.loadVersions},null,8,["id","versions","readonly","onTouched","onDeleted"])]),_:1}),e.id?(c(),C(b,{key:0},no({default:i(()=>[e.id?(c(),C(v,{key:0,id:e.selectedBusinessModel.id,drivers:e.drivers,driversOptions:e.analyticalDrivers,readonly:e.readonly,onDelete:e.setDriversForDelete},null,8,["id","drivers","driversOptions","readonly","onDelete"])):x("",!0)]),_:2},[e.id?{name:"header",fn:i(()=>[a("span",null,l(e.$t("managers.businessModelManager.drivers")),1),e.invalidDrivers>0?(c(),C(u,{key:0,value:e.invalidDrivers,class:"p-ml-2",severity:"danger"},null,8,["value"])):x("",!0)])}:void 0]),1024)):x("",!0)]),_:1}))],64)}var Jc=B(Sc,[["render",Ic],["__scopeId","data-v-0af99562"]]);export{Jc as default};
//# sourceMappingURL=BusinessModelCatalogueDetail-1716ee8b.js.map
