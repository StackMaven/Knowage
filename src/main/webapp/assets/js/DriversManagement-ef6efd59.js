import{d as M,a5 as R,_ as $,r as n,o as p,h,w as l,a as t,f as a,G as A,t as i,ah as Z,l as S,n as z,c as T,A as w,g as x,B as F,i as ee,x as _,C as oe,D as U,z as D,Y as E,k as K,v as te,u as ae,a4 as X,at as J,s as N,y as j,V as Q,X as re,j as ne}from"./index-1e676509.js";import{K as Y,u as G,c as H}from"./KnValidatonMessages-ebe48c72.js";import{s as ie}from"./multiselect.esm-ce4000f7.js";import{f as L}from"./filterHelper-a723991a.js";import{d as O}from"./base64-d3a217e7.js";import{K as W}from"./KnHint-6d455703.js";const le=["name"],se={insert:{toastTitle:"common.toast.createTitle"},success:"common.toast.success",update:{toastTitle:"common.toast.updateTitle"}},de=[{label:"functional",name:"Functional"},{label:"temporal",name:"Temporal"}];var I={filterFields:le,operation:se,options:de};const ce={driver:[{fieldName:"label",validators:[{key:"required"},{key:"regex",validator:{type:"extendedAlphanumericRegex"}}]},{fieldName:"name",validators:[{key:"required"},{key:"regex",validator:{type:"extendedAlphanumericRegex"}}]},{fieldName:"type",validators:[{key:"required"}]}]};var B={validations:ce};const pe=M({name:"detail-card",components:{Dropdown:R,MultiSelect:ie,KnValidationMessages:Y},props:{selectedDriver:{type:Object,required:!1},types:{type:Array,required:!1}},data(){return{driver:{},driversManagemenDetailtDescriptor:I,driversManagemenValidationtDescriptor:B,selectedOptions:[],v$:G()}},validations(){return{driver:H("driver",B.validations.driver)}},watch:{selectedDriver(){this.driver=this.selectedDriver,this.handleTypes()}},mounted(){this.driver&&(this.driver=this.selectedDriver,this.handleTypes())},methods:{handleTypes(){this.selectedOptions=[],this.driver.functional&&this.selectedOptions.push("functional"),this.driver.temporal&&this.selectedOptions.push("temporal")},changeType(){this.selectedOptions.includes("temporal")?this.driver.temporal=!0:this.driver.temporal=!1,this.selectedOptions.includes("functional")?this.driver.functional=!0:this.driver.functional=!1,this.setDirty()},setDirty(){this.$emit("touched")}}}),be={class:"p-fluid p-formgrid p-grid"},me={class:"p-field p-col-4"},ke={class:"p-float-label"},ue={for:"label",class:"kn-material-input-label"},ve={class:"p-field p-col-4"},he={class:"p-float-label"},ge={for:"name",class:"kn-material-input-label"},fe={class:"p-field p-col-4"},ye={class:"p-float-label"},we={for:"type",class:"kn-material-input-label"},xe={class:"p-field p-col-8"},Me={class:"p-float-label"},$e={for:"description",class:"kn-material-input-label"},Ce={class:"p-field p-col-4"},Ae={class:"p-float-label"},De={for:"description",class:"kn-material-input-label"};function Le(e,o,c,b,g,m){const d=n("InputText"),s=n("KnValidationMessages"),k=n("Dropdown"),v=n("MultiSelect"),u=n("Card");return p(),h(u,null,{content:l(()=>[t("form",be,[t("div",me,[t("span",ke,[a(d,{id:"label",class:A(["kn-material-input",{"p-invalid":e.v$.driver.label.$invalid&&e.v$.driver.label.$dirty}]),type:"text",modelValue:e.v$.driver.label.$model,"onUpdate:modelValue":o[0]||(o[0]=r=>e.v$.driver.label.$model=r),maxLength:"20",onBlur:o[1]||(o[1]=r=>e.v$.driver.label.$touch()),onChange:e.setDirty},null,8,["modelValue","class","onChange"]),t("label",ue,i(e.$t("common.label"))+" * ",1)]),a(s,{class:"p-mt-1",vComp:e.v$.driver.label,additionalTranslateParams:{fieldName:e.$t("common.label")}},null,8,["vComp","additionalTranslateParams"])]),t("div",ve,[t("span",he,[a(d,{id:"name",class:A(["kn-material-input",{"p-invalid":e.v$.driver.name.$invalid&&e.v$.driver.name.$dirty}]),type:"text",modelValue:e.v$.driver.name.$model,"onUpdate:modelValue":o[2]||(o[2]=r=>e.v$.driver.name.$model=r),maxLength:"20",onBlur:o[3]||(o[3]=r=>e.v$.driver.name.$touch()),onChange:e.setDirty},null,8,["modelValue","class","onChange"]),t("label",ge,i(e.$t("common.name"))+" * ",1)]),a(s,{class:"p-mt-1",vComp:e.v$.driver.name,additionalTranslateParams:{fieldName:e.$t("common.name")}},null,8,["vComp","additionalTranslateParams"])]),t("div",fe,[t("span",ye,[a(k,{id:"type",class:A(["kn-material-input",{"p-invalid":e.v$.driver.type.$invalid&&e.v$.driver.type.$dirty}]),modelValue:e.v$.driver.type.$model,"onUpdate:modelValue":o[4]||(o[4]=r=>e.v$.driver.type.$model=r),options:e.types,optionValue:"VALUE_CD",optionLabel:"VALUE_NM",onBlur:o[5]||(o[5]=r=>e.v$.driver.type.$touch()),onChange:e.setDirty},null,8,["modelValue","options","class","onChange"]),t("label",we,i(e.$t("common.type"))+" * ",1)]),a(s,{class:"p-mt-1",vComp:e.v$.driver.type,additionalTranslateParams:{fieldName:e.$t("common.type")}},null,8,["vComp","additionalTranslateParams"])]),t("div",xe,[t("span",Me,[a(d,{id:"description",class:"kn-material-input",type:"text",modelValue:e.driver.description,"onUpdate:modelValue":o[6]||(o[6]=r=>e.driver.description=r),onChange:e.setDirty,maxLength:"100"},null,8,["modelValue","onChange"]),t("label",$e,i(e.$t("common.description")),1)])]),t("div",Ce,[t("span",Ae,[a(v,{class:"kn-material-input",modelValue:e.selectedOptions,"onUpdate:modelValue":o[7]||(o[7]=r=>e.selectedOptions=r),options:e.driversManagemenDetailtDescriptor.options,optionLabel:"name",optionValue:"label",onChange:e.changeType},null,8,["modelValue","options","onChange"]),t("label",De,i(e.$t("managers.driversManagement.options")),1)])])])]),_:1})}var Te=$(pe,[["render",Le]]);const Ve=[{field:"label",header:"common.label"},{field:"name",header:"common.name"},{field:"description",header:"common.description"}],Ee=[{f_value:"FIRST",name:"Main lov's first item"},{f_value:"LAST",name:"Main lov's last item"}],_e=[{label:"none",name:"None"},{label:"lov",name:"Use a LOV"},{label:"pickUp",name:"Pick Up"}],Se={breakpoints:{"640px":"100vw","960px":"85vw"},style:{width:"70vw"}},ze=["label","name","description"],Ue=[{label:"none",name:"None"},{label:"lov",name:"Use a LOV"}],Fe={column:{style:{width:"45%","word-break":"break-all"}},iconColumn:{style:{"text-align":"end",width:"5%"}}},Ne=[{name:"LOV",valueSelection:"lov"},{name:"Manual Input",valueSelection:"man_in"},{name:"Map Input",valueSelection:"map_in"}];var q={columnsLov:Ve,defaultFormula:Ee,defaultValues:_e,dialog:Se,globalFilterFields:ze,maxValues:Ue,table:Fe,types:Ne};const Ie={mode:[{fieldName:"label",validators:[{key:"required"},{key:"regex",validator:{type:"extendedAlphanumericRegex"}}]},{fieldName:"name",validators:[{key:"required"},{key:"regex",validator:{type:"extendedAlphanumericRegex"}}]},{fieldName:"valueSelection",validators:[{key:"required"}]},{fieldName:"selectionType",validators:[{key:"required_type_for_lov"}]},{fieldName:"selectedLayer",validators:[{key:"required_for_map_in"}]},{fieldName:"defaultFormula",validators:[{key:"required_for_pick_up"}]},{fieldName:"typeLov",validators:[{key:"required_lovId_for_lov"}]},{fieldName:"defLov",validators:[{key:"required_lov_for_default"}]},{fieldName:"maxLov",validators:[{key:"required_lov_for_max"}]}]};var P={validations:Ie};const qe=M({name:"lovs-detail",components:{VCodeMirror:Z,Column:S,DataTable:z},props:{lov:{type:Object,required:!1}},emits:["close","apply"],data(){return{selectedLov:{},useModeDescriptor:q,code:"",rows:[],codeMirror:{},codeMirrorVisiable:!1,label:null,name:null,options:{mode:"text/x-mysql",indentWithTabs:!0,smartIndent:!0,lineWrapping:!0,matchBrackets:!0,autofocus:!0,theme:"eclipse",lineNumbers:!0,readOnly:!0}}},mounted(){this.selectedLov={...this.lov},this.decode(),this.setupCodeMirror()},watch:{lov(){this.selectedLov={...this.lov},this.decode(),this.setupCodeMirror()}},methods:{setupCodeMirror(){this.$refs.codeMirror&&(this.codeMirror=this.$refs.codeMirror.cminstance)},escapeXml(e){return e.replace(/'/g,"'").replace(/"/g,'"').replace(/>/g,">").replace(/</g,"<").replace(/&/g,"&").replace(/&apos;/g,"'")},decode(){var e,o,c,b,g;if(this.selectedLov.itypeCd==="QUERY"){this.codeMirrorVisiable=!0,this.options.mode="text/x-mysql";let m=JSON.parse((e=this.lov)==null?void 0:e.lovProviderJSON);this.code=this.escapeXml(O(m.QUERY.STMT))}else if(this.selectedLov.itypeCd==="SCRIPT"){this.codeMirrorVisiable=!0,this.options.mode="text/javascript";let m=JSON.parse((o=this.lov)==null?void 0:o.lovProviderJSON);this.code=this.escapeXml(O(m.SCRIPTLOV.SCRIPT))}else if(this.selectedLov.itypeCd==="FIX_LOV"){this.codeMirrorVisiable=!1;let m=JSON.parse((c=this.lov)==null?void 0:c.lovProviderJSON);Array.isArray(m.FIXLISTLOV.ROWS.ROW)?this.rows=m.FIXLISTLOV.ROWS.ROW:this.rows=Object.values(m.FIXLISTLOV.ROWS)}else if(this.selectedLov.itypeCd==="DATASET"){this.codeMirrorVisiable=!1;let m=JSON.parse((b=this.lov)==null?void 0:b.lovProviderJSON);this.label=m.DATASET.LABEL}else if(this.selectedLov.itypeCd==="JAVACLASS"){this.codeMirrorVisiable=!1;let m=JSON.parse((g=this.lov)==null?void 0:g.lovProviderJSON);this.label=m.JAVACLASS.label,this.name=m.JAVACLASS.name}}}}),Oe={class:"p-mb-3"},Be={class:"p-fluid p-formgrid p-grid"},Pe={class:"p-field p-col-4"},Re={class:"p-float-label"},Ke={for:"label",class:"kn-material-input-label"},Xe={class:"p-field p-col-4"},Je={class:"p-float-label"},je={for:"name",class:"kn-material-input-label"},Qe={class:"p-field p-col-4"},Ye={class:"p-float-label"},Ge={for:"type",class:"kn-material-input-label"},He={class:"p-field p-col-12"},We={class:"p-float-label"},Ze={for:"desc",class:"kn-material-input-label"},eo={key:2,class:"p-field p-col-6"},oo={class:"p-float-label"},to={for:"label",class:"kn-material-input-label"},ao={key:3,class:"p-field p-col-6"},ro={class:"p-float-label"},no={for:"description",class:"kn-material-input-label"};function io(e,o,c,b,g,m){const d=n("Button"),s=n("InputText"),k=n("VCodeMirror"),v=n("Column"),u=n("DataTable");return p(),T(F,null,[t("div",Oe,[a(d,{label:e.$t("managers.driversManagement.useModes.backToList"),icon:"pi pi-arrow-left",class:"p-button-text",style:{width:"120px"},onClick:o[0]||(o[0]=r=>e.$emit("close"))},null,8,["label"])]),t("form",Be,[t("div",Pe,[t("span",Re,[a(s,{id:"label",class:"kn-material-input",type:"text",modelValue:e.selectedLov.label,"onUpdate:modelValue":o[1]||(o[1]=r=>e.selectedLov.label=r),disabled:""},null,8,["modelValue"]),t("label",Ke,i(e.$t("common.label")),1)])]),t("div",Xe,[t("span",Je,[a(s,{id:"name",class:"kn-material-input",type:"text",modelValue:e.selectedLov.name,"onUpdate:modelValue":o[2]||(o[2]=r=>e.selectedLov.name=r),disabled:""},null,8,["modelValue"]),t("label",je,i(e.$t("common.name")),1)])]),t("div",Qe,[t("span",Ye,[a(s,{id:"type",class:"kn-material-input",type:"text",modelValue:e.selectedLov.itypeCd,"onUpdate:modelValue":o[3]||(o[3]=r=>e.selectedLov.itypeCd=r),disabled:""},null,8,["modelValue"]),t("label",Ge,i(e.$t("common.type")),1)])]),t("div",He,[t("span",We,[a(s,{id:"desc",class:"kn-material-input",type:"text",modelValue:e.selectedLov.description,"onUpdate:modelValue":o[4]||(o[4]=r=>e.selectedLov.description=r),disabled:""},null,8,["modelValue"]),t("label",Ze,i(e.$t("common.description")),1)])]),e.codeMirrorVisiable?(p(),h(k,{key:0,ref:"codeMirror",class:"p-mt-2",options:e.options,value:e.code,"onUpdate:value":o[5]||(o[5]=r=>e.code=r),autoHeight:!0},null,8,["options","value"])):w("",!0),this.selectedLov.itypeCd==="FIX_LOV"?(p(),h(u,{key:1,value:e.rows,class:"p-datatable-sm kn-table",responsiveLayout:"stack"},{empty:l(()=>[x(i(e.$t("common.info.noDataFound")),1)]),default:l(()=>[a(v,{field:"VALUE",header:e.$t("common.value"),class:"kn-truncated"},null,8,["header"]),a(v,{field:"DESCRIPTION",header:e.$t("common.description"),class:"kn-truncated"},null,8,["header"])]),_:1},8,["value"])):w("",!0),e.selectedLov.itypeCd==="DATASET"||e.selectedLov.itypeCd==="JAVACLASS"?(p(),T("div",eo,[t("span",oo,[a(s,{id:"label",class:"kn-material-input",type:"text",modelValue:e.label,"onUpdate:modelValue":o[6]||(o[6]=r=>e.label=r),disabled:""},null,8,["modelValue"]),t("label",to,i(e.$t("common.label")),1)])])):w("",!0),e.selectedLov.itypeCd==="DATASET"||e.selectedLov.itypeCd==="JAVACLASS"?(p(),T("div",ao,[t("span",ro,[a(s,{id:"description",class:"kn-material-input",type:"text",modelValue:e.name,"onUpdate:modelValue":o[7]||(o[7]=r=>e.name=r),disabled:""},null,8,["modelValue"]),t("label",no,i(e.$t("common.name")),1)])])):w("",!0)])],64)}var lo=$(qe,[["render",io]]);const so=M({name:"lovs-dialog",components:{DataTable:z,Column:S,Dialog:ee,LovsDetail:lo},props:{dialogVisible:{type:Boolean,default:!1},lovs:{type:Array,required:!1},selectedLovProp:{type:Array,required:!1}},emits:["close","apply"],data(){return{selectedLov:{},detailVisiable:!1,lovDetails:{},useModeDescriptor:q,filters:{global:[L],label:{operator:_.AND,constraints:[L]},name:{operator:_.AND,constraints:[L]},description:{operator:_.AND,constraints:[L]}}}},mounted(){this.selectedLov={...this.selectedLovProp}},watch:{selectedLovProp(){this.selectedLov={...this.selectedLovProp}}},methods:{applyLov(){this.$emit("apply",this.selectedLov),this.detailVisiable=!1},closeLovDialog(){this.$emit("close"),this.detailVisiable=!1},lovDetail(e){this.detailVisiable=!0,this.lovDetails=e}}}),co={class:"table-header"},po={class:"p-input-icon-left"},bo=t("i",{class:"pi pi-search"},null,-1);function mo(e,o,c,b,g,m){const d=n("Toolbar"),s=n("InputText"),k=n("Column"),v=n("Button"),u=n("DataTable"),r=n("LovsDetail"),V=n("Dialog");return p(),h(V,{header:e.$t("managers.driversManagement.useModes.selectLov"),breakpoints:e.useModeDescriptor.dialog.breakpoints,style:U(e.useModeDescriptor.dialog.style),visible:e.dialogVisible,modal:!0,closable:!1,class:"p-fluid kn-dialog--toolbar--primary"},{header:l(()=>[a(d,{class:"kn-toolbar kn-toolbar--primary p-p-0 p-m-0 p-col-12"},{start:l(()=>[x(i(e.$t("managers.driversManagement.useModes.selectLov")),1)]),_:1})]),footer:l(()=>[a(v,{label:e.$t("common.cancel"),onClick:e.closeLovDialog,class:"kn-button kn-button--secondary"},null,8,["label","onClick"]),a(v,{label:e.$t("common.apply"),onClick:e.applyLov,class:"kn-button kn-button--primary"},null,8,["label","onClick"])]),default:l(()=>[e.detailVisiable?(p(),h(r,{key:1,lov:e.lovDetails,onClose:o[3]||(o[3]=f=>e.detailVisiable=!1)},null,8,["lov"])):(p(),h(u,{key:0,filters:e.filters,"onUpdate:filters":o[1]||(o[1]=f=>e.filters=f),filterDisplay:"menu",globalFilterFields:e.useModeDescriptor.globalFilterFields,selection:e.selectedLov,"onUpdate:selection":o[2]||(o[2]=f=>e.selectedLov=f),value:e.lovs,class:"p-datatable-sm kn-table",dataKey:"id",responsiveLayout:"stack",selectionMode:"single"},{header:l(()=>[t("div",co,[t("span",po,[bo,a(s,{class:"kn-material-input",type:"text",modelValue:e.filters.global.value,"onUpdate:modelValue":o[0]||(o[0]=f=>e.filters.global.value=f),placeholder:e.$t("common.search"),badge:"0","data-test":"search-input"},null,8,["modelValue","placeholder"])])])]),empty:l(()=>[x(i(e.$t("common.info.noDataFound")),1)]),loading:l(()=>[x(i(e.$t("common.info.dataLoading")),1)]),default:l(()=>[(p(!0),T(F,null,oe(e.useModeDescriptor.columnsLov,f=>(p(),h(k,{field:f.field,header:e.$t(f.header),key:f.field,class:"kn-truncated",sortable:!0},{body:l(y=>[t("span",null,i(y.data[y.column.props.field]),1)]),_:2},1032,["field","header"]))),128)),a(k,{headerStyle:"useModeDescriptor.table.iconColumn.style",style:U(e.useModeDescriptor.table.iconColumn.style)},{body:l(f=>[a(v,{icon:"pi pi-info-circle",class:"p-button-link",onClick:y=>e.lovDetail(f.data)},null,8,["onClick"])]),_:1},8,["style"])]),_:1},8,["filters","globalFilterFields","selection","value"]))]),_:1},8,["header","breakpoints","style","visible"])}var ko=$(so,[["render",mo]]);const uo=M({name:"detail-card",components:{Dropdown:R,KnValidationMessages:Y,LovsDialog:ko},props:{selectedMode:{type:Object,required:!1},selectionTypes:{type:Array,requierd:!0},layers:{type:Array,requierd:!0},lovs:{type:Array,requierd:!0},isDate:{type:Boolean,required:!0},showMapDriver:{type:Boolean,requierd:!0}},data(){return{mode:{},useModeDescriptor:q,selectedType:null,selectedDefault:null,selectedMax:null,lov:null,lovType:null,dialogVisiable:!1,v$:G(),useModeValidationtDescriptor:P}},validations(){const e={required_type_for_lov:()=>this.mode.valueSelection!="lov"||this.mode.selectionType!=null,required_lovId_for_lov:()=>this.mode.valueSelection!="lov"||this.mode.typeLov.name!=null,required_for_map_in:()=>this.mode.valueSelection!="map_in"||this.mode.selectedLayer!=""&&this.mode.selectedLayer!=null,required_for_pick_up:()=>this.selectedDefault!="pickUp"||this.mode.defaultFormula!=""&&this.mode.defaultFormula!=null,required_lov_for_default:()=>this.selectedDefault!="lov"||this.mode.defLov.name!=null,required_lov_for_max:()=>this.selectedMax!="lov"||this.mode.maxLov.name!=null};return{mode:H("mode",P.validations.mode,e)}},computed:{defaults(){return this.mode.valueSelection==="map_in"?this.useModeDescriptor.defaultValues.filter(e=>e.label!="pickUp"):this.useModeDescriptor.defaultValues},availableTypes(){return this.showMapDriver?this.useModeDescriptor.types:this.useModeDescriptor.types.filter(e=>e.valueSelection!="map_in")}},watch:{selectedMode(){this.v$.$reset(),this.mode=this.selectedMode,this.handleDropdowns(),this.v$.$touch(),setTimeout(()=>{this.modeChanged()},500),this.handleLovs()}},mounted(){this.selectedMode&&(this.mode=this.selectedMode,this.handleDropdowns()),this.v$.$touch(),this.handleLovs(),setTimeout(()=>{this.modeChanged()},500)},methods:{showLovsDialog(e){switch(this.dialogVisiable=!0,e){case"type":this.lov=this.mode.typeLov,this.lovType="type";break;case"default":this.lov=this.mode.defLov,this.lovType="default";break;case"max":this.lov=this.mode.maxLov,this.lovType="max";break}},handleDropdowns(){this.mode.defaultFormula==null?this.selectedDefault="none":this.selectedDefault="pickUp",this.mode.idLovForDefault!=null&&(this.selectedDefault="lov"),this.mode.idLovForMax!=null?this.selectedMax="lov":this.selectedMax="none"},setType(){switch(this.selectedDefault="none",this.mode.valueSelection){case"lov":this.mode.manualInput=0,this.mode.selectedLayer=null,this.mode.selectedLayerProp=null;break;case"man_in":this.mode.idLov=null,this.mode.typeLov={name:null},this.mode.selectionType=null,this.mode.selectedLayer=null,this.mode.selectedLayerProp=null;break;case"map_in":this.mode.idLov=null,this.mode.typeLov={name:null},this.mode.selectionType=null,this.mode.manualInput=0;break}this.modeChanged()},setDefault(){switch(this.selectedDefault){case"none":this.mode.defaultFormula=null,this.mode.idLovForDefault=null,this.mode.defLov={name:null};break;case"lov":this.mode.defaultFormula=null;break;case"pickUp":this.mode.idLovForDefault=null,this.mode.defLov={name:null};break}this.modeChanged()},setMax(){this.selectedMax=="none"&&(this.mode.idLovForMax=null,this.mode.maxLov={name:null}),this.modeChanged()},setDirty(){this.$emit("touched")},modeChanged(){this.mode.numberOfErrors=this.v$.$errors.length,this.mode.edited=!0},applyLov(e){switch(this.dialogVisiable=!1,this.lovType){case"type":this.mode.typeLov=e,this.mode.idLov=e.id;break;case"default":this.mode.defLov=e,this.mode.idLovForDefault=e.id;break;case"max":this.mode.maxLov=e,this.mode.idLovForMax=e.id;break}this.modeChanged()},handleLovs(){var e,o,c;this.mode.idLov?this.mode.typeLov=(e=this.lovs)==null?void 0:e.filter(b=>b.id==this.mode.idLov)[0]:this.mode.typeLov={name:null},this.mode.idLovForDefault?this.mode.defLov=(o=this.lovs)==null?void 0:o.filter(b=>b.id==this.mode.idLovForDefault)[0]:this.mode.defLov={name:null},this.mode.idLovForMax?this.mode.maxLov=(c=this.lovs)==null?void 0:c.filter(b=>b.id==this.mode.idLovForMax)[0]:this.mode.maxLov={name:null}}}}),vo={class:"p-fluid p-formgrid p-grid"},ho={class:"p-col-12 p-d-flex p-flex-wrap p-mt-3"},go={class:"p-field p-col-6"},fo={class:"p-float-label"},yo={for:"label",class:"kn-material-input-label"},wo={class:"p-field p-col-6"},xo={class:"p-float-label"},Mo={for:"name",class:"kn-material-input-label"},$o={class:"p-field p-col-12"},Co={class:"p-float-label"},Ao={for:"description",class:"kn-material-input-label"},Do={class:"p-col-12 p-d-flex p-flex-wrap"},Lo={class:"p-field p-col-3 p-sm-12 p-md-4"},To={class:"p-float-label"},Vo={for:"type",class:"kn-material-input-label"},Eo={class:"p-col-9 p-sm-12 p-md-8 p-fluid p-formgrid p-grid"},_o={class:"p-field p-col-6 p-sm-12 p-md-6"},So={class:"p-input-icon-right"},zo={class:"p-float-label"},Uo={for:"lov",class:"kn-material-input-label"},Fo={class:"p-field p-col-6 p-sm-12 p-md-6"},No={class:"p-float-label"},Io={for:"type",class:"kn-material-input-label"},qo={class:"p-col-9 p-sm-12 p-md-8 p-fluid p-formgrid p-grid"},Oo={class:"p-field p-col-6 p-sm-12 p-md-6"},Bo={class:"p-float-label"},Po={for:"type",class:"kn-material-input-label"},Ro={class:"p-field p-col-6 p-sm-12 p-md-6"},Ko={class:"p-float-label"},Xo={for:"prop",class:"kn-material-input-label"},Jo={class:"p-col-12 p-d-flex p-flex-wrap"},jo={class:"p-field p-col-4 p-sm-12 p-md-4"},Qo={class:"p-float-label"},Yo={for:"default",class:"kn-material-input-label"},Go={class:"p-field p-col-8 p-sm-12 p-md-8"},Ho={class:"p-input-icon-right"},Wo={class:"p-float-label"},Zo={for:"lov",class:"kn-material-input-label"},et={class:"p-field p-col-8 p-sm-12 p-md-8"},ot={class:"p-float-label"},tt={for:"defaultFormula",class:"kn-material-input-label"},at={class:"p-col-12 p-d-flex p-flex-wrap"},rt={class:"p-field p-col-4 p-sm-12 p-md-4"},nt={class:"p-float-label"},it={for:"max",class:"kn-material-input-label"},lt={class:"p-field p-col-6 p-sm-12 p-md-6"},st={class:"p-input-icon-right"},dt={class:"p-float-label"},ct={for:"lov",class:"kn-material-input-label"};function pt(e,o,c,b,g,m){const d=n("InputText"),s=n("KnValidationMessages"),k=n("Dropdown"),v=n("LovsDialog"),u=n("Card");return e.mode.useID?(p(),h(u,{key:0,class:"p-col-12"},{content:l(()=>[t("form",vo,[t("div",ho,[t("div",go,[t("span",fo,[a(d,{id:"label",class:A(["kn-material-input",{"p-invalid":e.v$.mode.label.$invalid&&e.v$.mode.label.$dirty}]),type:"text",modelValue:e.v$.mode.label.$model,"onUpdate:modelValue":o[0]||(o[0]=r=>e.v$.mode.label.$model=r),modelModifiers:{trim:!0},onBlur:o[1]||(o[1]=r=>e.v$.mode.label.$touch()),onInput:e.modeChanged},null,8,["modelValue","class","onInput"]),t("label",yo,i(e.$t("common.label"))+" * ",1)]),a(s,{class:"p-mt-1",vComp:e.v$.mode.label,additionalTranslateParams:{fieldName:e.$t("common.label")}},null,8,["vComp","additionalTranslateParams"])]),t("div",wo,[t("span",xo,[a(d,{id:"name",class:A(["kn-material-input",{"p-invalid":e.v$.mode.name.$invalid&&e.v$.mode.name.$dirty}]),type:"text",modelValue:e.v$.mode.name.$model,"onUpdate:modelValue":o[2]||(o[2]=r=>e.v$.mode.name.$model=r),modelModifiers:{trim:!0},onBlur:o[3]||(o[3]=r=>e.v$.mode.name.$touch()),onInput:e.modeChanged},null,8,["modelValue","class","onInput"]),t("label",Mo,i(e.$t("common.name"))+" * ",1)]),a(s,{class:"p-mt-1",vComp:e.v$.mode.name,additionalTranslateParams:{fieldName:e.$t("common.name")}},null,8,["vComp","additionalTranslateParams"])]),t("div",$o,[t("span",Co,[a(d,{id:"description",class:"kn-material-input",type:"text",modelValue:e.mode.description,"onUpdate:modelValue":o[4]||(o[4]=r=>e.mode.description=r),modelModifiers:{trim:!0},onInput:e.modeChanged},null,8,["modelValue","onInput"]),t("label",Ao,i(e.$t("common.description")),1)])])]),t("div",Do,[t("div",Lo,[t("span",To,[a(k,{id:"type",class:A(["kn-material-input",{"p-invalid":e.v$.mode.valueSelection.$invalid&&e.v$.mode.valueSelection.$dirty}]),modelValue:e.v$.mode.valueSelection.$model,"onUpdate:modelValue":o[5]||(o[5]=r=>e.v$.mode.valueSelection.$model=r),options:e.availableTypes,optionLabel:"name",optionValue:"valueSelection",onBlur:o[6]||(o[6]=r=>e.v$.mode.valueSelection.$touch()),onChange:e.setType},null,8,["modelValue","options","class","onChange"]),t("label",Vo,i(e.$t("common.type"))+" * ",1)]),a(s,{class:"p-mt-1",vComp:e.v$.mode.valueSelection,additionalTranslateParams:{fieldName:e.$t("common.type")}},null,8,["vComp","additionalTranslateParams"])]),D(t("div",Eo,[t("div",_o,[t("span",So,[t("span",zo,[a(d,{id:"lov",modelValue:e.mode.typeLov.name,"onUpdate:modelValue":o[7]||(o[7]=r=>e.mode.typeLov.name=r),class:"kn-material-input",type:"text",disabled:""},null,8,["modelValue"]),t("label",Uo,i(e.$t("managers.driversManagement.useModes.lov"))+" * ",1)]),t("i",{class:"pi pi-search input-buton",onClick:o[8]||(o[8]=r=>e.showLovsDialog("type"))})]),a(s,{class:"p-mt-1",vComp:e.v$.mode.typeLov,additionalTranslateParams:{fieldName:e.$t("managers.driversManagement.useModes.lov")},specificTranslateKeys:{required_lovId_for_lov:"common.validation.required"}},null,8,["vComp","additionalTranslateParams","specificTranslateKeys"])]),t("div",Fo,[t("span",No,[a(k,{id:"type",class:A(["kn-material-input",{"p-invalid":e.v$.mode.selectionType.$invalid&&e.v$.mode.selectionType.$dirty}]),modelValue:e.v$.mode.selectionType.$model,"onUpdate:modelValue":o[9]||(o[9]=r=>e.v$.mode.selectionType.$model=r),options:e.selectionTypes,optionLabel:"VALUE_NM",optionValue:"VALUE_CD",onBlur:o[10]||(o[10]=r=>e.v$.mode.selectionType.$touch()),onChange:e.modeChanged},null,8,["modelValue","options","class","onChange"]),t("label",Io,i(e.$t("managers.driversManagement.useModes.modality"))+" * ",1)]),a(s,{class:"p-mt-1",vComp:e.v$.mode.selectionType,additionalTranslateParams:{fieldName:e.$t("managers.driversManagement.useModes.modality")},specificTranslateKeys:{required_type_for_lov:"common.validation.required"}},null,8,["vComp","additionalTranslateParams","specificTranslateKeys"])])],512),[[E,e.mode.valueSelection==="lov"]]),D(t("div",qo,[t("div",Oo,[t("span",Bo,[a(k,{id:"type",class:A(["kn-material-input",{"p-invalid":e.v$.mode.selectedLayer.$invalid&&e.v$.mode.selectedLayer.$dirty}]),modelValue:e.v$.mode.selectedLayer.$model,"onUpdate:modelValue":o[11]||(o[11]=r=>e.v$.mode.selectedLayer.$model=r),options:e.layers,optionLabel:"name",optionValue:"name",onBlur:o[12]||(o[12]=r=>e.v$.mode.selectedLayer.$touch()),onChange:e.modeChanged},null,8,["modelValue","options","class","onChange"]),t("label",Po,i(e.$t("managers.driversManagement.useModes.layer"))+" * ",1)]),a(s,{class:"p-mt-1",vComp:e.v$.mode.selectedLayer,additionalTranslateParams:{fieldName:e.$t("managers.driversManagement.useModes.layer")},specificTranslateKeys:{required_for_map_in:"common.validation.required"}},null,8,["vComp","additionalTranslateParams","specificTranslateKeys"])]),t("div",Ro,[t("span",Ko,[a(d,{id:"prop",class:"kn-material-input",type:"text",modelValue:e.mode.selectedLayerProp,"onUpdate:modelValue":o[13]||(o[13]=r=>e.mode.selectedLayerProp=r)},null,8,["modelValue"]),t("label",Xo,i(e.$t("managers.driversManagement.useModes.layerProp")),1)])])],512),[[E,e.mode.valueSelection==="map_in"]])]),t("div",Jo,[t("div",jo,[t("span",Qo,[a(k,{id:"default",class:"kn-material-input",modelValue:e.selectedDefault,"onUpdate:modelValue":o[14]||(o[14]=r=>e.selectedDefault=r),options:e.defaults,optionLabel:"name",optionValue:"label",onChange:e.setDefault},null,8,["modelValue","options","onChange"]),t("label",Yo,i(e.$t("managers.driversManagement.useModes.defaultValue"))+" * ",1)])]),D(t("div",Go,[t("span",Ho,[t("span",Wo,[a(d,{id:"lov",modelValue:e.mode.defLov.name,"onUpdate:modelValue":o[15]||(o[15]=r=>e.mode.defLov.name=r),class:"kn-material-input",type:"text",disabled:""},null,8,["modelValue"]),t("label",Zo,i(e.$t("managers.driversManagement.useModes.lov"))+" * ",1)]),t("i",{class:"pi pi-search input-buton",onClick:o[16]||(o[16]=r=>e.showLovsDialog("default"))})]),a(s,{class:"p-mt-1",vComp:e.v$.mode.defLov,additionalTranslateParams:{fieldName:e.$t("managers.driversManagement.useModes.lov")},specificTranslateKeys:{required_lov_for_default:"common.validation.required"}},null,8,["vComp","additionalTranslateParams","specificTranslateKeys"])],512),[[E,e.selectedDefault==="lov"]]),D(t("div",et,[t("span",ot,[a(k,{id:"defaultFormula",class:A(["kn-material-input",{"p-invalid":e.v$.mode.defaultFormula.$invalid&&e.v$.mode.defaultFormula.$dirty}]),modelValue:e.v$.mode.defaultFormula.$model,"onUpdate:modelValue":o[17]||(o[17]=r=>e.v$.mode.defaultFormula.$model=r),options:e.useModeDescriptor.defaultFormula,optionLabel:"name",optionValue:"f_value",onBlur:o[18]||(o[18]=r=>e.v$.mode.defaultFormula.$touch()),onChange:e.modeChanged},null,8,["modelValue","options","class","onChange"]),t("label",tt,i(e.$t("managers.driversManagement.useModes.selectDefaultFormula"))+" * ",1)]),a(s,{class:"p-mt-1",vComp:e.v$.mode.defaultFormula,additionalTranslateParams:{fieldName:e.$t("managers.driversManagement.useModes.selectDefaultFormula")},specificTranslateKeys:{required_for_pick_up:"common.validation.required"}},null,8,["vComp","additionalTranslateParams","specificTranslateKeys"])],512),[[E,e.selectedDefault==="pickUp"]])]),t("div",at,[D(t("div",rt,[t("span",nt,[a(k,{id:"max",class:"kn-material-input",modelValue:e.selectedMax,"onUpdate:modelValue":o[19]||(o[19]=r=>e.selectedMax=r),options:e.useModeDescriptor.maxValues,optionLabel:"name",optionValue:"label",onChange:e.setMax},null,8,["modelValue","options","onChange"]),t("label",it,i(e.$t("managers.driversManagement.useModes.maxValue"))+" * ",1)])],512),[[E,e.isDate]]),D(t("div",lt,[t("span",st,[t("span",dt,[a(d,{id:"lov",modelValue:e.mode.maxLov.name,"onUpdate:modelValue":o[20]||(o[20]=r=>e.mode.maxLov.name=r),class:"kn-material-input",type:"text",disabled:""},null,8,["modelValue"]),t("label",ct,i(e.$t("managers.driversManagement.useModes.lov"))+" * ",1)]),t("i",{class:"pi pi-search input-buton",onClick:o[21]||(o[21]=r=>e.showLovsDialog("max"))})]),a(s,{class:"p-mt-1",vComp:e.v$.mode.maxLov,additionalTranslateParams:{fieldName:e.$t("managers.driversManagement.useModes.lov")},specificTranslateKeys:{required_lov_for_max:"common.validation.required"}},null,8,["vComp","additionalTranslateParams","specificTranslateKeys"])],512),[[E,e.selectedMax==="lov"]])])]),a(v,{dialogVisible:e.dialogVisiable,lovs:e.lovs,selectedLovProp:e.lov,onClose:o[22]||(o[22]=r=>e.dialogVisiable=!1),onApply:e.applyLov},null,8,["dialogVisible","lovs","selectedLovProp","onApply"])]),_:1})):w("",!0)}var bt=$(uo,[["render",pt]]);const mt=M({name:"roles-card",components:{Column:S,DataTable:z},props:{roles:{type:Array,required:!1},selectedModeProp:{type:Array,required:!1}},data(){return{selectedMode:[],filters:{global:[L],name:{operator:_.AND,constraints:[L]}}}},watch:{selectedModeProp(){this.selectedMode=this.selectedModeProp}},mounted(){this.selectedModeProp&&(this.selectedMode=this.selectedModeProp)}}),kt={class:"table-header"},ut={class:"p-input-icon-left"},vt=t("i",{class:"pi pi-search"},null,-1);function ht(e,o,c,b,g,m){const d=n("InputText"),s=n("Column"),k=n("DataTable"),v=n("Card");return p(),h(v,{style:{width:"100%"},class:"p-m-2"},{content:l(()=>[a(k,{paginator:!0,rows:10,selection:e.selectedMode.associatedRoles,"onUpdate:selection":o[1]||(o[1]=u=>e.selectedMode.associatedRoles=u),value:e.roles,class:"p-datatable-sm kn-table",dataKey:"id",responsiveLayout:"stack",filters:e.filters,"onUpdate:filters":o[2]||(o[2]=u=>e.filters=u),filterDisplay:"menu","data-test":"values-list"},{header:l(()=>[t("div",kt,[t("span",ut,[vt,a(d,{class:"kn-material-input",type:"text",modelValue:e.filters.global.value,"onUpdate:modelValue":o[0]||(o[0]=u=>e.filters.global.value=u),placeholder:e.$t("common.search"),badge:"0","data-test":"filter-input"},null,8,["modelValue","placeholder"])])])]),empty:l(()=>[x(i(e.$t("common.info.noDataFound")),1)]),loading:l(()=>[x(i(e.$t("common.info.dataLoading")),1)]),default:l(()=>[a(s,{selectionMode:"multiple",headerStyle:"width: 3rem"}),a(s,{field:"name",header:"Roles",class:"kn-truncated"})]),_:1},8,["selection","value","filters"])]),_:1})}var gt=$(mt,[["render",ht]]);const ft=M({name:"constraints-card",components:{Column:S,DataTable:z},props:{constraints:{type:Array,required:!1},selectedModeProp:{type:Array,required:!1}},data(){return{selectedMode:[],filters:{global:[L],name:{operator:_.AND,constraints:[L]}}}},watch:{selectedModeProp(){this.selectedMode=this.selectedModeProp}},mounted(){this.selectedModeProp&&(this.selectedMode=this.selectedModeProp)}}),yt={class:"table-header"},wt={class:"p-input-icon-left"},xt=t("i",{class:"pi pi-search"},null,-1);function Mt(e,o,c,b,g,m){const d=n("InputText"),s=n("Column"),k=n("DataTable"),v=n("Card");return p(),h(v,{style:{width:"100%"},class:"p-m-2"},{content:l(()=>[a(k,{selection:e.selectedMode.associatedChecks,"onUpdate:selection":o[1]||(o[1]=u=>e.selectedMode.associatedChecks=u),value:e.constraints,class:"p-datatable-sm kn-table",dataKey:"checkId",responsiveLayout:"stack",filters:e.filters,"onUpdate:filters":o[2]||(o[2]=u=>e.filters=u),filterDisplay:"menu","data-test":"values-list"},{header:l(()=>[t("div",yt,[t("span",wt,[xt,a(d,{class:"kn-material-input",type:"text",modelValue:e.filters.global.value,"onUpdate:modelValue":o[0]||(o[0]=u=>e.filters.global.value=u),placeholder:e.$t("common.search"),badge:"0","data-test":"filter-input"},null,8,["modelValue","placeholder"])])])]),empty:l(()=>[x(i(e.$t("common.info.noDataFound")),1)]),loading:l(()=>[x(i(e.$t("common.info.dataLoading")),1)]),default:l(()=>[a(s,{selectionMode:"multiple",headerStyle:"width: 3rem"}),a(s,{field:"name",header:"Constraints",class:"kn-truncated"})]),_:1},8,["selection","value","filters"])]),_:1})}var $t=$(ft,[["render",Mt]]);const Ct=M({name:"business-model-catalogue-detail",components:{Badge:K,TabView:te,TabPanel:ae,DetailsCard:bt,RolesCard:gt,ConstraintsCard:$t,KnHint:W},props:{selectedMode:{type:Object,required:!1},roles:{type:Array,requierd:!0},constraints:{type:Array,requierd:!0},selectionTypes:{type:Array,requierd:!0},layers:{type:Array,requierd:!0},isDate:{type:Boolean,requierd:!0},disabledRoles:{type:Array,required:!0},lovs:{type:Array,required:!0},showMapDriver:{type:Boolean,requierd:!0}},data(){return{mode:{}}},computed:{invalidModes(){return this.mode.numberOfErrors},invalidRoles(){return this.mode.associatedRoles.length===0},availableRoles(){var e;return(e=this.roles)==null?void 0:e.filter(o=>this.disabledRoles.findIndex(c=>o.id===(c==null?void 0:c.id))<0)}},watch:{selectedMode(){this.mode=this.selectedMode}},mounted(){this.selectedMode&&(this.mode=this.selectedMode)},methods:{}});function At(e,o,c,b,g,m){const d=n("KnHint"),s=n("Badge"),k=n("DetailsCard"),v=n("TabPanel"),u=n("RolesCard"),r=n("ConstraintsCard"),V=n("TabView");return e.selectedMode.useID?(p(),h(V,{key:1,class:"tabview-custom kn-page-content","data-test":"modes-form"},{default:l(()=>[a(v,null,{header:l(()=>[t("span",null,i(e.$t("managers.driversManagement.useModes.details")),1),e.invalidModes>0?(p(),h(s,{key:0,value:e.invalidModes,class:"p-ml-2",severity:"danger"},null,8,["value"])):w("",!0)]),default:l(()=>[a(k,{selectedMode:e.mode,selectionTypes:e.selectionTypes,layers:e.layers,isDate:e.isDate,lovs:e.lovs,showMapDriver:e.showMapDriver},null,8,["selectedMode","selectionTypes","layers","isDate","lovs","showMapDriver"])]),_:1}),a(v,null,{header:l(()=>[t("span",null,i(e.$t("managers.driversManagement.useModes.roles")),1),e.invalidRoles?(p(),h(s,{key:0,value:"1",class:"p-ml-2",severity:"danger"})):w("",!0)]),default:l(()=>[a(u,{roles:e.availableRoles,selectedModeProp:e.mode},null,8,["roles","selectedModeProp"])]),_:1}),a(v,null,{header:l(()=>[t("span",null,i(e.$t("managers.driversManagement.useModes.constraints")),1)]),default:l(()=>[a(r,{constraints:e.constraints,selectedModeProp:e.mode},null,8,["constraints","selectedModeProp"])]),_:1})]),_:1})):(p(),h(d,{key:0,class:"kn-card-reset",title:"managers.driversManagement.useModes.title",hint:"managers.driversManagement.useModes.hint","data-test":"mode-hint"},null,8,["title","hint"]))}var Dt=$(Ct,[["render",At]]);const Lt=M({name:"use-mode-card",components:{Listbox:X,UseModeDetail:Dt,Badge:K},directives:{tooltip:J},props:{propModes:{type:Array,required:!1},roles:{type:Array,requierd:!0},constraints:{type:Array,requierd:!0},selectionTypes:{type:Array,requierd:!0},layers:{type:Array,requierd:!0},lovs:{type:Array,requierd:!0},isDate:{type:Boolean,requierd:!0},showMapDriver:{type:Boolean,requierd:!0}},data(){return{driversManagemenDetailtDescriptor:I,selectedUseMode:{},modes:[],disabledRoles:[]}},watch:{propModes(){this.modes=this.propModes,this.selectedUseMode={}}},setup(){return{store:N()}},mounted(){this.propModes&&(this.modes=this.propModes)},methods:{showForm(e){e.value?this.selectedUseMode=e.value:(this.selectedUseMode={useID:-1,idLov:null,defaultFormula:null,idLovForMax:null,idLovForDefault:null,associatedRoles:[],associatedChecks:[]},this.modes.push(this.selectedUseMode)),this.disabledRoles=[],this.modes.forEach(o=>{o!=this.selectedUseMode&&(this.disabledRoles=this.disabledRoles.concat(o.associatedRoles))})},deleteModeConfirm(e){this.$confirm.require({message:this.$t("common.toast.deleteMessage"),header:this.$t("common.toast.deleteTitle"),icon:"pi pi-exclamation-triangle",accept:()=>this.deleteMode(e)})},async deleteMode(e){e.useID!=-1?await this.$http.delete("/knowage/restful-services/2.0/analyticalDrivers/modes/"+e.useID).then(()=>{this.store.setInfo({title:this.$t("common.toast.deleteTitle"),msg:this.$t("common.toast.deleteSuccess")}),this.modes.splice(this.modes.indexOf(e),1)}).catch(o=>{this.store.setError({title:this.$t("managers.driversManagement.deleteError"),msg:o.message})}):this.modes.splice(this.modes.indexOf(e)),this.selectedUseMode===e&&(this.selectedUseMode.useID=null)}}}),Tt={class:"p-grid p-m-0 p-col-12 p-p-0 kn-height-full"},Vt={class:"p-col-4 p-sm-4 p-md-3 p-p-0 kn-height-full"},Et={class:"kn-list-item"},_t={class:"kn-list-item-text"},St={"data-test":"list-item"},zt={class:"kn-list-item-text-secondary"},Ut={class:"p-col-8 p-sm-8 p-md-9 p-p-0"};function Ft(e,o,c,b,g,m){const d=n("Button"),s=n("Toolbar"),k=n("ProgressBar"),v=n("Badge"),u=n("Listbox"),r=n("UseModeDetail"),V=n("Card"),f=j("tooltip");return p(),h(V,{class:"p-col-12 kn-card kn-card-layout kn-tab-card"},{header:l(()=>[a(s,{class:"kn-toolbar kn-toolbar--secondary"},{start:l(()=>[t("span",null,i(e.$t("managers.driversManagement.useModes.title")),1)]),end:l(()=>[a(d,{label:e.$t("managers.driversManagement.add"),class:"kn-button p-button-text",disabled:e.disableActionButton,onClick:e.showForm,"data-test":"add-action-button"},null,8,["label","disabled","onClick"])]),_:1})]),content:l(()=>[t("div",Tt,[t("div",Vt,[e.loading?(p(),h(k,{key:0,mode:"indeterminate",class:"kn-progress-bar","data-test":"progress-bar"})):w("",!0),e.loading?w("",!0):(p(),h(u,{key:1,class:"kn-list kn-height-full",options:e.modes,optionLabel:"label",onChange:e.showForm,"data-test":"usemodes-list"},{empty:l(()=>[x(i(e.$t("common.info.noDataFound")),1)]),option:l(y=>[t("div",Et,[y.option.numberOfErrors>0||y.option.associatedRoles.length===0?(p(),h(v,{key:0,value:"!",class:"p-ml-2",severity:"danger"})):w("",!0),D((p(),T("div",_t,[t("span",St,i(y.option.label),1),t("span",zt,i(y.option.name),1)])),[[f,y.option.description,void 0,{top:!0}]]),a(d,{icon:"far fa-trash-alt",class:"p-button-text p-button-rounded p-button-plain",onClick:Q(C=>e.deleteModeConfirm(y.option),["stop"]),"data-test":"delete-button"},null,8,["onClick"])])]),_:1},8,["options","onChange"]))]),t("div",Ut,[a(r,{"data-test":"modes-form",selectedMode:e.selectedUseMode,selectionTypes:e.selectionTypes,roles:e.roles,constraints:e.constraints,lovs:e.lovs,disabledRoles:e.disabledRoles,layers:e.layers,isDate:e.isDate,showMapDriver:e.showMapDriver},null,8,["selectedMode","selectionTypes","roles","constraints","lovs","disabledRoles","layers","isDate","showMapDriver"])])])]),_:1})}var Nt=$(Lt,[["render",Ft]]);const It=M({name:"metadata-management-detail",components:{DriversDetailCard:Te,UseMode:Nt},props:{selectedDriver:{type:Object,required:!1}},computed:{buttonDisabled(){return!this.driver.label||!this.driver.name||!this.driver.type||this.invalidUseModes>0||this.noRoleSelected>0},invalidUseModes(){return this.modes.filter(e=>e.numberOfErrors>0).length},noRoleSelected(){return this.modes.filter(e=>e.associatedRoles.length===0).length},title(){return this.driver.id?this.driver.name:this.$t("common.new")},filteredTypes(){return this.types.filter(e=>e.VALUE_CD!="DATE_RANGE")},filteredSelectionTypes(){return this.selectionTypes.filter(e=>e.VALUE_CD!="SLIDER")},isDateType(){var e;return((e=this.driver.type)==null?void 0:e.toLowerCase())==="date"}},data(){return{driver:{},types:[],modes:[],modesToSave:[],roles:[],constraints:[],selectionTypes:[],layers:[],lovs:[],operation:"insert",useModeOperation:"insert",showMapDriver:!1,driversManagemenDetailtDescriptor:I}},watch:{selectedDriver(){this.driver={...this.selectedDriver},this.getModes()}},setup(){return{store:N()}},mounted(){this.driver&&(this.driver={...this.selectedDriver},this.getModes()),this.showMapDriver=this.store.$state.user.functionalities.indexOf("MapDriverManagement")>-1,this.loadAll()},methods:{async getTypes(){await this.$http.get("/knowage/restful-services/domains/listValueDescriptionByType?DOMAIN_TYPE=PAR_TYPE").then(e=>this.types=e.data)},async getModes(){this.driver.id?await this.$http.get("/knowage/restful-services/2.0/analyticalDrivers/"+this.driver.id+"/modes/").then(e=>this.modes=e.data):this.modes=[]},async getRoles(){await this.$http.get("/knowage/restful-services/2.0/roles").then(e=>this.roles=e.data)},async getConstraints(){await this.$http.get("/knowage/restful-services/2.0/analyticalDrivers/checks").then(e=>this.constraints=e.data)},async getselectionTypes(){await this.$http.get("/knowage/restful-services/domains/listValueDescriptionByType?DOMAIN_TYPE=SELECTION_TYPE").then(e=>this.selectionTypes=e.data)},async getLayers(){await this.$http.get("/knowage/restful-services/2.0/analyticalDriversee/layers").then(e=>this.layers=e.data)},async getLovs(){await this.$http.get("/knowage/restful-services/2.0/lovs/get/all").then(e=>this.lovs=e.data)},loadAll(){this.getTypes(),this.getRoles(),this.getConstraints(),this.getselectionTypes(),this.showMapDriver&&this.getLayers(),this.getLovs()},formatDriver(){this.driver.length=0;let e=this.types.filter(o=>o.VALUE_CD===this.driver.type);this.driver.type=e[0].VALUE_CD,this.driver.typeId=e[0].VALUE_ID},formatUseMode(){let e=this.modes.filter(o=>o.edited);this.modesToSave=[],e.forEach(o=>{o.maximizerEnabled=!1,o.manualInput=o.valueSelection=="man_in"?1:0,o.idLov===null&&(o.idLov=-1),o.idLovForDefault===null&&(o.idLovForDefault=-1),o.idLovForMax===null&&(o.idLovForMax=-1);const c=JSON.parse(JSON.stringify(o));delete c.numberOfErrors,delete c.defLov,delete c.typeLov,delete c.maxLov,delete c.edited,this.modesToSave.push(c)})},async handleSubmit(){if(this.formatDriver(),this.formatUseMode(),this.modesToSave.length===0)return this.store.setWarning({title:this.$t("common.toast.errorTitle"),msg:this.$t("managers.driversManagement.noModesSelected")});let e="/knowage/restful-services/2.0/analyticalDrivers/";this.driver.id?(this.operation="update",e+=this.driver.id):this.operation="insert";let o="";const c=[];await this.sendRequest(e).then(b=>{this.operation==="insert"&&(this.driver=b.data),this.$emit("created",this.driver),o="OK"}).catch(b=>{o=b.message});for(let b=0;b<this.modesToSave.length;b++){const g=this.modesToSave[b];let m="/knowage/restful-services/2.0/analyticalDrivers/modes/";g.id=this.driver.id,g.useID!=-1?(this.useModeOperation="update",m+=g.id):(delete g.useID,this.useModeOperation="insert"),await this.sendUseModeRequest(m,g).catch(d=>c.push(d==null?void 0:d.message)),this.getModes()}if(o==="OK"&&c.length===0)this.store.setInfo({title:this.$t(this.driversManagemenDetailtDescriptor.operation[this.operation].toastTitle),msg:this.$t(this.driversManagemenDetailtDescriptor.operation.success)});else if(c.length>0){const b=o==="OK"?this.$t("managers.driversManagement.partialSuccessMessage")+`

`:"";this.store.setError({title:this.$t("common.toast.errorTitle"),msg:b.concat(c.join(`

`))})}else this.store.setError({title:this.$t("common.toast.errorTitle"),msg:o})},sendRequest(e){return this.operation==="insert"?this.$http.post(e,this.driver,{headers:{"X-Disable-Errors":"true"}}):this.$http.put(e,this.driver,{headers:{"X-Disable-Errors":"true"}})},sendUseModeRequest(e,o){return this.useModeOperation==="insert"?this.$http.post(e,o,{headers:{"X-Disable-Errors":"true"}}):this.$http.put(e,o,{headers:{"X-Disable-Errors":"true"}})},setDirty(){this.$emit("touched")},closeTemplate(){this.$emit("close")}}}),qt={class:"p-grid p-m-0 p-p-2 p-fluid p-d-flex p-flex-column kn-height-full kn-overflow-y","data-test":"drivers-form"};function Ot(e,o,c,b,g,m){const d=n("Button"),s=n("Toolbar"),k=n("DriversDetailCard"),v=n("UseMode");return p(),T(F,null,[a(s,{class:"kn-toolbar kn-toolbar--secondary p-p-0 p-m-0"},{start:l(()=>[x(i(e.title),1)]),end:l(()=>[a(d,{icon:"pi pi-save",class:"p-button-text p-button-rounded p-button-plain",disabled:e.buttonDisabled,onClick:e.handleSubmit},null,8,["disabled","onClick"]),a(d,{class:"p-button-text p-button-rounded p-button-plain",icon:"pi pi-times",onClick:e.closeTemplate},null,8,["onClick"])]),_:1}),t("div",qt,[a(k,{class:"p-mt-2",selectedDriver:e.driver,types:e.filteredTypes,onTouched:e.setDirty},null,8,["selectedDriver","types","onTouched"]),a(v,{class:"kn-flex-grow p-mt-2",propModes:e.modes,roles:e.roles,constraints:e.constraints,layers:e.layers,lovs:e.lovs,selectionTypes:e.filteredSelectionTypes,isDate:e.isDateType,showMapDriver:e.showMapDriver},null,8,["propModes","roles","constraints","layers","lovs","selectionTypes","isDate","showMapDriver"])])],64)}var Bt=$(It,[["render",Ot],["__scopeId","data-v-38cb6767"]]);const Pt=["name","label"],Rt={DATE:{icon:"far fa-calendar",style:{"background-color":"#FFCC8D",color:"black"},tooltip:"Date"},NUM:{icon:"fas fa-hashtag",style:{"background-color":"#B477C0",color:"black"},tooltip:"Number"},STRING:{icon:"fas fa-quote-right",style:{"background-color":"#9BCD9B",color:"black"},tooltip:"String"}};var Kt={filterFields:Pt,iconTypesMap:Rt};const Xt=M({name:"constraint-management",components:{FabButton:re,KnHint:W,Listbox:X,Avatar:ne,DriversManagementDetail:Bt},directives:{tooltip:J},data(){return{loading:!1,touched:!1,formVisible:!1,driversManagementDescriptor:Kt,drivers:[],selectedDriver:{}}},setup(){return{store:N()}},created(){this.loadAllDrivers()},methods:{async loadAllDrivers(){this.loading=!0,await this.$http.get("/knowage/restful-services/2.0/analyticalDrivers").then(e=>this.drivers=e.data).finally(()=>this.loading=!1)},showForm(e){this.touched?this.$confirm.require({message:this.$t("common.toast.unsavedChangesMessage"),header:this.$t("common.toast.unsavedChangesHeader"),icon:"pi pi-exclamation-triangle",accept:()=>{this.touched=!1,this.setSelectedDriver(e)}}):this.setSelectedDriver(e)},closeForm(){this.touched?this.$confirm.require({message:this.$t("common.toast.unsavedChangesMessage"),header:this.$t("common.toast.unsavedChangesHeader"),icon:"pi pi-exclamation-triangle",accept:()=>{this.touched=!1,this.formVisible=!1}}):this.formVisible=!1},setSelectedDriver(e){e&&(this.selectedDriver=e.value),this.formVisible=!0},handleSave(e){this.loadAllDrivers(),this.touched=!1,this.selectedDriver=e},deleteDriverConfirm(e){this.$confirm.require({message:this.$t("common.toast.deleteMessage"),header:this.$t("common.toast.deleteTitle"),icon:"pi pi-exclamation-triangle",accept:()=>this.deleteDriver(e)})},async deleteDriver(e){await this.$http.delete("/knowage/restful-services/2.0/analyticalDrivers/"+e).then(()=>{this.store.setInfo({title:this.$t("common.toast.deleteTitle"),msg:this.$t("common.toast.deleteSuccess")}),this.loadAllDrivers(),this.formVisible=!1}).catch(o=>{this.store.setError({title:this.$t("managers.driversManagement.deleteError"),msg:o.message})})}}}),Jt={class:"kn-page-content p-grid p-m-0"},jt={class:"p-col-4 p-sm-4 p-md-3 p-p-0"},Qt={class:"kn-list-item","data-test":"list-item"},Yt={class:"kn-list-item-text"},Gt={class:"kn-list-item-text-secondary"},Ht={class:"kn-list--column p-col-8 p-sm-8 p-md-9 p-p-0"};function Wt(e,o,c,b,g,m){const d=n("FabButton"),s=n("Toolbar"),k=n("ProgressBar"),v=n("Avatar"),u=n("Button"),r=n("Listbox"),V=n("KnHint"),f=n("DriversManagementDetail"),y=j("tooltip");return p(),T("div",Jt,[t("div",jt,[a(s,{class:"kn-toolbar kn-toolbar--primary"},{start:l(()=>[x(i(e.$t("managers.driversManagement.title")),1)]),end:l(()=>[a(d,{icon:"fas fa-plus",onClick:e.showForm,"data-test":"open-form-button"},null,8,["onClick"])]),_:1}),e.loading?(p(),h(k,{key:0,mode:"indeterminate",class:"kn-progress-bar","data-test":"progress-bar"})):w("",!0),e.loading?w("",!0):(p(),h(r,{key:1,class:"kn-list--column",options:e.drivers,optionLabel:"label",filter:!0,filterPlaceholder:e.$t("common.search"),filterMatchMode:"contains",filterFields:e.driversManagementDescriptor.filterFields,emptyFilterMessage:e.$t("common.info.noDataFound"),onChange:e.showForm,"data-test":"drivers-list"},{empty:l(()=>[x(i(e.$t("common.info.noDataFound")),1)]),option:l(C=>[t("div",Qt,[D(a(v,{icon:e.driversManagementDescriptor.iconTypesMap[C.option.type].icon,style:U(e.driversManagementDescriptor.iconTypesMap[C.option.type].style),shape:"circle",size:"medium"},null,8,["icon","style"]),[[y,e.driversManagementDescriptor.iconTypesMap[C.option.type].tooltip]]),D((p(),T("div",Yt,[t("span",null,i(C.option.label),1),t("span",Gt,i(C.option.name),1)])),[[y,C.option.description,void 0,{top:!0}]]),a(u,{icon:"far fa-trash-alt",class:"p-button-text p-button-rounded p-button-plain",onClick:Q(Zt=>e.deleteDriverConfirm(C.option.id),["stop"]),"data-test":"delete-button"},null,8,["onClick"])])]),_:1},8,["options","filterPlaceholder","filterFields","emptyFilterMessage","onChange"]))]),t("div",Ht,[e.formVisible?(p(),h(f,{key:1,selectedDriver:e.selectedDriver,onCreated:e.handleSave,onClose:e.closeForm,onTouched:o[0]||(o[0]=C=>e.touched=!0),"data-test":"drivers-form"},null,8,["selectedDriver","onCreated","onClose"])):(p(),h(V,{key:0,title:"managers.driversManagement.title",hint:"managers.driversManagement.hint"},null,8,["title","hint"]))])])}var ia=$(Xt,[["render",Wt]]);export{ia as default};
//# sourceMappingURL=DriversManagement-ef6efd59.js.map
