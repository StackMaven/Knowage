{"version":3,"file":"DataSourceManagement-11b14b42.js","sources":["../../../../modules/managers/dataSourceManagement/DataSourceManagement.vue"],"sourcesContent":["<template>\r\n    <div class=\"kn-page-content p-grid p-m-0\">\r\n        <div class=\"kn-list--column p-col-4 p-sm-4 p-md-3 p-p-0\">\r\n            <Toolbar class=\"kn-toolbar kn-toolbar--primary\">\r\n                <template #start>\r\n                    {{ $t('managers.dataSourceManagement.title') }}\r\n                </template>\r\n                <template #end>\r\n                    <FabButton icon=\"fas fa-plus\" @click=\"showForm\" data-test=\"open-form-button\" />\r\n                </template>\r\n            </Toolbar>\r\n            <ProgressBar mode=\"indeterminate\" class=\"kn-progress-bar\" v-if=\"loading\" data-test=\"progress-bar\" />\r\n            <Listbox\r\n                v-if=\"!loading\"\r\n                class=\"kn-list--column\"\r\n                :options=\"datasources\"\r\n                optionLabel=\"label\"\r\n                :filter=\"true\"\r\n                :filterPlaceholder=\"$t('common.search')\"\r\n                filterMatchMode=\"contains\"\r\n                :filterFields=\"dataSourceDescriptor.filterFields\"\r\n                :emptyFilterMessage=\"$t('common.info.noDataFound')\"\r\n                @change=\"showForm\"\r\n                data-test=\"datasource-list\"\r\n            >\r\n                <template #empty>{{ $t('common.info.noDataFound') }}</template>\r\n                <template #option=\"slotProps\">\r\n                    <div class=\"kn-list-item\" data-test=\"list-item\">\r\n                        <Avatar\r\n                            :icon=\"dataSourceDescriptor.iconTypesMap[slotProps.option.dialectName]?.dbIcon\"\r\n                            shape=\"circle\"\r\n                            size=\"medium\"\r\n                            :style=\"dataSourceDescriptor.iconTypesMap[slotProps.option.dialectName]?.style\"\r\n                            v-tooltip=\"dataSourceDescriptor.iconTypesMap[slotProps.option.dialectName]?.tooltip\"\r\n                        />\r\n                        <div class=\"kn-list-item-text\">\r\n                            <span>{{ slotProps.option.label }}</span>\r\n                            <span class=\"kn-list-item-text-secondary\">{{ slotProps.option.descr }}</span>\r\n                        </div>\r\n                        <Button icon=\"far fa-trash-alt\" class=\"p-button-text p-button-rounded p-button-plain\" v-if=\"slotProps.option.owner == this.user.userId || this.user.isSuperadmin\" @click.stop=\"deleteDatasourceConfirm(slotProps.option.dsId)\" data-test=\"delete-button\" />\r\n                    </div>\r\n                </template>\r\n            </Listbox>\r\n        </div>\r\n        <div class=\"p-col-8 p-sm-8 p-md-9 p-p-0 p-m-0 p-d-flex p-flex-column kn-height-full-vertical\">\r\n            <router-view :selectedDatasource=\"selDatasource\" :databases=\"listOfAvailableDatabases\" :user=\"user\" @touched=\"touched = true\" @closed=\"onFormClose\" @inserted=\"reloadPage\" />\r\n        </div>\r\n    </div>\r\n</template>\r\n\r\n<script lang=\"ts\">\r\n/* eslint-disable no-prototype-builtins */\r\nimport { defineComponent } from 'vue'\r\nimport { AxiosResponse } from 'axios'\r\nimport dataSourceDescriptor from './DataSourceDescriptor.json'\r\nimport FabButton from '@/components/UI/KnFabButton.vue'\r\nimport Listbox from 'primevue/listbox'\r\nimport Avatar from 'primevue/avatar'\r\nimport mainStore from '../../../App.store'\r\n\r\nexport default defineComponent({\r\n    name: 'datasources-management',\r\n    components: {\r\n        FabButton,\r\n        Listbox,\r\n        Avatar\r\n    },\r\n    data() {\r\n        return {\r\n            dataSourceDescriptor,\r\n            datasources: [] as any[],\r\n            selDatasource: {} as any,\r\n            listOfAvailableDatabases: [] as any,\r\n            user: {} as any,\r\n            loading: false,\r\n            touched: false\r\n        }\r\n    },\r\n    setup() {\r\n        const store = mainStore()\r\n        return { store }\r\n    },\r\n    async created() {\r\n        await this.getAllDatasources()\r\n        await this.getAllDatabases()\r\n        await this.getCurrentUser()\r\n    },\r\n    methods: {\r\n        async getAllDatabases() {\r\n            return this.$http\r\n                .get(import.meta.env.VITE_RESTFUL_SERVICES_PATH + `2.0/databases`)\r\n                .then((response: AxiosResponse<any>) => {\r\n                    this.listOfAvailableDatabases = response.data\r\n                })\r\n                .finally(() => (this.loading = false))\r\n        },\r\n\r\n        async getCurrentUser() {\r\n            return this.$http\r\n                .get(import.meta.env.VITE_RESTFUL_SERVICES_PATH + `2.0/currentuser`)\r\n                .then((response: AxiosResponse<any>) => {\r\n                    this.user = response.data\r\n                })\r\n                .finally(() => (this.loading = false))\r\n        },\r\n\r\n        async getAllDatasources() {\r\n            this.loading = true\r\n            await this.$http\r\n                .get(import.meta.env.VITE_RESTFUL_SERVICES_PATH + '2.0/datasources')\r\n                .then((response: AxiosResponse<any>) => {\r\n                    this.datasources = response.data\r\n                    this.convertToSeconds(this.datasources)\r\n                })\r\n                .finally(() => (this.loading = false))\r\n        },\r\n        convertToSeconds(dataSourceArr) {\r\n            Array.prototype.forEach.call(dataSourceArr, (dataSource) => {\r\n                if (dataSource.hasOwnProperty('jdbcPoolConfiguration')) {\r\n                    dataSource.jdbcPoolConfiguration.maxWait /= 1000\r\n                    dataSource.jdbcPoolConfiguration.timeBetweenEvictionRuns /= 1000\r\n                    dataSource.jdbcPoolConfiguration.minEvictableIdleTimeMillis /= 1000\r\n                    if (dataSource.jdbcPoolConfiguration.maxIdle === null) dataSource.jdbcPoolConfiguration.maxIdle = dataSourceDescriptor.newDataSourceValues.jdbcPoolConfiguration.maxIdle\r\n                    if (dataSource.jdbcPoolConfiguration.validationQueryTimeout === null) dataSource.jdbcPoolConfiguration.validationQueryTimeout = dataSourceDescriptor.newDataSourceValues.jdbcPoolConfiguration.validationQueryTimeout\r\n                }\r\n            })\r\n        },\r\n\r\n        showForm(event: any) {\r\n            const path = event.value ? `/datasource-management/${event.value.dsId}` : '/datasource-management/new-datasource'\r\n\r\n            if (!this.touched) {\r\n                this.$router.push(path)\r\n                this.selDatasource = event.value\r\n            } else {\r\n                this.$confirm.require({\r\n                    message: this.$t('common.toast.unsavedChangesMessage'),\r\n                    header: this.$t('common.toast.unsavedChangesHeader'),\r\n                    icon: 'pi pi-exclamation-triangle',\r\n                    accept: () => {\r\n                        this.touched = false\r\n                        this.$router.push(path)\r\n                        this.selDatasource = event.value\r\n                    }\r\n                })\r\n            }\r\n        },\r\n\r\n        deleteDatasourceConfirm(datasourceId: number) {\r\n            this.$confirm.require({\r\n                message: this.$t('common.toast.deleteMessage'),\r\n                header: this.$t('common.toast.deleteTitle'),\r\n                icon: 'pi pi-exclamation-triangle',\r\n                accept: () => this.deleteDatasource(datasourceId)\r\n            })\r\n        },\r\n        async deleteDatasource(datasourceId: number) {\r\n            await this.$http\r\n                .delete(import.meta.env.VITE_RESTFUL_SERVICES_PATH + '2.0/datasources/' + datasourceId)\r\n                .then(() => {\r\n                    this.store.setInfo({\r\n                        title: this.$t('common.toast.deleteTitle'),\r\n                        msg: this.$t('common.toast.deleteSuccess')\r\n                    })\r\n                    this.$router.push('/datasource-management')\r\n                    this.getAllDatasources()\r\n                })\r\n                .catch((error) => {\r\n                    this.store.setError({ title: 'Delete error', msg: error.message })\r\n                })\r\n        },\r\n\r\n        reloadPage() {\r\n            this.touched = false\r\n            this.$router.push('/datasource-management')\r\n            this.getAllDatasources()\r\n        },\r\n        onFormClose() {\r\n            this.touched = false\r\n        }\r\n    }\r\n})\r\n</script>\r\n"],"names":["FabButton","Listbox","Avatar","mainStore","_openBlock","_createElementBlock","_createElementVNode","_createVNode","_withCtx","_createBlock","_createCommentVNode","_withDirectives","_normalizeStyle","_toDisplayString"],"mappings":"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"}