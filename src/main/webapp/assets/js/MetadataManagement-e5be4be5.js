import{d as x,a5 as V,s as M,_ as $,r as n,o as l,c as C,f as o,w as s,a as e,G as p,t as i,B as _,X as D,a4 as N,g as w,h as k,A as m}from"./index-1e676509.js";import{K as B}from"./KnHint-6d455703.js";import{K as F,u as S,c as I}from"./KnValidatonMessages-ebe48c72.js";const L=["name","dataType"],U={insert:{toastTitle:"common.toast.createTitle"},update:{toastTitle:"common.toast.updateTitle"},success:"common.toast.success"},K=[{name:"SHORT_TEXT",value:"SHORT_TEXT"},{name:"LONG_TEXT",value:"LONG_TEXT"},{name:"FILE",value:"FILE"}];var h={filterFields:L,operation:U,metadataTypes:K};const X={metadata:[{fieldName:"label",validators:[{key:"required"},{key:"regex",validator:{type:"extendedAlphanumericRegex"}}]},{fieldName:"name",validators:[{key:"required"},{key:"regex",validator:{type:"extendedAlphanumericRegex"}}]},{fieldName:"description",validators:[{key:"regex",validator:{type:"extendedAlphanumericRegex"}}]},{fieldName:"dataType",validators:[{key:"required"}]}]};var y={validations:X};const P=x({name:"metadata-management-detail",components:{Dropdown:V,KnValidationMessages:F},props:{model:{type:Object,required:!1}},emits:["close","saved","touched"],data(){return{metadataManagementDescriptor:h,metadataManagementValidationDescriptor:y,metadata:{},metadataTypes:h.metadataTypes,submitted:!1,operation:"insert",v$:S()}},validations(){return{metadata:I("metadata",y.validations.metadata)}},computed:{buttonDisabled(){return this.v$.$invalid},title(){return this.metadata.id?this.$t("common.edit"):this.$t("common.new")}},watch:{model(){this.v$.$reset(),this.metadata={...this.model}}},setup(){return{store:M()}},mounted(){this.model&&(this.metadata={...this.model})},methods:{async handleSubmit(){this.v$.$invalid||(this.metadata.id&&(this.operation="update"),await this.$http.post("/knowage/restful-services/2.0/objMetadata",this.metadata).then(()=>{this.store.setInfo({title:this.$t(this.metadataManagementDescriptor.operation[this.operation].toastTitle),msg:this.$t(this.metadataManagementDescriptor.operation.success)}),this.$emit("saved")}))},closeTemplate(){this.$emit("close")},setDirty(){this.$emit("touched")}}}),j={class:"p-grid p-m-0 p-fluid p-jc-center","data-test":"metadata-form"},R={class:"p-col-9"},O={class:"p-fluid p-m-5"},q={class:"p-field"},G={class:"p-float-label"},H={for:"label",class:"kn-material-input-label"},Q={class:"p-field"},J={class:"p-float-label"},Y={for:"name",class:"kn-material-input-label"},Z={class:"p-field"},W={class:"p-float-label"},aa={for:"description",class:"kn-material-input-label"},ta={class:"p-field"},ea={class:"p-float-label"},oa={for:"dataType",class:"kn-material-input-label"};function ra(a,t,A,T,E,z){const c=n("Button"),v=n("Toolbar"),b=n("InputText"),d=n("KnValidationMessages"),u=n("Dropdown"),g=n("Card");return l(),C(_,null,[o(v,{class:"kn-toolbar kn-toolbar--secondary p-p-0 p-m-0"},{end:s(()=>[o(c,{icon:"pi pi-save",class:"kn-button p-button-text p-button-rounded",disabled:a.buttonDisabled,onClick:a.handleSubmit},null,8,["disabled","onClick"]),o(c,{class:"kn-button p-button-text p-button-rounded",icon:"pi pi-times",onClick:a.closeTemplate},null,8,["onClick"])]),_:1}),e("div",j,[e("div",R,[o(g,null,{content:s(()=>[e("form",O,[e("div",q,[e("span",G,[o(b,{id:"label",class:p(["kn-material-input",{"p-invalid":a.v$.metadata.label.$invalid&&a.v$.metadata.label.$dirty}]),type:"text",modelValue:a.v$.metadata.label.$model,"onUpdate:modelValue":t[0]||(t[0]=r=>a.v$.metadata.label.$model=r),modelModifiers:{trim:!0},onBlur:t[1]||(t[1]=r=>a.v$.metadata.label.$touch()),onChange:a.setDirty,"data-test":"label-input"},null,8,["modelValue","class","onChange"]),e("label",H,i(a.$t("common.label"))+" * ",1)]),o(d,{vComp:a.v$.metadata.label,additionalTranslateParams:{fieldName:a.$t("common.label")}},null,8,["vComp","additionalTranslateParams"])]),e("div",Q,[e("span",J,[o(b,{id:"name",class:p(["kn-material-input",{"p-invalid":a.v$.metadata.name.$invalid&&a.v$.metadata.name.$dirty}]),type:"text",modelValue:a.v$.metadata.name.$model,"onUpdate:modelValue":t[2]||(t[2]=r=>a.v$.metadata.name.$model=r),modelModifiers:{trim:!0},onBlur:t[3]||(t[3]=r=>a.v$.metadata.name.$touch()),onChange:a.setDirty,"data-test":"name-input"},null,8,["modelValue","class","onChange"]),e("label",Y,i(a.$t("common.name"))+" * ",1)]),o(d,{vComp:a.v$.metadata.name,additionalTranslateParams:{fieldName:a.$t("common.name")}},null,8,["vComp","additionalTranslateParams"])]),e("div",Z,[e("span",W,[o(b,{id:"description",class:p(["kn-material-input",{"p-invalid":a.v$.metadata.description.$invalid&&a.v$.metadata.description.$dirty}]),type:"text",modelValue:a.v$.metadata.description.$model,"onUpdate:modelValue":t[4]||(t[4]=r=>a.v$.metadata.description.$model=r),modelModifiers:{trim:!0},onBlur:t[5]||(t[5]=r=>a.v$.metadata.description.$touch()),onChange:a.setDirty,"data-test":"description-input"},null,8,["modelValue","class","onChange"]),e("label",aa,i(a.$t("common.description")),1)]),o(d,{vComp:a.v$.metadata.description,additionalTranslateParams:{fieldName:a.$t("common.description")}},null,8,["vComp","additionalTranslateParams"])]),e("div",ta,[e("span",ea,[o(u,{id:"dataType",class:p(["kn-material-input",{"p-invalid":a.v$.metadata.dataType.$invalid&&a.v$.metadata.dataType.$dirty}]),modelValue:a.v$.metadata.dataType.$model,"onUpdate:modelValue":t[6]||(t[6]=r=>a.v$.metadata.dataType.$model=r),options:a.metadataTypes,optionLabel:"name",optionValue:"value",onBeforeShow:t[7]||(t[7]=r=>a.v$.metadata.dataType.$touch()),onChange:a.setDirty,"data-test":"dataType-dropdown"},null,8,["class","modelValue","options","onChange"]),e("label",oa,i(a.$t("common.type"))+" * ",1)]),o(d,{vComp:a.v$.metadata.dataType,additionalTranslateParams:{fieldName:a.$t("common.type")}},null,8,["vComp","additionalTranslateParams"])])])]),_:1})])])],64)}var na=$(P,[["render",ra]]);const ia=x({name:"metadata-management",components:{KnFabButton:D,Listbox:N,MetadataManagementDetail:na,KnHint:B},data(){return{metadataManagementDescriptor:h,metadataList:[],formVisible:!1,loading:!1,touched:!1,selectedMetadata:{}}},setup(){return{store:M()}},created(){this.loadAllMetadata()},methods:{async loadAllMetadata(){this.loading=!0,this.metadataList=[],await this.$http.get("/knowage/restful-services/2.0/objMetadata").then(a=>a.data.map(t=>{this.metadataList.push({id:t.objMetaId,label:t.label,name:t.name,description:t.description,dataType:t.dataTypeCode})})).finally(()=>this.loading=!1)},showForm(a){this.touched?this.$confirm.require({message:this.$t("common.toast.unsavedChangesMessage"),header:this.$t("common.toast.unsavedChangesHeader"),icon:"pi pi-exclamation-triangle",accept:()=>{this.touched=!1,this.setSelectedMetadata(a)}}):this.setSelectedMetadata(a)},deleteMetadataConfirm(a){this.$confirm.require({message:this.$t("common.toast.deleteMessage"),header:this.$t("common.toast.deleteTitle"),icon:"pi pi-exclamation-triangle",accept:()=>this.deleteMetadata(a)})},async deleteMetadata(a){await this.$http.delete("/knowage/restful-services/2.0/objMetadata/"+a).then(()=>{this.store.setInfo({title:this.$t("common.toast.deleteTitle"),msg:this.$t("common.toast.deleteSuccess")}),this.closeForm(),this.loadAllMetadata()})},closeForm(){this.formVisible=!1},reloadMetadata(){this.touched=!1,this.formVisible=!1,this.loadAllMetadata()},setSelectedMetadata(a){a&&(this.selectedMetadata=a.value),this.formVisible=!0}}}),da={class:"kn-page"},la={class:"kn-page-content p-grid p-m-0"},sa={class:"kn-list--column p-col-4 p-sm-4 p-md-3 p-p-0"},ba={class:"kn-list-item","data-test":"list-item"},ca={class:"kn-list-item-text"},fa={class:"kn-list-item-text-secondary"},pa={class:"kn-list--column p-col-8 p-sm-8 p-md-9 p-p-0"};function ka(a,t,A,T,E,z){const c=n("KnFabButton"),v=n("Toolbar"),b=n("ProgressBar"),d=n("Button"),u=n("Listbox"),g=n("KnHint"),r=n("MetadataManagementDetail");return l(),C("div",da,[e("div",la,[e("div",sa,[o(v,{class:"kn-toolbar kn-toolbar--primary"},{start:s(()=>[w(i(a.$t("managers.metadata.title")),1)]),end:s(()=>[o(c,{icon:"fas fa-plus",onClick:a.showForm,"data-test":"open-form-button"},null,8,["onClick"])]),_:1}),a.loading?(l(),k(b,{key:0,mode:"indeterminate",class:"kn-progress-bar","data-test":"progress-bar"})):m("",!0),a.loading?m("",!0):(l(),k(u,{key:1,class:"kn-list--column",options:a.metadataList,filter:!0,filterPlaceholder:a.$t("common.search"),optionLabel:"name",filterMatchMode:"contains",filterFields:a.metadataManagementDescriptor.filterFields,emptyFilterMessage:a.$t("managers.widgetGallery.noResults"),onChange:a.showForm,"data-test":"metadata-list"},{empty:s(()=>[w(i(a.$t("common.info.noDataFound")),1)]),option:s(f=>[e("div",ba,[e("div",ca,[e("span",null,i(f.option.name),1),e("span",fa,i(f.option.dataType),1)]),o(d,{icon:"pi pi-trash",class:"p-button-link p-button-sm",onClick:ma=>a.deleteMetadataConfirm(f.option.id),"data-test":"delete-button"},null,8,["onClick"])])]),_:1},8,["options","filterPlaceholder","filterFields","emptyFilterMessage","onChange"]))]),e("div",pa,[a.formVisible?m("",!0):(l(),k(g,{key:0,title:"managers.metadata.title",hint:"managers.metadata.hint"},null,8,["title","hint"])),a.formVisible?(l(),k(r,{key:1,model:a.selectedMetadata,onClose:a.closeForm,onSaved:a.reloadMetadata,onTouched:t[0]||(t[0]=f=>a.touched=!0)},null,8,["model","onClose","onSaved"])):m("",!0)])])])}var ha=$(ia,[["render",ka],["__scopeId","data-v-303b4f5f"]]);export{ha as default};
//# sourceMappingURL=MetadataManagement-e5be4be5.js.map
