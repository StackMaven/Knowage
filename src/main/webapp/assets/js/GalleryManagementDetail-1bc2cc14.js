import{_ as I,d as N,ah as S,a5 as B,O as L,v as G,u as P,s as j,a8 as C,r as i,y as O,o as n,c as l,f as r,w as s,g as u,t as d,z as b,h as M,A as f,a as e,G as k,B as g,C as A,p as R,b as W}from"./index-1e676509.js";import{s as X}from"./chips.esm-693c3c01.js";import{s as F}from"./textarea.esm-32051d54.js";import{g as J}from"./GalleryManagementDescriptor-33e009e7.js";const Q=N({name:"gallery-management-detail",components:{Chips:X,VCodeMirror:S,Dropdown:B,InputText:L,TabView:G,TabPanel:P,Textarea:F},emits:["saved"],props:{id:String},data(){return{dirty:!1,files:[],loading:!1,test:"",galleryTemplates:[],template:{},galleryDescriptor:J,windowWidth:window.innerWidth,windowWidthBreakPoint:1500}},setup(){return{store:j()}},created(){this.loadTemplate(this.id),window.addEventListener("resize",this.resizeHandler),console.log("OPTIONS: ",this.galleryDescriptor.options.html)},methods:{downloadTemplate(){this.dirty?this.$confirm.require({message:this.$t("managers.widgetGallery.templateIsNotSaved"),header:this.$t("managers.widgetGallery.downloadTemplate"),icon:"pi pi-exclamation-triangle",accept:()=>{C(JSON.stringify(this.template),this.template.name,"application/json")}}):C(JSON.stringify(this.template),this.template.name,"application/json")},closeTemplate(){this.$router.push("/gallery-management")},loadTemplate(a){this.loading=!0,a?this.$http.get("/knowage-api/api/1.0/widgetgallery/"+(a||this.id)).then(t=>{this.template=t.data}).catch(t=>console.error(t)).finally(()=>{this.loading=!1,this.dirty=!1}):(this.template={type:"html",code:{html:"",css:"",javascript:"",python:""}},this.loading=!1,this.dirty=!1)},onCmCodeChange(){this.setDirty()},saveTemplate(){if(this.validateTags()){let a=this.id?"1.0/widgetgallery/"+this.id:"1.0/widgetgallery";this.$http.post("/knowage-api/api/"+a,this.template).then(t=>{this.store.setInfo({title:this.$t("managers.widgetGallery.saveTemplate"),msg:this.$t("managers.widgetGallery.templateSuccessfullySaved")}),this.$router.push("/gallery-management/"+t.data.id),this.$emit("saved")}).catch(t=>console.error(t))}},setDirty(){this.dirty=!0},uploadFile(a){const t=new FileReader;let c=this;t.addEventListener("load",function(){c.template.image=t.result||""},!1),a.srcElement.files[0]&&a.srcElement.files[0].size<"200000"?(t.readAsDataURL(a.srcElement.files[0]),this.setDirty()):this.store.setError({title:this.$t("common.error.uploading"),msg:this.$t("common.error.exceededSize",{size:"(200KB)"})})},resizeHandler(){this.windowWidth=window.innerWidth},validateTags(){const a=/^([a-zA-Z0-9-_])*$/g;for(var t in this.template.tags){let c=this.template.tags[t];if(!c.match(a))return this.store.setError({title:this.$t("common.error.uploading"),msg:this.$t("common.error.tags.tagIsNotValid",{tag:c})}),!1}return!0},tabChange(a){let t="editor_"+a.index;this.$refs[t].editor.refresh()}},watch:{"$route.params.id":function(a){this.loadTemplate(a)}},unmounted(){window.removeEventListener("resize",this.resizeHandler)}}),Y=a=>(R("data-v-04f574f3"),a=a(),W(),a),H={class:"managerDetail"},K={class:"p-grid p-m-0 p-fluid"},Z={class:"p-col-9"},q={class:"p-grid"},aa={class:"p-col-3"},ta={class:"p-float-label"},ea={class:"kn-material-input-label",for:"label"},oa={class:"p-col-3"},ra={class:"p-float-label"},na={class:"kn-material-input-label",for:"name"},ia={class:"p-float-label"},la={class:"kn-material-input-label",for:"type"},da={key:0,class:"p-col-3"},sa={class:"p-float-label"},fa={class:"kn-material-input-label",for:"outputType"},ca={class:"p-col-12"},pa={class:"p-float-label"},ba={class:"kn-material-input-label",for:"description"},ka={class:"p-col-12"},va={class:"p-float-label kn-material-input"},ma={class:"kn-material-input-label",for:"tags"},ga={id:"username1-help"},ua={class:"p-col-3 kn-height-full"},ha={for:"inputImage"},wa=Y(()=>e("i",{class:"pi pi-upload"},null,-1)),ya=[wa],xa={class:"imageContainer p-d-flex p-jc-center p-ai-center"},Ca={key:0,class:"far fa-image fa-5x icon"},Ma=["src"],Aa={key:0,class:"p-grid p-m-2 flex"},Da=u("\xA0"),za={style:{"text-transform":"uppercase"}},Ta={key:1,class:"p-grid p-m-0 flex"};function $a(a,t,c,D,Ea,_a){const v=i("Button"),z=i("Toolbar"),T=i("ProgressBar"),h=i("InputText"),w=i("Dropdown"),$=i("Textarea"),E=i("Chips"),y=i("Card"),x=i("VCodeMirror"),_=i("TabPanel"),V=i("TabView"),p=O("tooltip");return n(),l(g,null,[r(z,{class:"kn-toolbar kn-toolbar--secondary p-m-0"},{start:s(()=>[u(" Template "+d(a.template.label),1)]),end:s(()=>[b(r(v,{icon:"pi pi-download",class:"p-button-text p-button-rounded p-button-plain",onClick:a.downloadTemplate,disabled:!a.template.id},null,8,["onClick","disabled"]),[[p,a.$t("common.download"),void 0,{bottom:!0}]]),b(r(v,{icon:"pi pi-save",class:"p-button-text p-button-rounded p-button-plain",disabled:!a.dirty,onClick:a.saveTemplate},null,8,["disabled","onClick"]),[[p,a.$t("common.save"),void 0,{bottom:!0}]]),b(r(v,{icon:"pi pi-times",class:"p-button-text p-button-rounded p-button-plain",onClick:t[0]||(t[0]=o=>a.closeTemplate(o))},null,512),[[p,a.$t("common.close"),void 0,{bottom:!0}]])]),_:1}),a.loading?(n(),M(T,{key:0,mode:"indeterminate",class:"kn-progress-bar"})):f("",!0),e("div",H,[e("div",K,[e("div",Z,[r(y,null,{content:s(()=>[e("div",q,[e("div",aa,[e("span",ta,[r(h,{id:"label",class:"kn-material-input",type:"text",modelValue:a.template.label,"onUpdate:modelValue":t[1]||(t[1]=o=>a.template.label=o),onChange:a.setDirty},null,8,["modelValue","onChange"]),e("label",ea,d(a.$t("common.label")),1)])]),e("div",oa,[e("span",ra,[r(h,{id:"name",class:"kn-material-input",type:"text",modelValue:a.template.name,"onUpdate:modelValue":t[2]||(t[2]=o=>a.template.name=o),onChange:a.setDirty},null,8,["modelValue","onChange"]),e("label",na,d(a.$t("common.name")),1)])]),e("div",{class:k(a.template.type==="python"?"p-col-3":"p-col-6")},[e("span",ia,[r(w,{id:"type",class:"kn-material-input",modelValue:a.template.type,"onUpdate:modelValue":t[3]||(t[3]=o=>a.template.type=o),onChange:a.setDirty,options:a.galleryDescriptor.types,optionLabel:"name",optionValue:"value"},null,8,["modelValue","onChange","options"]),e("label",la,d(a.$t("common.type")),1)])],2),a.template.type==="python"?(n(),l("div",da,[e("span",sa,[r(w,{id:"outputType",class:"kn-material-input",modelValue:a.template.outputType,"onUpdate:modelValue":t[4]||(t[4]=o=>a.template.outputType=o),onChange:a.setDirty,options:a.galleryDescriptor.outputTypes,optionLabel:"name",optionValue:"value"},null,8,["modelValue","onChange","options"]),e("label",fa,d(a.$t("managers.widgetGallery.outputType")),1)])])):f("",!0),e("div",ca,[e("span",pa,[r($,{modelValue:a.template.description,"onUpdate:modelValue":t[5]||(t[5]=o=>a.template.description=o),class:"kn-material-input",style:{resize:"none"},id:"description",rows:"3",onChange:a.setDirty},null,8,["modelValue","onChange"]),e("label",ba,d(a.$t("common.description")),1)])]),e("div",ka,[e("span",va,[r(E,{modelValue:a.template.tags,"onUpdate:modelValue":t[6]||(t[6]=o=>a.template.tags=o),onAdd:a.setDirty,onRemove:a.setDirty,allowDuplicate:!1},null,8,["modelValue","onAdd","onRemove"]),e("label",ma,d(a.$t("common.tags")),1)]),e("small",ga,d(a.$t("managers.widgetGallery.tags.availableCharacters")),1)])])]),_:1})]),e("div",ua,[r(y,{class:"imageUploader"},{title:s(()=>[e("input",{id:"inputImage",type:"file",onChange:t[7]||(t[7]=(...o)=>a.uploadFile&&a.uploadFile(...o)),accept:"image/png, image/jpeg"},null,32),b((n(),l("label",ha,ya)),[[p,a.$t("common.upload"),void 0,{bottom:!0}]])]),content:s(()=>[e("div",xa,[a.template.image?f("",!0):(n(),l("i",Ca)),a.template.image?(n(),l("img",{key:1,src:a.template.image,height:"100%",class:"kn-no-select"},null,8,Ma)):f("",!0)])]),_:1})])]),a.template.type&&a.windowWidth<a.windowWidthBreakPoint?(n(),l("div",Aa,[r(V,{class:"tabview-custom",style:{width:"100%"},onTabChange:a.tabChange},{default:s(()=>[(n(!0),l(g,null,A(a.galleryDescriptor.allowedEditors[a.template.type],(o,m)=>(n(),M(_,{key:o},{header:s(()=>[e("i",{class:k(["icon",a.galleryDescriptor.editor[o].icon])},null,2),Da,e("span",za,d(a.$t("common.codingLanguages."+o)),1)]),default:s(()=>[r(x,{ref_for:!0,ref:"editor_"+m,class:"flex",value:a.template.code[o],"onUpdate:value":[U=>a.template.code[o]=U,a.onCmCodeChange],options:a.galleryDescriptor.options[o]},null,8,["value","onUpdate:value","options"])]),_:2},1024))),128))]),_:1},8,["onTabChange"])])):f("",!0),a.template.type&&a.windowWidth>=a.windowWidthBreakPoint?(n(),l("div",Ta,[(n(!0),l(g,null,A(a.galleryDescriptor.allowedEditors[a.template.type],o=>(n(),l("div",{class:k("p-col-"+12/a.galleryDescriptor.allowedEditors[a.template.type].length),key:o,style:{height:"100%",display:"flex","flex-direction":"column"}},[e("h4",null,[e("i",{class:k(["icon",a.galleryDescriptor.editor[o].icon])},null,2),u(" "+d(a.$t("common.codingLanguages."+o)),1)]),r(x,{class:"flex",value:a.template.code[o],"onUpdate:value":[m=>a.template.code[o]=m,a.onCmCodeChange],options:a.galleryDescriptor.options[o]},null,8,["value","onUpdate:value","options"])],2))),128))])):f("",!0)])],64)}var Sa=I(Q,[["render",$a],["__scopeId","data-v-04f574f3"]]);export{Sa as default};
//# sourceMappingURL=GalleryManagementDetail-1bc2cc14.js.map
