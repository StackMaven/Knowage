import{d as A,ad as I,a9 as de,a5 as R,s as V,a8 as pe,_ as E,r as i,o as p,h,w as b,a as l,D,f as r,t as u,A as f,c as w,l as N,n as B,q as O,g as x,C as P,B as F,G as Q,i as q,X as ce,m as j,ai as X,a6 as be,aY as me,y as ue,z as U,V as L}from"./index-1e676509.js";import{f as ke}from"./filterHelper-a723991a.js";import{u as K,K as fe,c as he}from"./KnValidatonMessages-ebe48c72.js";import{s as ge}from"./inputswitch.esm-80317a38.js";import{E as ve,W as ye,w as H}from"./Workspace.store-75fa566b.js";import{m as we}from"./WorkspaceDescriptor-d4693b02.js";import{D as De,W as xe}from"./WorkspaceCard-6d9360d0.js";import{s as Me}from"./chip.esm-057ba1f1.js";import{s as Ce}from"./contextmenu.esm-4301c9fe.js";import{D as $e,W as Te}from"./WorkspaceDataPreviewDialog-5099e5c1.js";import{W as Ae}from"./WorkspaceWarningDialog-b684933b.js";import{s as Ee}from"./selectbutton.esm-1085ac65.js";import{Q as Se}from"./QBE-95a8c4bc.js";import{s as Ve}from"./multiselect.esm-ce4000f7.js";import{K as Fe}from"./KnParameterSidebar-7c5f3d6f.js";import{C as Ie}from"./client-1808a2c5.js";import"./textarea.esm-32051d54.js";import"./sidebar.esm-2131cfd1.js";import"./KnScheduler-d2aec922.js";import"./calendar.esm-60a451ba.js";import"./checkbox.esm-fa6c8259.js";import"./radiobutton.esm-c3e6fa9b.js";import"./chips.esm-693c3c01.js";import"./menu.esm-6bee86d0.js";import"./KnCronDescriptor-98645843.js";import"./KnCalculatedField-ab0b2f81.js";import"./KnHint-6d455703.js";import"./tree.esm-837306a6.js";const ze=[{name:",",value:","},{name:";",value:";"},{name:"\\t",value:"\\t"},{name:"|",value:"|"}],Ue=[{name:"windows-1252",value:"windows-1252"},{name:"UTF-8",value:"UTF-8"},{name:"UTF-16",value:"UTF-16"},{name:"US-ASCII",value:"US-ASCII"},{name:"ISO-8859-1",value:"ISO-8859-1"}],Le=[{name:'"',value:'"'},{name:"'",value:"'"}],Pe=[{name:"dd/MM/yyyy",value:"dd/MM/yyyy"},{name:"MM/dd/yyyy",value:"MM/dd/yyyy"},{name:"dd-MM-yyyy",value:"dd-MM-yyyy"},{name:"MM-dd-yyyy",value:"MM-dd-yyyy"},{name:"yyyy-MM-dd",value:"yyyy-MM-dd"},{name:"yyyy:MM:dd",value:"yyyy:MM:dd"},{name:"dd.MM.yyyy",value:"dd.MM.yyyy"},{name:"MM.dd.yyyy",value:"MM.dd.yyyy"}],Re=[{name:"ATTRIBUTE",value:"ATTRIBUTE"},{name:"SPATIAL ATTRIBUTE",value:"SPATIAL_ATTRIBUTE"},{name:"MEASURE",value:"MEASURE"}],Ne={dialog:{width:"50vw"},maxwidth:{"border-bottom":"none",width:"100%"}},Be=[{name:"dd/MM/yyyy HH:mm:ss",value:"dd/MM/yyyy HH:mm:ss"},{name:"MM/dd/yyyy hh:mm:ss a",value:"MM/dd/yyyy hh:mm:ss a"},{name:"dd-MM-yyyy hh:mm:ss a",value:"dd-MM-yyyy hh:mm:ss a"},{name:"MM-dd-yyyy hh:mm:ss a",value:"MM-dd-yyyy hh:mm:ss a"},{name:"yyyy-MM-dd hh:mm:ss a",value:"yyyy-MM-dd hh:mm:ss a"},{name:"yyyy:MM:dd hh:mm:ss a",value:"yyyy:MM:dd hh:mm:ss a"},{name:"dd.MM.yyyy HH:mm:ss",value:"dd.MM.yyyy HH:mm:ss"},{name:"MM.dd.yyyy HH:mm:ss",value:"MM.dd.yyyy HH:mm:ss"}],Oe={dataset:[{fieldName:"name",validators:[{key:"required",validator:{type:"wizard-field-required"}}]},{fieldName:"tableName",validators:[{key:"required",validator:{type:"persist-field-required"}},{key:"regex",validator:{type:"alphanumericNoSpaces"}}]}]},We=[{name:"java.lang.String",value:"String"},{name:"java.lang.Double",value:"Double"},{name:"java.lang.Integer",value:"Integer"},{name:"java.lang.Long",value:"Long"},{name:"java.util.Date",value:"Date"},{name:"java.sql.Timestamp",value:"Timestamp"}];var T={csvDelimiterCharacterTypes:ze,csvEncodingTypes:Ue,csvQuoteCharacterTypes:Le,dateFormatTypes:Pe,fieldsMetadataTypes:Re,style:Ne,timestampFormatTypes:Be,validations:Oe,valueTypes:We};const Qe=A({components:{Card:I,KnInputFile:de,Dropdown:R},props:{selectedDataset:{type:Object}},emits:["touched","fileUploaded","closeDialog"],data(){return{v$:K(),dataViewDescriptor:T,dataset:{},triggerUpload:!1,uploading:!1,loading:!1,expandTableCard:!0,columns:[],rows:[]}},setup(){return{store:V()}},created(){this.dataset=this.selectedDataset},watch:{selectedDataset(){this.dataset=this.selectedDataset}},methods:{setUploadType(){this.triggerUpload=!1,setTimeout(()=>this.triggerUpload=!0,200)},uploadDatasetFile(e){this.uploading=!0;let t=e.target.files[0];t.name.includes(this.dataset.fileName)?(this.store.setError({title:this.$t("common.toast.errorTitle"),msg:this.$t("common.error.sameFileName")}),this.triggerUpload=!1):this.startUpload(t),this.triggerUpload=!1,setTimeout(()=>this.uploading=!1,200)},async startUpload(e){var t=new FormData;t.append("file",e),await this.$http.post("/knowage/restful-services//selfservicedatasetupload/fileupload",t,{headers:{"Content-Type":"multipart/form-data; boundary=----WebKitFormBoundaryFYwjkDOpT85ZFN3L"}}).then(a=>{this.store.setInfo({title:this.$t("common.uploading"),msg:this.$t("importExport.import.successfullyCompleted")}),this.dataset.fileType=a.data.fileType,this.dataset.fileName=a.data.fileName,this.$emit("fileUploaded")}).catch().finally(()=>{this.triggerUpload=!1})},async downloadDatasetFile(){var e=encodeURI(this.dataset.label);await this.$http.get(`/knowage/restful-services/2.0/datasets/download/file?dsLabel=${e}&type=${this.dataset.fileType}`,{headers:{Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9","X-Disable-Errors":"true"}}).then(t=>{t.data.errors?this.store.setError({title:this.$t("common.error.downloading"),msg:this.$t("common.error.errorCreatingPackage")}):(this.store.setInfo({title:this.$t("common.toast.success")}),t.headers&&pe(t.data,this.createCompleteFileName(t),t.headers["content-type"]))},t=>this.store.setError({title:this.$t("common.error.downloading"),msg:this.$t(t)}))},createCompleteFileName(e){var t=e.headers["content-disposition"],a=t.match(/filename[^;\n=]*=((['"]).*?\2|[^;\n]*)/i)[1],o=a.replaceAll('"',"");return o},resetFields(){this.dataset.csvEncoding="UTF-8",this.dataset.csvDelimiter=",",this.dataset.dateFormat="dd/MM/yyyy",this.dataset.timestampFormat="dd/MM/yyyy HH:mm:ss",this.dataset.csvQuote='"',this.dataset.skipRows=0,this.dataset.limitRows=null,this.dataset.xslSheetNumber=1,(this.dataset.fileType=="XLS"||this.dataset.fileType=="XLSX")&&(this.dataset.limitRows="",this.dataset.csvDelimiter="",this.dataset.dateFormat="",this.dataset.timestampFormat="",this.dataset.csvQuote="")}}}),je={class:"p-d-flex"},Xe={class:"p-float-label"},He={for:"fileName",class:"kn-material-input-label"},qe={key:0,class:"p-fluid p-formgrid p-grid p-mt-3"},Ke={class:"p-field p-float-label p-col"},Je={for:"scope",class:"kn-material-input-label"},Ye={class:"p-field p-float-label p-col"},Ge={for:"scope",class:"kn-material-input-label"},Ze={class:"p-field p-float-label p-col"},_e={for:"scope",class:"kn-material-input-label"},et={class:"p-field p-float-label p-col"},tt={for:"scope",class:"kn-material-input-label"},at={class:"p-field p-float-label p-col"},ot={for:"scope",class:"kn-material-input-label"},rt={key:1,class:"p-fluid p-formgrid p-grid p-mt-3"},nt={class:"p-field p-col-12 p-xl-4"},it={class:"p-float-label"},st={for:"skipRows",class:"kn-material-input-label"},lt={class:"p-field p-col-12 p-xl-4"},dt={class:"p-float-label"},pt={for:"limitRows",class:"kn-material-input-label"},ct={class:"p-field p-col-12 p-xl-4"},bt={class:"p-float-label"},mt={for:"sheetnumber",class:"kn-material-input-label"};function ut(e,t,a,o,d,m){const s=i("InputText"),v=i("Button"),y=i("KnInputFile"),k=i("Dropdown"),g=i("Card");return p(),h(g,{class:"p-mt-4"},{content:b(()=>[l("div",je,[l("div",{class:"p-field",style:D(e.dataViewDescriptor.style.maxwidth)},[l("span",Xe,[r(s,{id:"fileName",class:"kn-material-input",style:D(e.dataViewDescriptor.style.maxwidth),modelValue:e.dataset.fileName,"onUpdate:modelValue":t[0]||(t[0]=n=>e.dataset.fileName=n),modelModifiers:{trim:!0},disabled:!0,onChange:t[1]||(t[1]=n=>e.$emit("touched"))},null,8,["style","modelValue"]),l("label",He,u(e.$t("downloadsDialog.columns.fileName")),1)])],4),r(v,{icon:"fas fa-upload fa-2x",class:"p-button-text p-button-plain p-ml-2",onClick:e.setUploadType},null,8,["onClick"]),r(v,{icon:"fas fa-download fa-2x",class:"p-button-text y p-button-plain p-ml-2",onClick:e.downloadDatasetFile},null,8,["onClick"]),e.uploading?f("",!0):(p(),h(y,{key:0,changeFunction:e.uploadDatasetFile,accept:".csv, .xls, .xlsx",triggerInput:e.triggerUpload},null,8,["changeFunction","triggerInput"]))]),e.dataset.fileType&&e.dataset.fileType=="CSV"?(p(),w("div",qe,[l("span",Ke,[r(k,{id:"csvDelimiter",class:"kn-material-input workspace-wizard-step-one-input",options:e.dataViewDescriptor.csvDelimiterCharacterTypes,optionLabel:"name",optionValue:"value",modelValue:e.dataset.csvDelimiter,"onUpdate:modelValue":t[2]||(t[2]=n=>e.dataset.csvDelimiter=n)},null,8,["options","modelValue"]),l("label",Je,u(e.$t("managers.datasetManagement.ckanCsvDelimiter")),1)]),l("span",Ye,[r(k,{id:"csvQuote",class:"kn-material-input workspace-wizard-step-one-input",options:e.dataViewDescriptor.csvQuoteCharacterTypes,optionLabel:"name",optionValue:"value",modelValue:e.dataset.csvQuote,"onUpdate:modelValue":t[3]||(t[3]=n=>e.dataset.csvQuote=n)},null,8,["options","modelValue"]),l("label",Ge,u(e.$t("managers.datasetManagement.ckanCsvQuote")),1)]),l("span",Ze,[r(k,{id:"csvEncoding",class:"kn-material-input workspace-wizard-step-one-input",options:e.dataViewDescriptor.csvEncodingTypes,optionLabel:"name",optionValue:"value",modelValue:e.dataset.csvEncoding,"onUpdate:modelValue":t[4]||(t[4]=n=>e.dataset.csvEncoding=n)},null,8,["options","modelValue"]),l("label",_e,u(e.$t("managers.datasetManagement.ckanCsvEncoding")),1)]),l("span",et,[r(k,{id:"dateFormat",class:"kn-material-input workspace-wizard-step-one-input",options:e.dataViewDescriptor.dateFormatTypes,optionLabel:"name",optionValue:"value",modelValue:e.dataset.dateFormat,"onUpdate:modelValue":t[5]||(t[5]=n=>e.dataset.dateFormat=n)},null,8,["options","modelValue"]),l("label",tt,u(e.$t("managers.datasetManagement.ckanDateFormat")),1)]),l("span",at,[r(k,{id:"timestampFormat",class:"kn-material-input workspace-wizard-step-one-input",options:e.dataViewDescriptor.timestampFormatTypes,optionLabel:"name",optionValue:"value",modelValue:e.dataset.timestampFormat,"onUpdate:modelValue":t[6]||(t[6]=n=>e.dataset.timestampFormat=n)},null,8,["options","modelValue"]),l("label",ot,u(e.$t("managers.datasetManagement.timestampFormat")),1)])])):f("",!0),e.dataset.fileType=="XLS"||e.dataset.fileType=="XLSX"?(p(),w("div",rt,[l("div",nt,[l("span",it,[r(s,{id:"skipRows",class:"kn-material-input",type:"number",modelValue:e.dataset.skipRows,"onUpdate:modelValue":t[7]||(t[7]=n=>e.dataset.skipRows=n),modelModifiers:{trim:!0},onChange:t[8]||(t[8]=n=>e.$emit("touched"))},null,8,["modelValue"]),l("label",st,u(e.$t("managers.datasetManagement.ckanSkipRows")),1)])]),l("div",lt,[l("span",dt,[r(s,{id:"limitRows",class:"kn-material-input",type:"number",modelValue:e.dataset.limitRows,"onUpdate:modelValue":t[9]||(t[9]=n=>e.dataset.limitRows=n),modelModifiers:{trim:!0},onChange:t[10]||(t[10]=n=>e.$emit("touched"))},null,8,["modelValue"]),l("label",pt,u(e.$t("managers.datasetManagement.ckanLimitRows")),1)])]),l("div",ct,[l("span",bt,[r(s,{id:"sheetnumber",class:"kn-material-input",type:"number",modelValue:e.dataset.xslSheetNumber,"onUpdate:modelValue":t[11]||(t[11]=n=>e.dataset.xslSheetNumber=n),modelModifiers:{trim:!0},onChange:t[12]||(t[12]=n=>e.$emit("touched"))},null,8,["modelValue"]),l("label",mt,u(e.$t("managers.datasetManagement.ckanXslSheetNumber")),1)])])])):f("",!0)]),_:1})}var kt=E(Qe,[["render",ut]]);const ft=A({components:{Card:I,Column:N,DataTable:B,Message:O,Dropdown:R},props:{selectedDataset:{type:Object}},computed:{},emits:["touched"],data(){return{wizardDescriptor:T,fieldMetadataTypes:T.fieldsMetadataTypes,valueTypes:T.valueTypes,dataset:{},fieldsMetadata:[]}},setup(){return{store:V()}},created(){this.dataset=this.selectedDataset,this.dataset.meta&&this.exctractFieldsMetadata(this.dataset.meta.columns)},watch:{selectedDataset(){this.dataset=this.selectedDataset,this.dataset.meta&&this.exctractFieldsMetadata(this.dataset.meta.columns)}},methods:{exctractFieldsMetadata(e){var t={};for(var a in e){var o=t[e[a].column];o||(o={},t[e[a].column]=o,o.column=e[a].column),o[e[a].pname]=e[a].pvalue}var d=new Array;for(a in t)d.push(t[a]);this.fieldsMetadata=d},saveFieldsMetadata(){var e=0;for(let t=0;t<this.fieldsMetadata.length;t++)if(this.fieldsMetadata[t].fieldType=="SPATIAL_ATTRIBUTE"&&(e++,e>1)){this.store.setError({title:this.$t("common.error.saving"),msg:this.$t("managers.datasetManagement.duplicateSpatialAttribute")});return}for(let t=0;t<this.fieldsMetadata.length;t++)for(let a=0;a<this.dataset.meta.columns.length;a++)this.fieldsMetadata[t].column==this.dataset.meta.columns[a].column&&this.dataset.meta.columns[a].pname=="fieldType"&&(this.dataset.meta.columns[a].pvalue=this.fieldsMetadata[t].fieldType);for(let t=0;t<this.fieldsMetadata.length;t++)for(let a=0;a<this.dataset.meta.columns.length;a++)this.fieldsMetadata[t].column==this.dataset.meta.columns[a].column&&this.dataset.meta.columns[a].pname=="Type"&&(this.dataset.meta.columns[a].pvalue=this.fieldsMetadata[t].Type)}}}),ht={key:1};function gt(e,t,a,o,d,m){const s=i("Column"),v=i("Dropdown"),y=i("DataTable"),k=i("Message"),g=i("Card");return p(),h(g,{class:"p-mt-4"},{content:b(()=>[e.dataset.meta?(p(),h(y,{key:0,class:"p-datatable-sm kn-table",scrollable:!0,scrollHeight:"40vh",value:e.fieldsMetadata,stripedRows:"",rowHover:""},{default:b(()=>[r(s,{field:"fieldAlias",header:e.$t("managers.datasetManagement.fieldAlias"),sortable:!0},{body:b(({data:n})=>[x(u(n.fieldAlias),1)]),_:1},8,["header"]),r(s,{field:"Type",header:e.$t("importExport.catalogFunction.column.type"),sortable:!0},{body:b(({data:n})=>[r(v,{class:"kn-material-input",style:D(e.wizardDescriptor.style.maxwidth),modelValue:n.Type,"onUpdate:modelValue":M=>n.Type=M,options:e.valueTypes,optionLabel:"value",optionValue:"name",onChange:e.saveFieldsMetadata,disabled:!0},null,8,["style","modelValue","onUpdate:modelValue","options","onChange"])]),_:1},8,["header"]),r(s,{field:"fieldType",header:e.$t("managers.datasetManagement.fieldType"),sortable:!0},{body:b(({data:n})=>[r(v,{class:"kn-material-input",style:D(e.wizardDescriptor.style.maxwidth),modelValue:n.fieldType,"onUpdate:modelValue":M=>n.fieldType=M,options:e.fieldMetadataTypes,optionLabel:"value",optionValue:"value",onChange:e.saveFieldsMetadata},null,8,["style","modelValue","onUpdate:modelValue","options","onChange"])]),_:1},8,["header"])]),_:1},8,["value"])):(p(),w("div",ht,[r(k,{severity:"info",closable:!1},{default:b(()=>[x(u(e.$t("managers.datasetManagement.metadataInfo")),1)]),_:1})]))]),_:1})}var vt=E(ft,[["render",gt]]);const yt=A({components:{DataTable:B,Column:N,Card:I},props:{gridForPreview:{type:Object}},computed:{},emits:["close"],data(){return{columns:[],rows:[],loading:!1}},created(){this.getPreviewData()},watch:{selectedDataset(){this.getPreviewData()}},methods:{getPreviewData(){this.loading=!0,this.gridForPreview.metaData.fields.forEach(t=>{typeof t!="object"||this.columns.push(t)}),this.rows=this.gridForPreview.rows,this.loading=!1}}});function wt(e,t,a,o,d,m){const s=i("Column"),v=i("DataTable"),y=i("Card");return p(),h(y,{class:"p-mt-4"},{content:b(()=>[r(v,{value:e.rows,class:"p-datatable-sm kn-table",responsiveLayout:"scroll",loading:e.loading,stripedRows:"",rowHover:""},{default:b(()=>[(p(!0),w(F,null,P(e.columns,k=>(p(),h(s,{field:k.name,header:k.header,key:k.dataIndex,class:"kn-truncated",sortable:!0},null,8,["field","header"]))),128))]),_:1},8,["value","loading"])]),_:1})}var Dt=E(yt,[["render",wt]]);const xt=A({components:{Card:I,KnValidationMessages:fe,InputSwitch:ge},props:{selectedDataset:{type:Object}},data(){return{v$:K(),dataViewDescriptor:T,dataset:{}}},created(){this.dataset=this.selectedDataset},watch:{selectedDataset(){this.dataset=this.selectedDataset}},validations(){const a={"wizard-field-required":d=>d,"persist-field-required":d=>!this.dataset.isPersisted||d};return{dataset:he("dataset",T.validations.dataset,a)}}}),Mt={class:"p-fluid p-formgrid p-grid"},Ct={class:"p-field p-col-12"},$t={class:"p-float-label"},Tt={for:"name",class:"kn-material-input-label"},At={class:"p-field p-col-12"},Et={class:"p-float-label"},St={for:"description",class:"kn-material-input-label"},Vt={key:0,class:"p-field"},Ft={class:"p-float-label p-mt-3 p-mx-2"},It={for:"persistTableName",class:"kn-material-input-label"};function zt(e,t,a,o,d,m){const s=i("InputText"),v=i("KnValidationMessages"),y=i("InputSwitch"),k=i("Toolbar"),g=i("Card");return p(),h(g,{class:"p-mt-4"},{content:b(()=>[l("form",Mt,[l("div",Ct,[l("span",$t,[r(s,{id:"name",class:Q(["kn-material-input",{"p-invalid":e.v$.dataset.name.$invalid&&e.v$.dataset.name.$dirty}]),type:"text",maxLength:"50",modelValue:e.v$.dataset.name.$model,"onUpdate:modelValue":t[0]||(t[0]=n=>e.v$.dataset.name.$model=n),onBlur:t[1]||(t[1]=n=>e.v$.dataset.name.$touch()),onChange:t[2]||(t[2]=n=>e.$emit("touched")),"data-test":"name-input"},null,8,["modelValue","class"]),l("label",Tt,u(e.$t("common.name"))+" * ",1)]),r(v,{class:"p-mt-1",vComp:e.v$.dataset.name,additionalTranslateParams:{fieldName:e.$t("common.name")}},null,8,["vComp","additionalTranslateParams"])]),l("div",At,[l("span",Et,[r(s,{id:"description",class:"kn-material-input",type:"text",maxLength:"50",modelValue:e.dataset.description,"onUpdate:modelValue":t[3]||(t[3]=n=>e.dataset.description=n),"data-test":"description-input"},null,8,["modelValue"]),l("label",St,u(e.$t("common.description")),1)])]),r(k,{class:"kn-toolbar kn-toolbar--secondary p-mt-1 p-mx-2",style:D(e.dataViewDescriptor.style.maxwidth)},{start:b(()=>[r(y,{modelValue:e.dataset.exportToHdfs,"onUpdate:modelValue":t[4]||(t[4]=n=>e.dataset.exportToHdfs=n),class:"p-mr-2",onChange:t[5]||(t[5]=n=>e.$emit("touched"))},null,8,["modelValue"]),l("span",null,u(e.$t("managers.datasetManagement.isPersistedHDFS")),1)]),_:1},8,["style"]),l("div",{class:"persistence-container",style:D(e.dataViewDescriptor.style.maxwidth)},[r(k,{class:"kn-toolbar kn-toolbar--secondary p-mt-3 p-mx-2"},{start:b(()=>[r(y,{modelValue:e.dataset.persist,"onUpdate:modelValue":t[6]||(t[6]=n=>e.dataset.persist=n),disabled:e.disablePersist,class:"p-mr-2",onChange:t[7]||(t[7]=n=>e.$emit("touched"))},null,8,["modelValue","disabled"]),l("span",null,u(e.$t("managers.datasetManagement.isPersisted")),1)]),_:1}),e.dataset.persist?(p(),w("div",Vt,[l("span",Ft,[r(s,{id:"persistTableName",class:Q(["kn-material-input",{"p-invalid":e.v$.dataset.tableName.$invalid&&e.v$.dataset.tableName.$dirty}]),type:"text",maxLength:"50",modelValue:e.dataset.tableName,"onUpdate:modelValue":t[8]||(t[8]=n=>e.dataset.tableName=n),onBlur:t[9]||(t[9]=n=>e.v$.dataset.tableName.$touch()),onChange:t[10]||(t[10]=n=>e.$emit("touched"))},null,8,["modelValue","class"]),l("label",It,u(e.$t("managers.datasetManagement.persistTableName"))+" *",1)]),r(v,{class:"p-mt-1",vComp:e.v$.dataset.tableName,additionalTranslateParams:{fieldName:e.$t("managers.datasetManagement.persistTableName")}},null,8,["vComp","additionalTranslateParams"])])):f("",!0)],4)])]),_:1})}var Ut=E(xt,[["render",zt]]);const Lt=A({components:{Dialog:q,StepOne:kt,StepTwo:vt,StepThree:Dt,StepFour:Ut},emits:["touched","fileUploaded","closeDialog","closeDialogAndReload"],props:{selectedDataset:{type:Object},visible:{type:Boolean}},computed:{documentFields(){switch(this.wizardStep){case 1:return this.submitStepOne;case 2:return this.submitStepTwo;case 3:return this.submitStepThree;case 4:return this.submitStepFour;default:return this.$emit("closeDialog")}}},data(){return{dataViewDescriptor:T,dataset:{},gridForPreview:{},datasetColumns:[],editingDatasetFile:!1,newFileUploaded:!1,fileUploaded:!1,wizardStep:1}},setup(){return{store:V()}},created(){this.dataset=this.selectedDataset,this.dataset.id?this.getSelectedDataset():this.initializeDatasetWizard(void 0,!1)},watch:{selectedDataset(){this.dataset=this.selectedDataset,this.dataset.id?this.getSelectedDataset():this.initializeDatasetWizard(void 0,!1)}},methods:{onFileUpload(){this.fileUploaded=!0,this.newFileUploaded=!0},async getSelectedDataset(){this.$http.get(`/knowage/restful-services/1.0/datasets/dataset/id/${this.selectedDataset.id}`).then(e=>{this.dataset=e.data[0]?{...e.data[0]}:{},this.initializeDatasetWizard(this.dataset,!0)}).catch()},initializeDatasetWizard(e,t){this.editingDatasetFile=t,t?this.fileUploaded=!0:this.fileUploaded=!1,this.dataset.csvEncoding=e!=null?e.csvEncoding:"UTF-8",this.dataset.csvDelimiter=e!=null?e.csvDelimiter:",",this.dataset.csvQuote=e!=null?e.csvQuote:'"',this.dataset.skipRows=e!=null?e.skipRows:null,this.dataset.dateFormat=e!=null&&e.dateFormat!=null?e.dateFormat:"dd/MM/yyyy",this.dataset.timestampFormat=e!=null&&e.timestampFormat!=null?e.timestampFormat:"dd/MM/yyyy HH:mm:ss",e!=null?e.limitRows!=null&&e.limitRows!=""?this.dataset.limitRows=e.limitRows:this.dataset.limitRows=e.limitRows:this.dataset.limitRows=null,this.dataset.xslSheetNumber=e!=null?e.xslSheetNumber:1,this.dataset.catTypeVn=e!=null?e.catTypeVn:null,this.dataset.catTypeId=e!=null?e.catTypeId:null,this.dataset.id=e!=null?e.id:"",this.dataset.label=e!=null?e.label:"",this.dataset.name=e!=null?e.name:"",this.dataset.description=e!=null?e.description:"",this.dataset.meta=e!=null?e.meta:[],this.dataset.persist=e!=null&&e.isPersisted?e.isPersisted:!1,this.dataset.tableName=e!=null&&e.persistTableName?e.persistTableName:""},submitStepOne(){let e={};e.SBI_EXECUTION_ID=-1,e.isTech=!1,e.showOnlyOwner=!0,e.showDerivedDataset=!1,this.dataset.type="File",this.dataset.exportToHdfs=!1,this.dataset.limitPreview=!0,this.dataset.tablePrefix="",this.dataset.persist||(this.dataset.persist=!1),this.dataset.tableName||(this.dataset.tableName=""),this.dataset.skipRows==null&&(this.dataset.skipRows=""),this.dataset.limitRows==null&&(this.dataset.limitRows=""),this.dataset.xslSheetNumber==null&&(this.dataset.xslSheetNumber=""),this.dataset.meta=JSON.stringify(this.dataset.meta),this.newFileUploaded&&(this.dataset.fileUploaded=!0),console.log(this.dataset),this.$http({method:"POST",url:"/knowage/restful-services/selfservicedataset/testDataSet",data:this.dataset,params:e,headers:{"Content-Type":"application/x-www-form-urlencoded","X-Disable-Errors":"true"},transformRequest:function(t){var a=[];for(var o in t)a.push(encodeURIComponent(o)+"="+encodeURIComponent(t[o]));return a.join("&")}}).then(t=>{t.data.errors?this.dataset.meta=[]:(this.gridForPreview=t.data.gridForPreview,this.dataset.meta=t.data.meta,this.datasetColumns=t.data.datasetColumns,this.wizardStep++)}).catch(t=>{this.dataset.meta=[],t.message=="error.mesage.description.data.set.parsing.error"?this.store.setError({title:this.$t("common.toast.errorTitle"),msg:this.$t("workspace.myData.parseError")}):this.store.setError({title:this.$t("common.toast.errorTitle"),msg:this.$t(t.message)})})},submitStepTwo(){this.dataset.isPublicDS=!1,this.dataset.datasetMetadata={},this.dataset.datasetMetadata.version=1,this.dataset.datasetMetadata.dataset=[],this.dataset.datasetMetadata.columns=[],this.dataset.datasetMetadata.dataset=[...this.dataset.meta.dataset],this.dataset.datasetMetadata.columns=[...this.dataset.meta.columns];let e=this.dataset.datasetMetadata.columns;for(var t=0;t<e.length;t++)delete e[t].columnView,delete e[t].pvalueView,delete e[t].pnameView,delete e[t].dsMetaValue;let a=this.dataset.datasetMetadata.dataset;for(t=0;t<a.length;t++)delete a[t].pvalueView,delete a[t].pnameView;this.dataset.datasetMetadata=JSON.stringify(this.dataset.datasetMetadata),this.dataset.limitPreview=!0,this.dataset.page=1,this.dataset.start="",this.dataset.page=10,this.editingDatasetFile==!0&&this.dataset.fileUploaded==!0&&(this.dataset.label=""),this.wizardStep++},submitStepThree(){this.wizardStep++},async submitStepFour(){let e={...this.dataset};e.isPublicDS=!1,e.meta=this.dataset.datasetMetadata,e.fileUploaded=this.fileUploaded,delete e.datasetMetadata;var t=new Date,a="ds__"+t.getTime()%1e7;e.label===""&&(e.label=a);var o={};o.showDerivedDataset=!1,o.SBI_EXECUTION_ID=-1,o.isTech=!1,o.showOnlyOwner=!0,await this.$http({method:"POST",url:"/knowage/restful-services/selfservicedataset/save",data:e,params:o,headers:{"Content-Type":"application/x-www-form-urlencoded","X-Disable-Errors":"true"},transformRequest:function(d){var m=[];for(var s in d)m.push(encodeURIComponent(s)+"="+encodeURIComponent(d[s]));return m.join("&")}}).then(d=>{e.exportToHdfs&&this.$http.post(`/knowage/restful-services/1.0/hdfs/${d.data.id}`,{headers:{"X-Disable-Errors":"true"}}).catch(m=>{this.store.setError({title:this.$t("common.toast.errorTitle"),msg:m.data.errors[0].message})}),this.$emit("closeDialogAndReload")}).catch(d=>{this.store.setError({title:this.$t("common.toast.errorTitle"),msg:this.$t("common.error.uploading")})})}}}),Pt={key:0},Rt={key:1},Nt={key:2},Bt={key:3};function Ot(e,t,a,o,d,m){const s=i("StepOne"),v=i("StepTwo"),y=i("StepThree"),k=i("StepFour"),g=i("Button"),n=i("Dialog");return p(),h(n,{class:"kn-dialog--toolbar--primary importExportDialog",style:D(e.dataViewDescriptor.style.dialog),visible:e.visible,footer:"footer",header:e.$t("workspace.myData.wizardTitle"),closable:!1,modal:""},{footer:b(()=>[l("div",null,[r(g,{class:"kn-button kn-button--secondary",label:e.$t("common.cancel"),onClick:t[0]||(t[0]=M=>e.$emit("closeDialog"))},null,8,["label"]),e.wizardStep>1?(p(),h(g,{key:0,class:"kn-button kn-button--secondary",label:e.$t("common.back"),onClick:t[1]||(t[1]=M=>e.wizardStep--)},null,8,["label"])):f("",!0),r(g,{class:"kn-button kn-button--primary",label:e.$t("common.next"),disabled:!e.fileUploaded,onClick:e.documentFields},null,8,["label","disabled","onClick"])])]),default:b(()=>[e.wizardStep===1?(p(),w("span",Pt,[r(s,{selectedDataset:e.dataset,onFileUploaded:e.onFileUpload},null,8,["selectedDataset","onFileUploaded"])])):f("",!0),e.wizardStep===2?(p(),w("span",Rt,[r(v,{selectedDataset:e.dataset},null,8,["selectedDataset"])])):f("",!0),e.wizardStep===3?(p(),w("span",Nt,[r(y,{gridForPreview:e.gridForPreview},null,8,["gridForPreview"])])):f("",!0),e.wizardStep===4?(p(),w("span",Bt,[r(k,{selectedDataset:e.dataset},null,8,["selectedDataset"])])):f("",!0)]),_:1},8,["style","visible","header"])}var Wt=E(Lt,[["render",Ot]]);const Qt={style:{width:"60vw"}},jt={message:{"align-items":"center",display:"flex","justify-content":"center","text-align":"center"}};var Xt={dialog:Qt,styles:jt};const Ht=A({name:"workspace-repository-move-dialog",components:{Dialog:q,Dropdown:R,Message:O},props:{visible:{type:Boolean},propDataset:{type:Object},datasetCategories:{type:Array}},emits:["close","share"],data(){return{workspaceDataShareDialogDescriptor:Xt,dataset:{}}},watch:{propDataset(){this.loadDataset()}},created(){this.loadDataset()},methods:{loadDataset(){this.propDataset&&(this.dataset={...this.propDataset})},closeDialog(){this.loadDataset(),this.$emit("close")},shareDataset(e){e||(this.dataset.catTypeId=null),this.$emit("share",this.dataset)}}}),qt={class:"p-m-4"},Kt={class:"p-d-flex p-flex-row p-jc-end"};function Jt(e,t,a,o,d,m){const s=i("Toolbar"),v=i("Message"),y=i("Dropdown"),k=i("Button"),g=i("Dialog");return p(),h(g,{class:"p-fluid kn-dialog--toolbar--primary",contentStyle:e.workspaceDataShareDialogDescriptor.dialog.style,visible:e.visible,modal:!0,closable:!1},{header:b(()=>[r(s,{class:"kn-toolbar kn-toolbar--primary p-p-0 p-m-0 p-col-12"},{start:b(()=>[x(u(e.$t("workspace.myData.shareDataset")),1)]),_:1})]),footer:b(()=>[l("div",Kt,[r(k,{class:"kn-button kn-button--primary",onClick:t[1]||(t[1]=n=>e.shareDataset(!1))},{default:b(()=>[x(u(e.$t("workspace.myData.unshareDataset")),1)]),_:1}),r(k,{class:"kn-button kn-button--primary",onClick:e.closeDialog},{default:b(()=>[x(u(e.$t("common.cancel")),1)]),_:1},8,["onClick"]),r(k,{class:"kn-button kn-button--primary",onClick:t[2]||(t[2]=n=>e.shareDataset(!0)),disabled:!e.dataset.catTypeId},{default:b(()=>[x(u(e.$t("common.save")),1)]),_:1},8,["disabled"])])]),default:b(()=>[r(v,{class:"p-m-4",severity:"info",closable:!1,style:D(e.workspaceDataShareDialogDescriptor.styles.message)},{default:b(()=>[x(u(e.$t("workspace.myData.shareDatasetHint")),1)]),_:1},8,["style"]),l("div",qt,[l("span",null,[r(y,{class:"kn-material-input",modelValue:e.dataset.catTypeId,"onUpdate:modelValue":t[0]||(t[0]=n=>e.dataset.catTypeId=n),options:e.datasetCategories,optionLabel:"VALUE_NM",optionValue:"VALUE_ID"},null,8,["modelValue","options"])])])]),_:1},8,["contentStyle","visible"])}var Yt=E(Ht,[["render",Jt]]);const Gt=A({components:{QBE:Se,MultiSelect:Ve,DataTable:B,Column:N,Chip:Me,DataPreparationMonitoringDialog:$e,EditPreparedDatasetDialog:ve,DetailSidebar:De,WorkspaceCard:xe,Menu:Ce,KnFabButton:ce,DatasetWizard:Wt,WorkspaceDataCloneDialog:ye,WorkspaceWarningDialog:Ae,WorkspaceDataShareDialog:Yt,WorkspaceDataPreviewDialog:Te,SelectButton:Ee,Message:O,KnParameterSidebar:Fe},emits:["toggleDisplayView"],props:{toggleCardDisplay:{type:Boolean}},computed:{...j(V,["user"]),...j(H,["dataPreparation","isAvroLoaded","isAvroLoading","isAvroReady"]),isDatasetOwner(){return this.user.userId===this.selectedDataset.owner},showCkanIntegration(){return this.user.functionalities.indexOf("CkanIntegrationFunctionality")>-1},showQbeEditButton(){return this.user.userId===this.selectedDataset.owner&&(this.selectedDataset.dsTypeCd=="Federated"||this.selectedDataset.dsTypeCd=="Qbe")},datasetHasDrivers(){return this.selectedDataset.drivers&&this.selectedDataset.length>0},datasetHasParams(){return this.selectedDataset.pars&&this.selectedDataset.pars>0},datasetIsIterable(){return!["Federated"].includes(this.selectedDataset.dsTypeCd)},canLoadData(){if(this.selectedDataset.actions){for(let e=0;e<this.selectedDataset.actions.length;e++)if(this.selectedDataset.actions[e].name=="loaddata")return!0}return!1}},data(){return{mainDescriptor:we,loading:!1,showDetailSidebar:!1,showDatasetDialog:!1,showEditPreparedDatasetDialog:!1,datasetList:[],selectedCategories:[],selectedCategoryIds:[],filteredDatasets:[],datasetCategories:[],selectedDataset:{},menuButtons:[],creationMenuButtons:[],filters:{global:[ke]},cloneDialogVisible:!1,shareDialogVisible:!1,previewDialogVisible:!1,warningDialogVisbile:!1,warningMessage:"",tableMode:"My Datasets",selectButtonOptions:["My Datasets","Enterprise","Shared","All Datasets"],searchWord:"",qbeVisible:!1,client:{},selectedQbeDataset:null,showMonitoring:!1,filtersData:{},userRole:null,parameterSidebarVisible:!1,exportFormat:""}},async created(){var t;if(this.userRole=this.user.sessionRole!==this.$t("role.defaultRolePlaceholder")?this.user.sessionRole:null,await this.getAllData(),(t=this.user)!=null&&t.functionalities.includes("DataPreparation")){var e=new URL(window.location.origin);e.protocol=e.protocol.replace("http","ws");let a=e+"knowage-data-preparation/ws?X-Kn-Authorization="+localStorage.getItem("token");this.client=new Ie({brokerURL:a,connectHeaders:{},heartbeatIncoming:4e3,heartbeatOutgoing:4e3}),this.client.onConnect=o=>{console.log(o),this.client.subscribe("/user/queue/prepare",d=>{if(d.body){let m=JSON.parse(d.body);m.statusOk?(this.setInfo({title:"Dataset prepared successfully"}),this.addToLoadedAvros(m.dsId),this.addToAvroDatasets(m.dsId)):this.setError({title:"Cannot prepare dataset",msg:m.errorMessage}),this.removeFromLoadingAvros(m.dsId)}else this.setError({title:"Websocket error",msg:"got empty message"})})},this.client.onStompError=function(o){console.log("Broker reported error: "+o.headers.message),console.log("Additional details: "+o.body)},this.client.activate()}},methods:{...X(V,["setInfo","setError"]),...X(H,["addToLoadedAvros","addToLoadingAvros","addToAvroDatasets","removeFromLoadingAvros","removeFromLoadedAvros","setAvroDatasets","setLoadedAvros"]),async updatePreparedDataset(e){this.showEditPreparedDatasetDialog=!1,this.selectedDataset.name=e.name,this.selectedDataset.description=e.description,this.selectedDataset.type="PreparedDataset",await this.$http({method:"POST",url:"/knowage/restful-services/selfservicedataset/update",data:this.selectedDataset,headers:{"Content-Type":"application/x-www-form-urlencoded","X-Disable-Errors":"true"},transformRequest:function(t){var a=[];for(var o in t)a.push(encodeURIComponent(o)+"="+encodeURIComponent(t[o]));return a.join("&")}}).then(()=>{this.setInfo({title:"Updated successfully"})}).catch(()=>{this.setError({title:"Save error",msg:"Cannot update Prepared Dataset"})}),await this.getAllData()},getDatasets(e){return this.loading=!0,this.$http.get(`/knowage/restful-services/3.0/datasets/${e}/`)},async getAllAvroDataSets(){await this.$http.get("/knowage/restful-services/3.0/datasets/avro").then(e=>{this.setAvroDatasets(e.data),this.setLoadedAvros(e.data)}).catch(()=>{})},async getAllData(){await this.getDatasetsByFilter(),await this.getDatasetCategories()},async getDatasetCategories(){return this.loading=!0,this.$http.get("/knowage/restful-services/domainsforfinaluser/ds-categories").then(e=>{this.datasetCategories=[...e.data]})},async loadDataset(e){this.loading=!0,await this.$http.get(`/knowage/restful-services/1.0/datasets/${e}`).then(t=>{this.selectedDataset=t.data[0]}).catch(()=>{}),this.loading=!1},async loadDatasetDrivers(e){let t=!1;return e.label&&e.id&&e.dsTypeCd!=="Prepared"&&(await this.$http.post(`/knowage/restful-services/3.0/datasets/${e.label}/filters`,{role:this.userRole}).then(a=>{this.filtersData=a.data,this.filtersData.filterStatus&&(this.filtersData.filterStatus=this.filtersData.filterStatus.filter(o=>o.id))}).catch(()=>{t=!0}),await this.formatDrivers()),t},formatDrivers(){var e,t;(t=(e=this.filtersData)==null?void 0:e.filterStatus)==null||t.forEach(a=>{var o,d,m,s,v;if(a.parameterValue=a.multivalue?[]:[{value:"",description:""}],((o=a.driverDefaultValue)==null?void 0:o.length)>0){let y="_col0",k="col1";(d=a.metadata)!=null&&d.colsMap&&(y=Object.keys((m=a.metadata)==null?void 0:m.colsMap).find(g=>a.metadata.colsMap[g]===a.metadata.valueColumn),k=Object.keys((s=a.metadata)==null?void 0:s.colsMap).find(g=>a.metadata.colsMap[g]===a.metadata.descriptionColumn)),a.parameterValue=a.driverDefaultValue.map(g=>{var n,M;return{value:(n=g.value)!=null?n:g[y],description:(M=g.desc)!=null?M:g[k]}}),a.type==="DATE"&&!a.selectionType&&a.valueSelection==="man_in"&&a.showOnPanel==="true"&&(a.parameterValue[0].value=be((v=a.parameterValue[0].description)==null?void 0:v.split("#")[0]).toDate())}a.data&&(a.data=a.data.map(y=>this.formatParameterDataOptions(a,y)),a.data.length===1&&(a.parameterValue=[...a.data])),(a.selectionType==="COMBOBOX"||a.selectionType==="LIST")&&a.multivalue&&a.mandatory&&a.data.length===1&&(a.showOnPanel="false"),a.parameterValue||(a.parameterValue=[{value:"",description:""}]),a.parameterValue[0]&&!a.parameterValue[0].description&&(a.parameterValue[0].description=a.parameterDescription?a.parameterDescription[0]:"")})},formatParameterDataOptions(e,t){const a=e.metadata.valueColumn,o=e.metadata.descriptionColumn,d=Object.keys(e.metadata.colsMap).find(s=>e.metadata.colsMap[s]===a),m=Object.keys(e.metadata.colsMap).find(s=>e.metadata.colsMap[s]===o);return{value:d?t[d]:"",description:m?t[m]:""}},getFormattedDrivers(e){let t={};return Object.keys(e.filterStatus).forEach(a=>{var d,m,s;const o=e.filterStatus[a];o.multivalue?(t[o.urlName]=[],t[o.urlName].push({value:(m=o.parameterValue)==null?void 0:m.map(v=>v.value),description:(s=o.parameterDescription)!=null?s:o.parameterValue[0].value})):(t[o.urlName]=[],t[o.urlName].push({value:o.parameterValue[0].value,description:(d=o.parameterValue[0].description)!=null?d:o.parameterValue[0].value}))}),t},async onExecute(e,t){const a={drivers:this.getFormattedDrivers(t),parameters:e};this.exportDataset(a)},async prepareDatasetForExport(e,t){this.exportFormat=t,await this.loadDataset(e.label),await this.loadDatasetDrivers(this.selectedDataset),this.selectedDataset.pars.length>0||this.filtersData.filterStatus.length>0?this.parameterSidebarVisible=!0:this.exportDataset()},async exportDataset(e){await this.$http.post(`/knowage/restful-services/2.0/export/dataset/${this.selectedDataset.id}/${this.exportFormat}`,e!=null?e:{},{headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json;charset=UTF-8"}}).then(()=>{this.setInfo({title:this.$t("common.toast.updateTitle"),msg:this.$t("workspace.myData.exportSuccess")})}).catch(()=>{}).finally(()=>this.parameterSidebarVisible=!1)},toggleDisplayView(){this.$emit("toggleDisplayView")},showSidebar(e){this.selectedDataset=e,this.showDetailSidebar=!0},showCreationMenu(e){this.createCreationMenuButtons(),this.$refs.creationMenu.toggle(e)},showMenu(e,t){this.selectedDataset=t,this.createMenuItems(t),this.$refs.optionsMenu.toggle(e)},createMenuItems(e){var a;let t=[];t.push({key:"0",label:this.$t("workspace.myAnalysis.menuItems.showDsDetails"),icon:"fas fa-pen",command:this.editDataset,visible:this.isDatasetOwner&&(this.selectedDataset.dsTypeCd=="File"||this.selectedDataset.dsTypeCd=="Prepared")},{key:"1",label:this.$t("workspace.myModels.openInQBE"),icon:"fas fa-pen",command:()=>this.openDatasetInQBE(e),visible:this.showQbeEditButton},{key:"2",label:this.$t("workspace.myData.xlsxExport"),icon:"fas fa-file-excel",command:()=>this.prepareDatasetForExport(e,"xls"),visible:this.canLoadData&&!this.datasetHasDrivers&&!this.datasetHasParams&&this.selectedDataset.dsTypeCd!="File"&&this.datasetIsIterable},{key:"3",label:this.$t("workspace.myData.csvExport"),icon:"fas fa-file-csv",command:()=>this.prepareDatasetForExport(e,"csv"),visible:this.canLoadData&&!this.datasetHasDrivers&&!this.datasetHasParams&&this.selectedDataset.dsTypeCd!="File"},{key:"4",label:this.$t("workspace.myData.fileDownload"),icon:"fas fa-download",command:()=>this.downloadDatasetFile(e),visible:this.selectedDataset.dsTypeCd=="File"},{key:"5",label:this.$t("workspace.myData.shareDataset"),icon:"fas fa-share-alt",command:()=>this.shareDataset(),visible:this.canLoadData&&this.isDatasetOwner&&this.selectedDataset.dsTypeCd!="Prepared"},{key:"6",label:this.$t("workspace.myData.cloneDataset"),icon:"fas fa-clone",command:()=>this.cloneDataset(e),visible:this.canLoadData&&this.selectedDataset.dsTypeCd=="Qbe"},{key:"9",label:this.$t("workspace.myData.deleteDataset"),icon:"fas fa-trash",command:()=>this.deleteDatasetConfirm(e),visible:this.isDatasetOwner}),(a=this.user)!=null&&a.functionalities.includes("DataPreparation")&&t.push({key:"7",label:this.$t("workspace.myData.openDataPreparation"),icon:"fas fa-cogs",command:()=>this.openDataPreparation(e),visible:this.canLoadData&&this.selectedDataset.pars&&this.selectedDataset.pars.length==0}),t=t.sort((o,d)=>o.key.localeCompare(d.key)),this.menuButtons=t},createCreationMenuButtons(){this.creationMenuButtons=[],this.creationMenuButtons.push({key:"0",label:this.$t("managers.businessModelManager.uploadFile"),command:this.toggleDatasetDialog,visible:!0},{key:"1",label:this.$t("workspace.myData.openData"),command:this.openDatasetInQBE,visible:this.showCkanIntegration})},toggleDatasetDialog(){this.selectedDataset={},this.showDatasetDialog=!0},async previewDataset(e){await this.loadDataset(e.label),this.selectedDataset&&(this.selectedDataset.drivers=e.drivers),this.previewDialogVisible=!0},editDataset(){this.selectedDataset.dsTypeCd=="File"?this.showDatasetDialog=!0:this.selectedDataset.dsTypeCd=="Prepared"&&(this.showEditPreparedDatasetDialog=!0)},async generateAvro(e){var t;this.$http.post(`/knowage/restful-services/1.0/data-preparation/prepare/${e}`,{},{headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json;charset=UTF-8"}}).then(()=>{this.setInfo({title:this.$t("workspace.myData.isPreparing")}),this.addToLoadingAvros(e);let a=this.dataPreparation.loadedAvros.indexOf(e);a>=0&&this.removeFromLoadedAvros(a)}).catch(()=>{}),((t=this.user)==null?void 0:t.functionalities.includes("DataPreparation"))&&Object.keys(this.client).length>0&&this.client.publish({destination:"/app/prepare",body:e})},openDataPreparation(e){e.dsTypeCd=="Prepared"?this.$http.get(`/knowage/restful-services/3.0/datasets/advanced/${e.id}`).then(t=>{let a=t.data.configuration.dataPrepInstanceId;this.$http.get(`/knowage-data-preparation/api/1.0/process/by-instance-id/${a}`).then(o=>{let d=o.data.definition,m=o.data.id,s=o.data.instance.dataSetId;this.isAvroReady(s)?this.$router.push({name:"data-preparation",params:{id:s,transformations:JSON.stringify(d),processId:m,instanceId:a,dataset:JSON.stringify(e)}}):this.generateAvro(s)},()=>{this.setError({title:"Save error",msg:"Cannot create process"})})},()=>{this.setError({title:"Cannot open data preparation"})}):this.isAvroReady(e.id)?this.$router.push({name:"data-preparation",params:{id:e.id}}):this.generateAvro(e.id)},openDatasetInQBE(e){this.selectedQbeDataset=e,this.qbeVisible=!0},async downloadDatasetFile(e){await this.loadDataset(e.label),await this.$http.get(`/knowage/restful-services/2.0/datasets/download/file?dsLabel=${this.selectedDataset.label}&type=${this.selectedDataset.fileType.toLowerCase()}`,{headers:{Accept:"application/json, text/plain, */*"},responseType:"blob"}).then(t=>{if(t.data.errors)this.setError({title:this.$t("common.error.downloading"),msg:this.$t("common.error.downloading")});else{let a=t.headers["content-disposition"].split("fileName=")[1].split(";")[0];me(t,a),this.setInfo({title:this.$t("common.toast.success")})}})},getFileType(e){switch(e){case"csv":return"text/csv";case"xls":return"application/vnd.ms-excel";case"xlsx":return"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}},shareDataset(){this.shareDialogVisible=!0},async handleDatasetShare(e){this.loading=!0;const t=e.catTypeId?`selfservicedataset/share/?catTypeId=${e.catTypeId}&id=${e.id}`:`selfservicedataset/share/?id=${e.id}`;await this.$http.post("/knowage/restful-services/"+t).then(()=>{this.setInfo({title:this.$t("common.toast.updateTitle"),msg:this.$t("common.toast.success")}),this.showDetailSidebar=!1,this.shareDialogVisible=!1,this.getDatasetsByFilter()}).catch(()=>{}),this.loading=!1},async cloneDataset(e){await this.loadDataset(e.label),this.cloneDialogVisible=!0},async handleDatasetClone(e){await this.$http.post("/knowage/restful-services/1.0/datasets",e,{headers:{"X-Disable-Errors":"true"}}).then(()=>{this.setInfo({title:this.$t("common.toast.deleteTitle"),msg:this.$t("common.toast.success")}),this.showDetailSidebar=!1,this.cloneDialogVisible=!1,this.getDatasetsByFilter()}).catch(t=>{this.warningDialogVisbile=!0,this.warningMessage=t})},datasetPreparation(e){this.$router.push({name:"data-preparation",params:{id:e.id}})},deleteDatasetConfirm(e){this.$confirm.require({message:this.$t("common.toast.deleteMessage"),header:this.$t("common.toast.deleteTitle"),icon:"pi pi-exclamation-triangle",accept:async()=>await this.deleteDataset(e)})},async deleteDataset(e){this.loading=!0,await this.$http.delete(`/knowage/restful-services/1.0/datasets/${e.label}`).then(()=>{this.setInfo({title:this.$t("common.toast.deleteTitle"),msg:this.$t("common.toast.success")}),this.showDetailSidebar=!1,this.getDatasetsByFilter()}).catch(()=>{}),this.loading=!1},closeWarningDialog(){this.warningMessage="",this.warningDialogVisbile=!1},closeWizardAndRealod(){this.showDatasetDialog=!1,this.getDatasetsByFilter()},async getDatasetsByFilter(){switch(await this.getAllAvroDataSets(),this.searchWord="",this.selectedCategoryIds=[],this.selectedCategories=[],this.tableMode){case"My Datasets":this.datasetList=this.getDatasets("owned").then(e=>{this.datasetList=[...e.data.root],this.filteredDatasets=[...this.datasetList]}).finally(()=>this.loading=!1);break;case"Enterprise":this.datasetList=this.getDatasets("enterprise").then(e=>{this.datasetList=[...e.data.root],this.filteredDatasets=[...this.datasetList]}).finally(()=>this.loading=!1);break;case"Shared":this.datasetList=this.getDatasets("shared").then(e=>{this.datasetList=[...e.data.root],this.filteredDatasets=[...this.datasetList]}).finally(()=>this.loading=!1);break;case"All Datasets":this.datasetList=this.getDatasets("mydata").then(e=>{this.datasetList=[...e.data.root],this.filteredDatasets=[...this.datasetList]}).finally(()=>this.loading=!1)}},searchItems(e){setTimeout(()=>{e.value&&(this.selectedCategoryIds=[],e.value.forEach(t=>{this.selectedCategoryIds.push(t.VALUE_ID)})),!this.searchWord.trim().length&&this.selectedCategoryIds.length==0?this.filteredDatasets=[...this.datasetList]:this.selectedCategoryIds.length>0?this.filteredDatasets=this.datasetList.filter(t=>{var a,o,d;return this.selectedCategoryIds.includes(t.catTypeId)&&(((a=t.label)==null?void 0:a.toLowerCase().includes(this.searchWord.toLowerCase()))||((o=t.name)==null?void 0:o.toLowerCase().includes(this.searchWord.toLowerCase()))||((d=t.dsTypeCd)==null?void 0:d.toLowerCase().includes(this.searchWord.toLowerCase()))||this.datasetTagFound(t))}):this.filteredDatasets=this.datasetList.filter(t=>{var a,o,d;return((a=t.label)==null?void 0:a.toLowerCase().includes(this.searchWord.toLowerCase()))||((o=t.name)==null?void 0:o.toLowerCase().includes(this.searchWord.toLowerCase()))||((d=t.dsTypeCd)==null?void 0:d.toLowerCase().includes(this.searchWord.toLowerCase()))||this.datasetTagFound(t)})},250)},closeQbe(){this.qbeVisible=!1,this.selectedQbeDataset=null},datasetTagFound(e){let t=!1;for(let a=0;a<e.tags.length;a++)if(e.tags[a].name.toLowerCase().includes(this.searchWord.toLowerCase())){t=!0;break}return t},handleMonitoring(e){this.selectedDataset=e,this.showMonitoring=!this.showMonitoring},async updateDatasetWithNewCronExpression(e){this.showMonitoring=!1,await this.$http.post("/knowage-data-preparation/api/1.0/process",e).then(()=>{this.loadDataset(this.selectedDataset.label),this.setInfo({title:this.$t("common.save"),msg:this.$t("common.toast.updateSuccess")})},()=>{this.setError({title:this.$t("common.error.saving"),msg:this.$t("managers.workspaceManagement.dataPreparation.errors.updatingSchedulation")})})}},unmounted(){var e;((e=this.user)==null?void 0:e.functionalities.includes("DataPreparation"))&&this.client&&Object.keys(this.client).length>0&&(this.client.deactivate(),this.client={})}}),Zt={class:"p-d-flex p-flex-row p-ai-center p-flex-wrap"},_t={class:"p-float-label p-mr-auto model-search"},ea={class:"kn-material-input-label"},ta={class:"kn-overflow"},aa={key:0},oa={key:0,class:"fas fa-check p-button-link"},ra=x(" \u2002 "),na={key:1,class:"p-grid p-m-2","data-test":"card-container"};function ia(e,t,a,o,d,m){const s=i("Button"),v=i("KnFabButton"),y=i("Toolbar"),k=i("ProgressBar"),g=i("InputText"),n=i("MultiSelect"),M=i("SelectButton"),S=i("Column"),J=i("Chip"),Y=i("DataTable"),G=i("Message"),Z=i("WorkspaceCard"),_=i("DetailSidebar"),ee=i("KnParameterSidebar"),te=i("DatasetWizard"),ae=i("EditPreparedDatasetDialog"),W=i("Menu"),oe=i("WorkspaceDataCloneDialog"),re=i("WorkspaceDataShareDialog"),ne=i("WorkspaceDataPreviewDialog"),ie=i("WorkspaceWarningDialog"),se=i("QBE"),le=i("DataPreparationMonitoringDialog"),z=ue("tooltip");return p(),w(F,null,[r(y,{class:"kn-toolbar kn-toolbar--secondary",style:D(e.mainDescriptor.style.maxWidth)},{start:b(()=>[r(s,{id:"showSidenavIcon",icon:"fas fa-bars",class:"p-button-text p-button-rounded p-button-plain",onClick:t[0]||(t[0]=c=>e.$emit("showMenu"))}),x(" "+u(e.$t("workspace.myData.title")),1)]),end:b(()=>[e.toggleCardDisplay?(p(),h(s,{key:0,icon:"fas fa-list",class:"p-button-text p-button-rounded p-button-plain",onClick:e.toggleDisplayView},null,8,["onClick"])):f("",!0),e.toggleCardDisplay?f("",!0):(p(),h(s,{key:1,icon:"fas fa-th-large",class:"p-button-text p-button-rounded p-button-plain",onClick:e.toggleDisplayView},null,8,["onClick"])),e.tableMode==="My Datasets"?(p(),h(v,{key:2,icon:"fas fa-plus","data-test":"new-folder-button",onClick:e.showCreationMenu},null,8,["onClick"])):f("",!0)]),_:1},8,["style"]),e.loading?(p(),h(k,{key:0,mode:"indeterminate",class:"kn-progress-bar p-ml-2","data-test":"progress-bar"})):f("",!0),l("div",Zt,[r(g,{class:"kn-material-input p-m-3 model-search",style:D(e.mainDescriptor.style.filterInput),modelValue:e.searchWord,"onUpdate:modelValue":t[1]||(t[1]=c=>e.searchWord=c),type:"text",placeholder:e.$t("common.search"),onInput:e.searchItems,"data-test":"search-input"},null,8,["style","modelValue","placeholder","onInput"]),l("span",_t,[r(n,{class:"kn-material-input kn-width-full",style:D(e.mainDescriptor.style.multiselect),modelValue:e.selectedCategories,"onUpdate:modelValue":t[2]||(t[2]=c=>e.selectedCategories=c),options:e.datasetCategories,optionLabel:"VALUE_CD",onChange:e.searchItems,filter:!0},null,8,["style","modelValue","options","onChange"]),l("label",ea,u(e.$t("common.type")),1)]),r(M,{class:"p-mx-2",modelValue:e.tableMode,"onUpdate:modelValue":t[3]||(t[3]=c=>e.tableMode=c),options:e.selectButtonOptions,onClick:e.getDatasetsByFilter,"data-test":"dataset-select"},null,8,["modelValue","options","onClick"])]),l("div",ta,[e.toggleCardDisplay?f("",!0):(p(),h(Y,{key:0,class:"p-datatable-sm kn-table p-mx-2",value:e.filteredDatasets,loading:e.loading,dataKey:"objId",responsiveLayout:"stack",breakpoint:"600px","data-test":"datasets-table"},{empty:b(()=>[x(u(e.$t("common.info.noDataFound")),1)]),default:b(()=>[r(S,{field:"label",header:e.$t("importExport.catalogFunction.column.label"),class:"kn-truncated",sortable:!0},null,8,["header"]),r(S,{field:"name",header:e.$t("importExport.gallery.column.name"),class:"kn-truncated",sortable:!0},null,8,["header"]),r(S,{field:"dsTypeCd",header:e.$t("importExport.gallery.column.type"),sortable:!0},null,8,["header"]),r(S,{field:"tags",header:e.$t("importExport.gallery.column.tags"),sortable:!0},{body:b(c=>[c.data.tags.length>0?(p(),w("span",aa,[(p(!0),w(F,null,P(c.data.tags,($,C)=>(p(),h(J,{key:C},{default:b(()=>[x(u($.name),1)]),_:2},1024))),128))])):f("",!0)]),_:1},8,["header"]),r(S,{header:e.$t("workspace.myData.parametrical")},{body:b(c=>[c.data.pars.length>0||c.data.drivers.length>0?(p(),w("i",oa)):f("",!0)]),_:1},8,["header"]),r(S,{style:D(e.mainDescriptor.style.iconColumn)},{header:b(()=>[ra]),body:b(c=>[e.isAvroLoaded(c.data.id)?U((p(),h(s,{key:0,icon:"far fa-circle-check",class:"p-button-link"},null,512)),[[z,e.$t("workspace.advancedData.avroReady"),void 0,{left:!0}]]):f("",!0),e.isAvroLoading(c.data.id)?U((p(),h(s,{key:1,icon:"fa-solid fa-spinner",class:"p-button-link"},null,512)),[[z,e.$t("workspace.advancedData.avroLoading"),void 0,{left:!0}]]):f("",!0),r(s,{icon:"fas fa-ellipsis-v",class:"p-button-link",onClick:L($=>e.showMenu($,c.data),["stop"])},null,8,["onClick"]),U(r(s,{icon:"fas fa-info-circle",class:"p-button-link",onClick:L($=>e.showSidebar(c.data),["stop"]),"data-test":"info-button-"+c.data.name},null,8,["onClick","data-test"]),[[z,e.$t("workspace.myModels.showInfo"),void 0,{left:!0}]]),r(s,{icon:"fas fa-eye",class:"p-button-link",onClick:L($=>e.previewDataset(c.data),["stop"])},null,8,["onClick"])]),_:1},8,["style"])]),_:1},8,["value","loading"])),e.toggleCardDisplay?(p(),w("div",na,[e.filteredDatasets.length===0?(p(),h(G,{key:0,class:"kn-flex p-m-2",severity:"info",closable:!1,style:D(e.mainDescriptor.style.message)},{default:b(()=>[x(u(e.$t("common.info.noDataFound")),1)]),_:1},8,["style"])):(p(!0),w(F,{key:1},P(e.filteredDatasets,(c,$)=>(p(),h(Z,{key:$,viewType:"dataset",document:c,isAvroReady:e.isAvroReady(c.id),onPreviewDataset:e.previewDataset,onEditDataset:e.editDataset,onOpenDatasetInQBE:t[4]||(t[4]=C=>e.openDatasetInQBE(C)),onExportToXlsx:t[5]||(t[5]=C=>e.prepareDatasetForExport(C,"xls")),onExportToCsv:t[6]||(t[6]=C=>e.prepareDatasetForExport(C,"csv")),onDownloadDatasetFile:e.downloadDatasetFile,onShareDataset:e.shareDataset,onCloneDataset:e.cloneDataset,onDeleteDataset:e.deleteDatasetConfirm,onOpenDataPreparation:e.openDataPreparation,onOpenSidebar:e.showSidebar,onMonitoring:t[7]||(t[7]=C=>e.showMonitoring=!e.showMonitoring)},null,8,["document","isAvroReady","onPreviewDataset","onEditDataset","onDownloadDatasetFile","onShareDataset","onCloneDataset","onDeleteDataset","onOpenDataPreparation","onOpenSidebar"]))),128))])):f("",!0)]),r(_,{visible:e.showDetailSidebar,viewType:"dataset",document:e.selectedDataset,isAvroReady:e.isAvroReady(e.selectedDataset.id),datasetCategories:e.datasetCategories,onPreviewDataset:e.previewDataset,onEditDataset:e.editDataset,onOpenDatasetInQBE:t[8]||(t[8]=c=>e.openDatasetInQBE(c)),onExportToXlsx:t[9]||(t[9]=c=>e.prepareDatasetForExport(c,"xls")),onExportToCsv:t[10]||(t[10]=c=>e.prepareDatasetForExport(c,"csv")),onDownloadDatasetFile:e.downloadDatasetFile,onShareDataset:e.shareDataset,onCloneDataset:e.cloneDataset,onDeleteDataset:e.deleteDatasetConfirm,onOpenDataPreparation:e.openDataPreparation,onClose:t[11]||(t[11]=c=>e.showDetailSidebar=!1),"data-test":"detail-sidebar",onMonitoring:t[12]||(t[12]=c=>e.showMonitoring=!e.showMonitoring)},null,8,["visible","document","isAvroReady","datasetCategories","onPreviewDataset","onEditDataset","onDownloadDatasetFile","onShareDataset","onCloneDataset","onDeleteDataset","onOpenDataPreparation"]),e.parameterSidebarVisible?(p(),w("div",{key:1,id:"document-execution-backdrop",onClick:t[13]||(t[13]=c=>e.parameterSidebarVisible=!1)})):f("",!0),e.parameterSidebarVisible?(p(),h(ee,{key:2,style:{height:"100%",top:"0 !important"},class:"workspace-parameter-sidebar kn-overflow-y",filtersData:e.filtersData,propDocument:e.selectedDataset,propMode:"workspaceView",propQBEParameters:e.selectedDataset.pars,userRole:e.userRole,dataset:e.selectedDataset,onExecute:e.onExecute,onRoleChanged:e.onRoleChange},null,8,["filtersData","propDocument","propQBEParameters","userRole","dataset","onExecute","onRoleChanged"])):f("",!0),e.showDatasetDialog?(p(),h(te,{key:3,selectedDataset:e.selectedDataset,visible:e.showDatasetDialog,onCloseDialog:t[14]||(t[14]=c=>e.showDatasetDialog=!1),onCloseDialogAndReload:e.closeWizardAndRealod},null,8,["selectedDataset","visible","onCloseDialogAndReload"])):f("",!0),r(ae,{dataset:e.selectedDataset,visible:e.showEditPreparedDatasetDialog,onSave:e.updatePreparedDataset,onCancel:t[15]||(t[15]=c=>e.showEditPreparedDatasetDialog=!1)},null,8,["dataset","visible","onSave"]),r(W,{id:"optionsMenu",ref:"optionsMenu",model:e.menuButtons},null,8,["model"]),r(W,{id:"creationMenu",ref:"creationMenu",model:e.creationMenuButtons},null,8,["model"]),r(oe,{visible:e.cloneDialogVisible,propDataset:e.selectedDataset,onClose:t[16]||(t[16]=c=>e.cloneDialogVisible=!1),onClone:e.handleDatasetClone},null,8,["visible","propDataset","onClone"]),r(re,{visible:e.shareDialogVisible,propDataset:e.selectedDataset,datasetCategories:e.datasetCategories,onClose:t[17]||(t[17]=c=>e.shareDialogVisible=!1),onShare:e.handleDatasetShare},null,8,["visible","propDataset","datasetCategories","onShare"]),e.previewDialogVisible?(p(),h(ne,{key:4,visible:e.previewDialogVisible,propDataset:e.selectedDataset,onClose:t[18]||(t[18]=c=>e.previewDialogVisible=!1),previewType:"workspace"},null,8,["visible","propDataset"])):f("",!0),r(ie,{visible:e.warningDialogVisbile,title:e.$t("workspace.myData.title"),warningMessage:e.warningMessage,onClose:e.closeWarningDialog},null,8,["visible","title","warningMessage","onClose"]),e.qbeVisible?(p(),h(se,{key:5,visible:e.qbeVisible,dataset:e.selectedQbeDataset,onClose:e.closeQbe},null,8,["visible","dataset","onClose"])):f("",!0),r(le,{visibility:e.showMonitoring,"onUpdate:visibility":t[19]||(t[19]=c=>e.showMonitoring=c),onClose:t[20]||(t[20]=c=>e.showMonitoring=!1),onSave:e.updateDatasetWithNewCronExpression,dataset:e.selectedDataset},null,8,["visibility","onSave","dataset"])],64)}var Ua=E(Gt,[["render",ia],["__scopeId","data-v-e06f1290"]]);export{Ua as default};
//# sourceMappingURL=WorkspaceDataView-7da91cbb.js.map
