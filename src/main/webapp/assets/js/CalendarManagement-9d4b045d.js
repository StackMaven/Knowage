import{d as M,s as D,_ as A,r as l,o as m,c as I,a as t,f as o,G as z,t as d,z as V,Y as B,w as r,g as v,A as h,l as T,n as F,a6 as C,W as N,h as y,D as g,i as Y,a7 as x,X as L,aK as O}from"./index-1e676509.js";import{f as _}from"./filterHelper-a723991a.js";import{s as H}from"./calendar.esm-60a451ba.js";import{s as X}from"./checkbox.esm-fa6c8259.js";import{s as K}from"./multiselect.esm-ce4000f7.js";const j=["calendar","calType"],Q={"text-align":"end"};var R={globalFilterFields:j,iconColumnStyle:Q};const G={style:{height:"60%","max-height":"80%","max-width":"80%","min-width":"80%"}};var J={dialog:G};const q=100,Z=30;var S={nameMaxLength:q,typeMaxLength:Z};const W=M({name:"calendar-management-detail-form",components:{Calendar:H},props:{propCalendar:{type:Object},generateButtonVisible:{type:Boolean},generateButtonDisabled:{type:Boolean}},emits:["generateCalendarClicked"],data(){return{calendarManagementDetailFormDescriptor:S,calendar:null,calendarNameDirty:!1,startDateDirty:!1,endDateDirty:!1}},computed:{canManageCalendar(){return this.store.$state.user.functionalities.includes("ManageCalendar")},readonly(){var a;return((a=this.calendar)==null?void 0:a.calendarId)!==void 0},nameHelp(){var a,e;return((e=(a=this.calendar)==null?void 0:a.calendar.length)!=null?e:"0")+" / "+S.nameMaxLength},typeHelp(){var a,e;return((e=(a=this.calendar)==null?void 0:a.calType.length)!=null?e:"0")+" / "+S.typeMaxLength}},watch:{propCalendar(){this.loadCalendar()}},setup(){return{store:D()}},created(){this.loadCalendar()},methods:{loadCalendar(){this.calendar=this.propCalendar},generateCalendar(){this.$emit("generateCalendarClicked")}}}),P={key:0,class:"p-fluid p-formgrid p-grid p-m-2"},aa={class:"p-col-12 p-md-6 p-d-flex p-flex-row p-ai-center"},ea={class:"kn-flex"},ta={class:"p-float-label p-m-2"},oa={class:"kn-material-input-label"},ra={class:"p-d-flex p-flex-row p-jc-between"},na={class:"calendar-management-input-help p-m-0"},la={class:"kn-flex"},ia={class:"p-float-label p-m-2"},da={class:"kn-material-input-label"},sa={class:"p-d-flex p-flex-row p-jc-end"},ca={class:"calendar-management-input-help p-m-0"},pa={class:"p-col-12 p-md-6 p-flex p-d-flex p-ai-center"},ba={class:"kn-flex p-mx-2"},ka={class:"p-float-label"},ma={class:"kn-material-input-label"},ua={class:"kn-flex"},ga={class:"p-float-label"},va={class:"kn-material-input-label"};function ha(a,e,s,w,$,E){const b=l("InputText"),u=l("Calendar"),f=l("Button");return a.calendar?(m(),I("div",P,[t("div",aa,[t("div",ea,[t("span",ta,[o(b,{class:z(["kn-material-input",{"p-invalid":a.calendarNameDirty&&a.calendar.calendar.trim().length===0}]),modelValue:a.calendar.calendar,"onUpdate:modelValue":e[0]||(e[0]=i=>a.calendar.calendar=i),modelModifiers:{trim:!0},maxlength:a.calendarManagementDetailFormDescriptor.nameMaxLength,disabled:a.readonly,onInput:e[1]||(e[1]=i=>a.calendarNameDirty=!0),onBlur:e[2]||(e[2]=i=>a.calendarNameDirty=!0),"data-test":"calendar-name-input"},null,8,["modelValue","maxlength","class","disabled"]),t("label",oa,d(a.$t("common.name")+" *"),1)]),t("div",ra,[t("div",null,[V(t("div",{class:"p-error p-mx-2"},d(a.$t("common.validation.required",{fieldName:a.$t("common.name")})),513),[[B,a.calendarNameDirty&&a.calendar.calendar.trim().length===0]])]),t("p",na,d(a.nameHelp),1)])]),t("div",la,[t("span",ia,[o(b,{class:"kn-material-input",modelValue:a.calendar.calType,"onUpdate:modelValue":e[3]||(e[3]=i=>a.calendar.calType=i),modelModifiers:{trim:!0},maxlength:a.calendarManagementDetailFormDescriptor.typeMaxLength,disabled:a.readonly,"data-test":"calendar-type-input"},null,8,["modelValue","maxlength","disabled"]),t("label",da,d(a.$t("common.type")),1)]),t("div",sa,[t("p",ca,d(a.typeHelp),1)])])]),t("div",pa,[t("div",ba,[t("span",ka,[o(u,{class:z(["calendar-management-detail-form-calendar-input",{"p-invalid":a.startDateDirty&&!a.calendar.calStartDay}]),modelValue:a.calendar.calStartDay,"onUpdate:modelValue":e[4]||(e[4]=i=>a.calendar.calStartDay=i),manualInput:!0,disabled:a.readonly,onInput:e[5]||(e[5]=i=>a.startDateDirty=!0),onBlur:e[6]||(e[6]=i=>a.startDateDirty=!0),"data-test":"calendar-start-date-input"},null,8,["modelValue","class","disabled"]),t("label",ma,d(a.$t("managers.calendarManagement.startValidityDate")+" *"),1)])]),t("div",ua,[t("span",ga,[o(u,{class:z(["calendar-management-detail-form-calendar-input",{"p-invalid":a.endDateDirty&&!a.calendar.calEndDay}]),modelValue:a.calendar.calEndDay,"onUpdate:modelValue":e[7]||(e[7]=i=>a.calendar.calEndDay=i),manualInput:!0,minDate:a.calendar.calStartDay,disabled:a.readonly,onInput:e[8]||(e[8]=i=>a.endDateDirty=!0),onBlur:e[9]||(e[9]=i=>a.endDateDirty=!0),"data-test":"calendar-end-date-input"},null,8,["modelValue","class","minDate","disabled"]),t("label",va,d(a.$t("managers.calendarManagement.endValidityDate")+" *"),1)])]),V(o(f,{id:"calendar-management-generate-calendar-button",class:"kn-button kn-button--primary p-ml-2",disabled:a.generateButtonDisabled,onClick:a.generateCalendar},{default:r(()=>[v(d(a.$t("common.generate")),1)]),_:1},8,["disabled","onClick"]),[[B,a.canManageCalendar&&a.generateButtonVisible]])])])):h("",!0)}var fa=A(W,[["render",ha],["__scopeId","data-v-56554484"]]);const ya={date:{width:"20%"},day:{width:"20%"},checkbox:{width:"10%"},checkEvent:{width:"30%"}},wa={"text-align":"end"};var xa={columnStyle:ya,iconColumnStyle:wa};const Ca=M({name:"calendar-management-detail-table",components:{Checkbox:X,Column:T,DataTable:F,MultiSelect:K},props:{propCalendarInfo:{type:Array},domains:{type:Array}},data(){return{calendarManagementDetailTableDescriptor:xa,calendarSplitData:[]}},computed:{canManageCalendar(){return this.store.$state.user.functionalities.includes("ManageCalendar")}},watch:{propCalendarInfo(){this.loadCalendarInfo()}},setup(){return{store:D()}},created(){this.loadCalendarInfo()},methods:{loadCalendarInfo(){this.calendarSplitData=this.propCalendarInfo},getFormattedDate(a){const e=C(a).format("DD/MM/YYYY");return N(e,"","DD/MM/YYYY")},deleteItemConfirm(a){this.$confirm.require({message:this.$t("common.toast.deleteMessage"),header:this.$t("common.toast.deleteConfirmTitle"),icon:"pi pi-exclamation-triangle",accept:()=>this.deleteItem(a)})},deleteItem(a){const e=this.calendarSplitData.findIndex(s=>a.idCalComposition===s.idCalComposition);e!==-1&&this.calendarSplitData.splice(e,1)}}});function Ma(a,e,s,w,$,E){const b=l("Column"),u=l("Checkbox"),f=l("MultiSelect"),i=l("Button"),k=l("DataTable");return a.calendarSplitData?(m(),y(k,{key:0,value:a.calendarSplitData,paginator:a.calendarSplitData.length>20,rows:20,class:"p-datatable-sm",dataKey:"idCalComposition",responsiveLayout:"stack",breakpoint:"960px"},{empty:r(()=>[v(d(a.$t("common.info.noDataFound")),1)]),default:r(()=>[o(b,{class:"kn-truncated",field:"timeByDay.timeDate",header:a.$t("cron.date"),style:g(a.calendarManagementDetailTableDescriptor.columnStyle.date),sortable:!0},{body:r(n=>[t("span",null,d(a.getFormattedDate(n.data.timeByDay.timeDate)),1)]),_:1},8,["header","style"]),o(b,{class:"kn-truncated",field:"day",header:a.$t("cron.day"),style:g(a.calendarManagementDetailTableDescriptor.columnStyle.day),sortable:!0},null,8,["header","style"]),o(b,{class:"kn-truncated",field:"isHoliday",header:a.$t("managers.calendarManagement.holiday"),style:g(a.calendarManagementDetailTableDescriptor.columnStyle.checkbox),sortable:!0},{body:r(n=>[o(u,{modelValue:n.data[n.column.props.field],"onUpdate:modelValue":c=>n.data[n.column.props.field]=c,binary:!0},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["header","style"]),o(b,{class:"kn-truncated",field:"pubHoliday",header:a.$t("managers.calendarManagement.publicHoliday"),style:g(a.calendarManagementDetailTableDescriptor.columnStyle.checkbox),sortable:!0},{body:r(n=>[o(u,{modelValue:n.data[n.column.props.field],"onUpdate:modelValue":c=>n.data[n.column.props.field]=c,binary:!0},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["header","style"]),o(b,{class:"kn-truncated",field:"listOfAttributes",header:a.$t("common.attributes"),style:g(a.calendarManagementDetailTableDescriptor.columnStyle.checkEvent),sortable:!0},{body:r(n=>[o(f,{class:"kn-material-input",modelValue:n.data[n.column.props.field],"onUpdate:modelValue":c=>n.data[n.column.props.field]=c,options:a.domains,optionLabel:"attributeDomainDescr",optionValue:"attributeDomainDescr"},null,8,["modelValue","onUpdate:modelValue","options"])]),_:1},8,["header","style"]),a.canManageCalendar?(m(),y(b,{key:0,style:g(a.calendarManagementDetailTableDescriptor.iconColumnStyle)},{body:r(n=>[o(i,{icon:"pi pi-trash",class:"p-button-link",onClick:c=>a.deleteItemConfirm(n.data)},null,8,["onClick"])]),_:1},8,["style"])):h("",!0)]),_:1},8,["value","paginator"])):h("",!0)}var Da=A(Ca,[["render",Ma]]);const Aa=M({name:"calendar-management-dialog",components:{CalendarManagementDetailForm:fa,CalendarManagementDetailTable:Da,Dialog:Y},props:{visible:{type:Boolean},propCalendar:{type:Object},domains:{type:Array}},emits:["close","calendarSaved"],data(){return{calendarManagementDialogDescriptor:J,calendar:null,calendarInfo:[],generateButtonVisible:!1,generateButtonDisabled:!0,calendarDetailTableVisible:!1,loading:!1}},computed:{buttonDisabled(){return this.calendar===null||!this.calendar.calendar||!this.calendar.calStartDay||!this.calendar.calEndDay},canManageCalendar(){return this.store.$state.user.functionalities.includes("ManageCalendar")}},watch:{propCalendar(){this.visible&&this.loadCalendar()}},setup(){return{store:D()}},created(){this.loadCalendar()},methods:{async loadCalendar(){var a;this.calendar=x(this.propCalendar),this.calendar&&this.calendar.calStartDay&&(this.calendar.calStartDay=new Date(this.calendar.calStartDay)),this.calendar&&this.calendar.calEndDay&&(this.calendar.calEndDay=new Date(this.calendar.calEndDay)),(a=this.calendar)!=null&&a.calendarId&&(await this.loadCalendarInfo(this.calendar.calendarId),this.calendarDetailTableVisible=!0)},async loadCalendarInfo(a){this.loading=!0,await this.$http.get(`/knowage/restful-services/calendar/${a}/getInfoCalendarById`).then(e=>{this.calendarInfo=e.data,this.generateButtonVisible=!0,this.getRealCalendarInfo()}).catch(()=>{}),this.loading=!1},getRealCalendarInfo(){var a;if(!!this.calendar){this.calendar.splittedCalendar=[];for(let e=0;e<this.calendarInfo.length;e++){const s=x(this.calendarInfo[e]);s.day=s.timeByDay.dayName,s.isHoliday=s.isHoliday==1,s.pubHoliday=s.pubHoliday=="true",s.listOfAttributes=(a=s.listOfAttributes)==null?void 0:a.map(w=>w.calendarAttributeDomain.attributeDomainDescr),this.calendar.splittedCalendar.push(s)}}},async save(){var a;this.loading=!0,(a=this.calendar)!=null&&a.calendarId?await this.updateCalendar():await this.saveCalendar(),this.loading=!1},async saveCalendar(){const a=x(this.calendar);a.calStartDay=C(a.calStartDay).valueOf(),a.calEndDay=C(a.calEndDay).valueOf(),await this.$http.post("/knowage/restful-services/calendar/saveCalendar",a).then(e=>{this.store.setInfo({title:this.$t("common.toast.createTitle"),msg:this.$t("common.toast.createSuccess")}),this.calendar&&(this.calendar.calendarId=e.data),this.generateButtonVisible=!0,this.generateButtonDisabled=!1,this.$emit("calendarSaved")}).catch(()=>{})},async updateCalendar(){if(!this.calendar)return;const a=this.getFormattedSplittedCalendar();await this.$http.post(`/knowage/restful-services/calendar/${this.calendar.calendarId}/updateDaysGenerated`,a).then(()=>{this.store.setInfo({title:this.$t("common.toast.updateTitle"),msg:this.$t("common.toast.updateSuccess")})}).catch(()=>{})},getFormattedSplittedCalendar(){if(!this.calendar)return;const a=x(this.calendar.splittedCalendar);return a==null||a.forEach(e=>{e.isHoliday=e.isHoliday?1:null,e.pubHoliday=e.pubHoliday?"true":null,delete e.date,delete e.day,delete e.checkEvent}),a},generateCalendarConfirm(){this.$confirm.require({message:this.$t("managers.calendarManagement.generateConfirmMessage",{numberOfDays:this.getDays()}),header:this.$t("managers.calendarManagement.generateConfirmTitle"),icon:"pi pi-exclamation-triangle",accept:()=>this.generateCalendar()})},getDays(){if(!this.calendar)return;const a=Math.abs(this.calendar.calEndDay.getTime()-this.calendar.calStartDay.getTime());return Math.ceil(a/(1e3*3600*24))+1},async generateCalendar(){var a;this.loading=!0,await this.$http.post(`/knowage/restful-services/calendar/${(a=this.calendar)==null?void 0:a.calendarId}/generateCalendarDays`,{}).then(async()=>{var e;await this.loadCalendarInfo((e=this.calendar)==null?void 0:e.calendarId),this.generateButtonDisabled=!0,this.calendarDetailTableVisible=!0}).catch(()=>{}),this.loading=!1},close(){this.calendar=null,this.generateButtonVisible=!1,this.generateButtonDisabled=!0,this.calendarDetailTableVisible=!1,this.$emit("close")}}});function $a(a,e,s,w,$,E){const b=l("Toolbar"),u=l("ProgressBar"),f=l("CalendarManagementDetailForm"),i=l("CalendarManagementDetailTable"),k=l("Button"),n=l("Dialog");return m(),y(n,{id:"calendar-management-dialog",class:"p-fluid kn-dialog--toolbar--primary",visible:a.visible,modal:!0,closable:!1,style:g(a.calendarManagementDialogDescriptor.dialog.style)},{header:r(()=>[o(b,{class:"kn-toolbar kn-toolbar--primary p-p-0 p-m-0 p-col-12"},{start:r(()=>{var c;return[v(d((c=a.calendar)==null?void 0:c.calendar),1)]}),_:1})]),footer:r(()=>[o(k,{class:"kn-button kn-button--primary",onClick:a.close},{default:r(()=>[v(d(a.$t("common.cancel")),1)]),_:1},8,["onClick"]),a.canManageCalendar?(m(),y(k,{key:0,class:"kn-button kn-button--primary",disabled:a.buttonDisabled,onClick:a.save},{default:r(()=>[v(d(a.$t("common.save")),1)]),_:1},8,["disabled","onClick"])):h("",!0)]),default:r(()=>{var c;return[a.loading?(m(),y(u,{key:0,mode:"indeterminate",class:"kn-progress-bar"})):h("",!0),t("div",null,[o(f,{propCalendar:a.calendar,generateButtonVisible:a.generateButtonVisible,generateButtonDisabled:a.generateButtonDisabled,onGenerateCalendarClicked:a.generateCalendarConfirm},null,8,["propCalendar","generateButtonVisible","generateButtonDisabled","onGenerateCalendarClicked"]),a.calendarDetailTableVisible?(m(),y(i,{key:0,class:"p-m-4",propCalendarInfo:(c=a.calendar)==null?void 0:c.splittedCalendar,domains:a.domains},null,8,["propCalendarInfo","domains"])):h("",!0)])]}),_:1},8,["visible","style"])}var Ea=A(Aa,[["render",$a]]);const za=M({name:"calendar-management",components:{CalendarManagementDialog:Ea,Column:T,DataTable:F,KnFabButton:L,KnOverlaySpinnerPanel:O},data(){return{calendarManagementDescriptor:R,calendars:[],domains:[],filters:{global:[_]},selectedCalendar:null,calendarDialogVisible:!1,loading:!1}},computed:{canManageCalendar(){return this.store.$state.user.functionalities.includes("ManageCalendar")}},setup(){return{store:D()}},async created(){await this.loadCalendars(),await this.loadDomains()},methods:{async loadCalendars(){this.loading=!0,await this.$http.get("/knowage/restful-services/calendar/getCalendarList").then(a=>this.calendars=a.data),this.loading=!1},async loadDomains(){this.loading=!0,await this.$http.get("/knowage/restful-services/calendar/getDomains").then(a=>this.domains=a.data),this.loading=!1},showForm(a=null){this.selectedCalendar=a?a.data:this.createNewCalendar(),this.calendarDialogVisible=!0},getFormattedDate(a){const e=C(a).format("DD/MM/YYYY");return N(e,"","DD/MM/YYYY")},deleteCalendarConfirm(a){this.$confirm.require({message:this.$t("common.toast.deleteMessage"),header:this.$t("common.toast.deleteConfirmTitle"),icon:"pi pi-exclamation-triangle",accept:()=>this.deleteCalendar(a)})},async deleteCalendar(a){await this.$http.post(`/knowage/restful-services/calendar/${a.calendarId}/deleteCalendar`).then(()=>{this.store.setInfo({title:this.$t("common.toast.deleteTitle"),msg:this.$t("common.toast.deleteSuccess")}),this.removeCalendar(a)}).catch(()=>{})},removeCalendar(a){const e=this.calendars.findIndex(s=>s.calendarId===a.calendarId);e!==-1&&this.calendars.splice(e,1)},createNewCalendar(){return{realDateGenerated:[],splittedCalendar:[],calStartDay:null,calEndDay:null,calendar:"",calType:""}},closeCalendarDialog(){this.selectedCalendar=null,this.calendarDialogVisible=!1},onCalendarSaved(){this.loadCalendars()}}}),Sa={class:"kn-page"},Ia={class:"kn-page-content p-grid p-m-0"},Va={key:0,class:"p-col"},Ba={class:"table-header"},Ta={class:"p-input-icon-left"},Fa=t("i",{class:"pi pi-search"},null,-1),Na=["data-test"];function Ua(a,e,s,w,$,E){const b=l("KnFabButton"),u=l("Toolbar"),f=l("KnOverlaySpinnerPanel"),i=l("InputText"),k=l("Column"),n=l("Button"),c=l("DataTable"),U=l("CalendarManagementDialog");return m(),I("div",Sa,[o(u,{class:"kn-toolbar kn-toolbar--primary"},{start:r(()=>[v(d(a.$t("managers.calendarManagement.title")),1)]),end:r(()=>[V(o(b,{icon:"fas fa-plus",onClick:e[0]||(e[0]=p=>a.showForm())},null,512),[[B,a.canManageCalendar]])]),_:1}),o(f,{visibility:a.loading,"data-test":"spinner"},null,8,["visibility"]),t("div",Ia,[a.loading?h("",!0):(m(),I("div",Va,[o(c,{value:a.calendars,paginator:a.calendars.length>20,loading:a.loading,rows:20,class:"p-datatable-sm kn-table",dataKey:"id",filters:a.filters,"onUpdate:filters":e[2]||(e[2]=p=>a.filters=p),globalFilterFields:a.calendarManagementDescriptor.globalFilterFields,responsiveLayout:"stack",breakpoint:"960px",onRowClick:e[3]||(e[3]=p=>a.showForm(p)),"data-test":"calendar-table"},{header:r(()=>[t("div",Ba,[t("span",Ta,[Fa,o(i,{class:"kn-material-input",modelValue:a.filters.global.value,"onUpdate:modelValue":e[1]||(e[1]=p=>a.filters.global.value=p),placeholder:a.$t("common.search"),"data-test":"search-input"},null,8,["modelValue","placeholder"])])])]),empty:r(()=>[v(d(a.$t("common.info.noDataFound")),1)]),loading:r(()=>[v(d(a.$t("common.info.dataLoading")),1)]),default:r(()=>[o(k,{class:"kn-truncated",field:"calendar",header:a.$t("common.name"),sortable:!0},null,8,["header"]),o(k,{class:"kn-truncated",field:"calStartDay",header:a.$t("cron.startDate"),sortable:!0},{body:r(p=>[t("span",{"data-test":"calendar-start-day-"+p.data.calendar},d(a.getFormattedDate(p.data.calStartDay)),9,Na)]),_:1},8,["header"]),o(k,{class:"kn-truncated",field:"calEndDay",header:a.$t("cron.endDate"),sortable:!0},{body:r(p=>[t("span",null,d(a.getFormattedDate(p.data.calEndDay)),1)]),_:1},8,["header"]),o(k,{class:"kn-truncated",field:"calType",header:a.$t("common.type"),sortable:!0},null,8,["header"]),a.canManageCalendar?(m(),y(k,{key:0,style:g(a.calendarManagementDescriptor.iconColumnStyle)},{body:r(p=>[o(n,{icon:"pi pi-trash",class:"p-button-link",onClick:Ya=>a.deleteCalendarConfirm(p.data),"data-test":"delete-button-"+p.data.calendar},null,8,["onClick","data-test"])]),_:1},8,["style"])):h("",!0)]),_:1},8,["value","paginator","loading","filters","globalFilterFields"])]))]),o(U,{visible:a.calendarDialogVisible,propCalendar:a.selectedCalendar,domains:a.domains,onClose:a.closeCalendarDialog,onCalendarSaved:a.onCalendarSaved},null,8,["visible","propCalendar","domains","onClose","onCalendarSaved"])])}var Ka=A(za,[["render",Ua]]);export{Ka as default};
//# sourceMappingURL=CalendarManagement-9d4b045d.js.map
