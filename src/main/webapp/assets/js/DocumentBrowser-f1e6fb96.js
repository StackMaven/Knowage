import{d as A,_ as E,r as k,o as a,h as w,w as v,a as n,t as u,l as K,n as X,q as P,x as $,s as T,y as V,c as l,g as N,D as I,A as p,f as g,B as D,C as B,z as y,V as Q,W as _,X as j,Y as F,N as Y,G as J,$ as W,a0 as G,v as H,u as Z,a1 as S}from"./index-1e676509.js";import{K as q}from"./KnHint-6d455703.js";import{s as ee}from"./tree.esm-837306a6.js";import{s as te}from"./breadcrumb.esm-bbffcb4d.js";import{f as z}from"./filterHelper-a723991a.js";import{s as L}from"./menu.esm-6bee86d0.js";function oe(e){let t="";switch(e.typeCode){case"DATAMART":t="registry";break;case"DASHBOARD":case"DOCUMENT_COMPOSITE":t="document-composite";break;case"OFFICE_DOC":t="office-doc";break;case"OLAP":t="olap";break;case"MAP":t="map";break;case"REPORT":t="report";break;case"KPI":t="kpi";break;case"DOSSIER":t="dossier";break;case"ETL":t="etl";break}return t}const re=A({name:"document-browser-hint",components:{KnHint:q}});function ae(e,t,o,r,d,h){const b=k("KnHint");return a(),w(b,{title:"documentBrowser.title",hint:"documentBrowser.hint"},null,8,["title","hint"])}var ne=E(re,[["render",ae]]);const ie=A({name:"document-browser-tree",components:{Tree:ee},props:{propFolders:{type:Array},selectedBreadcrumb:{type:Object},selectedFolderProp:{type:Object}},emits:["folderSelected"],data(){return{folders:[],nodes:[],selectedFolderKey:{},expandedKeys:{},selectedFolder:null}},watch:{propFolders(){this.loadFolders(),this.createNodeTree()},selectedBreadcrumb(){this.onBreadcrumbSelected()},selectedFolderProp(){var t,o;if(this.selectedFolder=this.selectedFolderProp,!this.selectedFolder)return;this.selectedFolderKey={},this.selectedFolderKey[this.selectedFolder.key]=!0;let e=null;for(let r=0;r<this.nodes.length;r++)if(e=this.findNode(this.nodes[r],this.selectedFolder.id,"id"),e){this.selectedFolderKey[e.key]=!0,this.expandedKeys[e.key]=!0;const d=(o=(t=this.selectedFolder.path)==null?void 0:t.substring(1))==null?void 0:o.split("/");d==null||d.forEach(h=>{const b=this.findNode(this.nodes[r],h,"code");b&&(this.expandedKeys[b.key]=!0)});break}}},created(){this.loadFolders(),this.createNodeTree()},methods:{loadFolders(){this.folders=this.propFolders,this.loadSelectedFolderFromLocalStorage()},createNodeTree(){const e={key:"Personal_Folders",icon:"pi pi-folder",id:-1,parentId:null,label:"Personal_Folders",children:[],data:{id:-1,codType:"LOW_FUNCT",code:"Personal_Folders",createRoles:[],description:"Personal Folders",name:"Personal_Folders",parentId:null,subfolders:[],path:"/Personal-Folders"}};this.nodes=[e];const t=[];this.folders.forEach(o=>{const r={key:o.name,icon:"pi pi-folder",id:o.id,parentId:o.parentId,label:o.name,children:[],data:o};r.children=t.filter(d=>r.id===d.parentId&&d.data.codType!=="LOW_FUNCT"),this.attachFolderToTree(r,t,e)})},attachFolderToTree(e,t,o){var r,d,h;if(e.parentId&&e.parentId!==-1){let b=null;for(let i=0;i<t.length;i++)if(e.parentId===t[i].id&&t[i].data.codType!=="USER_FUNCT"){e.data.parentFolder=t[i],(r=t[i].children)==null||r.push(e);break}for(let i=0;i<this.nodes.length;i++)if(b=this.findParentFolder(e,this.nodes[i]),b&&b.data.codType!=="USER_FUNCT"){e.data.parentFolder=b,(d=b.children)==null||d.push(e);break}!b&&e.data.codType!=="USER_FUNCT"&&t.push(e)}else e.data.codType==="USER_FUNCT"?(e.data.parentFolder=o,e.data.parentId=o.id,(h=o.children)==null||h.push(e)):this.nodes.push(e)},findParentFolder(e,t){if(e.data.codType==="USER_FUNCT")return null;if(e.parentId===t.id)return t;{let o=null;if(t.children)for(let r=0;r<t.children.length&&(o=this.findParentFolder(e,t.children[r]),!o);r++);return o}},setSelectedFolder(e){this.selectedFolder=e.data,localStorage.setItem("documentSelectedFolderId",JSON.stringify(this.selectedFolder.id)),this.$emit("folderSelected",this.selectedFolder)},setOpenFolderIcon(e){e.icon="pi pi-folder-open"},setClosedFolderIcon(e){e.icon="pi pi-folder"},onBreadcrumbSelected(){var e;this.selectedFolder=(e=this.selectedBreadcrumb)==null?void 0:e.node,this.selectedFolderKey={},this.selectedFolderKey[this.selectedFolder.key]=!0},loadSelectedFolderFromLocalStorage(){const e=localStorage.getItem("documentSelectedFolderId");if(e){const t=this.folders.findIndex(o=>o.id===JSON.parse(e));t!==-1&&(this.selectedFolder=this.folders[t],this.selectedFolderKey[this.folders[t].name]=!0,this.expandedKeys[this.folders[t].name]=!0,this.$emit("folderSelected",this.selectedFolder))}},findNode(e,t,o){if(e.data[o]===t)return e;if(e.children!=null){let r=null;for(let d=0;r==null&&d<e.children.length;d++)r=this.findNode(e.children[d],t,o);return r}return null}}});function de(e,t,o,r,d,h){const b=k("Tree");return a(),w(b,{id:"folders-tree",class:"kn-tree kn-column-tree kn-flex p-p-0",scrollHeight:"calc(100vh - 127px)",maximizable:"",value:e.nodes,selectionMode:"single",selectionKeys:e.selectedFolderKey,"onUpdate:selectionKeys":t[0]||(t[0]=i=>e.selectedFolderKey=i),filter:!0,filterMode:"lenient",expandedKeys:e.expandedKeys,onNodeSelect:e.setSelectedFolder,onNodeExpand:t[1]||(t[1]=i=>e.setOpenFolderIcon(i)),onNodeCollapse:t[2]||(t[2]=i=>e.setClosedFolderIcon(i))},null,8,["value","selectionKeys","expandedKeys","onNodeSelect"])}var le=E(ie,[["render",de],["__scopeId","data-v-189b55f0"]]);const ce=A({name:"document-browser-breadcrumb",components:{Breadcrumb:te},props:{breadcrumbs:{type:Array}},emits:["breadcrumbClicked"],data(){return{home:{icon:"pi pi-home"},items:[]}},watch:{breadcrumbs(){this.loadBreadcrumbs()}},created(){this.loadBreadcrumbs()},methods:{loadBreadcrumbs(){this.items=this.breadcrumbs},selectBreadcrumb(e){const t=this.items.findIndex(o=>o.label===e.target.textContent);t!==-1&&(this.$emit("breadcrumbClicked",this.items[t]),this.items.splice(t+1))}}}),se=["data-test"];function be(e,t,o,r,d,h){const b=k("Breadcrumb");return a(),w(b,{home:e.home,model:e.items,class:"kn-breadcrumb border-bottom"},{item:v(({item:i})=>[n("span",{class:"breadcrumbs-item",onClick:t[0]||(t[0]=(...x)=>e.selectBreadcrumb&&e.selectBreadcrumb(...x)),"data-test":"breadcrumb-"+i.label},u(i.label),9,se)]),_:1},8,["home","model"])}var pe=E(ce,[["render",be]]);const ke="960px",ue=[{field:"typeCode",header:"common.type",style:{}},{field:"name",header:"common.name",style:{}},{field:"label",header:"common.label",style:{}},{field:"creationUser",header:"common.author",style:{}}],me="stack",fe=15,ve={"sbidomains.nm.dev":"common.development","sbidomains.nm.rel":"common.released","sbidomains.nm.susp":"common.suspended","sbidomains.nm.test":"common.test"},ge={message:{"align-items":"center",display:"flex","justify-content":"center","text-align":"center"}},he={iconColumn:{style:{"flex-basis":"40px","flex-grow":.3,"justify-content":"center"}},smallmessage:{"flex-basis":"40px","flex-grow":.3}};var U={breakpoint:ke,columns:ue,responsiveLayout:me,rows:fe,status:ve,styles:ge,table:he};const we=A({name:"document-browser-table",components:{Column:K,DataTable:X,Message:P},props:{propDocuments:{type:Array},searchMode:{type:Boolean}},emits:["itemSelected","selected"],data(){return{documentBrowserTableDescriptor:U,documents:[],filters:{global:[z],typeCode:{operator:$.AND,constraints:[z]},name:{operator:$.AND,constraints:[z]},label:{operator:$.AND,constraints:[z]},creationUser:{operator:$.AND,constraints:[z]},stateCodeStr:{operator:$.AND,constraints:[z]}},user:null,first:0}},watch:{propDocuments(){this.loadDocuments(),this.first=0}},computed:{isAdmin(){var e,t;return((e=this.user)==null?void 0:e.functionalities.includes("DocumentManagement"))||((t=this.user)==null?void 0:t.isSuperadmin)}},setup(){return{store:T()}},created(){this.loadDocuments(),this.first=0,this.user=this.store.$state.user},methods:{loadDocuments(){var e;this.documents=(e=this.propDocuments)==null?void 0:e.map(t=>(t.field==="status"&&(t.style=U.table.smallmessage),{...t,stateCodeStr:this.getTranslatedStatus(t.stateCodeStr)}))},getTranslatedStatus(e){var t;return e?this.$t((t=U.status[e])!=null?t:""):""},executeDocument(e){this.$emit("itemSelected",{item:e,mode:"execute"})}}}),xe={class:"p-d-flex p-flex-row p-jc-center"},ye={key:0,class:"table-header p-d-flex"},Me={class:"p-input-icon-left p-mr-3 p-col-12"},Ce=n("i",{class:"pi pi-search"},null,-1),Ae={class:"kn-overflow-y last-flex-container kn-flex"},Ee={class:"kn-truncated"},De={"data-test":"document-status"},Ie={class:"fa-stack"},ze=n("i",{class:"fa fa-eye fa-stack-1x"},null,-1),$e={key:0,class:"fa fa-ban fa-stack-2x"};function Se(e,t,o,r,d,h){const b=k("Message"),i=k("InputText"),x=k("Column"),f=k("Button"),C=k("DataTable"),M=V("tooltip");return a(),l(D,null,[n("div",xe,[e.searchMode?(a(),w(b,{key:0,id:"documents-found-hint",class:"p-m-2",severity:"info",closable:!1,style:I(e.documentBrowserTableDescriptor.styles.message)},{default:v(()=>[N(u(e.documents.length+" "+e.$t("documentBrowser.documentsFound")),1)]),_:1},8,["style"])):p("",!0)]),e.searchMode?p("",!0):(a(),l("div",ye,[n("span",Me,[Ce,g(i,{class:"kn-material-input",modelValue:e.filters.global.value,"onUpdate:modelValue":t[0]||(t[0]=c=>e.filters.global.value=c),type:"text",placeholder:e.$t("common.search"),"data-test":"filterInput"},null,8,["modelValue","placeholder"])])])),n("div",Ae,[g(C,{id:"documents-datatable",first:e.first,"onUpdate:first":t[1]||(t[1]=c=>e.first=c),value:e.documents,paginator:e.documents.length>e.documentBrowserTableDescriptor.rows,paginatorTemplate:"CurrentPageReport FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink",currentPageReportTemplate:e.$t("common.table.footer.paginated",{first:"{first}",last:"{last}",totalRecords:"{totalRecords}"}),rows:e.documentBrowserTableDescriptor.rows,filters:e.filters,"onUpdate:filters":t[2]||(t[2]=c=>e.filters=c),filterDisplay:"menu",selectionMode:"single",class:"p-datatable-sm kn-table",dataKey:"id",responsiveLayout:e.documentBrowserTableDescriptor.responsiveLayout,breakpoint:e.documentBrowserTableDescriptor.breakpoint,onRowClick:t[3]||(t[3]=c=>e.$emit("selected",c.data)),"data-test":"documents-datatable",style:{width:"100%"},scrollable:!0,scrollHeight:"100%"},{empty:v(()=>[g(b,{class:"p-m-2",severity:"info",closable:!1,style:I(e.documentBrowserTableDescriptor.styles.message),"data-test":"no-documents-hint"},{default:v(()=>[N(u(e.$t("documentBrowser.noDocumentsHint")),1)]),_:1},8,["style"])]),default:v(()=>[(a(!0),l(D,null,B(e.documentBrowserTableDescriptor.columns,c=>(a(),w(x,{class:"kn-truncated",style:I(c.style),header:e.$t(c.header),field:c.field,key:c.field,sortField:c.field,sortable:!0},{filter:v(({filterModel:s})=>[g(i,{type:"text",modelValue:s.value,"onUpdate:modelValue":m=>s.value=m,class:"p-column-filter"},null,8,["modelValue","onUpdate:modelValue"])]),body:v(s=>[y((a(),l("span",Ee,[N(u(s.data[c.field]),1)])),[[M,s.data[c.field],void 0,{top:!0}]])]),_:2},1032,["style","header","field","sortField"]))),128)),e.isAdmin?(a(),w(x,{key:0,header:e.$t("common.status"),field:"stateCodeStr",sortField:"stateCodeStr",sortable:!0,style:I(e.documentBrowserTableDescriptor.table.smallmessage)},{filter:v(({filterModel:c})=>[g(i,{type:"text",modelValue:c.value,"onUpdate:modelValue":s=>c.value=s,class:"p-column-filter"},null,8,["modelValue","onUpdate:modelValue"])]),body:v(c=>[n("span",De,u(c.data.stateCodeStr),1)]),_:1},8,["header","style"])):p("",!0),e.isAdmin?(a(),w(x,{key:1,header:e.$t("common.visible"),field:"visible",sortField:"visible",sortable:!0,style:I(e.documentBrowserTableDescriptor.table.iconColumn.style)},{body:v(c=>[y((a(),l("span",Ie,[ze,c.data.visible?p("",!0):(a(),l("i",$e))])),[[M,c.data.visible?e.$t("common.visible"):e.$t("common.notVisible")]])]),_:1},8,["header","style"])):p("",!0),g(x,{style:I(e.documentBrowserTableDescriptor.table.iconColumn.style)},{body:v(c=>[y(g(f,{icon:"fa fa-play-circle",class:"p-button-link",onClick:Q(s=>e.executeDocument(c.data),["stop"])},null,8,["onClick"]),[[M,e.$t("documentBrowser.executeDocument"),void 0,{left:!0}]])]),_:1},8,["style"])]),_:1},8,["first","value","paginator","currentPageReportTemplate","rows","filters","responsiveLayout","breakpoint"])])],64)}var Fe=E(we,[["render",Se]]);const Be=A({name:"document-browser-sidebar",props:{selectedDocument:{type:Object}},emits:["documentCloneClick","documentDeleteClick","itemSelected","documentChangeStateClicked","showDocumentDetails"],data(){return{document:null,user:null}},watch:{selectedDocument(){this.loadDocument()}},computed:{isSuperAdmin(){var e;return(e=this.user)==null?void 0:e.isSuperadmin},getImageUrl(){var e;return`/knowage/servlet/AdapterHTTP?ACTION_NAME=MANAGE_PREVIEW_FILE_ACTION&SBI_ENVIRONMENT=DOCBROWSER&LIGHT_NAVIGATOR_DISABLED=TRUE&operation=DOWNLOAD&fileName=${(e=this.selectedDocument)==null?void 0:e.previewFile}`},canEditDocument(){if(!this.user)return!1;switch(this.document.stateCode){case"TEST":return this.user.functionalities.includes("DocumentTestManagement");case"DEV":return this.user.functionalities.includes("DocumentDevManagement");case"REL":return this.user.functionalities.includes("DocumentAdminManagement");case"SUSPENDED":case"SUSP":return this.user.functionalities.includes("DocumentAdminManagement");default:return!1}}},setup(){return{store:T()}},created(){this.loadDocument(),this.user=this.store.$state.user},methods:{loadDocument(){this.document=this.selectedDocument},getFormatedDate(e){return _(e,"MMM DD, YYYY h:mm:ss A")},cloneDocumentConfirm(){this.$confirm.require({header:this.$t("common.toast.cloneConfirmTitle"),accept:()=>this.$emit("documentCloneClick",this.document)})},deleteDocumentConfirm(){this.$confirm.require({message:this.$t("common.toast.deleteMessage"),header:this.$t("common.toast.deleteTitle"),icon:"pi pi-exclamation-triangle",accept:()=>this.$emit("documentDeleteClick",this.document)})},changeStateDocumentConfirm(e){this.$confirm.require({message:this.$t("documentBrowser.changeStateMessage"),header:this.$t("documentBrowser.changeStateTitle"),icon:"pi pi-exclamation-triangle",accept:()=>this.$emit("documentChangeStateClicked",{document:this.document,direction:e})})},executeDocument(){this.$emit("itemSelected",{item:this.document,mode:"execute"})}}}),Te={id:"document-browser-sidebar"},Ne={id:"document-icons-container",class:"p-d-flex p-flex-row p-jc-around"},Ue={class:"p-m-4"},Re={key:0,class:"p-text-center"},Oe=["src"],Ve={key:1,class:"p-m-4"},Le={class:"p-m-0"},Ke={key:2,class:"p-m-4"},Xe={class:"p-m-0"},Pe={class:"p-m-0"},Qe={key:3,class:"p-m-4"},_e={class:"p-m-0"},je={class:"p-m-0"},Ye={key:4,class:"p-m-4"},Je={class:"p-m-0"},We={class:"p-m-0"},Ge={key:5,class:"p-m-4"},He={class:"p-m-0"},Ze={class:"p-m-0"},qe={key:6,class:"p-m-4"},et={class:"p-m-0"},tt={class:"p-m-0"},ot={key:7,class:"p-m-4"},rt={class:"p-m-0"},at={class:"p-m-0"},nt={key:8,class:"p-m-4"},it={class:"p-m-0"},dt={class:"p-m-0"},lt={key:9,class:"p-m-4"},ct={class:"p-m-0"},st={class:"p-m-0"};function bt(e,t,o,r,d,h){var x;const b=k("Toolbar"),i=V("tooltip");return a(),l("div",Te,[g(b,{id:"document-detail-toolbar",class:"kn-toolbar kn-toolbar--secondary"},{start:v(()=>{var f,C,M,c;return[n("div",Ne,[(f=e.user)!=null&&f.functionalities.includes("DocumentUserManagement")?y((a(),l("i",{key:0,class:"fa fa-play-circle document-pointer p-mx-4",onClick:t[0]||(t[0]=(...s)=>e.executeDocument&&e.executeDocument(...s))},null,512)),[[i,e.$t("documentBrowser.executeDocument"),void 0,{top:!0}]]):p("",!0),e.canEditDocument?(a(),l(D,{key:1},[y(n("i",{class:"pi pi-pencil document-pointer p-mx-4",onClick:t[1]||(t[1]=s=>e.$emit("showDocumentDetails",e.document))},null,512),[[i,e.$t("documentBrowser.editDocument"),void 0,{top:!0}]]),y(n("i",{class:"far fa-copy document-pointer p-mx-4",onClick:t[2]||(t[2]=(...s)=>e.cloneDocumentConfirm&&e.cloneDocumentConfirm(...s))},null,512),[[i,e.$t("documentBrowser.cloneDocument"),void 0,{top:!0}]]),(C=e.user)!=null&&C.functionalities.includes("DocumentDeleteManagement")?y((a(),l("i",{key:0,class:"far fa-trash-alt document-pointer p-mx-4",onClick:t[3]||(t[3]=(...s)=>e.deleteDocumentConfirm&&e.deleteDocumentConfirm(...s))},null,512)),[[i,e.$t("documentBrowser.deleteDocument"),void 0,{top:!0}]]):p("",!0)],64)):p("",!0),((M=e.user)==null?void 0:M.functionalities.includes("DocumentMoveUpState"))&&e.document.stateCode==="TEST"?y((a(),l("i",{key:2,class:"fa fa-arrow-up document-pointer p-mx-4",onClick:t[4]||(t[4]=s=>e.changeStateDocumentConfirm("UP"))},null,512)),[[i,e.$t("documentBrowser.moveUpDocumentState"),void 0,{left:!0}]]):p("",!0),((c=e.user)==null?void 0:c.functionalities.includes("DocumentMoveDownState"))&&(e.document.stateCode==="TEST"||e.document.stateCode==="REL")?y((a(),l("i",{key:3,class:"fa fa-arrow-down document-pointer p-mx-4",onClick:t[5]||(t[5]=s=>e.changeStateDocumentConfirm("DOWN"))},null,512)),[[i,e.$t("documentBrowser.moveDownDocumentState"),void 0,{left:!0}]]):p("",!0)])]}),_:1}),n("div",Ue,[(x=e.selectedDocument)!=null&&x.previewFile?(a(),l("div",Re,[n("img",{id:"image-preview",src:e.getImageUrl},null,8,Oe)])):p("",!0),e.document.functionalities&&e.document.functionalities.length>0?(a(),l("div",Ve,[n("h3",Le,u(e.$t("common.path")),1),(a(!0),l(D,null,B(e.document.functionalities,(f,C)=>(a(),l("p",{key:C,class:"p-m-0"},u(f),1))),128))])):p("",!0),e.document.name?(a(),l("div",Ke,[n("h3",Xe,u(e.$t("common.name")),1),n("p",Pe,u(e.document.name),1)])):p("",!0),e.document.label?(a(),l("div",Qe,[n("h3",_e,u(e.$t("common.label")),1),n("p",je,u(e.document.label),1)])):p("",!0),e.document.creationUser?(a(),l("div",Ye,[n("h3",Je,u(e.$t("common.author")),1),n("p",We,u(e.document.creationUser),1)])):p("",!0),e.document.description?(a(),l("div",Ge,[n("h3",He,u(e.$t("common.description")),1),n("p",Ze,u(e.document.description),1)])):p("",!0),e.document.stateCodeStr?(a(),l("div",qe,[n("h3",et,u(e.$t("common.state")),1),n("p",tt,u(e.document.stateCodeStr),1)])):p("",!0),e.document.typeCode?(a(),l("div",ot,[n("h3",rt,u(e.$t("common.type")),1),n("p",at,u(e.document.typeCode),1)])):p("",!0),e.document.creationDate?(a(),l("div",nt,[n("h3",it,u(e.$t("common.creationDate")),1),n("p",dt,u(e.getFormatedDate(e.document.creationDate)),1)])):p("",!0),e.document.visible?(a(),l("div",lt,[n("h3",ct,u(e.$t("common.visibility")),1),n("p",st,u(e.document.visible?e.$t("common.visible"):e.$t("common.notVisible")),1)])):p("",!0)])])}var pt=E(Be,[["render",bt],["__scopeId","data-v-4890706c"]]);const kt=A({name:"document-browser-detail",components:{DocumentBrowserBreadcrumb:pe,DocumentBrowserTable:Fe,DocumentBrowserSidebar:pt},props:{propDocuments:{type:Array},breadcrumbs:{type:Array},searchMode:{type:Boolean}},emits:["breadcrumbClicked","loading","documentCloned","itemSelected","documentStateChanged","showDocumentDetails"],data(){return{documents:[],selectedDocument:null}},watch:{propDocuments(){this.loadDocuments(),this.selectedDocument=null}},setup(){return{store:T()}},created(){this.loadDocuments()},methods:{loadDocuments(){this.documents=this.propDocuments},setSelectedDocument(e){this.selectedDocument=e},async cloneDocument(e){this.$emit("loading",!0),await this.$http.post(`/knowage/restful-services/documents/clone?docId=${e.id}`).then(()=>{this.store.setInfo({title:this.$t("common.toast.createTitle"),msg:this.$t("common.toast.success")}),this.$emit("documentCloned")}).catch(()=>{}),this.$emit("loading",!1)},async deleteDocument(e){this.$emit("loading",!0),await this.$http.delete(`/knowage/restful-services/1.0/documents/${e.label}`).then(()=>{this.store.setInfo({title:this.$t("common.toast.deleteTitle"),msg:this.$t("common.toast.success")}),this.selectedDocument=null,this.documents=this.documents.filter(t=>t.id!==e.id)}).catch(()=>{}),this.$emit("loading",!1)},async changeDocumentState(e){this.$emit("loading",!0),await this.$http.post(`/knowage/restful-services/documents/changeStateDocument?docId=${e.document.id}&direction=${e.direction}`).then(()=>{this.store.setInfo({title:this.$t("common.toast.deleteTitle"),msg:this.$t("common.toast.success")}),this.$emit("documentStateChanged")}).catch(()=>{}),this.$emit("loading",!1)}}}),ut={class:"p-d-flex p-flex-row kn-flex"},mt={class:"p-d-flex p-flex-column kn-flex"},ft={class:"document-table-container p-d-flex p-flex-column kn-flex"},vt={key:0,id:"document-browser-sidebar-container","data-test":"document-browser-sidebar"};function gt(e,t,o,r,d,h){const b=k("DocumentBrowserBreadcrumb"),i=k("DocumentBrowserTable"),x=k("DocumentBrowserSidebar");return a(),l("div",ut,[n("div",mt,[n("div",ft,[e.selectedDocument?(a(),l("div",{key:0,id:"document-detail-backdrop",onClick:t[0]||(t[0]=f=>e.selectedDocument=null)})):p("",!0),e.searchMode?p("",!0):(a(),w(b,{key:1,breadcrumbs:e.breadcrumbs,onBreadcrumbClicked:t[1]||(t[1]=f=>e.$emit("breadcrumbClicked",f))},null,8,["breadcrumbs"])),g(i,{propDocuments:e.documents,searchMode:e.searchMode,onSelected:e.setSelectedDocument,onItemSelected:t[2]||(t[2]=f=>e.$emit("itemSelected",f))},null,8,["propDocuments","searchMode","onSelected"])])]),e.selectedDocument?(a(),l("div",vt,[g(x,{selectedDocument:e.selectedDocument,onDocumentCloneClick:e.cloneDocument,onDocumentDeleteClick:e.deleteDocument,onItemSelected:t[3]||(t[3]=f=>e.$emit("itemSelected",f)),onDocumentChangeStateClicked:e.changeDocumentState,onShowDocumentDetails:t[4]||(t[4]=f=>e.$emit("showDocumentDetails",f))},null,8,["selectedDocument","onDocumentCloneClick","onDocumentDeleteClick","onDocumentChangeStateClicked"])])):p("",!0)])}var ht=E(kt,[["render",gt],["__scopeId","data-v-5fc4c26c"]]);const wt=A({name:"document-browser-home",components:{DocumentBrowserHint:ne,DocumentBrowserTree:le,DocumentBrowserDetail:ht,KnFabButton:j,Menu:L},props:{documentSaved:{type:Object},documentSavedTrigger:{type:Boolean}},emits:["itemSelected"],data(){return{folders:[],selectedFolder:null,documents:[],searchedDocuments:[],breadcrumbs:[],selectedBreadcrumb:null,searchWord:null,searchMode:!1,items:[],user:null,sidebarVisible:!1,windowWidth:window.innerWidth,loading:!1,showDocumentDetails:!1,selectedDocument:null,documentId:null}},computed:{isSuperAdmin(){var e;return(e=this.user)==null?void 0:e.isSuperadmin},canAddNewDocument(){var e,t;return(t=(e=this.user)==null?void 0:e.functionalities)==null?void 0:t.includes("DocumentManagement")},hasCreateCockpitFunctionality(){var e;return(e=this.user.functionalities)==null?void 0:e.includes("CreateCockpitFunctionality")},isSidebarHidden(){return this.sidebarVisible?!1:this.windowWidth<1024}},watch:{documentSavedTrigger(){!this.documentSaved||(this.documentSaved.folderId&&(this.selectedFolder.id=this.documentSaved.folderId),this.loadDocumentsWithBreadcrumbs())}},setup(){return{store:T()}},async created(){window.addEventListener("resize",this.onResize),await this.loadFolders(),this.user=this.store.$state.user,this.$route.name==="document-browser-functionality"&&this.setFolderFromRoute(),this.setRouterWatcher()},beforeUnmount(){window.removeEventListener("resize",this.onResize)},methods:{setRouterWatcher(){this.$watch(()=>this.$route.params.pathMatch,e=>{this.$route.name==="document-browser-functionality"&&e.length>0&&this.setFolderFromRoute()})},onResize(){this.windowWidth=window.innerWidth},async setFolderFromRoute(){if(this.$route.params.pathMatch.length>0){if(this.selectedFolder=this.findSelectedFolder(),!this.selectedFolder)return;localStorage.setItem("documentSelectedFolderId",JSON.stringify(this.selectedFolder.id)),await this.loadDocumentsWithBreadcrumbs()}},findSelectedFolder(){const e=this.$route.params.pathMatch[this.$route.params.pathMatch.length-1],t=this.folders.findIndex(o=>o.id==e);return t!==-1?this.folders[t]:null},async loadFolders(){this.loading=!0,await this.$http.get("/knowage/restful-services/2.0/folders/").then(e=>{var t;this.folders=e.data,(t=this.folders)==null||t.sort((o,r)=>o.id-r.id)}),this.loading=!1},async loadDocuments(){var t;this.loading=!0;const e=this.searchMode?`2.0/documents?searchAttributes=all&searchKey=${this.searchWord}`:`2.0/documents?folderId=${(t=this.selectedFolder)==null?void 0:t.id}`;await this.$http.get("/knowage/restful-services/"+e).then(o=>{this.searchMode?this.searchedDocuments=o.data:this.documents=o.data}),this.loading=!1},async setSelectedFolder(e){var t;((t=this.selectedFolder)==null?void 0:t.id)!==e.id&&(this.selectedFolder=e,this.changeFolderRotue(),await this.loadDocumentsWithBreadcrumbs())},changeFolderRotue(){var o,r;const e=(r=(o=this.selectedFolder.path)==null?void 0:o.substring(1))==null?void 0:r.split("/");if(!e)return;let t="";for(let d=0;d<e.length;d++){const h=this.folders.findIndex(b=>b.code==e[d]);h!==-1&&(t+=`/${this.folders[h].id}`)}history.pushState({},"","/knowage-vue/document-browser"+t)},async loadDocumentsWithBreadcrumbs(){this.selectedFolder&&this.selectedFolder.id!==-1?(await this.loadDocuments(),this.createBreadcrumbs()):this.documents=[]},createBreadcrumbs(){if(!this.selectedFolder)return;let e={key:this.selectedFolder.name,label:this.selectedFolder.name,data:this.selectedFolder};this.breadcrumbs=[];do this.breadcrumbs.unshift({label:e.data.name,node:e}),e=e.data.parentFolder;while(e)},async setSelectedBreadcrumb(e){var t;this.selectedBreadcrumb=e,((t=this.selectedFolder)==null?void 0:t.id)!==e.node.data.id&&(this.selectedFolder=e.node.data,await this.loadDocuments())},exitSearchMode(){this.searchMode=!1},toggle(e){this.createMenuItems(),this.$refs.menu.toggle(e)},createMenuItems(){this.items=[],this.items.push({label:this.$t("documentBrowser.genericDocument"),command:()=>this.createNewDocument()}),this.hasCreateCockpitFunctionality&&(this.items.push({label:this.$t("common.cockpit"),command:()=>this.createNewCockpit()}),this.items.push({label:this.$t("dashboard.dashboardBeta"),command:()=>this.createNewDashboard()}))},createNewDocument(){this.documentId=null,this.$emit("itemSelected",{item:null,mode:"documentDetail",functionalityId:this.selectedFolder.id})},async openDocumentDetails(e){this.documentId=e.id,this.$emit("itemSelected",{item:e,mode:"documentDetail",functionalityId:null})},createNewCockpit(){this.$emit("itemSelected",{item:null,mode:"createCockpit",functionalityId:this.selectedFolder.id})},createNewDashboard(){this.$emit("itemSelected",{item:null,mode:"createDashboard",functionalityId:this.selectedFolder.id})},toggleSidebarView(){this.sidebarVisible=!this.sidebarVisible},openSearchBar(){this.searchMode=!0,setTimeout(()=>{this.$refs.searchBar.$el.focus()},0)},onCloseDetails(){this.showDocumentDetails=!1,this.loadDocuments()}}}),xt={class:"p-mx-4"},yt={key:0,class:"p-mx-4"},Mt={id:"document-browser-detail",class:"p-d-flex p-flex-row kn-flex p-m-0"},Ct={id:"detail-container",class:"p-d-flex p-flex-column"};function At(e,t,o,r,d,h){const b=k("InputText"),i=k("KnFabButton"),x=k("Menu"),f=k("Toolbar"),C=k("ProgressBar"),M=k("DocumentBrowserTree"),c=k("DocumentBrowserDetail"),s=k("DocumentBrowserHint");return a(),l(D,null,[g(f,{class:"kn-toolbar kn-toolbar--primary"},{start:v(()=>[n("i",{class:"fa fa-ellipsis-v p-mr-3",id:"sidebar-button",onClick:t[0]||(t[0]=(...m)=>e.toggleSidebarView&&e.toggleSidebarView(...m))}),n("span",null,u(e.searchMode?e.$t("documentBrowser.documentsSearch"):e.$t("documentBrowser.title")),1),y(n("span",xt,[n("i",{class:"fa fa-arrow-left search-pointer p-mx-4",onClick:t[1]||(t[1]=(...m)=>e.exitSearchMode&&e.exitSearchMode(...m))}),g(b,{id:"document-search",class:"kn-material-input p-inputtext-sm p-mx-2",ref:"searchBar",onKeyup:Y(e.loadDocuments,["enter"]),modelValue:e.searchWord,"onUpdate:modelValue":t[2]||(t[2]=m=>e.searchWord=m),placeholder:e.$t("common.search"),autofocus:""},null,8,["onKeyup","modelValue","placeholder"]),n("i",{class:"fa fa-times search-pointer p-mx-4",onClick:t[3]||(t[3]=m=>e.searchWord="")}),n("i",{class:"pi pi-search search-pointer p-mx-4",onClick:t[4]||(t[4]=(...m)=>e.loadDocuments&&e.loadDocuments(...m))})],512),[[F,e.searchMode]])]),end:v(()=>[e.searchMode?p("",!0):(a(),l("span",yt,[n("i",{class:"pi pi-search search-pointer",onClick:t[5]||(t[5]=m=>e.openSearchBar())})])),(e.isSuperAdmin||e.canAddNewDocument)&&e.selectedFolder&&e.selectedFolder.parentId&&e.selectedFolder.codType!=="USER_FUNCT"?(a(),w(i,{key:1,icon:"fas fa-plus",onClick:t[6]||(t[6]=m=>e.toggle(m)),"aria-haspopup":"true","aria-controls":"overlay_menu"})):p("",!0),g(x,{ref:"menu",model:e.items,popup:!0},null,8,["model"])]),_:1}),e.loading?(a(),w(C,{key:0,class:"kn-progress-bar",mode:"indeterminate","data-test":"progress-bar"})):p("",!0),n("div",Mt,[e.sidebarVisible&&e.windowWidth<1024?(a(),l("div",{key:0,id:"document-browser-sidebar-backdrop",onClick:t[7]||(t[7]=m=>e.sidebarVisible=!1)})):p("",!0),y(n("div",{class:J(["document-sidebar kn-flex",{"sidebar-hidden":e.isSidebarHidden,"document-sidebar-absolute":e.sidebarVisible&&e.windowWidth<1024}]),style:{width:"350px"}},[g(M,{propFolders:e.folders,selectedBreadcrumb:e.selectedBreadcrumb,selectedFolderProp:e.selectedFolder,onFolderSelected:e.setSelectedFolder},null,8,["propFolders","selectedBreadcrumb","selectedFolderProp","onFolderSelected"])],2),[[F,!e.searchMode]]),n("div",Ct,[e.selectedFolder||e.searchMode?(a(),w(c,{key:0,propDocuments:e.searchMode?e.searchedDocuments:e.documents,breadcrumbs:e.breadcrumbs,searchMode:e.searchMode,onBreadcrumbClicked:t[8]||(t[8]=m=>e.setSelectedBreadcrumb(m)),onDocumentCloned:e.loadDocuments,onDocumentStateChanged:e.loadDocuments,onItemSelected:t[9]||(t[9]=m=>e.$emit("itemSelected",m)),onShowDocumentDetails:e.openDocumentDetails},null,8,["propDocuments","breadcrumbs","searchMode","onDocumentCloned","onDocumentStateChanged","onShowDocumentDetails"])):(a(),w(s,{key:1,"data-test":"document-browser-hint"}))])])],64)}var Et=E(wt,[["render",At],["__scopeId","data-v-78c76ed2"]]);const Dt=A({name:"document-browser-tab",components:{},emits:["close","iframeCreated","closeIframe","documentSaved"],props:{item:{type:Object},functionalityId:{type:String}},data(){return{parameterValuesMap:{},loadedItem:null}},computed:{key(){var e;return(e=this.item)==null?void 0:e.routerId}},watch:{item(){this.loadItem()}},created(){this.loadItem()},methods:{onIframeCreated(e){this.$emit("iframeCreated",e)},onParametersChange(e){this.parameterValuesMap[e.document.label+"-"+this.key]=e.parameters},loadItem(){this.loadedItem=this.item}}});function It(e,t,o,r,d,h){const b=k("router-view");return y((a(),w(b,{functionalityId:e.functionalityId,item:e.loadedItem,parameterValuesMap:e.parameterValuesMap,tabKey:e.key,onClose:t[0]||(t[0]=i=>e.$emit("close",e.item)),onParametersChanged:e.onParametersChange,onIframeCreated:e.onIframeCreated,onCloseIframe:t[1]||(t[1]=i=>e.$emit("closeIframe")),onCloseDetails:t[2]||(t[2]=i=>e.$emit("close",e.item)),onDocumentSaved:t[3]||(t[3]=i=>e.$emit("documentSaved",i))},{default:v(({Component:i})=>[(a(),w(W,null,[(a(),w(G(i),{key:e.key,functionalityId:e.functionalityId,item:e.loadedItem,parameterValuesMap:e.parameterValuesMap,tabKey:e.key},null,8,["functionalityId","item","parameterValuesMap","tabKey"]))],1024))]),_:1},8,["functionalityId","item","parameterValuesMap","tabKey","onParametersChanged","onIframeCreated"])),[[F,e.item]])}var zt=E(Dt,[["render",It]]);const $t=A({name:"document-browser",components:{DocumentBrowserHome:Et,DocumentBrowserTab:zt,Menu:L,TabView:H,TabPanel:Z},props:{selectedMenuItem:{type:Object},menuItemClickedTrigger:{type:Boolean}},data(){return{tabs:[],activeIndex:0,menuItems:[],selectedItem:null,id:0,iFrameContainers:[],menuItem:null,documentSaved:null,documentSavedTrigger:!1,getRouteDocumentType:oe}},watch:{menuItemClickedTrigger(){!this.selectedMenuItem||(this.selectedMenuItem.to==="/document-browser"?(this.selectedItem=null,this.activeIndex=0):this.selectedMenuItem.to&&this.selectedMenuItem.to.includes("document-browser")&&this.loadPage())}},async created(){this.loadPage()},methods:{async loadPage(){var t;window.addEventListener("message",o=>{o.data.type==="saveCockpit"&&this.$router.currentRoute.value.name==="new-dashboard"&&(this.loadSavedCockpit(o.data.model),this.documentSaved=o.data.model,this.documentSavedTrigger=!this.documentSavedTrigger)});let e=(t=this.$router.currentRoute.value.params.id)!=null?t:this.parseSelectedMenuItem();if(e&&e!=="document-browser"&&(this.$router.currentRoute.value.name==="document-browser-document-execution"||this.$router.currentRoute.value.name==="document-browser-document-details-edit"||this.$router.currentRoute.value.name==="document-browser")){let o={};e!=="new-dashboard"&&await this.$http.get(`/knowage/restful-services/2.0/documents/${e}`).then(d=>o=d.data);const r={item:{name:o.name,label:e,mode:this.$router.currentRoute.value.params.mode,routerId:S({length:16,type:"base64"}),id:e,showMode:this.$router.currentRoute.value.name==="document-browser-document-execution"?"execute":"documentDetail"},mode:this.$router.currentRoute.value.name==="document-browser-document-execution"&&this.$router.currentRoute.value.params.id?"execute":"documentDetail"};this.tabs.push(r),this.activeIndex=1,this.selectedItem=r}},parseSelectedMenuItem(){var e;return this.selectedMenuItem?(e=this.selectedMenuItem.to)==null?void 0:e.substring(this.selectedMenuItem.to.lastIndexOf("/")+1):null},onTabChange(){if(this.activeIndex===0){this.selectedItem=null,this.$router.push("/document-browser");return}const e=this.tabs[this.activeIndex-1].item?this.tabs[this.activeIndex-1].item.label:"new-dashboard";if(this.selectedItem=this.tabs[this.activeIndex-1],this.selectedItem.item.fromTab=!0,this.selectedItem.mode==="documentDetail"){const t=this.selectedItem.functionalityId?`/document-browser/document-details/new/${this.selectedItem.functionalityId}`:`/document-browser/document-details/${this.selectedItem.item.id}`;this.$router.push(t)}else{let t=this.tabs[this.activeIndex-1].item.mode?this.tabs[this.activeIndex-1].item.mode:this.getRouteDocumentType(this.tabs[this.activeIndex-1].item);t?this.$router.push(`/document-browser/${t}/`+e):this.$router.push("/document-browser/new-dashboard")}},onItemSelect(e){e.item&&(e.item.routerId=S({length:16,type:"base64"}));const t={...e,item:{...e.item}};if(e.mode==="documentDetail"&&(t.mode="documentDetail"),this.tabs.push(t),this.selectedItem=t,e.mode==="documentDetail"){const o=e.functionalityId?`/document-browser/document-details/new/${e.functionalityId}`:`/document-browser/document-details/${e.item.id}`;this.selectedItem.item.showMode="documentDetail",this.$router.push(o)}else{const o=e.item?e.item.label:"new-dashboard";if(e.item){let r=this.getRouteDocumentType(e.item);this.selectedItem.item.showMode="execute",this.$router.push(`/document-browser/${r}/`+o)}else{this.selectedItem.item={routerId:S({length:16,type:"base64"})},this.selectedItem.item.showMode=e.mode;const r=e.mode==="createCockpit"?"/document-browser/new-cockpit":`/document-browser/new-dashboard?folderId=${e.functionalityId}`;this.$router.push(r)}}this.activeIndex=this.tabs.length},toggle(e){this.createMenuItems(),this.$refs.menu.toggle(e)},createMenuItems(){this.menuItems=[],this.menuItems.push({label:this.$t("documentBrowser.closeCurrentDocument"),command:()=>this.closeDocumentConfirm("current")}),this.menuItems.push({label:this.$t("documentBrowser.closeOtherDocuments"),command:()=>this.closeDocumentConfirm("other")}),this.menuItems.push({label:this.$t("documentBrowser.closeDocumentRight"),command:()=>this.closeDocumentConfirm("right")}),this.menuItems.push({label:this.$t("documentBrowser.closeAllDocuments"),command:()=>this.closeDocumentConfirm("all")})},closeDocumentConfirm(e){this.$confirm.require({message:this.$t("documentBrowser.closeDocumentConfirmMessage"),header:this.$t("documentBrowser.closeDocumentConfirmTitle",{numberOfDocuments:this.getNumberOfDocuments(e)}),accept:()=>this.closeDocument(e)})},getNumberOfDocuments(e){switch(e){case"current":return 1;case"other":return this.tabs.length-1;case"right":return this.tabs.length-this.activeIndex;case"all":return this.tabs.length}},closeDocument(e){let t=-1;switch(e){case"current":this.tabs.splice(this.activeIndex-1,1),this.activeIndex=0,t=this.iFrameContainers.findIndex(o=>{var r,d;return((r=o.item)==null?void 0:r.routerId)===((d=this.selectedItem)==null?void 0:d.item.routerId)}),t!==-1&&this.iFrameContainers.splice(t,1),this.$router.push("/document-browser");break;case"other":this.tabs=[this.tabs[this.activeIndex-1]],this.activeIndex=1,this.iFrameContainers=this.iFrameContainers.filter(o=>{var r,d;return((r=o.item)==null?void 0:r.routerId)===((d=this.selectedItem)==null?void 0:d.item.routerId)});break;case"right":this.tabs.splice(this.activeIndex),t=this.iFrameContainers.findIndex(o=>{var r,d;return((r=o.item)==null?void 0:r.routerId)===((d=this.selectedItem)==null?void 0:d.item.routerId)}),t!==-1&&this.iFrameContainers.splice(t+1);break;case"all":this.$router.push("/document-browser"),this.tabs=[],this.activeIndex=0,this.iFrameContainers=[]}},onIFrameCreated(e){this.iFrameContainers.findIndex(o=>{var r,d;return((r=o.item)==null?void 0:r.routerId)===((d=this.selectedItem)==null?void 0:d.item.routerId)})===-1&&this.iFrameContainers.push(e)},closeIframe(){const e=this.iFrameContainers.findIndex(t=>{var o,r;return((o=t.item)==null?void 0:o.routerId)===((r=this.selectedItem)==null?void 0:r.item.routerId)});e!==-1&&this.iFrameContainers.splice(e,1)},loadSavedCockpit(e){this.closeIframe(),this.selectedItem={item:{...e,routerId:S({length:16,type:"base64"}),name:e.DOCUMENT_NAME,label:e.DOCUMENT_LABEL,showMode:"execute"},mode:"execute"},this.tabs[this.activeIndex-1]=this.selectedItem,this.$router.push(`/document-browser/document-composite/${e.DOCUMENT_LABEL}`)},getTabName(e){return e.item&&e.item.name?e.item.name:e.mode==="documentDetail"?"new document":"new dashboard"},onDocumentSaved(e){this.documentSaved=e,this.documentSavedTrigger=!this.documentSavedTrigger,this.selectedItem.functionalityId=null,this.selectedItem.item={name:e.name,label:e.id,routerId:S({length:16,type:"base64"}),id:e.id,showMode:"documentDetail"},this.$router.push(`/document-browser/document-details/${e.id}`)}}}),St={class:"kn-page"},Ft={class:"document-browser-tab-container kn-flex"},Bt=n("i",{class:"fa fa-folder-open"},null,-1),Tt=["src"],Nt={key:0,id:"document-browser-tab-icon-container"};function Ut(e,t,o,r,d,h){var M,c;const b=k("DocumentBrowserHome"),i=k("TabPanel"),x=k("TabView"),f=k("DocumentBrowserTab"),C=k("Menu");return a(),l("div",St,[n("div",Ft,[g(x,{id:"document-browser-tab-view",class:"p-d-flex p-flex-column kn-flex kn-tab",activeIndex:e.activeIndex,"onUpdate:activeIndex":t[1]||(t[1]=s=>e.activeIndex=s),onTabChange:e.onTabChange},{default:v(()=>[g(i,null,{header:v(()=>[Bt]),default:v(()=>[g(b,{documentSaved:e.documentSaved,documentSavedTrigger:e.documentSavedTrigger,onItemSelected:t[0]||(t[0]=s=>e.onItemSelect(s))},null,8,["documentSaved","documentSavedTrigger"])]),_:1}),(a(!0),l(D,null,B(e.tabs,(s,m)=>(a(),w(i,{key:m},{header:v(()=>[n("span",null,u(e.getTabName(s)),1)]),_:2},1024))),128))]),_:1},8,["activeIndex","onTabChange"]),y(g(f,{item:(M=e.selectedItem)==null?void 0:M.item,functionalityId:(c=e.selectedItem)==null?void 0:c.functionalityId,onClose:t[2]||(t[2]=s=>e.closeDocument("current")),onIframeCreated:e.onIFrameCreated,onCloseIframe:e.closeIframe,onDocumentSaved:e.onDocumentSaved},null,8,["item","functionalityId","onIframeCreated","onCloseIframe","onDocumentSaved"]),[[F,e.selectedItem&&e.selectedItem.mode]]),(a(!0),l(D,null,B(e.iFrameContainers,(s,m)=>{var R,O;return a(),l("div",{key:m},[y(n("iframe",{ref_for:!0,ref:"iframe",class:"document-browser-cockpit-iframe",src:s.iframe},null,8,Tt),[[F,((R=s.item)==null?void 0:R.routerId)===((O=e.selectedItem)==null?void 0:O.item.routerId)]])])}),128)),e.activeIndex!==0?(a(),l("div",Nt,[n("i",{id:"document-browser-tab-icon",class:"fa fa-times-circle",onClick:t[3]||(t[3]=s=>e.toggle(s))}),g(C,{ref:"menu",model:e.menuItems,popup:!0},null,8,["model"])])):p("",!0)])])}var Pt=E($t,[["render",Ut]]);export{Pt as default};
//# sourceMappingURL=DocumentBrowser-f1e6fb96.js.map
