import{L as m,M as D,H as k,q as E,R as M,r as g,y as z,o as a,c as o,a as r,z as C,G as c,D as B,N as L,t as p,h,A as u,B as b,C as y,w,g as I,f as U,J as T}from"./index-1e676509.js";var N={name:"FileUpload",emits:["select","uploader","before-upload","progress","upload","error","before-send","clear","remove"],props:{name:{type:String,default:null},url:{type:String,default:null},mode:{type:String,default:"advanced"},multiple:{type:Boolean,default:!1},accept:{type:String,default:null},disabled:{type:Boolean,default:!1},auto:{type:Boolean,default:!1},maxFileSize:{type:Number,default:null},invalidFileSizeMessage:{type:String,default:"{0}: Invalid file size, file size should be smaller than {1}."},invalidFileTypeMessage:{type:String,default:"{0}: Invalid file type, allowed file types: {1}."},fileLimit:{type:Number,default:null},invalidFileLimitMessage:{type:String,default:"Maximum number of files exceeded, limit is {0} at most."},withCredentials:{type:Boolean,default:!1},previewWidth:{type:Number,default:50},chooseLabel:{type:String,default:null},uploadLabel:{type:String,default:null},cancelLabel:{type:String,default:null},customUpload:{type:Boolean,default:!1},showUploadButton:{type:Boolean,default:!0},showCancelButton:{type:Boolean,default:!0},chooseIcon:{type:String,default:"pi pi-plus"},uploadIcon:{type:String,default:"pi pi-upload"},cancelIcon:{type:String,default:"pi pi-times"},style:null,class:null},duplicateIEEvent:!1,data(){return{uploadedFileCount:0,files:[],messages:[],focused:!1,progress:null}},methods:{onFileSelect(e){if(e.type!=="drop"&&this.isIE11()&&this.duplicateIEEvent){this.duplicateIEEvent=!1;return}this.messages=[],this.files=this.files||[];let t=e.dataTransfer?e.dataTransfer.files:e.target.files;for(let s of t)this.isFileSelected(s)||this.validate(s)&&(this.isImage(s)&&(s.objectURL=window.URL.createObjectURL(s)),this.files.push(s));this.$emit("select",{originalEvent:e,files:this.files}),this.fileLimit&&this.checkFileLimit(),this.auto&&this.hasFiles&&!this.isFileLimitExceeded()&&this.upload(),e.type!=="drop"&&this.isIE11()?this.clearIEInput():this.clearInputElement()},choose(){this.$refs.fileInput.click()},upload(){if(this.customUpload)this.fileLimit&&(this.uploadedFileCount+=this.files.length),this.$emit("uploader",{files:this.files}),this.clear();else{let e=new XMLHttpRequest,t=new FormData;this.$emit("before-upload",{xhr:e,formData:t});for(let s of this.files)t.append(this.name,s,s.name);e.upload.addEventListener("progress",s=>{s.lengthComputable&&(this.progress=Math.round(s.loaded*100/s.total)),this.$emit("progress",{originalEvent:s,progress:this.progress})}),e.onreadystatechange=()=>{e.readyState===4&&(this.progress=0,e.status>=200&&e.status<300?(this.fileLimit&&(this.uploadedFileCount+=this.files.length),this.$emit("upload",{xhr:e,files:this.files})):this.$emit("error",{xhr:e,files:this.files}),this.clear())},e.open("POST",this.url,!0),this.$emit("before-send",{xhr:e,formData:t}),e.withCredentials=this.withCredentials,e.send(t)}},clear(){this.files=[],this.messages=null,this.$emit("clear"),this.isAdvanced&&this.clearInputElement()},onFocus(){this.focused=!0},onBlur(){this.focused=!1},isFileSelected(e){if(this.files&&this.files.length){for(let t of this.files)if(t.name+t.type+t.size===e.name+e.type+e.size)return!0}return!1},isIE11(){return!!window.MSInputMethodContext&&!!document.documentMode},validate(e){return this.accept&&!this.isFileTypeValid(e)?(this.messages.push(this.invalidFileTypeMessage.replace("{0}",e.name).replace("{1}",this.accept)),!1):this.maxFileSize&&e.size>this.maxFileSize?(this.messages.push(this.invalidFileSizeMessage.replace("{0}",e.name).replace("{1}",this.formatSize(this.maxFileSize))),!1):!0},isFileTypeValid(e){let t=this.accept.split(",").map(s=>s.trim());for(let s of t)if(this.isWildcard(s)?this.getTypeClass(e.type)===this.getTypeClass(s):e.type==s||this.getFileExtension(e).toLowerCase()===s.toLowerCase())return!0;return!1},getTypeClass(e){return e.substring(0,e.indexOf("/"))},isWildcard(e){return e.indexOf("*")!==-1},getFileExtension(e){return"."+e.name.split(".").pop()},isImage(e){return/^image\//.test(e.type)},onDragEnter(e){this.disabled||(e.stopPropagation(),e.preventDefault())},onDragOver(e){this.disabled||(m.addClass(this.$refs.content,"p-fileupload-highlight"),e.stopPropagation(),e.preventDefault())},onDragLeave(){this.disabled||m.removeClass(this.$refs.content,"p-fileupload-highlight")},onDrop(e){if(!this.disabled){m.removeClass(this.$refs.content,"p-fileupload-highlight"),e.stopPropagation(),e.preventDefault();const t=e.dataTransfer?e.dataTransfer.files:e.target.files;(this.multiple||t&&t.length===1)&&this.onFileSelect(e)}},onBasicUploaderClick(){this.hasFiles?this.upload():this.$refs.fileInput.click()},remove(e){this.clearInputElement();let t=this.files.splice(e,1)[0];this.files=[...this.files],this.$emit("remove",{file:t,files:this.files})},clearInputElement(){this.$refs.fileInput.value=""},clearIEInput(){this.$refs.fileInput&&(this.duplicateIEEvent=!0,this.$refs.fileInput.value="")},formatSize(e){if(e===0)return"0 B";let t=1e3,s=3,d=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],n=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,n)).toFixed(s))+" "+d[n]},isFileLimitExceeded(){return this.fileLimit&&this.fileLimit<=this.files.length+this.uploadedFileCount&&this.focused&&(this.focused=!1),this.fileLimit&&this.fileLimit<this.files.length+this.uploadedFileCount},checkFileLimit(){this.isFileLimitExceeded()&&this.messages.push(this.invalidFileLimitMessage.replace("{0}",this.fileLimit.toString()))},onMessageClose(){this.messages=null}},computed:{isAdvanced(){return this.mode==="advanced"},isBasic(){return this.mode==="basic"},advancedChooseButtonClass(){return["p-button p-component p-fileupload-choose",this.class,{"p-disabled":this.disabled,"p-focus":this.focused}]},basicChooseButtonClass(){return["p-button p-component p-fileupload-choose",this.class,{"p-fileupload-choose-selected":this.hasFiles,"p-disabled":this.disabled,"p-focus":this.focused}]},advancedChooseIconClass(){return["p-button-icon p-button-icon-left pi-fw",this.chooseIcon]},basicChooseButtonIconClass(){return["p-button-icon p-button-icon-left",!this.hasFiles||this.auto?this.uploadIcon:this.chooseIcon]},basicChooseButtonLabel(){return this.auto?this.chooseButtonLabel:this.hasFiles?this.files.map(e=>e.name).join(", "):this.chooseButtonLabel},hasFiles(){return this.files&&this.files.length>0},chooseDisabled(){return this.disabled||this.fileLimit&&this.fileLimit<=this.files.length+this.uploadedFileCount},uploadDisabled(){return this.disabled||!this.hasFiles||this.fileLimit&&this.fileLimit<this.files.length},cancelDisabled(){return this.disabled||!this.hasFiles},chooseButtonLabel(){return this.chooseLabel||this.$primevue.config.locale.choose},uploadButtonLabel(){return this.uploadLabel||this.$primevue.config.locale.upload},cancelButtonLabel(){return this.cancelLabel||this.$primevue.config.locale.cancel}},components:{FileUploadButton:D,FileUploadProgressBar:k,FileUploadMessage:E},directives:{ripple:M}};const P={key:0,class:"p-fileupload p-fileupload-advanced p-component"},O={class:"p-fileupload-buttonbar"},R=["multiple","accept","disabled"],A={class:"p-button-label"},V={key:1,class:"p-fileupload-files"},j=["alt","src","width"],K={class:"p-fileupload-filename"},W={key:2,class:"p-fileupload-empty"},H={key:1,class:"p-fileupload p-fileupload-basic p-component"},q={class:"p-button-label"},G=["accept","disabled","multiple"];function J(e,t,s,d,n,l){const f=g("FileUploadButton"),S=g("FileUploadProgressBar"),F=g("FileUploadMessage"),v=z("ripple");return l.isAdvanced?(a(),o("div",P,[r("div",O,[C((a(),o("span",{class:c(l.advancedChooseButtonClass),style:B(s.style),onClick:t[1]||(t[1]=(...i)=>l.choose&&l.choose(...i)),onKeydown:t[2]||(t[2]=L((...i)=>l.choose&&l.choose(...i),["enter"])),onFocus:t[3]||(t[3]=(...i)=>l.onFocus&&l.onFocus(...i)),onBlur:t[4]||(t[4]=(...i)=>l.onBlur&&l.onBlur(...i)),tabindex:"0"},[r("input",{ref:"fileInput",type:"file",onChange:t[0]||(t[0]=(...i)=>l.onFileSelect&&l.onFileSelect(...i)),multiple:s.multiple,accept:s.accept,disabled:l.chooseDisabled},null,40,R),r("span",{class:c(l.advancedChooseIconClass)},null,2),r("span",A,p(l.chooseButtonLabel),1)],38)),[[v]]),s.showUploadButton?(a(),h(f,{key:0,label:l.uploadButtonLabel,icon:s.uploadIcon,onClick:l.upload,disabled:l.uploadDisabled},null,8,["label","icon","onClick","disabled"])):u("",!0),s.showCancelButton?(a(),h(f,{key:1,label:l.cancelButtonLabel,icon:s.cancelIcon,onClick:l.clear,disabled:l.cancelDisabled},null,8,["label","icon","onClick","disabled"])):u("",!0)]),r("div",{ref:"content",class:"p-fileupload-content",onDragenter:t[5]||(t[5]=(...i)=>l.onDragEnter&&l.onDragEnter(...i)),onDragover:t[6]||(t[6]=(...i)=>l.onDragOver&&l.onDragOver(...i)),onDragleave:t[7]||(t[7]=(...i)=>l.onDragLeave&&l.onDragLeave(...i)),onDrop:t[8]||(t[8]=(...i)=>l.onDrop&&l.onDrop(...i))},[l.hasFiles?(a(),h(S,{key:0,value:n.progress},null,8,["value"])):u("",!0),(a(!0),o(b,null,y(n.messages,i=>(a(),h(F,{key:i,severity:"error",onClose:l.onMessageClose},{default:w(()=>[I(p(i),1)]),_:2},1032,["onClose"]))),128)),l.hasFiles?(a(),o("div",V,[(a(!0),o(b,null,y(n.files,(i,x)=>(a(),o("div",{key:i.name+i.type+i.size,class:"p-fileupload-row"},[r("div",null,[l.isImage(i)?(a(),o("img",{key:0,role:"presentation",alt:i.name,src:i.objectURL,width:s.previewWidth},null,8,j)):u("",!0)]),r("div",K,p(i.name),1),r("div",null,p(l.formatSize(i.size)),1),r("div",null,[U(f,{type:"button",icon:"pi pi-times",onClick:Z=>l.remove(x)},null,8,["onClick"])])]))),128))])):u("",!0),e.$slots.empty&&!l.hasFiles?(a(),o("div",W,[T(e.$slots,"empty")])):u("",!0)],544)])):l.isBasic?(a(),o("div",H,[(a(!0),o(b,null,y(n.messages,i=>(a(),h(F,{key:i,severity:"error",onClose:l.onMessageClose},{default:w(()=>[I(p(i),1)]),_:2},1032,["onClose"]))),128)),C((a(),o("span",{class:c(l.basicChooseButtonClass),style:B(s.style),onMouseup:t[12]||(t[12]=(...i)=>l.onBasicUploaderClick&&l.onBasicUploaderClick(...i)),onKeydown:t[13]||(t[13]=L((...i)=>l.choose&&l.choose(...i),["enter"])),onFocus:t[14]||(t[14]=(...i)=>l.onFocus&&l.onFocus(...i)),onBlur:t[15]||(t[15]=(...i)=>l.onBlur&&l.onBlur(...i)),tabindex:"0"},[r("span",{class:c(l.basicChooseButtonIconClass)},null,2),r("span",q,p(l.basicChooseButtonLabel),1),l.hasFiles?u("",!0):(a(),o("input",{key:0,ref:"fileInput",type:"file",accept:s.accept,disabled:s.disabled,multiple:s.multiple,onChange:t[9]||(t[9]=(...i)=>l.onFileSelect&&l.onFileSelect(...i)),onFocus:t[10]||(t[10]=(...i)=>l.onFocus&&l.onFocus(...i)),onBlur:t[11]||(t[11]=(...i)=>l.onBlur&&l.onBlur(...i))},null,40,G))],38)),[[v]])])):u("",!0)}function X(e,t){t===void 0&&(t={});var s=t.insertAt;if(!(!e||typeof document=="undefined")){var d=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css",s==="top"&&d.firstChild?d.insertBefore(n,d.firstChild):d.appendChild(n),n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e))}}var Y=`
.p-fileupload-content {
    position: relative;
}
.p-fileupload-row {
    display: -webkit-box;
    display: -ms-flexbox;
    display: flex;
    -webkit-box-align: center;
        -ms-flex-align: center;
            align-items: center;
}
.p-fileupload-row > div {
    -webkit-box-flex: 1;
        -ms-flex: 1 1 auto;
            flex: 1 1 auto;
    width: 25%;
}
.p-fileupload-row > div:last-child {
    text-align: right;
}
.p-fileupload-content .p-progressbar {
    width: 100%;
    position: absolute;
    top: 0;
    left: 0;
}
.p-button.p-fileupload-choose {
    position: relative;
    overflow: hidden;
}
.p-button.p-fileupload-choose input[type='file'] {
    display: none;
}
.p-fileupload-choose.p-fileupload-choose-selected input[type='file'] {
    display: none;
}
.p-fileupload-filename {
    word-break: break-all;
}
.p-fluid .p-fileupload .p-button {
    width: auto;
}
`;X(Y);N.render=J;export{N as s};
//# sourceMappingURL=fileupload.esm-1d15ac9e.js.map
