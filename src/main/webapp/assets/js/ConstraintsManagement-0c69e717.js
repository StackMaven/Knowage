import{d as M,a5 as E,aE as F,s as D,_ as I,r as i,o,c as v,f as s,w as h,a,G as u,t as l,h as r,A as f,D as B,B as L,X as K,a4 as P,j as S,at as U,y as q,g as V,z as G,V as H}from"./index-1e676509.js";import{K as R,u as j,c as z}from"./KnValidatonMessages-ebe48c72.js";import{K as X}from"./KnHint-6d455703.js";const O=["label","name","valueTypeCd"],Y={false:{icon:"pi pi-lock-open"},true:{icon:"pi pi-lock"}};var J={filterFields:O,iconTypesMap:Y};const Q={DATE:{class:"p-field p-col-8",label:"managers.constraintManagement.dateValue"},DECIMALS:{class:"p-field p-col-8",label:"managers.constraintManagement.decimalPlaces"},MAXLENGTH:{class:"p-field p-col-8",label:"managers.constraintManagement.maxLenghtValue"},MINLENGTH:{class:"p-field p-col-8",label:"managers.constraintManagement.minLenghtValue"},RANGE:{class:"p-field p-col-4",label:"managers.constraintManagement.lowerRangeValue",labelTwo:"managers.constraintManagement.higherRangeValue"},REGEXP:{class:"p-field p-col-8",label:"managers.constraintManagement.regexpValue"}},W={insert:{toastTitle:"common.toast.createTitle"},success:"common.toast.success",update:{toastTitle:"common.toast.updateTitle"}},Z={basicCard:{width:"100%"},inputFields:{width:"45%"},menuButton:{height:"24px",width:"24px"},message:{"align-items":"center",display:"flex","justify-content":"center","margin-bottom":"3%","text-align":"center"}};var _={firstValue:Q,operation:W,styles:Z};const x={constraint:[{fieldName:"label",validators:[{key:"required"}]},{fieldName:"name",validators:[{key:"required"}]},{fieldName:"description",validators:[{key:"regex",validator:{type:"extendedAlphanumericRegex"}}]},{fieldName:"valueTypeCd",validators:[{key:"required"}]},{fieldName:"secondValue",validators:[{key:"range_check",validator:{type:"range-check"}}]}]};var T={validations:x};const ee=M({name:"constraint-management-detail",components:{Dropdown:E,KnValidationMessages:R,InputNumber:F},props:{selectedConstraint:{type:Object,required:!1},domains:{type:Array,required:!0}},emits:["close","created","touched"],data(){return{constraintsManagementDetailDescriptor:_,constraint:{},constraintsManagementValidationDescriptor:T,operation:"insert",v$:j()}},validations(){const e={"range-check":()=>this.rangeCheck||this.constraint.valueTypeCd!="RANGE"};return{constraint:z("constraint",T.validations.constraint,e)}},computed:{inputDisabled(){return this.constraint.predifined==!0},buttonDisabled(){return this.constraint.predifined==!0||this.v$.$invalid},numberType(){return this.constraint.valueTypeCd=="MAXLENGTH"||this.constraint.valueTypeCd=="RANGE"||this.constraint.valueTypeCd=="DECIMALS"||this.constraint.valueTypeCd=="MINLENGTH"},rangeCheck(){return this.constraint.firstValue<this.constraint.secondValue}},watch:{selectedConstraint(){this.v$.$reset(),this.constraint={...this.selectedConstraint}}},setup(){return{store:D()}},mounted(){this.selectedConstraint&&(this.constraint={...this.selectedConstraint})},methods:{async handleSubmit(){if(this.v$.$invalid)return;delete this.constraint.predifined;let e=this.domains.filter(p=>{var $;return p.VALUE_CD==(($=this.constraint)==null?void 0:$.valueTypeCd)});this.constraint.valueTypeId=e[0].VALUE_ID;let t="/knowage/restful-services/2.0/customChecks/";this.constraint.checkId?(this.operation="update",t+=this.constraint.checkId):this.operation="insert",await this.sendRequest(t).then(p=>{this.constraint.checkId=p.data,this.store.setInfo({title:this.$t(this.constraintsManagementDetailDescriptor.operation[this.operation].toastTitle),msg:this.$t(this.constraintsManagementDetailDescriptor.operation.success)}),this.$emit("created",this.constraint)}).catch(p=>{this.store.setError({title:this.$t("managers.constraintManagement.saveError"),msg:p.message})})},sendRequest(e){return this.operation==="insert"?this.$http.post(e,this.constraint):this.$http.put(e,this.constraint)},clearInput(){this.constraint.firstValue=null,this.constraint.secondValue=null,this.$emit("touched")},closeForm(){this.$emit("close")}}}),te={class:"p-grid p-m-0 p-fluid p-jc-center"},ne={class:"p-fluid p-formgrid p-grid","data-test":"constraints-form"},ae={class:"p-field p-col-6"},se={class:"p-float-label"},ie={for:"label",class:"kn-material-input-label"},oe={class:"p-field p-col-6"},le={class:"p-float-label"},re={for:"name",class:"kn-material-input-label"},de={class:"p-field p-col-12"},pe={class:"p-float-label"},me={for:"description",class:"kn-material-input-label"},ce={class:"p-field p-col-4"},ue={class:"p-float-label"},he={for:"type",class:"kn-material-input-label"},ve={class:"p-float-label"},fe={for:"type",class:"kn-material-input-label"},$e={class:"p-float-label"},ge={for:"typeTwo",class:"kn-material-input-label"};function Ce(e,t,p,$,w,N){const g=i("Button"),b=i("Toolbar"),m=i("InputText"),c=i("KnValidationMessages"),y=i("Dropdown"),C=i("InputNumber"),k=i("Card");return o(),v(L,null,[s(b,{class:"kn-toolbar kn-toolbar--secondary p-p-0 p-m-0"},{end:h(()=>[s(g,{icon:"pi pi-save",class:"kn-button p-button-text p-button-rounded",disabled:e.buttonDisabled,onClick:e.handleSubmit},null,8,["disabled","onClick"]),s(g,{class:"kn-button p-button-text p-button-rounded",icon:"pi pi-times",onClick:e.closeForm},null,8,["onClick"])]),_:1}),a("div",te,[s(k,{style:B(e.constraintsManagementDetailDescriptor.styles.basicCard),class:"p-m-2"},{content:h(()=>[a("form",ne,[a("div",ae,[a("span",se,[s(m,{id:"label",class:u(["kn-material-input",{"p-invalid":e.v$.constraint.label.$invalid&&e.v$.constraint.label.$dirty}]),type:"text",modelValue:e.v$.constraint.label.$model,"onUpdate:modelValue":t[0]||(t[0]=n=>e.v$.constraint.label.$model=n),modelModifiers:{trim:!0},maxlength:"20",onBlur:t[1]||(t[1]=n=>e.v$.constraint.label.$touch()),onInput:t[2]||(t[2]=n=>e.$emit("touched")),disabled:e.inputDisabled},null,8,["modelValue","class","disabled"]),a("label",ie,l(e.$t("common.label"))+" * ",1)]),s(c,{class:"p-mt-1",vComp:e.v$.constraint.label,additionalTranslateParams:{fieldName:e.$t("common.label")}},null,8,["vComp","additionalTranslateParams"])]),a("div",oe,[a("span",le,[s(m,{id:"name",class:u(["kn-material-input",{"p-invalid":e.v$.constraint.name.$invalid&&e.v$.constraint.name.$dirty}]),type:"text",modelValue:e.v$.constraint.name.$model,"onUpdate:modelValue":t[3]||(t[3]=n=>e.v$.constraint.name.$model=n),modelModifiers:{trim:!0},maxlength:"40",onBlur:t[4]||(t[4]=n=>e.v$.constraint.name.$touch()),onInput:t[5]||(t[5]=n=>e.$emit("touched")),disabled:e.inputDisabled},null,8,["modelValue","class","disabled"]),a("label",re,l(e.$t("common.name"))+" * ",1)]),s(c,{class:"p-mt-1",vComp:e.v$.constraint.name,additionalTranslateParams:{fieldName:e.$t("common.name")}},null,8,["vComp","additionalTranslateParams"])]),a("div",de,[a("span",pe,[s(m,{id:"description",class:u(["kn-material-input",{"p-invalid":e.v$.constraint.description.$invalid&&e.v$.constraint.description.$dirty}]),type:"text",modelValue:e.v$.constraint.description.$model,"onUpdate:modelValue":t[6]||(t[6]=n=>e.v$.constraint.description.$model=n),modelModifiers:{trim:!0},disabled:e.inputDisabled,onInput:t[7]||(t[7]=n=>e.$emit("touched")),maxlength:"160"},null,8,["modelValue","class","disabled"]),a("label",me,l(e.$t("common.description")),1)]),s(c,{class:"p-mt-1",vComp:e.v$.constraint.description,additionalTranslateParams:{fieldName:e.$t("common.description")}},null,8,["vComp","additionalTranslateParams"])]),a("div",ce,[a("span",ue,[e.constraint.predifined?(o(),r(m,{key:1,id:"type",class:"kn-material-input",type:"text",modelValue:e.constraint.valueTypeCd,"onUpdate:modelValue":t[10]||(t[10]=n=>e.constraint.valueTypeCd=n),modelModifiers:{trim:!0},disabled:""},null,8,["modelValue"])):(o(),r(y,{key:0,id:"type",class:u(["kn-material-input",{"p-invalid":e.v$.constraint.valueTypeCd.$invalid&&e.v$.constraint.valueTypeCd.$dirty}]),modelValue:e.v$.constraint.valueTypeCd.$model,"onUpdate:modelValue":t[8]||(t[8]=n=>e.v$.constraint.valueTypeCd.$model=n),dataKey:"id",optionLabel:"VALUE_NM",optionValue:"VALUE_CD",options:e.domains,onBlur:t[9]||(t[9]=n=>e.v$.constraint.valueTypeCd.$touch()),onChange:e.clearInput},null,8,["modelValue","options","class","onChange"])),a("label",he,l(e.$t("managers.constraintManagement.type"))+" * ",1)]),s(c,{class:"p-mt-1",vComp:e.v$.constraint.valueTypeCd,additionalTranslateParams:{fieldName:e.$t("managers.constraintManagement.type")}},null,8,["vComp","additionalTranslateParams"])]),!e.constraint.predifined&&e.constraint.valueTypeCd?(o(),v("div",{key:0,class:u(e.constraintsManagementDetailDescriptor.firstValue[e.constraint.valueTypeCd].class)},[a("span",ve,[e.numberType?(o(),r(C,{key:1,id:"type",inputClass:"kn-material-input",modelValue:e.constraint.firstValue,"onUpdate:modelValue":t[13]||(t[13]=n=>e.constraint.firstValue=n),onInput:t[14]||(t[14]=n=>e.$emit("touched"))},null,8,["modelValue"])):(o(),r(m,{key:0,id:"type",class:"kn-material-input",type:"text",modelValue:e.constraint.firstValue,"onUpdate:modelValue":t[11]||(t[11]=n=>e.constraint.firstValue=n),modelModifiers:{trim:!0},onInput:t[12]||(t[12]=n=>e.$emit("touched"))},null,8,["modelValue"])),a("label",fe,l(e.$t(e.constraintsManagementDetailDescriptor.firstValue[e.constraint.valueTypeCd].label)),1)])],2)):f("",!0),!e.constraint.predifined&&e.constraint.valueTypeCd&&e.constraint.valueTypeCd=="RANGE"?(o(),v("div",{key:1,class:u(e.constraintsManagementDetailDescriptor.firstValue[e.constraint.valueTypeCd].class)},[a("span",$e,[s(C,{id:"typeTwo",inputClass:"kn-material-input",modelValue:e.v$.constraint.secondValue.$model,"onUpdate:modelValue":t[15]||(t[15]=n=>e.v$.constraint.secondValue.$model=n),class:u({"p-invalid":e.v$.constraint.secondValue.$invalid&&e.v$.constraint.secondValue.$dirty}),onBlur:t[16]||(t[16]=n=>e.v$.constraint.secondValue.$touch()),onInput:t[17]||(t[17]=n=>e.$emit("touched"))},null,8,["modelValue","class"]),a("label",ge,l(e.$t(e.constraintsManagementDetailDescriptor.firstValue[e.constraint.valueTypeCd].labelTwo)),1)]),s(c,{class:"p-mt-1",vComp:e.v$.constraint.secondValue,additionalTranslateParams:{fieldName:e.$t(e.constraintsManagementDetailDescriptor.firstValue[e.constraint.valueTypeCd].labelTwo)},specificTranslateKeys:{range_check:"managers.constraintManagement.rangeCheck"}},null,8,["vComp","additionalTranslateParams","specificTranslateKeys"])],2)):f("",!0)])]),_:1},8,["style"])])],64)}var be=I(ee,[["render",Ce]]);const ye=M({name:"constraint-management",components:{FabButton:K,KnHint:X,Listbox:P,Avatar:S,ConstraintsManagementDetail:be},directives:{tooltip:U},data(){return{loading:!1,touched:!1,formVisible:!1,predefinedChecks:[],customChecks:[],allCheks:[],selectedCheck:{},domains:[],constraintManagementDescriptor:J}},setup(){return{store:D()}},created(){this.loadAll()},methods:{async loadAll(){this.loading=!0,await this.getAllPredefinedChecks(),await this.getAllCustomChecks(),await this.getDomainTypes(),this.loadCheks()},async getAllPredefinedChecks(){return this.$http.get("/knowage/restful-services/2.0/predefinedChecks").then(e=>{this.predefinedChecks=e.data.map(t=>({checkId:t.checkId,valueTypeId:t.valueTypeId,name:t.name,label:t.label,description:t.description,valueTypeCd:t.valueTypeCd,firstValue:t.firstValue,secondValue:t.secondValue,predifined:!0}))})},async getAllCustomChecks(){return this.$http.get("/knowage/restful-services/2.0/customChecks").then(e=>{this.customChecks=e.data.map(t=>({checkId:t.checkId,valueTypeId:t.valueTypeId,name:t.name,label:t.label,description:t.description,valueTypeCd:t.valueTypeCd,firstValue:t.firstValue,secondValue:t.secondValue,predifined:!1}))})},loadCheks(){this.allCheks=this.customChecks.concat(this.predefinedChecks),this.loading=!1},showForm(e){this.touched?this.$confirm.require({message:this.$t("common.toast.unsavedChangesMessage"),header:this.$t("common.toast.unsavedChangesHeader"),icon:"pi pi-exclamation-triangle",accept:()=>{this.touched=!1,this.setSelectedCheck(e)}}):this.setSelectedCheck(e)},async getDomainTypes(){return this.$http.get("/knowage/restful-services/domains/listValueDescriptionByType?DOMAIN_TYPE=CHECK").then(e=>{this.domains=e.data})},deleteConstraintConfirm(e){this.$confirm.require({message:this.$t("common.toast.deleteMessage"),header:this.$t("common.toast.deleteTitle"),icon:"pi pi-exclamation-triangle",accept:()=>this.deleteConstraint(e)})},async deleteConstraint(e){await this.$http.delete("/knowage/restful-services/2.0/customChecks/"+e).then(()=>{this.store.setInfo({title:this.$t("common.toast.deleteTitle"),msg:this.$t("common.toast.deleteSuccess")}),this.loadAll(),this.formVisible=!1}).catch(t=>{this.store.setError({title:this.$t("managers.constraintManagement.deleteError"),msg:t.message})})},setSelectedCheck(e){e&&(this.selectedCheck=e.value),this.formVisible=!0},handleSave(e){this.loadAll(),this.touched=!1,this.selectedCheck=e},closeForm(){this.touched?this.$confirm.require({message:this.$t("common.toast.unsavedChangesMessage"),header:this.$t("common.toast.unsavedChangesHeader"),icon:"pi pi-exclamation-triangle",accept:()=>{this.touched=!1,this.formVisible=!1}}):this.formVisible=!1}}}),ke={class:"kn-page-content p-grid p-m-0"},Ve={class:"kn-list--column p-col-4 p-sm-4 p-md-3 p-p-0"},Te={class:"kn-list-item","data-test":"list-item"},Me={class:"kn-list-item-text"},De={class:"kn-list-item-text-secondary"},Ie={class:"kn-list-item-text-secondary"},we={class:"kn-list--column p-col-8 p-sm-8 p-md-9 p-p-0"};function Ne(e,t,p,$,w,N){const g=i("FabButton"),b=i("Toolbar"),m=i("ProgressBar"),c=i("Avatar"),y=i("Button"),C=i("Listbox"),k=i("KnHint"),n=i("ConstraintsManagementDetail"),A=q("tooltip");return o(),v("div",ke,[a("div",Ve,[s(b,{class:"kn-toolbar kn-toolbar--primary"},{start:h(()=>[V(l(e.$t("managers.constraintManagement.title")),1)]),end:h(()=>[s(g,{icon:"fas fa-plus",onClick:e.showForm,"data-test":"open-form-button"},null,8,["onClick"])]),_:1}),e.loading?(o(),r(m,{key:0,mode:"indeterminate",class:"kn-progress-bar","data-test":"progress-bar"})):f("",!0),e.loading?f("",!0):(o(),r(C,{key:1,class:"kn-list--column",options:e.allCheks,optionLabel:"label",filter:!0,filterPlaceholder:e.$t("common.search"),filterMatchMode:"contains",filterFields:e.constraintManagementDescriptor.filterFields,emptyFilterMessage:e.$t("common.info.noDataFound"),onChange:e.showForm,"data-test":"check-list"},{empty:h(()=>[V(l(e.$t("common.info.noDataFound")),1)]),option:h(d=>[a("div",Te,[s(c,{icon:e.constraintManagementDescriptor.iconTypesMap[d.option.predifined].icon,shape:"circle",size:"medium"},null,8,["icon"]),G((o(),v("div",Me,[a("span",null,l(d.option.label),1),a("span",De,l(d.option.name),1),a("span",Ie,l(d.option.valueTypeCd),1)])),[[A,d.option.description,void 0,{top:!0}]]),d.option.predifined?f("",!0):(o(),r(y,{key:0,icon:"far fa-trash-alt",class:"p-button-text p-button-rounded p-button-plain",onClick:H(Ae=>e.deleteConstraintConfirm(d.option.checkId),["stop"]),"data-test":"delete-button"},null,8,["onClick"]))])]),_:1},8,["options","filterPlaceholder","filterFields","emptyFilterMessage","onChange"]))]),a("div",we,[e.formVisible?(o(),r(n,{key:1,selectedConstraint:e.selectedCheck,domains:e.domains,onClose:e.closeForm,onCreated:e.handleSave,onTouched:t[0]||(t[0]=d=>e.touched=!0)},null,8,["selectedConstraint","domains","onClose","onCreated"])):(o(),r(k,{key:0,title:"managers.constraintManagement.title",hint:"managers.constraintManagement.hint"},null,8,["title","hint"]))])])}var Le=I(ye,[["render",Ne]]);export{Le as default};
//# sourceMappingURL=ConstraintsManagement-0c69e717.js.map
