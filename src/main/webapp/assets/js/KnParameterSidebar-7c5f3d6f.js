import{d as I,l as W,n as ee,q as ae,_ as N,r as u,o as b,h as y,w as m,f as v,g as V,t as f,D as B,a as c,A as C,c as M,C as T,B as z,i as F,a7 as be,a5 as te,G as P,y as oe,z as A,V as L,p as ue,b as ke,aG as me,s as fe,W as ve}from"./index-1e676509.js";import{s as he}from"./calendar.esm-60a451ba.js";import{s as ge}from"./chip.esm-057ba1f1.js";import{s as we}from"./chips.esm-693c3c01.js";import{s as re}from"./checkbox.esm-fa6c8259.js";import{f as ne}from"./filterHelper-a723991a.js";import{s as xe}from"./tree.esm-837306a6.js";import{K as ye,u as Ce,c as Me}from"./KnValidatonMessages-ebe48c72.js";import{s as Ve}from"./menu.esm-6bee86d0.js";import{s as De}from"./multiselect.esm-ce4000f7.js";import{s as Pe}from"./radiobutton.esm-c3e6fa9b.js";function Ae(e,a){var o,r;((o=a.dependencies)==null?void 0:o.visual.length)!==0&&((r=a.dependencies)==null||r.visual.forEach(i=>{const l=e.filterStatus.findIndex(n=>n.urlName===i.parFatherUrlName);if(l!==-1){const n=e.filterStatus[l];a.dependsOnParameters?a.dependsOnParameters.push(n):a.dependsOnParameters=[n],n.dependentParameters?n.dependentParameters.push(a):n.dependentParameters=[a]}}))}function Ee(e){var a;(a=e.dependentParameters)==null||a.forEach(o=>Se(o,e))}function Se(e,a){var r;let o="false";for(let i=0;i<e.dependencies.visual.length;i++){let l=!1;const n=e.dependencies.visual[i];if(e.dependsOnParameters){const d=e.dependsOnParameters.findIndex(p=>p.urlName===n.parFatherUrlName),s=e.dependsOnParameters[d];for(let p=0;p<((r=s==null?void 0:s.parameterValue)==null?void 0:r.length);p++)if(s.parameterValue[p].value===n.compareValue){a.urlName===n.parFatherUrlName&&(e.label=n.viewLabel),l=!0;break}if(n.operation==="not contains")if(l){o="false";break}else o="true";else if(o=l?"true":"false",l)break}}e.showOnPanel=o,e.visible=o==="true"}function $e(e,a){var o,r;((o=a.dependencies)==null?void 0:o.data.length)!==0&&((r=a.dependencies)==null||r.data.forEach(i=>{const l=e.filterStatus.findIndex(n=>n.urlName===i.parFatherUrlName);if(l!==-1){const n=e.filterStatus[l];a.dataDependsOnParameters?a.dataDependsOnParameters.push(n):a.dataDependsOnParameters=[n],n.dataDependentParameters?n.dataDependentParameters.push(a):n.dataDependentParameters=[a]}}))}async function ze(e,a,o,r,i,l,n){if(a&&a.dataDependentParameters)for(let d=0;d<a.dataDependentParameters.length;d++)await Oe(e,a.dataDependentParameters[d],o,r,i,l,n)}async function Oe(e,a,o,r,i,l,n){const d={label:r==null?void 0:r.label,parameters:Ne(e),paramId:a.urlName,role:i};let s="2.0/documentExeParameters/admissibleValues";n!=="execution"&&r&&(s=r.type==="businessModel"?`1.0/businessmodel/${r.name}/admissibleValues`:`/3.0/datasets/${r.label}/admissibleValues`),await l.post("/knowage/restful-services/"+s,d).then(p=>{a.data=p.data.result.data,a.metadata=p.data.result.metadata,Te(a)})}function Te(e){Re(e)||(e.parameterValue=e.multivalue?[]:[{value:"",description:""}]),e.data&&(e.data=e.data.map(a=>Ie(e,a)),e.data.length===1&&(e.parameterValue=[...e.data])),(e.selectionType==="COMBOBOX"||e.selectionType==="LIST")&&e.multivalue&&e.mandatory&&e.data.length===1&&(e.showOnPanel="false",e.visible=!1),e.parameterValue[0]&&!e.parameterValue[0].description&&(e.parameterValue[0].description="")}function Ie(e,a){const o=e.metadata.valueColumn,r=e.metadata.descriptionColumn,i=Object.keys(e.metadata.colsMap).find(n=>e.metadata.colsMap[n]===o),l=Object.keys(e.metadata.colsMap).find(n=>e.metadata.colsMap[n]===r);return{value:i?a[i]:"",description:l?a[l]:""}}function Ne(e){let a=[];return Object.keys(e.filterStatus).forEach(o=>{var i,l;const r=e.filterStatus[o];r.multivalue?a.push({label:r.label,value:(i=r.parameterValue)==null?void 0:i.map(n=>n.value),description:(l=r.parameterDescription)!=null?l:""}):a.push({label:r.label,value:r.parameterValue[0].value,description:r.parameterValue[0].description})}),a}function Re(e){const a=e.metadata.valueColumn,o=e.metadata.descriptionColumn;let r=null;e.metadata.colsMap&&(r=Object.keys(e.metadata.colsMap).find(n=>e.metadata.colsMap[n]===a));let i=null;return e.metadata.colsMap&&(i=Object.keys(e.metadata.colsMap).find(n=>e.metadata.colsMap[n]===o)),e.data.findIndex(n=>n.value||n.description?e.parameterValue[0].value===n.value&&e.parameterValue[0].description===n.description:e.parameterValue[0].value===n[r]&&e.parameterValue[0].description===n[i])!==-1}function Ue(e,a){a.dependencies.lov.length!==0&&a.dependencies.lov.forEach(o=>{const r=e.filterStatus.findIndex(i=>i.urlName===o);if(r!==-1){const i=e.filterStatus[r];a.lovDependsOnParameters?a.lovDependsOnParameters.push(i):a.lovDependsOnParameters=[i],i.lovDependentParameters?i.lovDependentParameters.push(a):i.lovDependentParameters=[a]}})}async function Be(e,a,o,r,i,l,n){if(a&&a.lovDependentParameters)for(let d=0;d<a.lovDependentParameters.length;d++)await Fe(e,a.lovDependentParameters[d],o,r,i,l,n)}async function Fe(e,a,o,r,i,l,n){a.parameterValue[0]?a.parameterValue[0]={value:"",description:""}:a.parameterValue=[{value:"",description:""}];const d={label:r==null?void 0:r.label,parameters:je(e),paramId:a.urlName,role:i};let s="2.0/documentExeParameters/admissibleValues";n!=="execution"&&r&&(s=r.type==="businessModel"?`1.0/businessmodel/${r.name}/admissibleValues`:`/3.0/datasets/${r.label}/admissibleValues`),await l.post("/knowage/restful-services/"+s,d).then(p=>{a.data=p.data.result.data,a.metadata=p.data.result.metadata,_e(a)}).catch(()=>{})}function _e(e){e.parameterValue=e.multivalue?[]:[{value:"",description:""}],e.data&&(e.data=e.data.map(a=>Le(e,a)),e.data.length===1&&(e.parameterValue=[...e.data])),(e.selectionType==="COMBOBOX"||e.selectionType==="LIST")&&e.multivalue&&e.mandatory&&e.data.length===1&&(e.showOnPanel="false",e.visible=!1),e.parameterValue[0]&&!e.parameterValue[0].description&&(e.parameterValue[0].description="")}function Le(e,a){const o=e.metadata.valueColumn,r=e.metadata.descriptionColumn,i=Object.keys(e.metadata.colsMap).find(n=>e.metadata.colsMap[n]===o),l=Object.keys(e.metadata.colsMap).find(n=>e.metadata.colsMap[n]===r);return{value:i?a[i]:"",description:l?a[l]:""}}function je(e){let a=[];return Object.keys(e.filterStatus).forEach(o=>{var i,l;const r=e.filterStatus[o];r.multivalue?a.push({label:r.label,value:(i=r.parameterValue)==null?void 0:i.map(n=>n.value),description:(l=r.parameterDescription)!=null?l:""}):a.push({label:r.label,value:r.parameterValue[0].value,description:r.parameterValue[0].description})}),a}const Ke={scrollHeight:"50vh",style:{width:"80vw"}},Xe={checkboxColumn:{width:"flex: 0 0 4rem;"},message:{"align-items":"center",display:"flex","justify-content":"center","text-align":"center"}};var ie={dialog:Ke,styles:Xe};const Qe=I({name:"kn-parameter-popup-dialog",components:{Column:W,DataTable:ee,Message:ae},props:{parameterPopUpData:{type:Object},multivalue:{type:Boolean},multipleSelectedRows:{type:Array}},data(){return{knParameterPopupDialogDescriptor:ie,rows:[],columns:[],filters:{global:[ne]},globalFilterFields:[],selectedRow:null}},watch:{parameterPopUpData(){this.loadData()}},created(){this.loadData()},methods:{loadData(){var e,a;this.rows=(e=this.parameterPopUpData)==null?void 0:e.result.data,this.columns=[],Object.keys((a=this.parameterPopUpData)==null?void 0:a.result.metadata.colsMap).forEach(o=>{var r;this.columns.push({header:(r=this.parameterPopUpData)==null?void 0:r.result.metadata.colsMap[o],field:o})}),this.columns.forEach(o=>this.globalFilterFields.push(o.field)),this.selectedRow=this.multipleSelectedRows}}}),qe={class:"table-header p-d-flex p-ai-center"},Ye={id:"search-container",class:"p-input-icon-left p-mr-3"},Je=c("i",{class:"pi pi-search"},null,-1);function Ge(e,a,o,r,i,l){const n=u("Message"),d=u("InputText"),s=u("Column"),p=u("DataTable");return b(),y(p,{value:e.rows,class:"p-datatable-sm kn-table",selection:e.selectedRow,"onUpdate:selection":a[1]||(a[1]=k=>e.selectedRow=k),selectionMode:e.multivalue?!1:"single",filters:e.filters,"onUpdate:filters":a[2]||(a[2]=k=>e.filters=k),globalFilterFields:e.globalFilterFields,paginator:e.rows.length>20,rows:20,responsiveLayout:"stack",breakpoint:"600px",scrollable:!0,scrollHeight:e.knParameterPopupDialogDescriptor.dialog.scrollHeight,onRowSelect:a[3]||(a[3]=k=>e.$emit("selected",e.selectedRow)),onRowUnselect:a[4]||(a[4]=k=>e.$emit("selected",e.selectedRow)),onRowSelectAll:a[5]||(a[5]=k=>e.$emit("selected",e.selectedRow)),onRowUnselectAll:a[6]||(a[6]=k=>e.$emit("selected",e.selectedRow))},{empty:m(()=>[v(n,{class:"p-m-2",severity:"info",closable:!1,style:B(e.knParameterPopupDialogDescriptor.styles.message)},{default:m(()=>[V(f(e.$t("common.info.noDataFound")),1)]),_:1},8,["style"])]),header:m(()=>[c("div",qe,[c("span",Ye,[Je,v(d,{class:"kn-material-input",modelValue:e.filters.global.value,"onUpdate:modelValue":a[0]||(a[0]=k=>e.filters.global.value=k),type:"text",placeholder:e.$t("common.search")},null,8,["modelValue","placeholder"])])])]),default:m(()=>[e.multivalue?(b(),y(s,{key:0,selectionMode:"multiple",style:B(e.knParameterPopupDialogDescriptor.styles.checkboxColumn)},null,8,["style"])):C("",!0),(b(!0),M(z,null,T(e.columns,k=>(b(),y(s,{class:"kn-truncated",field:k.field,header:k.header,key:k.field,sortable:!0},null,8,["field","header"]))),128))]),_:1},8,["value","selection","selectionMode","filters","globalFilterFields","paginator","scrollHeight"])}var He=N(Qe,[["render",Ge]]);const Ze=I({name:"kn-parameter-popup-dialog",components:{Dialog:F,KnParameterPopupTable:He},props:{visible:{type:Boolean},selectedParameter:{type:Object},propLoading:{type:Boolean},parameterPopUpData:{type:Object}},emits:["close","save"],data(){return{knParameterPopupDialogDescriptor:ie,parameter:null,popupData:null,selectedRow:null,multipleSelectedRows:[],multivalue:!1,loading:!1}},watch:{visible(){this.loadParamaterData()},selectedParameter(){this.loadParamaterData()},propLoading(){this.setLoading()},parameterPopUpData(){this.loadPopupData(),this.loadParamaterData()}},created(){this.setLoading(),this.loadParamaterData()},methods:{loadParamaterData(){this.loading=!0,this.loadParameter(),this.loadPopupData(),this.multivalue?this.setMultipleSelectedRows():this.setSelectedRow(),this.loading=!1},loadParameter(){var e;this.parameter=this.selectedParameter,this.multivalue=(e=this.selectedParameter)==null?void 0:e.multivalue},setMultipleSelectedRows(){var l,n,d,s,p,k,D;this.multipleSelectedRows=[];const e=(l=this.popupData)==null?void 0:l.result.metadata.valueColumn,a=(n=this.popupData)==null?void 0:n.result.metadata.descriptionColumn,o=Object.keys((d=this.parameter)==null?void 0:d.metadata.colsMap).find(h=>{var g;return((g=this.parameter)==null?void 0:g.metadata.colsMap[h])===e}),r=Object.keys((s=this.parameter)==null?void 0:s.metadata.colsMap).find(h=>{var g;return((g=this.parameter)==null?void 0:g.metadata.colsMap[h])===a}),i=(p=this.parameter)==null?void 0:p.parameterValue;for(let h=0;h<i.length;h++){const g=i[h];if(o&&r){const x=(k=this.parameterPopUpData)==null?void 0:k.result.data.findIndex(S=>S[o]===g.value&&S[r]===g.description);x!==-1&&this.multipleSelectedRows.push((D=this.parameterPopUpData)==null?void 0:D.result.data[x])}}},setSelectedRow(){var o,r,i,l,n,d,s,p,k;const e=(o=this.popupData)==null?void 0:o.result.metadata.valueColumn,a=(r=this.popupData)==null?void 0:r.result.metadata.descriptionColumn;if((i=this.parameter)!=null&&i.metadata.colsMap){const D=Object.keys((l=this.parameter)==null?void 0:l.metadata.colsMap).find(g=>{var x;return((x=this.parameter)==null?void 0:x.metadata.colsMap[g])===e}),h=Object.keys((n=this.parameter)==null?void 0:n.metadata.colsMap).find(g=>{var x;return((x=this.parameter)==null?void 0:x.metadata.colsMap[g])===a});if(D&&h){const g=(d=this.parameterPopUpData)==null?void 0:d.result.data.findIndex(x=>{var S,R;return x[D]===((S=this.parameter)==null?void 0:S.parameterValue[0].value)&&x[h]===((R=this.parameter)==null?void 0:R.parameterValue[0].description)});g!==-1&&this.popupData&&(this.multipleSelectedRows=[(s=this.popupData)==null?void 0:s.result.data[g]],this.popupData.result.data=(p=this.popupData)==null?void 0:p.result.data.filter(x=>x[D]!==this.multipleSelectedRows[0][D]||x[h]!==this.multipleSelectedRows[0][h]),(k=this.popupData)==null||k.result.data.unshift(this.multipleSelectedRows[0]),this.selectedRow=this.multipleSelectedRows[0])}}},loadPopupData(){this.popupData=this.parameterPopUpData},setLoading(){this.loading=this.propLoading},closeDialog(){this.$emit("close"),this.loadParameter(),this.popupData=null,this.selectedRow=null},onRowSelected(e){this.multivalue?this.multipleSelectedRows=e:this.selectedRow=e},save(){var i,l,n;if(!this.parameter)return;const e=(i=this.popupData)==null?void 0:i.result.metadata.valueColumn,a=(l=this.popupData)==null?void 0:l.result.metadata.descriptionColumn,o=Object.keys(this.parameter.metadata.colsMap).find(d=>{var s;return((s=this.parameter)==null?void 0:s.metadata.colsMap[d])===e}),r=Object.keys(this.parameter.metadata.colsMap).find(d=>{var s;return((s=this.parameter)==null?void 0:s.metadata.colsMap[d])===a});this.multivalue?(this.parameter.parameterValue=[],(n=this.multipleSelectedRows)==null||n.forEach(d=>{var s;return(s=this.parameter)==null?void 0:s.parameterValue.push({value:o?d[o]:"",description:r?d[r]:""})})):(this.parameter.parameterValue=this.selectedRow?[{value:o?this.selectedRow[o]:"",description:r?this.selectedRow[r]:""}]:[],this.selectedRow=null),this.popupData=null,this.$emit("save",this.parameter)}}}),We={class:"p-d-flex p-flex-row p-jc-end"};function ea(e,a,o,r,i,l){const n=u("Toolbar"),d=u("ProgressBar"),s=u("KnParameterPopupTable"),p=u("Button"),k=u("Dialog");return b(),y(k,{class:"p-fluid kn-dialog--toolbar--primary",contentStyle:e.knParameterPopupDialogDescriptor.dialog.style,visible:e.visible,modal:!0,closable:!1},{header:m(()=>[v(n,{class:"kn-toolbar kn-toolbar--primary p-p-0 p-m-0 p-col-12"},{start:m(()=>[V(f(e.$t("common.parameter")+": ")+" "+f(e.popupData?e.popupData.idParam:""),1)]),_:1})]),footer:m(()=>[c("div",We,[v(p,{class:"kn-button kn-button--primary",onClick:e.closeDialog},{default:m(()=>[V(f(e.$t("common.cancel")),1)]),_:1},8,["onClick"]),v(p,{class:"kn-button kn-button--primary",onClick:e.save},{default:m(()=>[V(f(e.$t("common.save")),1)]),_:1},8,["onClick"])])]),default:m(()=>[e.loading?(b(),y(d,{key:0,mode:"indeterminate",class:"kn-progress-bar"})):C("",!0),e.parameterPopUpData&&!e.loading?(b(),y(s,{key:1,parameterPopUpData:e.popupData,multivalue:e.multivalue,multipleSelectedRows:e.multipleSelectedRows,onSelected:e.onRowSelected},null,8,["parameterPopUpData","multivalue","multipleSelectedRows","onSelected"])):C("",!0)]),_:1},8,["contentStyle","visible"])}var aa=N(Ze,[["render",ea]]);const ta={style:{width:"80vw"}},oa={style:{padding:0}};var ra={dialog:ta,node:oa};const na=I({name:"kn-parameter-tree-dialog",components:{Checkbox:re,Dialog:F,Tree:xe},props:{visible:{type:Boolean},selectedParameter:{type:Object},formatedParameterValues:{type:Object},document:{type:Object},mode:{type:String},selectedRole:{type:String}},emits:["close","save"],data(){return{knParameterTreeDialogDescriptor:ra,parameter:null,nodes:[],selectedValuesKeys:{},selectedValue:null,multipleSelectedValues:[],multivalue:!1,selectedNodes:[],loading:!1}},watch:{async visible(){await this.loadTree()},async selectedParameter(){await this.loadTree()}},async created(){await this.loadTree()},methods:{async loadTree(){this.loadParameter(),this.parameter&&this.formatedParameterValues&&this.visible&&await this.loadLeaf(null)},loadParameter(){var e,a;this.parameter=this.selectedParameter,this.multivalue=(e=this.selectedParameter)==null?void 0:e.multivalue,this.multivalue?this.setMultipleSelectedRows():(this.selectedValue=(a=this.selectedParameter)==null?void 0:a.parameterValue[0],this.selectedNodes=[this.selectedValue],this.selectedValue&&(this.selectedValuesKeys[this.selectedValue.description]=!0))},setMultipleSelectedRows(){!this.selectedParameter||(this.multipleSelectedValues=be(this.selectedParameter.parameterValue),this.selectedNodes=[...this.multipleSelectedValues])},async loadLeaf(e){var n,d;if(this.loading=!0,!this.document)return;if(e&&e.leaf){this.loading=!1;return}const a=this.store.$state.user.sessionRole,o=a&&a!==this.$t("role.defaultRolePlaceholder")?a:this.selectedRole;let r="2.0/documentexecution/admissibleValuesTree";this.mode!=="execution"&&(r=this.document.type==="businessModel"?`1.0/businessmodel/${this.document.name}/admissibleValuesTree`:`/3.0/datasets/${this.document.label}/admissibleValuesTree`);const i={label:(n=this.document.label)!=null?n:this.document.name,role:o,parameterId:(d=this.parameter)==null?void 0:d.urlName,mode:"complete",treeLovNode:e?e.id:"lovroot",parameters:this.formatedParameterValues};let l=[];await this.$http.post("/knowage/restful-services/"+r,i).then(s=>s.data.rows.forEach(p=>{l.push(this.createNode(p,e))})).catch(s=>console.log("ERROR: ",s)),this.attachContentToTree(e,l),l.forEach(s=>this.checkIfNodeIsSelected(s)),this.loading=!1,e&&this.setOpenFolderIcon(e)},checkIfNodeIsSelected(e){var a;e.leaf&&((a=this.parameter)==null?void 0:a.parameterValue.findIndex(r=>r.value===e.data.value))!==-1&&(this.selectedValuesKeys[e.key]={checked:!0,partialyChecked:!1},this.checkIfAllChildrensAreSelected(e.parent)&&(this.selectedValuesKeys[e.parent.key]={checked:!0,partialyChecked:!1}))},checkIfAllChildrensAreSelected(e){let a=!0;for(let o=0;o<e.children.length;o++)if(!this.selectedValuesKeys[e.children[o].key]||!this.selectedValuesKeys[e.children[o].key].checked){a=!1;break}return a},attachContentToTree(e,a){e?(e.children=[],e.children=a):(this.nodes=[],this.nodes=a)},createNode(e,a){return{key:e.label,id:e.id,label:e.label,children:[],data:{value:e.data,description:e.label},style:this.knParameterTreeDialogDescriptor.node.style,leaf:e.leaf,selectable:this.isNodeSelectable(e),parent:a,icon:e.leaf?"pi pi-file":"pi pi-folder"}},isNodeSelectable(e){return!this.multivalue||!this.parameter?!0:this.parameter.allowInternalNodeSelection||e.leaf},setOpenFolderIcon(e){e.icon="pi pi-folder-open"},setClosedFolderIcon(e){e.icon="pi pi-folder"},onNodeChange(){this.multipleSelectedValues=[...this.selectedNodes]},setSelectedValue(e){this.multivalue?e.leaf?this.multipleSelectedValues.push(e.data):e==null||e.children.forEach(a=>{this.multipleSelectedValues.findIndex(r=>r.value===a.data.value&&r.description===a.data.description)===-1&&this.multipleSelectedValues.push(a.data)}):this.selectedValue=e.data},removeSelectedValue(e){this.multivalue?e.leaf?this.removeSelectedNode(e):e==null||e.children.forEach(a=>{this.removeSelectedNode(a)}):this.selectedValue=null},removeSelectedNode(e){const a=this.multipleSelectedValues.findIndex(o=>o.value===e.data.value);a!==-1&&this.multipleSelectedValues.splice(a,1)},closeDialog(){this.$emit("close"),this.loadParameter(),this.selectedValue=null,this.multipleSelectedValues=[],this.nodes=[]},save(){var e,a;!this.parameter||(this.multivalue?(this.parameter.parameterValue=[],(a=this.multipleSelectedValues)==null||a.forEach(o=>{var r,i;return(i=this.parameter)==null?void 0:i.parameterValue.push({value:o.value,description:(r=o.description)!=null?r:""})}),this.multipleSelectedValues=[]):(this.parameter.parameterValue=this.selectedValue?[{value:this.selectedValue.value,description:(e=this.selectedValue.description)!=null?e:""}]:[],this.selectedValuesKeys={},this.selectedValue=null),this.nodes=[],this.$emit("save",this.parameter))}}}),ia={class:"p-d-flex p-flex-row p-jc-end"};function da(e,a,o,r,i,l){const n=u("Toolbar"),d=u("ProgressBar"),s=u("Checkbox"),p=u("Tree"),k=u("Button"),D=u("Dialog");return b(),y(D,{class:"p-fluid kn-dialog--toolbar--primary",contentStyle:e.knParameterTreeDialogDescriptor.dialog.style,visible:e.visible,modal:!0,closable:!1},{header:m(()=>[v(n,{class:"kn-toolbar kn-toolbar--primary p-p-0 p-m-0 p-col-12"},{start:m(()=>{var h;return[V(f(e.$t("common.parameter")+": "+((h=e.parameter)==null?void 0:h.urlName)),1)]}),_:1})]),footer:m(()=>[c("div",ia,[v(k,{class:"kn-button kn-button--primary",onClick:e.closeDialog},{default:m(()=>[V(f(e.$t("common.cancel")),1)]),_:1},8,["onClick"]),v(k,{class:"kn-button kn-button--primary",onClick:e.save},{default:m(()=>[V(f(e.$t("common.save")),1)]),_:1},8,["onClick"])])]),default:m(()=>[e.loading?(b(),y(d,{key:0,mode:"indeterminate",class:"kn-progress-bar"})):C("",!0),v(p,{id:"kn-parameter-tree",value:e.nodes,selectionMode:e.multivalue?null:"single",selectionKeys:e.selectedValuesKeys,"onUpdate:selectionKeys":a[2]||(a[2]=h=>e.selectedValuesKeys=h),metaKeySelection:!1,onNodeSelect:a[3]||(a[3]=h=>e.setSelectedValue(h)),onNodeUnselect:a[4]||(a[4]=h=>e.removeSelectedValue(h)),onNodeExpand:a[5]||(a[5]=h=>e.loadLeaf(h)),onNodeCollapse:a[6]||(a[6]=h=>e.setClosedFolderIcon(h))},{default:m(h=>[e.multivalue&&h.node.selectable?(b(),y(s,{key:0,class:"p-ml-2",modelValue:e.selectedNodes,"onUpdate:modelValue":a[0]||(a[0]=g=>e.selectedNodes=g),value:h.node.data,onChange:a[1]||(a[1]=g=>e.onNodeChange(g))},null,8,["modelValue","value"])):C("",!0),c("span",null,f(h.node.label),1)]),_:1},8,["value","selectionMode","selectionKeys"])]),_:1},8,["contentStyle","visible"])}var la=N(na,[["render",da],["__scopeId","data-v-7b6d9009"]]);const sa=160,ca={style:{width:"40vw"}},pa=40,ba=["PUBLIC","PRIVATE"],ua={viewpoint:[{fieldName:"NAME",validators:[{key:"required"},{key:"regex",validator:{type:"extendedAlphanumericRegex"}}]},{fieldName:"DESCRIPTION",validators:[{key:"required"},{key:"regex",validator:{type:"extendedAlphanumericRegex"}}]},{fieldName:"SCOPE",validators:[{key:"required"}]}]};var ka={descriptionMaxLength:sa,dialog:ca,nameMaxLength:pa,scopeOptions:ba,validations:ua};const ma=I({name:"kn-parameter-save-dialog",components:{Dialog:F,Dropdown:te,KnValidationMessages:ye},props:{visible:{type:Boolean},propLoading:{type:Boolean}},emits:["close","saveViewpoint"],data(){return{knParameterSaveDialogDescriptor:ka,viewpoint:{},loading:!1,v$:Ce()}},validations(){return{viewpoint:Me("viewpoint",this.knParameterSaveDialogDescriptor.validations.viewpoint)}},computed:{nameHelp(){var e,a;return((a=(e=this.viewpoint.NAME)==null?void 0:e.length)!=null?a:"0")+" / "+this.knParameterSaveDialogDescriptor.nameMaxLength},descriptionHelp(){var e,a;return((a=(e=this.viewpoint.DESCRIPTION)==null?void 0:e.length)!=null?a:"0")+" / "+this.knParameterSaveDialogDescriptor.descriptionMaxLength},saveButtonDisabled(){return this.v$.$invalid}},watch:{visible(){this.v$.$reset(),this.viewpoint={}},propLoading(){this.setLoading()}},created(){this.setLoading()},methods:{setLoading(){this.loading=this.propLoading},closeDialog(){this.viewpoint={},this.v$.$reset(),this.$emit("close")},saveViewpoint(){this.$emit("saveViewpoint",this.viewpoint)}}}),fa={class:"p-fluid p-formgrid p-grid p-m-4"},va={class:"p-field p-col-12"},ha={class:"p-float-label"},ga={for:"name",class:"kn-material-input-label"},wa={class:"p-d-flex p-flex-row p-jc-around"},xa={class:"input-help"},ya={class:"p-field p-col-12"},Ca={class:"p-float-label"},Ma={for:"description",class:"kn-material-input-label"},Va={class:"p-d-flex p-flex-row p-jc-around"},Da={class:"input-help"},Pa={class:"p-field p-col-12"},Aa={for:"scope",class:"kn-material-input-label"},Ea={class:"p-d-flex p-flex-row"},Sa={class:"p-d-flex p-flex-row p-jc-end"};function $a(e,a,o,r,i,l){const n=u("Toolbar"),d=u("ProgressBar"),s=u("InputText"),p=u("KnValidationMessages"),k=u("Dropdown"),D=u("Button"),h=u("Dialog");return b(),y(h,{class:"p-fluid kn-dialog--toolbar--primary",contentStyle:e.knParameterSaveDialogDescriptor.dialog.style,visible:e.visible,modal:!0,closable:!1},{header:m(()=>[v(n,{class:"kn-toolbar kn-toolbar--primary p-p-0 p-m-0 p-col-12"},{start:m(()=>[V(f(e.$t("common.saveAs")+" ... "),1)]),_:1})]),footer:m(()=>[c("div",Sa,[v(D,{class:"kn-button kn-button--primary",onClick:e.closeDialog},{default:m(()=>[V(f(e.$t("common.cancel")),1)]),_:1},8,["onClick"]),v(D,{class:"kn-button kn-button--primary",onClick:e.saveViewpoint,disabled:e.saveButtonDisabled},{default:m(()=>[V(f(e.$t("common.save")),1)]),_:1},8,["onClick","disabled"])])]),default:m(()=>[e.loading?(b(),y(d,{key:0,mode:"indeterminate",class:"kn-progress-bar"})):C("",!0),c("div",fa,[c("div",va,[c("span",ha,[v(s,{id:"name",class:P(["kn-material-input",{"p-invalid":e.v$.viewpoint.NAME.$invalid&&e.v$.viewpoint.NAME.$dirty}]),maxLength:e.knParameterSaveDialogDescriptor.nameMaxLength,modelValue:e.v$.viewpoint.NAME.$model,"onUpdate:modelValue":a[0]||(a[0]=g=>e.v$.viewpoint.NAME.$model=g),modelModifiers:{trim:!0},onBlur:a[1]||(a[1]=g=>e.v$.viewpoint.NAME.$touch())},null,8,["maxLength","modelValue","class"]),c("label",ga,f(e.$t("common.name"))+" * ",1)]),c("div",wa,[v(p,{vComp:e.v$.viewpoint.NAME,additionalTranslateParams:{fieldName:e.$t("common.name")}},null,8,["vComp","additionalTranslateParams"]),c("p",xa,f(e.nameHelp),1)])]),c("div",ya,[c("span",Ca,[v(s,{id:"description",class:P(["kn-material-input",{"p-invalid":e.v$.viewpoint.DESCRIPTION.$invalid&&e.v$.viewpoint.DESCRIPTION.$dirty}]),maxLength:e.knParameterSaveDialogDescriptor.descriptionMaxLength,modelValue:e.v$.viewpoint.DESCRIPTION.$model,"onUpdate:modelValue":a[2]||(a[2]=g=>e.v$.viewpoint.DESCRIPTION.$model=g),modelModifiers:{trim:!0},onBlur:a[3]||(a[3]=g=>e.v$.viewpoint.DESCRIPTION.$touch())},null,8,["maxLength","modelValue","class"]),c("label",Ma,f(e.$t("common.description"))+" * ",1)]),c("div",Va,[v(p,{vComp:e.v$.viewpoint.DESCRIPTION,additionalTranslateParams:{fieldName:e.$t("common.description")}},null,8,["vComp","additionalTranslateParams"]),c("p",Da,f(e.descriptionHelp),1)])]),c("div",Pa,[c("label",Aa,f(e.$t("common.scope"))+" * ",1),v(k,{id:"scope",class:P(["kn-material-input",{"p-invalid":e.v$.viewpoint.SCOPE.$invalid&&e.v$.viewpoint.SCOPE.$dirty}]),modelValue:e.v$.viewpoint.SCOPE.$model,"onUpdate:modelValue":a[4]||(a[4]=g=>e.v$.viewpoint.SCOPE.$model=g),options:e.knParameterSaveDialogDescriptor.scopeOptions,onBlur:a[5]||(a[5]=g=>e.v$.viewpoint.SCOPE.$touch())},null,8,["modelValue","class","options"]),c("div",Ea,[v(p,{vComp:e.v$.viewpoint.SCOPE,additionalTranslateParams:{fieldName:e.$t("common.scope")}},null,8,["vComp","additionalTranslateParams"])])])])]),_:1},8,["contentStyle","visible"])}var za=N(ma,[["render",$a],["__scopeId","data-v-7d2d0fba"]]);const Oa=[{field:"vpName",header:"common.name"},{field:"vpDesc",header:"common.description"},{field:"vpScope",header:"common.visibility"}],Ta={style:{width:"80vw"}},Ia=["vpName","vpDesc","vpScope"],Na={style:{"text-align":"end",width:"5%"}},Ra={message:{"align-items":"center",display:"flex","justify-content":"center","text-align":"center"}};var Ua={columns:Oa,dialog:Ta,globalFilterFields:Ia,iconColumn:Na,styles:Ra};const Ba=I({name:"kn-parameter-saved-parameters-dialog",components:{Column:W,DataTable:ee,Dialog:F,Message:ae},props:{visible:{type:Boolean},propViewpoints:{type:Array}},emits:["close","fillForm","executeViewpoint","deleteViewpoint"],data(){return{knParameterSavedParametersDialogDescriptor:Ua,viewpoints:[],filters:{global:[ne]}}},computed:{},watch:{propViewpoints(){this.loadViewpoints()}},created(){this.loadViewpoints()},methods:{loadViewpoints(){this.viewpoints=this.propViewpoints},closeDialog(){this.$emit("close")},deleteViewpointConfirm(e){this.$confirm.require({message:this.$t("documentExecution.dossier.deleteConfirm"),header:this.$t("documentExecution.dossier.deleteTitle"),icon:"pi pi-exclamation-triangle",accept:()=>this.$emit("deleteViewpoint",e)})}}}),Fa=e=>(ue("data-v-f8126c7a"),e=e(),ke(),e),_a={class:"table-header p-d-flex p-ai-center"},La={id:"search-container",class:"p-input-icon-left p-mr-3"},ja=Fa(()=>c("i",{class:"pi pi-search"},null,-1)),Ka={class:"p-d-flex p-flex-row"};function Xa(e,a,o,r,i,l){const n=u("Button"),d=u("Toolbar"),s=u("InputText"),p=u("Message"),k=u("Column"),D=u("DataTable"),h=u("Dialog"),g=oe("tooltip");return b(),y(h,{class:"p-fluid kn-dialog--toolbar--primary",contentStyle:e.knParameterSavedParametersDialogDescriptor.dialog.style,visible:e.visible,modal:!0,closable:!1},{header:m(()=>[v(d,{class:"kn-toolbar kn-toolbar--primary p-p-0 p-m-0 p-col-12"},{start:m(()=>[V(f(e.$t("documentExecution.main.savedParameters")),1)]),end:m(()=>[v(n,{id:"saved-parameters-dialog-close-button",class:"kn-button kn-button--primary",onClick:e.closeDialog},{default:m(()=>[V(f(e.$t("common.close")),1)]),_:1},8,["onClick"])]),_:1})]),default:m(()=>[v(D,{value:e.viewpoints,class:"p-datatable-sm kn-table",paginator:e.viewpoints.length>20,dataKey:"id",filters:e.filters,"onUpdate:filters":a[1]||(a[1]=x=>e.filters=x),globalFilterFields:e.knParameterSavedParametersDialogDescriptor.globalFilterFields,responsiveLayout:"stack",breakpoint:"600px"},{header:m(()=>[c("div",_a,[c("span",La,[ja,v(s,{class:"kn-material-input",modelValue:e.filters.global.value,"onUpdate:modelValue":a[0]||(a[0]=x=>e.filters.global.value=x),placeholder:e.$t("common.search")},null,8,["modelValue","placeholder"])])])]),empty:m(()=>[v(p,{class:"p-m-2",severity:"info",closable:!1,style:B(e.knParameterSavedParametersDialogDescriptor.styles.message)},{default:m(()=>[V(f(e.$t("common.info.noDataFound")),1)]),_:1},8,["style"])]),default:m(()=>[(b(!0),M(z,null,T(e.knParameterSavedParametersDialogDescriptor.columns,x=>(b(),y(k,{class:"kn-truncated",field:x.field,header:e.$t(x.header),key:x.field,sortable:!0},null,8,["field","header"]))),128)),v(k,{style:B(e.knParameterSavedParametersDialogDescriptor.iconColumn.style)},{body:m(x=>[c("div",Ka,[A(v(n,{icon:"fas fa-file-signature",class:"p-button-link p-mr-2",onClick:L(S=>e.$emit("fillForm",x.data),["stop"])},null,8,["onClick"]),[[g,e.$t("documentExecution.main.fillForm"),void 0,{left:!0}]]),A(v(n,{icon:"fa fa-play-circle",class:"p-button-link p-mr-2",onClick:L(S=>e.$emit("executeViewpoint",x.data),["stop"])},null,8,["onClick"]),[[g,e.$t("common.execute"),void 0,{left:!0}]]),A(v(n,{icon:"fas fa-trash-alt",class:"p-button-link",onClick:L(S=>e.deleteViewpointConfirm(x.data),["stop"])},null,8,["onClick"]),[[g,e.$t("common.delete"),void 0,{left:!0}]])])]),_:1},8,["style"])]),_:1},8,["value","paginator","filters","globalFilterFields"])]),_:1},8,["contentStyle","visible"])}var Qa=N(Ba,[["render",Xa],["__scopeId","data-v-f8126c7a"]]);const qa=I({name:"kn-parameter-sidebar",components:{Calendar:he,Chip:ge,Chips:we,Checkbox:re,Dropdown:te,KnParameterPopupDialog:aa,KnParameterTreeDialog:la,KnParameterSaveDialog:za,KnParameterSavedParametersDialog:Qa,Menu:Ve,MultiSelect:De,RadioButton:Pe,ScrollPanel:me},props:{filtersData:{type:Object},propDocument:{type:Object},userRole:{type:Object},propMode:{type:String},propQBEParameters:{type:Array},dateFormat:{type:String},dataset:{type:Object}},emits:["execute","exportCSV","roleChanged","parametersChanged"],data(){return{document:null,parameters:{isReadyForExecution:!1,filterStatus:[]},executeMenuItems:[],selectedParameterCheckbox:{},popupDialogVisible:!1,selectedParameter:null,parameterPopUpData:null,treeDialogVisible:!1,formatedParameterValues:null,parameterSaveDialogVisible:!1,savedParametersDialogVisible:!1,viewpoints:[],user:null,role:null,loading:!1,updateVisualDependency:Ee,mode:"execution",qbeParameters:[],primary:!0,userDateFormat:""}},watch:{sessionRole(){this.role="",this.parameters={isReadyForExecution:!1,filterStatus:[]}},filtersData(){this.loadDocument(),this.loadParameters()},userRole(){this.role=this.userRole},propMode(){this.loadMode()},propQBEParameters(){this.loadQBEParameters()},dateFormat(){this.userDateFormat=this.dateFormat}},computed:{sessionRole(){return this.store.$state.user.sessionRole},buttonsDisabled(){return this.requiredFiledMissing()},positionClass(){var e;return(e=this.document)!=null&&e.parametersRegion?"kn-parameter-sidebar-"+this.document.parametersRegion:"kn-parameter-sidebar"}},setup(){return{store:fe()}},created(){this.loadMode(),(this.mode==="qbeView"||this.mode==="workspaceView"||this.mode==="datasetManagement")&&this.loadQBEParameters(),this.user=this.store.$state.user,this.role=this.userRole,this.loadDocument(),this.loadParameters(),this.userDateFormat=this.dateFormat},methods:{applyFieldClass(e){let a=this.primary?e+" fieldBackgroundColorPrimary":e+" fieldBackgroundColorSecondary";return this.primary=!this.primary,a},setNewSessionRole(){this.$emit("roleChanged",this.role),this.parameters={isReadyForExecution:!1,filterStatus:[]}},loadDocument(){this.document=this.propDocument},loadParameters(){var e,a,o,r,i,l,n;this.parameters.isReadyForExecution=(e=this.filtersData)==null?void 0:e.isReadyForExecution,this.parameters.filterStatus=[],(o=(a=this.filtersData)==null?void 0:a.filterStatus)==null||o.forEach(d=>{var s;d.selectionType=="LIST"&&d.showOnPanel=="true"&&d.multivalue&&(this.selectedParameterCheckbox[d.id]=(s=d.parameterValue)==null?void 0:s.map(p=>p.value)),this.parameters.filterStatus.push(d)}),(r=this.parameters)==null||r.filterStatus.forEach(d=>Ae(this.parameters,d)),(i=this.parameters)==null||i.filterStatus.forEach(d=>$e(this.parameters,d)),(l=this.parameters)==null||l.filterStatus.forEach(d=>Ue(this.parameters,d)),(n=this.parameters)==null||n.filterStatus.forEach(d=>this.updateVisualDependency(d))},setDataDependency(e){e.dependencies.data.length!==0&&e.dependencies.data.forEach(a=>{const o=this.parameters.filterStatus.findIndex(r=>r.urlName===a.parFatherUrlName);if(o!==-1){const r=this.parameters.filterStatus[o];e.dataDependsOnParameters?e.dataDependsOnParameters.push(r):e.dataDependsOnParameters=[r],r.dataDependentParameters?r.dataDependentParameters.push(e):r.dataDependentParameters=[e]}})},resetParameterValue(e){var l,n,d,s;if(!e.driverDefaultValue){e.multivalue?(e.parameterValue=[],this.selectedParameterCheckbox[e.id]=[]):e.parameterValue[0]={value:"",description:""},this.parameters.filterStatus.forEach(p=>this.updateDependency(p));return}const a=e.metadata.valueColumn,o=e.metadata.descriptionColumn;let r=null;e.metadata.colsMap&&(r=Object.keys(e.metadata.colsMap).find(p=>e.metadata.colsMap[p]===a));let i=null;if(e.metadata.colsMap&&(i=Object.keys(e.metadata.colsMap).find(p=>e.metadata.colsMap[p]===o)),(e.selectionType==="LIST"||e.selectionType==="COMBOBOX")&&e.showOnPanel==="true"&&e.multivalue){e.parameterValue=[],this.selectedParameterCheckbox[e.id]=[];for(let p=0;p<e.driverDefaultValue.length;p++){const k=e.driverDefaultValue[p];e.parameterValue.push({value:r?k[r]:"",description:i?k[i]:""}),r&&this.selectedParameterCheckbox[e.id].push(k[r])}}else e.selectionType==="TREE"&&e.showOnPanel==="true"&&e.multivalue?e.parameterValue=(l=e.driverDefaultValue)==null?void 0:l.map(p=>({value:p.value,description:p.desc})):e.selectionType==="TREE"&&e.showOnPanel==="true"&&!e.multivalue?e.parameterValue[0]={value:e.driverDefaultValue[0].value,description:e.driverDefaultValue[0].desc}:(e.selectionType==="COMBOBOX"||e.selectionType==="LOOKUP")&&e.showOnPanel==="true"&&!e.multivalue?e.parameterValue[0]={value:e.driverDefaultValue[0][r],description:e.driverDefaultValue[0][i]}:e.selectionType==="LOOKUP"&&e.showOnPanel==="true"&&e.multivalue?e.parameterValue=e.driverDefaultValue.map(p=>({value:r?p[r]:"",description:i?p[i]:""})):e.type==="DATE"&&e.showOnPanel==="true"?(n=e.driverDefaultValue[0].desc)!=null&&n.split("#")[0]&&(e.parameterValue[0].value=this.getFormattedDate((d=e.driverDefaultValue[0].desc)==null?void 0:d.split("#")[0],void 0)):(e.parameterValue[0]||(e.parameterValue[0]={value:"",description:""}),e.parameterValue[0].value=(s=e.driverDefaultValue[0].value)!=null?s:e.driverDefaultValue[0][r]);this.parameters.filterStatus.forEach(p=>this.updateDependency(p))},resetAllParameters(){this.parameters.filterStatus.forEach(e=>this.resetParameterValue(e)),this.parameters.filterStatus.forEach(e=>this.updateDependency(e))},toggle(e){this.createMenuItems(),this.$refs.executeButtonMenu.toggle(e)},createMenuItems(){this.executeMenuItems=[],this.executeMenuItems.push({label:this.$t("common.exportCSV"),command:()=>this.$emit("exportCSV")})},requiredFiledMissing(){if(this.mode==="qbeView"||this.mode==="workspaceView"){for(let e=0;e<this.qbeParameters.length;e++)if(!this.qbeParameters[e].value)return!0}for(let e=0;e<this.parameters.filterStatus.length;e++){const a=this.parameters.filterStatus[e];if(a.mandatory&&a.showOnPanel=="true"){if(!a.parameterValue||a.parameterValue.length===0)return!0;for(let o=0;o<a.parameterValue.length;o++)if(!a.parameterValue[o].value)return!0}}return!1},setRadioButtonValue(e){var o;const a=(o=e.data)==null?void 0:o.findIndex(r=>r.value===e.parameterValue[0].value);a!==-1&&(e.parameterValue[0].description=e.data[a].description),this.updateDependency(e)},setCheckboxValue(e){e.parameterValue=this.selectedParameterCheckbox[e.id].map(a=>({value:a,description:a})),this.updateDependency(e)},openPopupDialog(e){this.selectedParameter=e,this.getParameterPopupInfo(e),this.popupDialogVisible=!0},openTreeDialog(e){this.selectedParameter=e,this.formatedParameterValues=this.getFormattedParameters(),this.treeDialogVisible=!0},onTreeClose(){this.selectedParameter=null,this.formatedParameterValues=null,this.treeDialogVisible=!1},async getParameterPopupInfo(e){var i;this.loading=!0;const a=this.sessionRole&&this.sessionRole!==this.$t("role.defaultRolePlaceholder")?this.sessionRole:this.role,o={label:(i=this.document)==null?void 0:i.label,parameters:this.getFormattedParameters(),paramId:e.urlName,role:a};let r="2.0/documentExeParameters/admissibleValues";this.mode!=="execution"&&this.document&&(r=this.document.type==="businessModel"?`1.0/businessmodel/${this.document.name}/admissibleValues`:`/3.0/datasets/${this.document.label}/admissibleValues`),await this.$http.post("/knowage/restful-services/"+r,o).then(l=>this.parameterPopUpData=l.data).catch(l=>console.log("ERROR: ",l)),this.loading=!1},getFormattedParameters(){let e=[];return Object.keys(this.parameters.filterStatus).forEach(a=>{var r,i,l;const o=this.parameters.filterStatus[a];o.multivalue?e.push({label:o.label,value:(i=o.parameterValue)==null?void 0:i.map(n=>n.value),description:(l=o.parameterDescription)!=null?l:""}):e.push({label:o.label,value:o.parameterValue[0].value,description:(r=o.parameterValue[0].description)!=null?r:""})}),e},getParameterValues(){let e={};return Object.keys(this.parameters.filterStatus).forEach(a=>{const o=this.parameters.filterStatus[a];if(o.type==="DATE")e[o.urlName]=o.parameterValue[0].value,e[o.urlName+"_field_visible_description"]=o.parameterValue[0].value;else if(o.valueSelection==="man_in"&&!o.multivalue)e[o.urlName]=o.type==="NUM"?+o.parameterValue[0].value:o.parameterValue[0].value,e[o.urlName+"_field_visible_description"]=o.type==="NUM"?+o.parameterValue[0].description:o.parameterValue[0].description;else if(o.selectionType==="TREE"||o.selectionType==="LOOKUP"||o.multivalue){e[o.urlName]=o.parameterValue.map(i=>i.value);let r="";for(let i=0;i<o.parameterValue.length;i++)r+=o.parameterValue[i].description,r+=i===o.parameterValue.length-1?"":";";e[o.urlName+"_field_visible_description"]=r}else e[o.urlName]=o.parameterValue[0].value,e[o.urlName+"_field_visible_description"]=o.parameterValue[0].description}),e},onPopupSave(e){this.updateDependency(e),this.popupDialogVisible=!1},onTreeSave(e){this.updateVisualDependency(e),this.treeDialogVisible=!1},updateDependency(e){const a=this.sessionRole&&this.sessionRole!==this.$t("role.defaultRolePlaceholder")?this.sessionRole:this.role;this.updateVisualDependency(e),ze(this.parameters,e,this.loading,this.document,a,this.$http,this.mode),Be(this.parameters,e,this.loading,this.document,a,this.$http,this.mode),this.$emit("parametersChanged",{parameters:this.parameters,document:this.propDocument})},openSaveParameterDialog(){this.parameterSaveDialogVisible=!0},async saveViewpoint(e){var r;const a=this.sessionRole&&this.sessionRole!==this.$t("role.defaultRolePlaceholder")?this.sessionRole:this.role;if(!a)return;const o={...e,OBJECT_LABEL:(r=this.document)==null?void 0:r.label,ROLE:a,VIEWPOINT:this.getParameterValues()};this.loading=!0,await this.$http.post("/knowage/restful-services/1.0/documentviewpoint/addViewpoint",o).then(()=>{this.store.setInfo({title:this.$t("common.toast.createTitle"),msg:this.$t("common.toast.success")}),this.parameterSaveDialogVisible=!1}).catch(()=>{}),this.loading=!1},async openSavedParametersDialog(){var a;const e=this.sessionRole&&this.sessionRole!==this.$t("role.defaultRolePlaceholder")?this.sessionRole:this.role;!e||(this.loading=!0,await this.$http.get(`/knowage/restful-services/1.0/documentviewpoint/getViewpoints?label=${(a=this.document)==null?void 0:a.label}&role=${e}`).then(o=>{this.viewpoints=o.data.viewpoints,this.savedParametersDialogVisible=!0}),this.loading=!1)},fillParameterForm(e){var o;const a=this.decodeViewpointPrameterValues(e.vpValueParams);(o=Object.keys(a))==null||o.forEach(r=>{var l,n;const i=this.parameters.filterStatus.findIndex(d=>d.urlName===r);if(i!==-1){const d=this.parameters.filterStatus[i];if(d.type==="DATE"){const s=new Date(a[r]);d.parameterValue[0].value=s instanceof Date&&!isNaN(s)?s:this.getFormattedDate(a[r],"DD/MM/YYYY"),d.parameterValue[0].value=s}else if((d.valueSelection==="man_in"||d.selectionType==="COMBOBOX")&&!d.multivalue)d.parameterValue[0].value=a[r],d.parameterValue[0].description=a[r+"_field_visible_description"];else if(d.selectionType==="TREE"||d.selectionType==="LOOKUP"||d.multivalue){const s=JSON.parse(a[r]),p=a[r+"_field_visible_description"].split(";");d.parameterValue=[];for(let k=0;k<s.length;k++)d.parameterValue[k]={value:s[k],description:(l=p[k])!=null?l:""};d.selectionType==="LIST"&&(this.selectedParameterCheckbox[d.id]=(n=d.parameterValue)==null?void 0:n.map(k=>k.value))}else d.parameterValue[0].value=a[r],d.parameterValue[0].description=a[r+"_field_visible_description"]}this.savedParametersDialogVisible=!1})},getFormattedDate(e,a){return ve(e,"l",a)},decodeViewpointPrameterValues(e){const a={},o=e.split("%26");for(let r=0;r<o.length;r++){const i=o[r].split("%3D");a[i[0]]=i[1]}return a},executeViewpoint(e){this.fillParameterForm(e),this.$emit("execute"),this.savedParametersDialogVisible=!1},async deleteViewpoint(e){this.loading=!0,await this.$http.post("/knowage/restful-services/1.0/documentviewpoint/deleteViewpoint",{VIEWPOINT:""+e.vpId}).then(async()=>{this.removeViewpoint(e),this.store.setInfo({title:this.$t("common.toast.deleteTitle"),msg:this.$t("common.toast.deleteSuccess")})}).catch(()=>{}),this.loading=!1},removeViewpoint(e){const a=this.viewpoints.findIndex(o=>o.vpId===e.vpId);a!==-1&&this.viewpoints.splice(a,1)},loadMode(){this.mode=this.propMode?this.propMode:"execution"},loadQBEParameters(){var e;this.qbeParameters=[],(e=this.propQBEParameters)==null||e.forEach(a=>{var o;a.multiValue&&a.defaultValue&&!Array.isArray(a.defaultValue)&&(a.defaultValue=(o=a.defaultValue)==null?void 0:o.split(",").map(r=>r.trim())),a.value||(a.value=a.defaultValue),this.qbeParameters.push(a)})},onDropdownChange(e){this.updateParameterDescriptionOnDropdownChange(e),this.updateDependency(e)},updateParameterDescriptionOnDropdownChange(e){var o;if(!e.parameterValue[0])return;const a=(o=e.data)==null?void 0:o.findIndex(r=>r.value===e.parameterValue[0].value);a!==-1&&(e.parameterValue[0].description=e.data[a].description)}}}),Ya={id:"kn-parameter-sidebar-toolbar-icons-container",class:"p-d-flex p-flex-row p-jc-around"},Ja={class:"p-fluid kn-parameter-sidebar-content kn-alternated-rows"},Ga={key:0,class:"p-field p-my-1 p-p-2"},Ha={class:"p-d-flex"},Za={class:"kn-material-input-label"},Wa={class:"p-field p-m-4"},et={class:"p-d-flex"},at={class:"kn-material-input-label"},tt={key:0},ot=["onClick"],rt={key:0,class:"p-field p-my-1 p-p-2"},nt={class:"p-d-flex"},it=["data-test"],dt=["onClick","data-test"],lt={key:1,class:"p-field p-my-1 p-p-2"},st={class:"p-d-flex"},ct=["data-test"],pt=["onClick","data-test"],bt={key:2,class:"p-field p-my-1 p-p-2"},ut={class:"p-d-flex"},kt=["data-test"],mt=["onClick","data-test"],ft=["data-test"],vt={key:3,class:"p-field p-my-1 p-p-2"},ht={class:"p-d-flex"},gt=["onClick"],wt={key:4,class:"p-field p-my-1 p-p-2"},xt={class:"p-d-flex"},yt=["onClick"],Ct={class:"p-d-flex p-flex-row"},Mt=["onClick"],Vt={key:5,class:"p-field p-my-1 p-p-2"},Dt={class:"p-d-flex"},Pt=["onClick"],At={class:"p-d-flex p-flex-row"},Et=["onClick"],St={key:1,class:"p-fluid p-d-flex p-flex-row p-m-2 kn-parameter-sidebar-buttons"};function $t(e,a,o,r,i,l){var j,K;const n=u("Button"),d=u("Toolbar"),s=u("Dropdown"),p=u("Chips"),k=u("InputText"),D=u("Calendar"),h=u("RadioButton"),g=u("Checkbox"),x=u("ScrollPanel"),S=u("MultiSelect"),R=u("Chip"),de=u("Menu"),le=u("KnParameterPopupDialog"),se=u("KnParameterTreeDialog"),ce=u("KnParameterSaveDialog"),pe=u("KnParameterSavedParametersDialog"),$=oe("tooltip");return b(),M("div",{id:"kn-parameter-sidebar",class:P(e.positionClass)},[e.mode!=="workspaceView"&&e.mode!=="qbeView"&&e.mode!=="datasetManagement"?(b(),y(d,{key:0,id:"kn-parameter-sidebar-toolbar",class:"kn-toolbar kn-toolbar--secondary"},{start:m(()=>[c("div",Ya,[A(v(n,{icon:"fa fa-eraser",class:"p-button-text p-button-rounded p-button-plain p-mx-2",onClick:e.resetAllParameters},null,8,["onClick"]),[[$,e.$t("documentExecution.main.resetParametersTooltip"),void 0,{top:!0}]]),A(v(n,{icon:"pi pi-pencil",class:"p-button-text p-button-rounded p-button-plain p-mx-2",onClick:e.openSavedParametersDialog},null,8,["onClick"]),[[$,e.$t("documentExecution.main.savedParametersTooltip"),void 0,{top:!0}]]),A(v(n,{icon:"fas fa-save",class:"p-button-text p-button-rounded p-button-plain p-mx-2",onClick:e.openSaveParameterDialog},null,8,["onClick"]),[[$,e.$t("documentExecution.main.saveParametersFromStateTooltip"),void 0,{top:!0}]])])]),_:1})):C("",!0),c("div",Ja,[e.user&&(!e.sessionRole||e.sessionRole===e.$t("role.defaultRolePlaceholder"))&&(e.mode==="execution"||e.mode==="qbeView"||e.mode==="workspaceView"&&((K=(j=e.dataset)==null?void 0:j.drivers)==null?void 0:K.length)>0)?(b(),M("div",Ga,[c("div",Ha,[c("label",Za,f(e.$t("common.roles")),1)]),v(s,{class:"kn-material-input",modelValue:e.role,"onUpdate:modelValue":a[0]||(a[0]=t=>e.role=t),options:e.user.roles,onChange:e.setNewSessionRole},null,8,["modelValue","options","onChange"])])):C("",!0),e.mode==="qbeView"||e.mode==="workspaceView"||e.mode==="datasetManagement"?(b(!0),M(z,{key:1},T(e.qbeParameters,(t,_)=>(b(),M("div",{key:_},[c("div",Wa,[c("div",et,[c("label",at,[V(f(t.name)+" ",1),e.mode!=="datasetManagement"?(b(),M("span",tt," *")):C("",!0)]),A(c("i",{class:"fa fa-eraser parameter-clear-icon kn-cursor-pointer",onClick:O=>t.value=t.defaultValue},null,8,ot),[[$,e.$t("documentExecution.main.parameterClearTooltip"),void 0,{left:!0}]])]),t.multiValue?(b(),y(p,{key:0,modelValue:t.value,"onUpdate:modelValue":O=>t.value=O},null,8,["modelValue","onUpdate:modelValue"])):(b(),y(k,{key:1,class:P(["kn-material-input p-inputtext-sm",{"p-invalid":!t.value&&e.mode!=="datasetManagement"}]),modelValue:t.value,"onUpdate:modelValue":O=>t.value=O},null,8,["modelValue","onUpdate:modelValue","class"]))])]))),128)):C("",!0),(b(!0),M(z,null,T(e.parameters.filterStatus,(t,_)=>{var O,X,Q,q,Y,J,G,H,Z;return b(),M(z,{key:_},[(t.type==="STRING"||t.type==="NUM")&&!t.selectionType&&t.valueSelection==="man_in"&&t.showOnPanel==="true"&&t.visible?(b(),M("div",rt,[c("div",nt,[c("label",{class:P(["kn-material-input-label",{"p-text-italic":t.dependsOnParameters||t.lovDependsOnParameters}]),"data-test":"parameter-input-label-"+t.id},f(t.label)+" "+f(t.mandatory?"*":""),11,it),A(c("i",{class:"fa fa-eraser parameter-clear-icon kn-cursor-pointer",onClick:w=>e.resetParameterValue(t),"data-test":"parameter-input-clear-"+t.id},null,8,dt),[[$,e.$t("documentExecution.main.parameterClearTooltip"),void 0,{left:!0}]])]),t.parameterValue?(b(),y(k,{key:0,class:P(["kn-material-input p-inputtext-sm",{"p-invalid":t.mandatory&&t.parameterValue&&!((O=t.parameterValue[0])!=null&&O.value)}]),type:t.type==="NUM"?"number":"text",modelValue:t.parameterValue[0].value,"onUpdate:modelValue":w=>t.parameterValue[0].value=w,onInput:w=>e.updateDependency(t),"data-test":"parameter-input-"+t.id},null,8,["type","modelValue","onUpdate:modelValue","class","onInput","data-test"])):C("",!0)])):C("",!0),t.type==="DATE"&&!t.selectionType&&t.valueSelection==="man_in"&&t.showOnPanel==="true"&&t.visible?(b(),M("div",lt,[c("div",st,[c("label",{class:P(["kn-material-input-label",{"p-text-italic":t.dependsOnParameters||t.lovDependsOnParameters}]),"data-test":"parameter-date-label-"+t.id},f(t.label)+" "+f(t.mandatory?"*":""),11,ct),A(c("i",{class:"fa fa-eraser parameter-clear-icon kn-cursor-pointer",onClick:w=>e.resetParameterValue(t),"data-test":"parameter-date-clear-"+t.id},null,8,pt),[[$,e.$t("documentExecution.main.parameterClearTooltip"),void 0,{left:!0}]])]),t.parameterValue?(b(),y(D,{key:0,modelValue:t.parameterValue[0].value,"onUpdate:modelValue":w=>t.parameterValue[0].value=w,showButtonBar:!0,showIcon:!0,manualInput:!0,class:P(["kn-material-input custom-timepicker",{"p-invalid":t.mandatory&&t.parameterValue&&!((X=t.parameterValue[0])!=null&&X.value)}]),onChange:w=>e.updateDependency(t),onDateSelect:w=>e.updateDependency(t),"data-test":"parameter-date-input-"+t.id},null,8,["modelValue","onUpdate:modelValue","class","onChange","onDateSelect","data-test"])):C("",!0)])):C("",!0),t.selectionType==="LIST"&&t.showOnPanel==="true"&&t.visible?(b(),M("div",bt,[c("div",ut,[c("label",{class:P(["kn-material-input-label",{"kn-required-alert":t.mandatory&&(!t.multivalue&&t.parameterValue&&!((Q=t.parameterValue[0])!=null&&Q.value)||t.multivalue&&t.parameterValue&&t.parameterValue.length===0),"p-text-italic":t.dependsOnParameters||t.lovDependsOnParameters}]),"data-test":"parameter-checkbox-label-"+t.id},f(t.label)+" "+f(t.mandatory?"*":""),11,kt),A(c("i",{class:"fa fa-eraser parameter-clear-icon kn-cursor-pointer",onClick:w=>e.resetParameterValue(t),"data-test":"parameter-checkbox-clear-"+t.id},null,8,mt),[[$,e.$t("documentExecution.main.parameterClearTooltip"),void 0,{left:!0}]])]),v(x,{class:"inputScrollPanel"},{default:m(()=>[(b(!0),M(z,null,T(t.data,(w,U)=>(b(),M("div",{class:"p-field-radiobutton",key:U,"data-test":"parameter-list-"+t.id},[!t.multivalue&&t.parameterValue?(b(),y(h,{key:0,value:w.value,modelValue:t.parameterValue[0].value,"onUpdate:modelValue":E=>t.parameterValue[0].value=E,onChange:E=>e.setRadioButtonValue(t)},null,8,["value","modelValue","onUpdate:modelValue","onChange"])):C("",!0),t.multivalue&&t.parameterValue?(b(),y(g,{key:1,value:w.value,modelValue:e.selectedParameterCheckbox[t.id],"onUpdate:modelValue":E=>e.selectedParameterCheckbox[t.id]=E,onChange:E=>e.setCheckboxValue(t)},null,8,["value","modelValue","onUpdate:modelValue","onChange"])):C("",!0),c("label",null,f(w.description),1)],8,ft))),128))]),_:2},1024)])):C("",!0),t.selectionType==="COMBOBOX"&&t.showOnPanel==="true"&&t.visible?(b(),M("div",vt,[c("div",ht,[c("label",{class:P(["kn-material-input-label",{"kn-required-alert":t.mandatory&&(!t.multivalue&&t.parameterValue&&!((q=t.parameterValue[0])!=null&&q.value)||t.multivalue&&((Y=t.parameterValue)==null?void 0:Y.length)===0),"p-text-italic":t.dependsOnParameters||t.lovDependsOnParameters}])},f(t.label)+" "+f(t.mandatory?"*":""),3),A(c("i",{class:"fa fa-eraser parameter-clear-icon kn-cursor-pointer",onClick:w=>e.resetParameterValue(t)},null,8,gt),[[$,e.$t("documentExecution.main.parameterClearTooltip"),void 0,{left:!0}]])]),!t.multivalue&&t.parameterValue?(b(),y(s,{key:0,class:"kn-material-input",modelValue:t.parameterValue[0].value,"onUpdate:modelValue":w=>t.parameterValue[0].value=w,options:t.data,optionValue:"value",optionLabel:"description",onChange:w=>e.onDropdownChange(t)},null,8,["modelValue","onUpdate:modelValue","options","onChange"])):(b(),y(S,{key:1,modelValue:t.parameterValue,"onUpdate:modelValue":w=>t.parameterValue=w,options:t.data,optionLabel:"description",onChange:w=>e.updateDependency(t)},null,8,["modelValue","onUpdate:modelValue","options","onChange"]))])):C("",!0),t.selectionType==="LOOKUP"&&t.showOnPanel==="true"&&t.visible?(b(),M("div",wt,[c("div",xt,[c("label",{class:P(["kn-material-input-label",{"kn-required-alert":t.mandatory&&(!t.multivalue&&t.parameterValue&&!((J=t.parameterValue[0])!=null&&J.value)||t.multivalue&&((G=t.parameterValue)==null?void 0:G.length)===0),"p-text-italic":t.dependsOnParameters||t.lovDependsOnParameters}])},f(t.label)+" "+f(t.mandatory?"*":""),3),A(c("i",{class:"fa fa-eraser parameter-clear-icon kn-cursor-pointer",onClick:w=>e.resetParameterValue(t)},null,8,yt),[[$,e.$t("documentExecution.main.parameterClearTooltip"),void 0,{left:!0}]])]),c("div",Ct,[c("i",{class:"pi pi-external-link kn-cursor-pointer p-mr-2",onClick:w=>e.openPopupDialog(t)},null,8,Mt),v(x,{class:"lookupScrollPanel"},{default:m(()=>[(b(!0),M(z,null,T(t.parameterValue,(w,U)=>(b(),y(R,{class:"parameterValueChip",key:U},{default:m(()=>{var E;return[V(f((E=w.description)!=null?E:w.value),1)]}),_:2},1024))),128))]),_:2},1024)])])):C("",!0),t.selectionType==="TREE"&&t.showOnPanel==="true"&&t.visible?(b(),M("div",Vt,[c("div",Dt,[c("label",{class:P(["kn-material-input-label",{"kn-required-alert":t.mandatory&&(!t.multivalue&&t.parameterValue&&!((H=t.parameterValue[0])!=null&&H.value)||t.multivalue&&((Z=t.parameterValue)==null?void 0:Z.length)===0),"p-text-italic":t.dependsOnParameters||t.lovDependsOnParameters}])},f(t.label)+" "+f(t.mandatory?"*":""),3),A(c("i",{class:"fa fa-eraser parameter-clear-icon kn-cursor-pointer",onClick:w=>e.resetParameterValue(t)},null,8,Pt),[[$,e.$t("documentExecution.main.parameterClearTooltip"),void 0,{left:!0}]])]),c("div",At,[c("i",{class:"pi pi-external-link kn-cursor-pointer p-mr-2",onClick:w=>e.openTreeDialog(t)},null,8,Et),c("div",null,[(b(!0),M(z,null,T(t.parameterValue,(w,U)=>(b(),y(R,{key:U},{default:m(()=>{var E;return[V(f((E=w.description)!=null?E:w.value),1)]}),_:2},1024))),128))])])])):C("",!0)],64)}),128))]),e.parameters&&e.parameters.filterStatus.length>0||e.mode==="qbeView"||e.mode==="workspaceView"||e.mode==="datasetManagement"?(b(),M("div",St,[v(n,{class:"kn-button kn-button--primary",disabled:e.buttonsDisabled,onClick:a[1]||(a[1]=t=>e.$emit("execute",e.qbeParameters,e.parameters))},{default:m(()=>[V(f(e.$t("common.execute")),1)]),_:1},8,["disabled"]),e.mode!=="qbeView"&&e.mode!=="workspaceView"&&e.mode!=="datasetManagement"?(b(),y(n,{key:0,class:"kn-button kn-button--primary p-ml-1",icon:"fa fa-chevron-down",disabled:e.buttonsDisabled,onClick:a[2]||(a[2]=t=>e.toggle(t))},null,8,["disabled"])):C("",!0),v(de,{ref:"executeButtonMenu",model:e.executeMenuItems,popup:!0},null,8,["model"])])):C("",!0),e.popupDialogVisible?(b(),y(le,{key:2,visible:e.popupDialogVisible,selectedParameter:e.selectedParameter,propLoading:e.loading,parameterPopUpData:e.parameterPopUpData,onClose:a[3]||(a[3]=t=>e.popupDialogVisible=!1),onSave:e.onPopupSave},null,8,["visible","selectedParameter","propLoading","parameterPopUpData","onSave"])):C("",!0),e.treeDialogVisible?(b(),y(se,{key:3,visible:e.treeDialogVisible,selectedParameter:e.selectedParameter,formatedParameterValues:e.formatedParameterValues,document:e.document,mode:e.mode,selectedRole:e.role,onClose:e.onTreeClose,onSave:e.onTreeSave},null,8,["visible","selectedParameter","formatedParameterValues","document","mode","selectedRole","onClose","onSave"])):C("",!0),v(ce,{visible:e.parameterSaveDialogVisible,propLoading:e.loading,onClose:a[4]||(a[4]=t=>e.parameterSaveDialogVisible=!1),onSaveViewpoint:e.saveViewpoint},null,8,["visible","propLoading","onSaveViewpoint"]),v(pe,{visible:e.savedParametersDialogVisible,propViewpoints:e.viewpoints,onClose:a[5]||(a[5]=t=>e.savedParametersDialogVisible=!1),onFillForm:e.fillParameterForm,onExecuteViewpoint:e.executeViewpoint,onDeleteViewpoint:e.deleteViewpoint},null,8,["visible","propViewpoints","onFillForm","onExecuteViewpoint","onDeleteViewpoint"])],2)}var jt=N(qa,[["render",$t]]);export{jt as K};
//# sourceMappingURL=KnParameterSidebar-7c5f3d6f.js.map
