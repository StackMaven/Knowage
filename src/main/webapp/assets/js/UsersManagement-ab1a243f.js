import{d as C,ad as R,l as V,n as I,a5 as S,q as N,_ as $,r as n,o as b,c as h,a as t,f as o,w as l,g as w,t as c,A as f,h as y,a4 as L,i as B,x as j,D as O,p as K,b as P,B as D,C as q,v as X,u as Q,X as Y,s as J,z as G,Y as H}from"./index-1e676509.js";import{K as Z,u as E,s as W,c as ee}from"./KnValidatonMessages-ebe48c72.js";import{K as ae}from"./KnHint-6d455703.js";import{s as te}from"./inlinemessage.esm-1edef892.js";import{f as F}from"./filterHelper-a723991a.js";const oe={header:{style:{"text-transform":"capitalize"}},style:{width:"50%"}},re={style:{height:"100vh",width:"100%","margin-bottom":"2em"}};var ne={column:oe,card:re};const ie=C({name:"roles-tab",components:{Card:R,Column:V,DataTable:I,Dropdown:S,Message:N},props:{defRole:Number,rolesList:Array,selected:Array},emits:["changed","setDefaultRole"],data(){return{defaultRole:null,rolesTabDescriptor:ne,selectedRoles:[],emptyOption:{id:null,name:this.$t("managers.usersManagement.emptyRolesOption"),value:""}}},mounted(){},watch:{selected:{handler:function(e){this.selectedRoles=e,this.setDefaultRole(this.defRole)}},defRole:{handler:function(e){this.setDefaultRole(e)}}},methods:{setDefaultRole(e){if(this.selectedRoles){const a=this.selectedRoles.find(r=>r.id===e);this.defaultRole=a||this.emptyOption}},onRowSelect(){this.$emit("changed",this.selectedRoles)},onRowUnselect(){var e;this.$emit("changed",this.selectedRoles),((e=this.selectedRoles)==null?void 0:e.length)<=1&&(this.defaultRole=null,this.onSelectDefaultRole())},onSelectDefaultRole(){this.$emit("setDefaultRole",this.defaultRole?this.defaultRole.id:null)},onSelectAll(){var e;this.$emit("changed",this.selectedRoles),((e=this.selectedRoles)==null?void 0:e.length)<=1&&(this.defaultRole=null,this.onSelectDefaultRole())},selectedRolesWithEmpty(){const e=this.selectedRoles?[...this.selectedRoles]:[];return e.unshift(this.emptyOption),e}}}),le={class:"p-fluid p-jc-center kn-height-full"},de={class:"p-col-12"},se={key:0},ce={class:"p-inputgroup"},be={class:"p-float-label"},pe={for:"defaultRole"};function ue(e,a,r,d,g,A){const k=n("Toolbar"),m=n("Dropdown"),p=n("Message"),u=n("Column"),v=n("DataTable"),s=n("Card");return b(),h("div",le,[t("div",de,[o(s,null,{header:l(()=>[o(k,{class:"kn-toolbar kn-toolbar--secondary"},{start:l(()=>[w(c(e.$t("managers.usersManagement.roles")),1)]),_:1})]),content:l(()=>[e.selectedRoles.length>1?(b(),h("div",se,[t("div",ce,[t("span",be,[o(m,{modelValue:e.defaultRole,"onUpdate:modelValue":a[0]||(a[0]=i=>e.defaultRole=i),showClear:"true",options:e.selectedRolesWithEmpty(),onChange:a[1]||(a[1]=i=>e.onSelectDefaultRole(i)),optionLabel:"name",class:"p-inputtext p-component kn-material-input"},{value:l(i=>{var M;return[t("span",null,c((M=i.value)==null?void 0:M.name),1)]}),option:l(i=>[t("span",null,c(i.option.name),1)]),_:1},8,["modelValue","options"]),t("label",pe,c(e.$t("managers.usersManagement.form.defaultRole")),1)])])])):f("",!0),t("p",null,[e.selectedRoles.length>1?(b(),y(p,{key:0,severity:"info"},{default:l(()=>[w(c(e.$t("managers.usersManagement.defaultRoleInfo")),1)]),_:1})):f("",!0)]),o(v,{value:e.rolesList,onRowSelectAll:e.onRowSelect,onRowUnselectAll:e.onRowUnselect,selection:e.selectedRoles,"onUpdate:selection":a[2]||(a[2]=i=>e.selectedRoles=i),class:"p-datatable-sm kn-table",dataKey:"id",paginator:!0,rows:20,responsiveLayout:"stack",breakpoint:"960px",onRowSelect:e.onRowSelect,onRowUnselect:e.onRowUnselect},{empty:l(()=>[w(c(e.$t("common.info.noDataFound")),1)]),default:l(()=>[o(u,{selectionMode:"multiple",dataKey:"id",style:{width:"50px"}}),o(u,{field:"name",header:e.$t("common.name")},null,8,["header"])]),_:1},8,["value","onRowSelectAll","onRowUnselectAll","selection","onRowSelect","onRowUnselect"])]),_:1})])])}var ke=$(ie,[["render",ue]]);const me=C({name:"roles-tab",components:{InlineMessage:te,Card:R,KnValidationMessages:Z},emits:["unlock","dataChanged"],props:{formValues:Object,disabledUID:Boolean,vobj:Object,formInsert:{type:Boolean,default:!1}},watch:{formValues:{handler:function(e){this.userDetailsForm=e}},disabledUID:{handler:function(e){this.disableUsername=e}}},data(){return{v$:E(),userDetailsForm:{},defaultRole:null,hiddenForm:!0,disableUsername:!0,loading:!1}},created(){this.userDetailsForm=this.formValues,this.disableUsername=this.disabledUID},methods:{unlockUser(){this.$emit("unlock")},onDataChange(e){e.$touch(),this.$emit("dataChanged")}}}),ve={class:"p-fluid p-jc-center kn-height-full"},fe={class:"p-col-12"},ge={key:0,class:"p-grid p-offset-1"},he={class:"p-col-9 p-md-9"},we={class:"p-col-3 p-md-3"},ye={ref:"detail-form",class:"p-m-5"},xe={class:"p-field"},Ae={class:"p-inputgroup"},Me={class:"p-float-label"},Ce={for:"userId"},$e={class:"p-field"},De={class:"p-inputgroup"},Fe={class:"p-float-label"},Ue={for:"fullName"},Re={class:"p-field"},Ve={class:"p-inputgroup"},Ie={class:"p-float-label"},Ee={for:"password"},_e={class:"p-field"},ze={class:"p-inputgroup"},Te={class:"p-float-label"},Se={for:"passwordConfirm"};function Ne(e,a,r,d,g,A){const k=n("Toolbar"),m=n("InlineMessage"),p=n("Button"),u=n("InputText"),v=n("KnValidationMessages"),s=n("Card");return b(),h("div",ve,[t("div",fe,[o(s,null,{header:l(()=>[o(k,{class:"kn-toolbar kn-toolbar--secondary"},{start:l(()=>[w(c(e.$t("managers.usersManagement.detail")),1)]),_:1})]),content:l(()=>[e.userDetailsForm.failedLoginAttempts>=3?(b(),h("div",ge,[t("div",he,[o(m,{severity:"warn"},{default:l(()=>[w(c(e.$t("managers.usersManagement.blockedUserInfo")),1)]),_:1})]),t("div",we,[o(p,{onClick:e.unlockUser,icon:"pi pi-lock-open",label:e.$t("managers.usersManagement.unlockUser")},null,8,["onClick","label"])])])):f("",!0),t("form",ye,[t("div",xe,[t("div",Ae,[t("span",Me,[o(u,{id:"userId",maxlength:"100",type:"text",disabled:!e.formInsert,modelValue:e.userDetailsForm.userId,"onUpdate:modelValue":a[0]||(a[0]=i=>e.userDetailsForm.userId=i),modelModifiers:{trim:!0},onChange:a[1]||(a[1]=i=>e.onDataChange(e.vobj.userDetailsForm.userId)),class:"p-inputtext p-component kn-material-input"},null,8,["disabled","modelValue"]),t("label",Ce,c(e.$t("managers.usersManagement.form.userId"))+" *",1)])]),o(v,{vComp:e.vobj.userDetailsForm.userId,additionalTranslateParams:{fieldName:e.$t("managers.usersManagement.form.userId")}},null,8,["vComp","additionalTranslateParams"])]),t("div",$e,[t("div",De,[t("span",Fe,[o(u,{id:"fullName",maxlength:"250",type:"text",modelValue:e.userDetailsForm.fullName,"onUpdate:modelValue":a[2]||(a[2]=i=>e.userDetailsForm.fullName=i),modelModifiers:{trim:!0},onChange:a[3]||(a[3]=i=>e.onDataChange(e.vobj.userDetailsForm.fullName)),class:"p-inputtext p-component kn-material-input"},null,8,["modelValue"]),t("label",Ue,c(e.$t("managers.usersManagement.fullName"))+" *",1)])]),o(v,{vComp:e.vobj.userDetailsForm.fullName,additionalTranslateParams:{fieldName:e.$t("managers.usersManagement.fullName")}},null,8,["vComp","additionalTranslateParams"])]),t("div",Re,[t("div",Ve,[t("span",Ie,[o(u,{id:"password",type:"password",modelValue:e.userDetailsForm.password,"onUpdate:modelValue":a[4]||(a[4]=i=>e.userDetailsForm.password=i),modelModifiers:{trim:!0},onChange:a[5]||(a[5]=i=>e.onDataChange(e.vobj.userDetailsForm.password)),class:"p-inputtext p-component kn-material-input"},null,8,["modelValue"]),t("label",Ee,c(e.$t("managers.usersManagement.form.password"))+" *",1)])]),o(v,{vComp:e.vobj.userDetailsForm.password,additionalTranslateParams:{fieldName:e.$t("managers.usersManagement.form.password")}},null,8,["vComp","additionalTranslateParams"])]),t("div",_e,[t("div",ze,[t("span",Te,[o(u,{id:"passwordConfirm",type:"password",modelValue:e.userDetailsForm.passwordConfirm,"onUpdate:modelValue":a[6]||(a[6]=i=>e.userDetailsForm.passwordConfirm=i),modelModifiers:{trim:!0},onChange:a[7]||(a[7]=i=>e.onDataChange(e.vobj.userDetailsForm.passwordConfirm)),class:"p-inputtext p-component kn-material-input"},null,8,["modelValue"]),t("label",Se,c(e.$t("managers.usersManagement.form.passwordConfirm"))+" *",1)])]),o(v,{vComp:e.vobj.userDetailsForm.passwordConfirm,additionalTranslateParams:{fieldName:e.$t("managers.usersManagement.form.passwordConfirm")},specificTranslateKeys:{sameAsPassword:"managers.usersManagement.validation.sameAsPassword"}},null,8,["vComp","additionalTranslateParams","specificTranslateKeys"])])],512)]),_:1})])])}var Le=$(me,[["render",Ne]]);const Be=[{field:"userId",header:"User ID"},{field:"fullName",header:"Full Name"}],je=["userId","fullName"],Oe={column:{style:{width:"40%"}},iconColumn:{style:{"text-align":"end"}}},Ke={style:{width:"60vw"}};var Pe={columns:Be,globalFilterFields:je,table:Oe,form:Ke};const qe=C({name:"users-list-box",components:{Listbox:L},emits:["selectedUser","deleteUser"],props:{users:Array,loading:Boolean},watch:{users:{handler:function(e){this.listUsers=e}},loading:{handler:function(e){this.load=e}}},data(){return{listUsers:[],load:!1,selectedUser:null,usersManagementDescriptor:Pe}},methods:{onUserSelect(e){this.$emit("selectedUser",e.value)},async onUserDelete(e){this.$confirm.require({message:this.$t("common.toast.deleteMessage",{item:"user"}),header:this.$t("common.toast.deleteConfirmTitle"),icon:"pi pi-exclamation-triangle",accept:async()=>{this.$emit("deleteUser",e)}})}}}),Xe={class:"kn-list-item","data-test":"list-item"},Qe={class:"kn-list-item-text"},Ye={class:"kn-list-item-text-secondary"};function Je(e,a,r,d,g,A){const k=n("Button"),m=n("Listbox");return e.load?f("",!0):(b(),y(m,{key:0,class:"kn-list--column",options:e.users,filter:!0,filterPlaceholder:e.$t("common.search"),optionLabel:"userId",filterMatchMode:"contains",filterFields:e.usersManagementDescriptor.globalFilterFields,emptyFilterMessage:e.$t("managers.widgetGallery.noResults"),onChange:e.onUserSelect,"data-test":"users-list"},{empty:l(()=>[w(c(e.$t("common.info.noDataFound")),1)]),option:l(p=>[t("div",Xe,[t("div",Qe,[t("span",null,c(p.option.userId),1),t("span",Ye,c(p.option.fullName),1)]),p.option.failedLoginAttempts>=3?(b(),y(k,{key:0,icon:"pi pi-lock",class:"p-button-text p-button-rounded p-button-plain"})):f("",!0),o(k,{icon:"pi pi-trash",class:"p-button-text p-button-rounded p-button-plain",onClick:u=>e.onUserDelete(p.option.id),"data-test":"deleteBtn"},null,8,["onClick"])])]),_:1},8,["options","filterPlaceholder","filterFields","emptyFilterMessage","onChange"]))}var Ge=$(qe,[["render",Je]]);const He=["value"],Ze={width:"60vw"};var We={globalFilterFields:He,style:Ze};const ea=C({name:"lovs-value-dialog",components:{Dialog:B,DataTable:I,Column:V},emits:["closeDialog","saveLovValues"],props:{attribute:{type:Object,required:!0},dialogVisible:Boolean,selection:Object},watch:{attribute(){!this.attribute||(this.loadAttributeValue(),this.selectionMode=this.attribute.multivalue?"multiple":"single",this.selectedLovValues=this.attribute.multivalue?[]:{})}},created(){this.loadAttributeValue()},data(){return{selectedLovValues:[],lovValues:[{id:1,value:"Bla bla"},{id:2,value:"ohoooo"}],userAttributesLovValueDialogDescriptor:We,selectionMode:"multiple",filters:{global:[F],value:{operator:j.AND,constraints:[F]}}}},methods:{async loadAttributeValue(){var e;(e=this.attribute)!=null&&e.lovId&&await this.$http.get(`/knowage/restful-services/2.0/lovs/${this.attribute.lovId}/preview`).then(a=>{this.lovValues=a.data.map((r,d)=>({value:r,id:d})),this.loadSelectedValues()})},loadSelectedValues(){if(this.attribute.multivalue){if(this.selectedLovValues=[],Array.isArray(this.selection)){const e=[];this.selection.forEach(a=>{const r=this.lovValues.findIndex(d=>d.value==a);r>=0&&e.push(this.lovValues[r])}),this.selectedLovValues=e}}else{this.selectedLovValues={};const e=this.lovValues.findIndex(a=>a.value==this.selection);e>=0&&(this.selectedLovValues=this.lovValues[e])}},closeDialog(){this.$emit("closeDialog")},handleSubmit(){this.$emit("saveLovValues",this.selectedLovValues)}}}),aa=e=>(K("data-v-f6abcbc4"),e=e(),P(),e),ta={class:"p-col-8 p-input-icon-left"},oa=aa(()=>t("i",{class:"pi pi-search"},null,-1));function ra(e,a,r,d,g,A){const k=n("Button"),m=n("Toolbar"),p=n("InputText"),u=n("Column"),v=n("DataTable"),s=n("Dialog");return b(),y(s,{visible:e.dialogVisible,modal:!0,class:"kn-dialog--toolbar--primary",closable:!1,style:O(e.userAttributesLovValueDialogDescriptor.style)},{header:l(()=>[o(m,{class:"kn-toolbar kn-toolbar--primary p-col"},{start:l(()=>[w(c(e.attribute.attributeName),1)]),end:l(()=>[o(k,{icon:"pi pi-save",class:"p-button-text p-button-rounded p-button-plain",disabled:e.buttonDisabled,onClick:e.handleSubmit,"data-test":"submit-button"},null,8,["disabled","onClick"]),o(k,{icon:"pi pi-times",class:"p-button-text p-button-rounded p-button-plain",onClick:e.closeDialog},null,8,["onClick"])]),_:1})]),default:l(()=>[o(v,{value:e.lovValues,selection:e.selectedLovValues,"onUpdate:selection":a[1]||(a[1]=i=>e.selectedLovValues=i),dataKey:"id",responsiveLayout:"scroll",filters:e.filters,"onUpdate:filters":a[2]||(a[2]=i=>e.filters=i),filterDisplay:"row",globalFilterFields:e.userAttributesLovValueDialogDescriptor.globalFilterFields},{header:l(()=>[t("div",ta,[oa,o(p,{class:"kn-material-input p-col-12",type:"text",modelValue:e.filters.global.value,"onUpdate:modelValue":a[0]||(a[0]=i=>e.filters.global.value=i),placeholder:e.$t("common.search"),badge:"0","data-test":"search-input"},null,8,["modelValue","placeholder"])])]),default:l(()=>[o(u,{selectionMode:e.selectionMode,dataKey:"id",exportable:!1},null,8,["selectionMode"]),o(u,{field:"value",header:"Value",sortable:!0})]),_:1},8,["value","selection","filters","globalFilterFields"])]),_:1},8,["visible","style"])}var na=$(ea,[["render",ra],["__scopeId","data-v-f6abcbc4"]]);const ia=C({components:{UserAttributesLovValueDialog:na},props:{attributes:{type:Object,required:!0},modelValue:{type:Object,required:!0}},data(){return{selectedAttribute:null,lovDialogVisible:!1,userAttributesForm:{},initialSelection:null}},watch:{modelValue:function(e){this.userAttributesForm={...e}}},methods:{onInputChange(e,a){const r={};r[e.attributeName]=a;const d=this.modelValue?{...this.modelValue}:{};d[e.attributeId]=r,this.$emit("update:modelValue",d),this.$emit("formDirty")},eraseAttribute(e){this.onInputChange(e,"")},openLovValuesDialog(e){var r;this.selectedAttribute=e;let a=null;if(a=this.userAttributesForm[e.attributeId][e.attributeName],this.initialSelection=[],a&&this.selectedAttribute.multivalue)if(this.selectedAttribute.syntax){if(new RegExp("(?<=\\{;\\{)[A-Za-z0-9;_]*(?!\\}\\})").test(a)){const g=a.indexOf("{;{"),A=a.indexOf("}}");this.initialSelection=a.substring(g+3,A).split(";")}}else this.initialSelection=(r=a.split(","))==null?void 0:r.map(d=>d.substring(1,d.length-1));this.lovDialogVisible=!0},onSaveLovValues(e){let a="";this.selectedAttribute&&Array.isArray(e)?this.selectedAttribute.syntax?(a=e.reduce((r,d,g)=>(r+=g>0?";":"",r+=d.value,r),""),a=`{;{${a}}}`):a=e.reduce((r,d,g)=>(r+=g>0?",":"",r+=`'${d.value}'`,r),""):a=e.value,this.selectedAttribute&&this.onInputChange(this.selectedAttribute,a),this.lovDialogVisible=!1,this.selectedAttribute=null}}}),la={class:"p-fluid p-jc-center kn-height-full"},da={class:"p-col-12"},sa={class:"p-m-5"},ca={key:0,class:"p-inputgroup"},ba={class:"p-float-label"},pa=["for"];function ua(e,a,r,d,g,A){const k=n("Toolbar"),m=n("InputText"),p=n("Button"),u=n("Card"),v=n("UserAttributesLovValueDialog");return b(),h(D,null,[t("div",la,[t("div",da,[o(u,{style:{width:"100%","margin-bottom":"2em"}},{header:l(()=>[o(k,{class:"kn-toolbar kn-toolbar--secondary"},{start:l(()=>[w(c(e.$t("managers.usersManagement.attributes")),1)]),_:1})]),content:l(()=>[t("div",sa,[(b(!0),h(D,null,q(e.attributes,s=>(b(),h("div",{class:"p-field",key:s.attributeId},[e.modelValue[s.attributeId]?(b(),h("div",ca,[t("span",ba,[o(m,{disabled:s.lovId,class:"p-inputtext p-component kn-material-input",id:s.attributeId,onInput:i=>e.onInputChange(s,i.target.value),type:"text",modelValue:e.userAttributesForm[s.attributeId][s.attributeName],"onUpdate:modelValue":i=>e.userAttributesForm[s.attributeId][s.attributeName]=i},null,8,["disabled","id","onInput","modelValue","onUpdate:modelValue"]),t("label",{for:s.attributeName},c(s.attributeName),9,pa)]),s.lovId?(b(),y(p,{key:0,icon:"pi pi-pencil",class:"p-button-text p-button-rounded p-button-plain",onClick:i=>e.openLovValuesDialog(s)},null,8,["onClick"])):f("",!0),o(p,{icon:"pi pi-times-circle",class:"p-button-text p-button-rounded p-button-plain",onClick:i=>e.eraseAttribute(s)},null,8,["onClick"])])):f("",!0)]))),128))])]),_:1})])]),o(v,{attribute:e.selectedAttribute,selection:e.initialSelection,dialogVisible:e.lovDialogVisible,onSaveLovValues:e.onSaveLovValues,onCloseDialog:a[0]||(a[0]=s=>{e.lovDialogVisible=!1,e.selectedAttribute=null})},null,8,["attribute","selection","dialogVisible","onSaveLovValues"])],64)}var ka=$(ia,[["render",ua]]);const ma={userDetailsForm:[{fieldName:"userId",validators:[{key:"maxLength",validator:{params:{max:100},type:"maxLength"}},{key:"required"},{key:"regex",validator:{type:"fullnameRegex"}}]},{fieldName:"fullName",validators:[{key:"maxLength",validator:{params:{max:250},type:"maxLength"}},{key:"required"},{key:"regex",validator:{type:"fullnameRegex"}}]},{fieldName:"password",validators:[{key:"minLength",validator:{params:{min:6},type:"minLength"}},{key:"required",validator:{type:"custom-required"}}]},{fieldName:"passwordConfirm",validators:[{key:"required",validator:{type:"custom-required"}},{key:"sameAsPassword",translateBaseKey:"usersManagement.validation",validator:{type:"custom-sameAs"}}]}]};var U={validations:ma};const va=C({name:"user-management",components:{UsersListBox:Ge,TabView:X,TabPanel:Q,KnFabButton:Y,KnHint:ae,RolesTab:ke,DetailFormTab:Le,UserAttributesForm:ka},data(){return{v$:E(),apiUrl:"/knowage/restful-services/2.0/",users:[],roles:[],detailFormTabValidationDescriptor:U,attributes:[],userDetailsForm:{},dirty:!1,formInsert:!0,attributesForm:{},tempAttributes:{},defaultRole:null,hiddenForm:!0,disableUsername:!0,loading:!1,selectedRoles:[]}},validations(){const e={"custom-required":r=>!this.formInsert||r,"custom-sameAs":W(this.userDetailsForm.password)};return{userDetailsForm:ee("userDetailsForm",U.validations.userDetailsForm,e)}},setup(){return{store:J()}},async created(){await this.loadAllUsers(),await this.loadAllRoles(),await this.loadAllAttributes()},methods:{async loadAllUsers(){this.loading=!0,await this.$http.get(this.apiUrl+"users").then(e=>{this.users=e.data}).finally(()=>this.loading=!1)},async loadAllRoles(){this.loading=!0,await this.$http.get(this.apiUrl+"roles").then(e=>{this.roles=e.data}).finally(()=>this.loading=!1)},async loadAllAttributes(){this.loading=!0,await this.$http.get(this.apiUrl+"attributes").then(e=>{this.attributes=e.data}).finally(()=>this.loading=!1)},setDefaultRoleValue(e){this.defaultRole=e,this.dirty=!0},setSelectedRoles(e){this.selectedRoles=e,this.dirty=!0},async showForm(){this.tempAttributes={},this.attributesForm={},this.disableUsername=!1,this.hiddenForm=!1,this.selectedRoles=[],this.userDetailsForm.id=null,this.userDetailsForm.userId="",this.userDetailsForm.fullName="",this.userDetailsForm.failedLoginAttempts=0,this.userDetailsForm.sbiExtUserRoleses=[],this.userDetailsForm.sbiUserAttributeses={},this.formInsert=!0,this.dirty=!1,this.v$.$reset(),this.populateForms(this.userDetailsForm)},formatUserObject(){const e={...this.userDetailsForm};delete e.passwordConfirm,e.defaultRoleId=this.defaultRole;for(var a in this.attributesForm)for(var r in this.attributesForm[a])this.attributesForm[a][r]===""&&delete this.attributesForm[a];return e.sbiUserAttributeses={...this.attributesForm},e.sbiExtUserRoleses=this.selectedRoles?[...this.selectedRoles.map(d=>d.id)]:[],e},onFormDirty(){this.dirty=!0},saveOrUpdateUser(e){const a="/knowage/restful-services/2.0/users";return this.userDetailsForm.id?this.$http.put(`${a}/${e.id}`,e):this.$http.post(a,e)},async saveUser(){if(this.loading=!0,!this.selectedRoles||this.selectedRoles.length==0)this.store.setError({title:this.userDetailsForm.id?this.$t("common.toast.updateTitle"):this.$t("managers.usersManagement.info.createTitle"),msg:this.$t("managers.usersManagement.error.noRolesSelected")}),this.loading=!1;else{const e=this.formatUserObject();this.saveOrUpdateUser(e).then(a=>{this.afterSaveOrUpdate(a)}).catch(a=>{this.store.setError({title:a.title,msg:a.msg})}).finally(()=>{this.loading=!1})}},async afterSaveOrUpdate(e){this.dirty=!1,await this.loadAllUsers(),this.formInsert=!1;const a=e.data,r=this.users.find(d=>d.id===a);r&&this.onUserSelect(r),this.store.setInfo({title:this.userDetailsForm.id?this.$t("common.toast.updateTitle"):this.$t("managers.usersManagement.info.createTitle"),msg:this.userDetailsForm.id?this.$t("common.toast.updateSuccess"):this.$t("managers.usersManagement.info.createMessage")})},onUserDelete(e){this.loading=!0,this.$http.delete(`/knowage/restful-services/2.0/users/${e}`).then(()=>{this.loadAllUsers(),this.store.setInfo({title:this.$t("managers.usersManagement.info.deleteTitle"),msg:this.$t("managers.usersManagement.info.deleteMessage")})}).catch(a=>{this.store.setError({title:a.title,msg:a.msg})}).finally(()=>{this.hiddenForm=!0,this.loading=!1})},async unlockUser(){this.userDetailsForm.failedLoginAttempts=0,await this.saveUser()},async onUserSelect(e){this.formInsert=!1,this.dirty?this.$confirm.require({message:this.$t("common.toast.unsavedChangesMessage"),header:this.$t("common.toast.unsavedChangesHeader"),icon:"pi pi-exclamation-triangle",accept:()=>{this.populateForms(e),this.dirty=!1},reject:()=>{}}):this.populateForms(e)},populateForms(e){this.dirty=!1,this.attributesForm={},this.hiddenForm=!1,this.disableUsername=!0,this.defaultRole=e.defaultRoleId,this.selectedRoles=this.getSelectedUserRoles(e.sbiExtUserRoleses),this.userDetailsForm={...e},this.populateAttributesForm(e.sbiUserAttributeses)},populateAttributesForm(e){const a={};this.attributes.forEach(r=>{let d={};d[r.attributeName]=e&&e[r.attributeId]?e[r.attributeId][r.attributeName]:null,a[r.attributeId]=d}),this.attributesForm={...a}},getSelectedUserRoles(e){return this.roles?[...this.roles.filter(a=>e&&e.find(r=>a.id===r))]:[]},closeForm(){this.dirty?this.$confirm.require({message:this.$t("common.toast.unsavedChangesMessage"),header:this.$t("common.toast.unsavedChangesHeader"),icon:"pi pi-exclamation-triangle",accept:()=>{this.hiddenForm=!0,this.dirty=!1},reject:()=>{}}):this.hiddenForm=!0},onDataChange(){this.dirty=!0}}}),fa={class:"kn-page kn-width-full-with-menu"},ga={class:"kn-page-content p-grid p-m-0"},ha={class:"kn-list--column p-col-4 p-sm-4 p-md-3 p-p-0"},wa={key:1},ya={class:"p-col-8 p-sm-8 p-md-9 p-p-0 p-m-0 kn-page"},xa={class:"kn-page-content"};function Aa(e,a,r,d,g,A){const k=n("KnFabButton"),m=n("Toolbar"),p=n("ProgressBar"),u=n("UsersListBox"),v=n("KnHint"),s=n("Button"),i=n("DetailFormTab"),M=n("TabPanel"),_=n("RolesTab"),z=n("UserAttributesForm"),T=n("TabView");return b(),h("div",fa,[t("div",ga,[t("div",ha,[o(m,{class:"kn-toolbar kn-toolbar--primary"},{start:l(()=>[w(c(e.$t("managers.usersManagement.title")),1)]),end:l(()=>[o(k,{icon:"fas fa-plus",onClick:a[0]||(a[0]=x=>e.showForm()),"data-test":"open-form-button"})]),_:1}),e.loading?(b(),y(p,{key:0,mode:"indeterminate",class:"kn-progress-bar","data-test":"progress-bar"})):f("",!0),e.loading?f("",!0):(b(),h("div",wa,[o(u,{users:e.users,loading:e.loading,onSelectedUser:e.onUserSelect,onDeleteUser:e.onUserDelete,"data-test":"users-list"},null,8,["users","loading","onSelectedUser","onDeleteUser"])]))]),e.hiddenForm?(b(),y(v,{key:0,title:"managers.usersManagement.title",hint:"managers.usersManagement.hint"},null,8,["title","hint"])):f("",!0),G(t("div",ya,[o(m,{class:"kn-toolbar kn-toolbar--secondary"},{start:l(()=>[w(c(e.userDetailsForm.userId),1)]),end:l(()=>[o(s,{icon:"pi pi-save",class:"p-button-text p-button-rounded p-button-plain",disabled:e.v$.userDetailsForm.$invalid,onClick:e.saveUser},null,8,["disabled","onClick"]),o(s,{class:"p-button-text p-button-rounded p-button-plain",icon:"pi pi-times",onClick:e.closeForm},null,8,["onClick"])]),_:1}),e.loading?(b(),y(p,{key:0,mode:"indeterminate",class:"kn-progress-bar","data-test":"progress-bar"})):f("",!0),t("div",xa,[o(T,{class:"tabview-custom kn-tab",ref:"usersFormTab"},{default:l(()=>[o(M,null,{header:l(()=>[t("span",null,c(e.$t("managers.usersManagement.detail")),1)]),default:l(()=>[e.hiddenForm?f("",!0):(b(),y(i,{key:0,formInsert:e.formInsert,formValues:e.userDetailsForm,vobj:e.v$,disabledUID:e.disableUsername,onDataChanged:e.onDataChange,onUnlock:a[1]||(a[1]=x=>e.unlockUser(x))},null,8,["formInsert","formValues","vobj","disabledUID","onDataChanged"]))]),_:1}),o(M,null,{header:l(()=>[t("span",null,c(e.$t("managers.usersManagement.roles")),1)]),default:l(()=>[o(_,{defRole:e.defaultRole,rolesList:e.roles,selected:e.selectedRoles,onChanged:a[2]||(a[2]=x=>e.setSelectedRoles(x)),onSetDefaultRole:a[3]||(a[3]=x=>e.setDefaultRoleValue(x))},null,8,["defRole","rolesList","selected"])]),_:1}),o(M,null,{header:l(()=>[t("span",null,c(e.$t("managers.usersManagement.attributes")),1)]),default:l(()=>[o(z,{attributes:e.attributes,modelValue:e.attributesForm,"onUpdate:modelValue":a[4]||(a[4]=x=>e.attributesForm=x),onFormDirty:e.onFormDirty},null,8,["attributes","modelValue","onFormDirty"])]),_:1})]),_:1},512)])],512),[[H,!e.hiddenForm]])])])}var Ua=$(va,[["render",Aa],["__scopeId","data-v-11403e9e"]]);export{Ua as default};
//# sourceMappingURL=UsersManagement-ab1a243f.js.map
