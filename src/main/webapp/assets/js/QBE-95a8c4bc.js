import{aZ as Ge,a_ as Ye,a6 as L,a1 as R,d as $,i as B,a$ as Xe,b0 as Je,b1 as Ke,b2 as We,b3 as he,a7 as W,b4 as Ze,b5 as ee,b6 as et,b7 as be,b8 as tt,_ as V,r as k,o as p,h as y,w as c,f as i,g as D,t as m,a as s,A as C,D as O,Z as fe,a2 as S,L as F,P as ot,Q as rt,U as at,S as nt,R as it,y as j,c as f,B as z,C as N,G as I,z as T,a0 as lt,K as Ve,J as Ie,T as st,l as H,n as G,x as dt,a5 as Y,Y as U,X as Ce,q as Me,s as re,b9 as ye,V as X,ad as ue,v as ct,u as pt,aJ as bt,W as ze,aG as kt,aj as ut,a8 as mt}from"./index-1e676509.js";import{s as Fe}from"./chip.esm-057ba1f1.js";import{s as Ne}from"./inputswitch.esm-80317a38.js";import{s as Qe}from"./calendar.esm-60a451ba.js";import{s as gt}from"./chips.esm-693c3c01.js";import{f as ht}from"./filterHelper-a723991a.js";import{s as me}from"./checkbox.esm-fa6c8259.js";import{s as ft}from"./menu.esm-6bee86d0.js";import{K as Le,u as Ae,c as Ue}from"./KnValidatonMessages-ebe48c72.js";import{s as vt}from"./multiselect.esm-ce4000f7.js";import{k as yt}from"./KnCronDescriptor-98645843.js";import{s as Be}from"./contextmenu.esm-4301c9fe.js";import{K as wt}from"./KnParameterSidebar-7c5f3d6f.js";import{K as xt}from"./KnCalculatedField-ab0b2f81.js";function Ct(e,t,o,r,a,n,l,u){var d;if(!!a){for(let g=0;g<e.length;g++){const b=e[g],E=n.filters.findIndex(w=>w.filterId===b.filterId);E!==-1?n.filters[E]=b:n.filters.push(b)}At(e,t,r,a,n),Mt(n.filters,r,a,n),((d=n.expression.childNodes)==null?void 0:d.length)===0&&(n.expression={}),a.pars=o?[...o]:[],l&&u(!1)}}function Mt(e,t,o,r){if(!!o){for(let l of e){var a={value:"$F{"+l.filterId+"}",childNodes:[],details:{leftOperandAlias:l.leftOperandAlias,operator:l.operator,entity:l.entity,rightOperandValue:l.rightOperandValue.join(", ")},type:"NODE_CONST"},n=Ge(t,a.value);Ye(t,a,n)}r.expression=t}}function At(e,t,o,r,a){if(!!r)for(let n=a.filters.length-1;n>=0;n--){const l=a.filters[n];l.leftOperandValue===t.id&&e.findIndex(d=>d.filterId===l.filterId)===-1&&a.filters.splice(n,1)}}function Dt(e){var t;(t=e==null?void 0:e.filterStatus)==null||t.forEach(o=>{var r,a,n,l,u;if(o.parameterValue=o.multivalue?[]:[{value:"",description:""}],((r=o.driverDefaultValue)==null?void 0:r.length)>0){let d="_col0",g="col1";(a=o.metadata)!=null&&a.colsMap&&(d=Object.keys((n=o.metadata)==null?void 0:n.colsMap).find(b=>o.metadata.colsMap[b]===o.metadata.valueColumn),g=Object.keys((l=o.metadata)==null?void 0:l.colsMap).find(b=>o.metadata.colsMap[b]===o.metadata.descriptionColumn)),o.parameterValue=o.driverDefaultValue.map(b=>{var E,w;return{value:(E=b.value)!=null?E:b[d],description:(w=b.desc)!=null?w:b[g]}}),o.type==="DATE"&&!o.selectionType&&o.valueSelection==="man_in"&&o.showOnPanel==="true"&&(o.parameterValue[0].value=L((u=o.parameterValue[0].description)==null?void 0:u.split("#")[0]).toDate())}o.data&&(o.data=o.data.map(d=>Et(o,d)),o.data.length===1&&(o.parameterValue=[...o.data])),(o.selectionType==="COMBOBOX"||o.selectionType==="LIST")&&o.multivalue&&o.mandatory&&o.data.length===1&&(o.showOnPanel="false"),o.parameterValue||(o.parameterValue=[{value:"",description:""}]),o.parameterValue[0]&&!o.parameterValue[0].description&&(o.parameterValue[0].description=o.parameterDescription?o.parameterDescription[0]:"")})}function Et(e,t){const o=e.metadata.valueColumn,r=e.metadata.descriptionColumn,a=Object.keys(e.metadata.colsMap).find(l=>e.metadata.colsMap[l]===o),n=Object.keys(e.metadata.colsMap).find(l=>e.metadata.colsMap[l]===r);return{value:a?t[a]:"",description:n?t[n]:""}}function Tt(e,t,o,r){if(!!t){for(let a=0;a<e.length;a++){const n=e[a],l=o.havings.findIndex(u=>u.filterId===n.filterId);l!==-1?o.havings[l]=n:o.havings.push(n)}St(e,t,o,r)}}function St(e,t,o,r){if(!!t)for(let a=o.havings.length-1;a>=0;a--){const n=o.havings[a];n.leftOperandValue===r.id&&e.findIndex(u=>u.filterId===n.filterId)===-1&&o.havings.splice(a,1)}}function Ot(e,t){var o={id:t.attributes.type==="inLineCalculatedField"?t.attributes.formState:t.id,alias:t.attributes.field,type:t.attributes.type==="inLineCalculatedField"?"inline.calculated.field":"datamartField",fieldType:t.attributes.iconCls,entity:t.attributes.entity,field:t.attributes.field,funct:Vt(t),color:t.color,group:It(t),order:"NONE",include:!0,inUse:t.hasOwnProperty("inUse")?t.inUse:!0,visible:!0,iconCls:t.iconCls,dataType:t.dataType,format:t.format,longDescription:t.attributes.longDescription,distinct:e.distinct,leaf:t.leaf,originalId:t.id,isSpatial:t.isSpatial,uniqueID:R({length:4,type:"base64"})};return t.hasOwnProperty("id")||(o.id=t.alias,o.alias=t.text,o.field=t.text,o.temporal=t.temporal),o}function $t(e){var t={uniqueID:e.uniqueID,column:e.alias,fieldAlias:e.field,Type:e.dataType,fieldType:e.iconCls.toUpperCase(),decrypt:!1,personal:!1,subjectid:!1};return t}function Vt(e){return we(e,"measure")&&e.aggtype?e.aggtype:we(e,"measure")?"SUM":"NONE"}function It(e){return we(e,"attribute")&&!qt(e,"com.vividsolutions.jts.geom.Geometry")}function qt(e,t){return e.dataType==t}function we(e,t){return e.iconCls==t||zt(e,t)}function zt(e,t){return Ft(e)&&e.attributes.formState.nature===t}function Ft(e){return e.attributes.type==="inLineCalculatedField"}function Nt(e,t){let o={},r={};return r.alias=e.alias,r.type=e.type,r.nature=e.nature,r.expressionSimple=e.expression,r.expression=Pe(e.expression,t),r.type==="DATE"&&(r.format=e.format),o.id=r,o.alias=r.alias,o.nature=r.nature,o.type="inline.calculated.field",o.distinct=!1,r.type==="DATE"&&(o.format=e.format),o.fieldType=e.nature.toLowerCase(),o.entity=e.alias,o.field=e.alias,o.funct=e.nature=="MEASURE"?"SUM":"",o.group=e.nature=="ATTRIBUTE",o.order="NONE",o.include=!0,o.inUse=!0,o.visible=!0,o.id.expression=P(o.id.expression),o.id.expressionSimple=P(o.id.expressionSimple),o.formula=P(r.expression),o.expression=P(r.expressionSimple),o.longDescription=P(r.alias+" : "+r.alias),o}function Qt(e,t,o){let r={},a={};return a.alias=t.alias,a.type=t.type,a.nature=t.nature,a.expressionSimple=t.expression,a.expression=Pe(t.expression,o),a.type==="DATE"&&(a.format=t.format),r.id=a,r.alias=a.alias,r.nature=a.nature,r.type="inline.calculated.field",r.distinct=!1,a.type==="DATE"&&(r.format=t.format),r.fieldType=t.nature.toLowerCase(),r.entity=t.alias,r.field=t.alias,r.group=e.group,r.order=e.order,r.funct=e.funct,r.visible=e.visible,r.inUse=e.inUse,r.include=!0,r.id.expression=P(r.id.expression),r.id.expressionSimple=P(r.id.expressionSimple),r.formula=P(a.expression),r.expression=P(a.expressionSimple),r.longDescription=P(a.alias+" : "+a.alias),r.uniqueID=e.uniqueID,r.iconCls=e.iconCls,r}function Pe(e,t){var o=/(\$F\{[a-zA-Z0-9\s\->]*\}){1}/g,r=/(\$F\{[a-zA-Z0-9\s\->]*\}){1}/,a=/(\$F\{)([a-zA-Z0-9\s\->]*)(\}){1}/;if(e.match(o))var n=e.match(o).length;for(var l=0;l<n;l++){var u="",d=a.exec(e);t.forEach(g=>{if(g.alias==d[2]){u=g.id;return}}),e=e.replace(r,u)}return e}function P(e){return e=e.replaceAll(/\u00a0/g," "),e}const Lt=$({name:"qbe-advanced-filter-dialog",components:{Dialog:B,QBEOperator:Xe},props:{visible:{type:Boolean},query:{type:Object}},emits:["save","close"],data(){return{QBEAdvancedFilterDialogDescriptor:Je,expression:null,filters:[],root:{},selectedCount:0,singleGroupSelected:!1,getSelectedCount:Ke,isSingleGroupSelected:We,sel:he}},watch:{query:{handler(){this.loadData()},deep:!0},visible(e){e&&this.loadData()}},created(){this.loadData()},methods:{loadData(){var e;this.query&&(this.expression=this.query.expression?W((e=this.query)==null?void 0:e.expression):{},this.filters=this.query.filters?[...this.query.filters]:[]),Ze(W(this.expression)),this.root=ee()},onSelectedChanged(){this.selectedCount=this.getSelectedCount(),this.singleGroupSelected=this.isSingleGroupSelected()},group(){et(ee(),he()),be(),this.root=ee()},ungroup(){tt(ee(),he()[0]),be(),this.root=ee()},onTreeUpdated(){this.root=ee()},closeDialog(){be(),this.selectedCount=this.getSelectedCount(),this.singleGroupSelected=this.isSingleGroupSelected(),this.$emit("close")},save(){this.$emit("save",W(this.root)),be(),this.selectedCount=this.getSelectedCount(),this.singleGroupSelected=this.isSingleGroupSelected()}}}),Ut={class:"p-d-flex p-flex-row"};function Bt(e,t,o,r,a,n){const l=k("Toolbar"),u=k("Button"),d=k("QBEOperator"),g=k("Dialog");return p(),y(g,{id:"qbe-advanced-filter-dialog",class:"p-fluid kn-dialog--toolbar--primary",style:O(e.QBEAdvancedFilterDialogDescriptor.dialog.style),visible:e.visible,modal:!0,closable:!1},{header:c(()=>[i(l,{class:"kn-toolbar kn-toolbar--primary p-p-0 p-m-2 p-col-12"},{start:c(()=>[D(m(e.$t("qbe.advancedFilters.advancedFilterVisualisation")),1)]),_:1})]),footer:c(()=>[i(u,{class:"kn-button kn-button--primary",onClick:e.closeDialog},{default:c(()=>[D(m(e.$t("common.cancel")),1)]),_:1},8,["onClick"]),i(u,{class:"kn-button kn-button--primary",onClick:e.save},{default:c(()=>[D(m(e.$t("common.save")),1)]),_:1},8,["onClick"])]),default:c(()=>[s("div",Ut,[i(u,{class:"kn-button kn-button--primary qbe-advanced-filter-button p-m-2",disabled:e.selectedCount<2,onClick:e.group},{default:c(()=>[D(m(e.$t("qbe.advancedFilters.group")),1)]),_:1},8,["disabled","onClick"]),i(u,{class:"kn-button kn-button--primary qbe-advanced-filter-button p-m-2",disabled:!e.singleGroupSelected,onClick:e.ungroup},{default:c(()=>[D(m(e.$t("qbe.advancedFilters.ungroup")),1)]),_:1},8,["disabled","onClick"])]),e.expression?(p(),y(d,{key:0,propNode:e.root,onSelectedChanged:e.onSelectedChanged,onTreeUpdated:e.onTreeUpdated},null,8,["propNode","onSelectedChanged","onTreeUpdated"])):C("",!0)]),_:1},8,["style","visible"])}var Pt=V(Lt,[["render",Bt]]),Re={name:"CascadeSelectSub",emits:["option-change"],props:{selectId:String,focusedOptionId:String,options:Array,optionLabel:String,optionValue:String,optionDisabled:null,optionGroupLabel:String,optionGroupChildren:Array,activeOptionPath:Array,level:Number,templates:null},mounted(){S.isNotEmpty(this.parentKey)&&this.position()},methods:{getOptionId(e){return`${this.selectId}_${e.key}`},getOptionLabel(e){return this.optionLabel?S.resolveFieldData(e.option,this.optionLabel):e.option},getOptionValue(e){return this.optionValue?S.resolveFieldData(e.option,this.optionValue):e.option},isOptionDisabled(e){return this.optionDisabled?S.resolveFieldData(e.option,this.optionDisabled):!1},getOptionGroupLabel(e){return this.optionGroupLabel?S.resolveFieldData(e.option,this.optionGroupLabel):null},getOptionGroupChildren(e){return e.children},isOptionGroup(e){return S.isNotEmpty(e.children)},isOptionSelected(e){return!this.isOptionGroup(e)&&this.isOptionActive(e)},isOptionActive(e){return this.activeOptionPath.some(t=>t.key===e.key)},isOptionFocused(e){return this.focusedOptionId===this.getOptionId(e)},getOptionLabelToRender(e){return this.isOptionGroup(e)?this.getOptionGroupLabel(e):this.getOptionLabel(e)},onOptionClick(e,t){this.$emit("option-change",{originalEvent:e,processedOption:t,isFocus:!0})},onOptionChange(e){this.$emit("option-change",e)},position(){const e=this.$el.parentElement,t=F.getOffset(e),o=F.getViewport(),r=this.$el.offsetParent?this.$el.offsetWidth:F.getHiddenElementOuterWidth(this.$el),a=F.getOuterWidth(e.children[0]);parseInt(t.left,10)+a+r>o.width-F.calculateScrollbarWidth()&&(this.$el.style.left="-100%")}},directives:{ripple:it}};const Rt={class:"p-cascadeselect-panel p-cascadeselect-items"},_t=["id","aria-label","aria-selected","aria-expanded","aria-setsize","aria-posinset","aria-level"],jt=["onClick"],Ht={key:1,class:"p-cascadeselect-item-text"},Gt={key:2,class:"p-cascadeselect-group-icon pi pi-angle-right","aria-hidden":"true"};function Yt(e,t,o,r,a,n){const l=k("CascadeSelectSub",!0),u=j("ripple");return p(),f("ul",Rt,[(p(!0),f(z,null,N(o.options,(d,g)=>(p(),f("li",{key:n.getOptionLabelToRender(d),id:n.getOptionId(d),class:I(["p-cascadeselect-item",{"p-cascadeselect-item-group":n.isOptionGroup(d),"p-cascadeselect-item-active p-highlight":n.isOptionActive(d),"p-focus":n.isOptionFocused(d),"p-disabled":n.isOptionDisabled(d)}]),role:"treeitem","aria-label":n.getOptionLabelToRender(d),"aria-selected":n.isOptionGroup(d)?void 0:n.isOptionSelected(d),"aria-expanded":n.isOptionGroup(d)?n.isOptionActive(d):void 0,"aria-setsize":d.length,"aria-posinset":g+1,"aria-level":o.level+1},[T((p(),f("div",{class:"p-cascadeselect-item-content",onClick:b=>n.onOptionClick(b,d)},[o.templates.option?(p(),y(lt(o.templates.option),{key:0,option:d.option},null,8,["option"])):(p(),f("span",Ht,m(n.getOptionLabelToRender(d)),1)),n.isOptionGroup(d)?(p(),f("span",Gt)):C("",!0)],8,jt)),[[u]]),n.isOptionGroup(d)&&n.isOptionActive(d)?(p(),y(l,{key:0,role:"group",class:"p-cascadeselect-sublist",selectId:o.selectId,focusedOptionId:o.focusedOptionId,options:n.getOptionGroupChildren(d),activeOptionPath:o.activeOptionPath,level:o.level+1,templates:o.templates,optionLabel:o.optionLabel,optionValue:o.optionValue,optionDisabled:o.optionDisabled,optionGroupLabel:o.optionGroupLabel,optionGroupChildren:o.optionGroupChildren,onOptionChange:n.onOptionChange},null,8,["selectId","focusedOptionId","options","activeOptionPath","level","templates","optionLabel","optionValue","optionDisabled","optionGroupLabel","optionGroupChildren","onOptionChange"])):C("",!0)],10,_t))),128))])}Re.render=Yt;var _e={name:"CascadeSelect",emits:["update:modelValue","change","focus","blur","click","group-change","before-show","before-hide","hide","show"],props:{modelValue:null,options:Array,optionLabel:null,optionValue:null,optionDisabled:null,optionGroupLabel:null,optionGroupChildren:null,placeholder:String,disabled:Boolean,dataKey:null,inputId:{type:String,default:null},inputClass:{type:String,default:null},inputStyle:{type:null,default:null},inputProps:{type:null,default:null},panelClass:{type:String,default:null},panelStyle:{type:null,default:null},panelProps:{type:null,default:null},appendTo:{type:String,default:"body"},loading:{type:Boolean,default:!1},loadingIcon:{type:String,default:"pi pi-spinner pi-spin"},autoOptionFocus:{type:Boolean,default:!0},selectOnFocus:{type:Boolean,default:!1},searchLocale:{type:String,default:void 0},searchMessage:{type:String,default:null},selectionMessage:{type:String,default:null},emptySelectionMessage:{type:String,default:null},emptySearchMessage:{type:String,default:null},emptyMessage:{type:String,default:null},tabindex:{type:Number,default:0},"aria-labelledby":{type:String,default:null},"aria-label":{type:String,default:null}},outsideClickListener:null,scrollHandler:null,resizeListener:null,overlay:null,searchTimeout:null,searchValue:null,focusOnHover:!1,data(){return{focused:!1,focusedOptionInfo:{index:-1,level:0,parentKey:""},activeOptionPath:[],overlayVisible:!1,dirty:!1}},watch:{options(){this.autoUpdateModel()}},mounted(){this.autoUpdateModel()},beforeUnmount(){this.unbindOutsideClickListener(),this.unbindResizeListener(),this.scrollHandler&&(this.scrollHandler.destroy(),this.scrollHandler=null),this.overlay&&(fe.clear(this.overlay),this.overlay=null)},methods:{getOptionLabel(e){return this.optionLabel?S.resolveFieldData(e,this.optionLabel):e},getOptionValue(e){return this.optionValue?S.resolveFieldData(e,this.optionValue):e},isOptionDisabled(e){return this.optionDisabled?S.resolveFieldData(e,this.optionDisabled):!1},getOptionGroupLabel(e){return this.optionGroupLabel?S.resolveFieldData(e,this.optionGroupLabel):null},getOptionGroupChildren(e,t){return S.resolveFieldData(e,this.optionGroupChildren[t])},isOptionGroup(e,t){return Object.prototype.hasOwnProperty.call(e,this.optionGroupChildren[t])},getProccessedOptionLabel(e){return this.isProccessedOptionGroup(e)?this.getOptionGroupLabel(e.option,e.level):this.getOptionLabel(e.option)},isProccessedOptionGroup(e){return S.isNotEmpty(e.children)},show(e){if(this.$emit("before-show"),this.overlayVisible=!0,this.activeOptionPath=this.hasSelectedOption?this.findOptionPathByValue(this.modelValue):this.activeOptionPath,this.hasSelectedOption&&S.isNotEmpty(this.activeOptionPath)){const t=this.activeOptionPath[this.activeOptionPath.length-1];this.focusedOptionInfo={index:this.autoOptionFocus?t.index:-1,level:t.level,parentKey:t.parentKey}}else this.focusedOptionInfo={index:this.autoOptionFocus?this.findFirstFocusedOptionIndex():-1,level:0,parentKey:""};e&&F.focus(this.$refs.focusInput)},hide(e){const t=()=>{this.$emit("before-hide"),this.overlayVisible=!1,this.activeOptionPath=[],this.focusedOptionInfo={index:-1,level:0,parentKey:""},e&&F.focus(this.$refs.focusInput)};setTimeout(()=>{t()},0)},onFocus(e){this.focused=!0,this.$emit("focus",e)},onBlur(e){this.focused=!1,this.focusedOptionInfo={index:-1,level:0,parentKey:""},this.searchValue="",this.$emit("blur",e)},onKeyDown(e){if(this.disabled||this.loading){e.preventDefault();return}const t=e.metaKey||e.ctrlKey;switch(e.code){case"ArrowDown":this.onArrowDownKey(e);break;case"ArrowUp":this.onArrowUpKey(e);break;case"ArrowLeft":this.onArrowLeftKey(e);break;case"ArrowRight":this.onArrowRightKey(e);break;case"Home":this.onHomeKey(e);break;case"End":this.onEndKey(e);break;case"Space":this.onSpaceKey(e);break;case"Enter":this.onEnterKey(e);break;case"Escape":this.onEscapeKey(e);break;case"Tab":this.onTabKey(e);break;case"PageDown":case"PageUp":case"Backspace":case"ShiftLeft":case"ShiftRight":break;default:!t&&S.isPrintableCharacter(e.key)&&(!this.overlayVisible&&this.show(),this.searchOptions(e,e.key));break}},onOptionChange(e){const{originalEvent:t,processedOption:o,isFocus:r,isHide:a}=e;if(S.isEmpty(o))return;const{index:n,level:l,parentKey:u,children:d}=o,g=S.isNotEmpty(d),b=this.activeOptionPath.filter(E=>E.parentKey!==u);b.push(o),this.focusedOptionInfo={index:n,level:l,parentKey:u},this.activeOptionPath=b,g?this.onOptionGroupSelect(t,o):this.onOptionSelect(t,o,a),r&&F.focus(this.$refs.focusInput)},onOptionSelect(e,t,o=!0){const r=this.getOptionValue(t.option);this.activeOptionPath.forEach(a=>a.selected=!0),this.updateModel(e,r),o&&this.hide(!0)},onOptionGroupSelect(e,t){this.dirty=!0,this.$emit("group-change",{originalEvent:e,value:t.option})},onContainerClick(e){this.disabled||this.loading||((!this.overlay||!this.overlay.contains(e.target))&&(this.overlayVisible?this.hide():this.show(),F.focus(this.$refs.focusInput)),this.$emit("click",e))},onOverlayClick(e){ot.emit("overlay-click",{originalEvent:e,target:this.$el})},onOverlayKeyDown(e){switch(e.code){case"Escape":this.onEscapeKey(e);break}},onArrowDownKey(e){const t=this.focusedOptionInfo.index!==-1?this.findNextOptionIndex(this.focusedOptionInfo.index):this.findFirstFocusedOptionIndex();this.changeFocusedOptionIndex(e,t),!this.overlayVisible&&this.show(),e.preventDefault()},onArrowUpKey(e){if(e.altKey){if(this.focusedOptionInfo.index!==-1){const t=this.visibleOptions[this.focusedOptionInfo.index];!this.isProccessedOptionGroup(t)&&this.onOptionChange({originalEvent:e,processedOption:t})}this.overlayVisible&&this.hide(),e.preventDefault()}else{const t=this.focusedOptionInfo.index!==-1?this.findPrevOptionIndex(this.focusedOptionInfo.index):this.findLastFocusedOptionIndex();this.changeFocusedOptionIndex(e,t),!this.overlayVisible&&this.show(),e.preventDefault()}},onArrowLeftKey(e){if(this.overlayVisible){const t=this.visibleOptions[this.focusedOptionInfo.index],o=this.activeOptionPath.find(n=>n.key===t.parentKey),r=this.focusedOptionInfo.parentKey===""||o&&o.key===this.focusedOptionInfo.parentKey,a=S.isEmpty(t.parent);r&&(this.activeOptionPath=this.activeOptionPath.filter(n=>n.parentKey!==this.focusedOptionInfo.parentKey)),a||(this.focusedOptionInfo={index:-1,parentKey:o?o.parentKey:""},this.searchValue="",this.onArrowDownKey(e)),e.preventDefault()}},onArrowRightKey(e){if(this.overlayVisible){const t=this.visibleOptions[this.focusedOptionInfo.index];this.isProccessedOptionGroup(t)&&(this.activeOptionPath.some(a=>t.key===a.key)?(this.focusedOptionInfo={index:-1,parentKey:t.key},this.searchValue="",this.onArrowDownKey(e)):this.onOptionChange({originalEvent:e,processedOption:t})),e.preventDefault()}},onHomeKey(e){this.changeFocusedOptionIndex(e,this.findFirstOptionIndex()),!this.overlayVisible&&this.show(),e.preventDefault()},onEndKey(e){this.changeFocusedOptionIndex(e,this.findLastOptionIndex()),!this.overlayVisible&&this.show(),e.preventDefault()},onEnterKey(e){if(!this.overlayVisible)this.onArrowDownKey(e);else if(this.focusedOptionInfo.index!==-1){const t=this.visibleOptions[this.focusedOptionInfo.index],o=this.isProccessedOptionGroup(t);this.onOptionChange({originalEvent:e,processedOption:t}),!o&&this.hide()}e.preventDefault()},onSpaceKey(e){this.onEnterKey(e)},onEscapeKey(e){this.overlayVisible&&this.hide(!0),e.preventDefault()},onTabKey(e){if(this.focusedOptionInfo.index!==-1){const t=this.visibleOptions[this.focusedOptionInfo.index];!this.isProccessedOptionGroup(t)&&this.onOptionChange({originalEvent:e,processedOption:t})}this.overlayVisible&&this.hide()},onOverlayEnter(e){fe.set("overlay",e,this.$primevue.config.zIndex.overlay),this.alignOverlay(),this.scrollInView()},onOverlayAfterEnter(){this.bindOutsideClickListener(),this.bindScrollListener(),this.bindResizeListener(),this.$emit("show")},onOverlayLeave(){this.unbindOutsideClickListener(),this.unbindScrollListener(),this.unbindResizeListener(),this.$emit("hide"),this.overlay=null,this.dirty=!1},onOverlayAfterLeave(e){fe.clear(e)},alignOverlay(){this.appendTo==="self"?F.relativePosition(this.overlay,this.$el):(this.overlay.style.minWidth=F.getOuterWidth(this.$el)+"px",F.absolutePosition(this.overlay,this.$el))},bindOutsideClickListener(){this.outsideClickListener||(this.outsideClickListener=e=>{this.overlayVisible&&this.overlay&&!this.$el.contains(e.target)&&!this.overlay.contains(e.target)&&this.hide()},document.addEventListener("click",this.outsideClickListener))},unbindOutsideClickListener(){this.outsideClickListener&&(document.removeEventListener("click",this.outsideClickListener),this.outsideClickListener=null)},bindScrollListener(){this.scrollHandler||(this.scrollHandler=new rt(this.$refs.container,()=>{this.overlayVisible&&this.hide()})),this.scrollHandler.bindScrollListener()},unbindScrollListener(){this.scrollHandler&&this.scrollHandler.unbindScrollListener()},bindResizeListener(){this.resizeListener||(this.resizeListener=()=>{this.overlayVisible&&!F.isTouchDevice()&&this.hide()},window.addEventListener("resize",this.resizeListener))},unbindResizeListener(){this.resizeListener&&(window.removeEventListener("resize",this.resizeListener),this.resizeListener=null)},isOptionMatched(e){return this.isValidOption(e)&&this.getProccessedOptionLabel(e).toLocaleLowerCase(this.searchLocale).startsWith(this.searchValue.toLocaleLowerCase(this.searchLocale))},isValidOption(e){return!!e&&!this.isOptionDisabled(e.option)},isValidSelectedOption(e){return this.isValidOption(e)&&this.isSelected(e)},isSelected(e){return this.activeOptionPath.some(t=>t.key===e.key)},findFirstOptionIndex(){return this.visibleOptions.findIndex(e=>this.isValidOption(e))},findLastOptionIndex(){return S.findLastIndex(this.visibleOptions,e=>this.isValidOption(e))},findNextOptionIndex(e){const t=e<this.visibleOptions.length-1?this.visibleOptions.slice(e+1).findIndex(o=>this.isValidOption(o)):-1;return t>-1?t+e+1:e},findPrevOptionIndex(e){const t=e>0?S.findLastIndex(this.visibleOptions.slice(0,e),o=>this.isValidOption(o)):-1;return t>-1?t:e},findSelectedOptionIndex(){return this.visibleOptions.findIndex(e=>this.isValidSelectedOption(e))},findFirstFocusedOptionIndex(){const e=this.findSelectedOptionIndex();return e<0?this.findFirstOptionIndex():e},findLastFocusedOptionIndex(){const e=this.findSelectedOptionIndex();return e<0?this.findLastOptionIndex():e},findOptionPathByValue(e,t,o=0){if(t=t||o===0&&this.processedOptions,!t)return null;if(S.isEmpty(e))return[];for(let r=0;r<t.length;r++){const a=t[r];if(S.equals(e,this.getOptionValue(a.option),this.equalityKey))return[a];const n=this.findOptionPathByValue(e,a.children,o+1);if(n)return n.unshift(a),n}},searchOptions(e,t){this.searchValue=(this.searchValue||"")+t;let o=-1,r=!1;return this.focusedOptionInfo.index!==-1?(o=this.visibleOptions.slice(this.focusedOptionInfo.index).findIndex(a=>this.isOptionMatched(a)),o=o===-1?this.visibleOptions.slice(0,this.focusedOptionInfo.index).findIndex(a=>this.isOptionMatched(a)):o+this.focusedOptionInfo.index):o=this.visibleOptions.findIndex(a=>this.isOptionMatched(a)),o!==-1&&(r=!0),o===-1&&this.focusedOptionInfo.index===-1&&(o=this.findFirstFocusedOptionIndex()),o!==-1&&this.changeFocusedOptionIndex(e,o),this.searchTimeout&&clearTimeout(this.searchTimeout),this.searchTimeout=setTimeout(()=>{this.searchValue="",this.searchTimeout=null},500),r},changeFocusedOptionIndex(e,t){this.focusedOptionInfo.index!==t&&(this.focusedOptionInfo.index=t,this.scrollInView(),this.selectOnFocus&&this.onOptionChange({originalEvent:e,processedOption:this.visibleOptions[t],isHide:!1}))},scrollInView(e=-1){const t=e!==-1?`${this.id}_${e}`:this.focusedOptionId,o=F.findSingle(this.list,`li[id="${t}"]`);o&&o.scrollIntoView&&o.scrollIntoView({block:"nearest",inline:"start"})},autoUpdateModel(){this.selectOnFocus&&this.autoOptionFocus&&!this.hasSelectedOption&&(this.focusedOptionInfo.index=this.findFirstFocusedOptionIndex(),this.onOptionChange({processedOption:this.visibleOptions[this.focusedOptionInfo.index],isHide:!1}),!this.overlayVisible&&(this.focusedOptionInfo={index:-1,level:0,parentKey:""}))},updateModel(e,t){this.$emit("update:modelValue",t),this.$emit("change",{originalEvent:e,value:t})},createProcessedOptions(e,t=0,o={},r=""){const a=[];return e&&e.forEach((n,l)=>{const u=(r!==""?r+"_":"")+l,d={option:n,index:l,level:t,key:u,parent:o,parentKey:r};d.children=this.createProcessedOptions(this.getOptionGroupChildren(n,t),t+1,d,u),a.push(d)}),a},overlayRef(e){this.overlay=e}},computed:{containerClass(){return["p-cascadeselect p-component p-inputwrapper",{"p-disabled":this.disabled,"p-focus":this.focused,"p-inputwrapper-filled":this.modelValue,"p-inputwrapper-focus":this.focused||this.overlayVisible,"p-overlay-open":this.overlayVisible}]},labelClass(){return["p-cascadeselect-label",{"p-placeholder":this.label===this.placeholder,"p-cascadeselect-label-empty":!this.$slots.value&&(this.label==="p-emptylabel"||this.label.length===0)}]},panelStyleClass(){return["p-cascadeselect-panel p-component",this.panelClass,{"p-input-filled":this.$primevue.config.inputStyle==="filled","p-ripple-disabled":this.$primevue.config.ripple===!1}]},dropdownIconClass(){return["p-cascadeselect-trigger-icon",this.loading?this.loadingIcon:"pi pi-chevron-down"]},hasSelectedOption(){return S.isNotEmpty(this.modelValue)},label(){const e=this.placeholder||"p-emptylabel";if(this.hasSelectedOption){const t=this.findOptionPathByValue(this.modelValue),o=S.isNotEmpty(t)?t[t.length-1]:null;return o?this.getOptionLabel(o.option):e}return e},processedOptions(){return this.createProcessedOptions(this.options||[])},visibleOptions(){const e=this.activeOptionPath.find(t=>t.key===this.focusedOptionInfo.parentKey);return e?e.children:this.processedOptions},equalityKey(){return this.optionValue?null:this.dataKey},searchResultMessageText(){return S.isNotEmpty(this.visibleOptions)?this.searchMessageText.replaceAll("{0}",this.visibleOptions.length):this.emptySearchMessageText},searchMessageText(){return this.searchMessage||this.$primevue.config.locale.searchMessage||""},emptySearchMessageText(){return this.emptySearchMessage||this.$primevue.config.locale.emptySearchMessage||""},emptyMessageText(){return this.emptyMessage||this.$primevue.config.locale.emptyMessage||""},selectionMessageText(){return this.selectionMessage||this.$primevue.config.locale.selectionMessage||""},emptySelectionMessageText(){return this.emptySelectionMessage||this.$primevue.config.locale.emptySelectionMessage||""},selectedMessageText(){return this.hasSelectedOption?this.selectionMessageText.replaceAll("{0}","1"):this.emptySelectionMessageText},id(){return this.$attrs.id||at()},focusedOptionId(){return this.focusedOptionInfo.index!==-1?`${this.id}${S.isNotEmpty(this.focusedOptionInfo.parentKey)?"_"+this.focusedOptionInfo.parentKey:""}_${this.focusedOptionInfo.index}`:null}},components:{CascadeSelectSub:Re,Portal:nt}};const Xt={class:"p-hidden-accessible"},Jt=["id","disabled","placeholder","tabindex","aria-label","aria-labelledby","aria-expanded","aria-controls","aria-activedescendant"],Kt={class:"p-cascadeselect-trigger",role:"button",tabindex:"-1","aria-hidden":"true"},Wt={role:"status","aria-live":"polite",class:"p-hidden-accessible"},Zt={class:"p-cascadeselect-items-wrapper"},eo={role:"status","aria-live":"polite",class:"p-hidden-accessible"};function to(e,t,o,r,a,n){const l=k("CascadeSelectSub"),u=k("Portal");return p(),f("div",{ref:"container",class:I(n.containerClass),onClick:t[5]||(t[5]=d=>n.onContainerClick(d))},[s("div",Xt,[s("input",Ve({ref:"focusInput",id:o.inputId,type:"text",style:o.inputStyle,class:o.inputClass,readonly:"",disabled:o.disabled,placeholder:o.placeholder,tabindex:o.disabled?-1:o.tabindex,role:"combobox","aria-label":e.ariaLabel,"aria-labelledby":e.ariaLabelledby,"aria-haspopup":"tree","aria-expanded":a.overlayVisible,"aria-controls":n.id+"_tree","aria-activedescendant":a.focused?n.focusedOptionId:void 0,onFocus:t[0]||(t[0]=(...d)=>n.onFocus&&n.onFocus(...d)),onBlur:t[1]||(t[1]=(...d)=>n.onBlur&&n.onBlur(...d)),onKeydown:t[2]||(t[2]=(...d)=>n.onKeyDown&&n.onKeyDown(...d))},o.inputProps),null,16,Jt)]),s("span",{class:I(n.labelClass)},[Ie(e.$slots,"value",{value:o.modelValue,placeholder:o.placeholder},()=>[D(m(n.label),1)])],2),s("div",Kt,[Ie(e.$slots,"indicator",{},()=>[s("span",{class:I(n.dropdownIconClass)},null,2)])]),s("span",Wt,m(n.searchResultMessageText),1),i(u,{appendTo:o.appendTo},{default:c(()=>[i(st,{name:"p-connected-overlay",onEnter:n.onOverlayEnter,onAfterEnter:n.onOverlayAfterEnter,onLeave:n.onOverlayLeave,onAfterLeave:n.onOverlayAfterLeave},{default:c(()=>[a.overlayVisible?(p(),f("div",Ve({key:0,ref:n.overlayRef,style:o.panelStyle,class:n.panelStyleClass,onClick:t[3]||(t[3]=(...d)=>n.onOverlayClick&&n.onOverlayClick(...d)),onKeydown:t[4]||(t[4]=(...d)=>n.onOverlayKeyDown&&n.onOverlayKeyDown(...d))},o.panelProps),[s("div",Zt,[i(l,{id:n.id+"_tree",role:"tree","aria-orientation":"horizontal",selectId:n.id,focusedOptionId:a.focused?n.focusedOptionId:void 0,options:n.processedOptions,activeOptionPath:a.activeOptionPath,level:0,templates:e.$slots,optionLabel:o.optionLabel,optionValue:o.optionValue,optionDisabled:o.optionDisabled,optionGroupLabel:o.optionGroupLabel,optionGroupChildren:o.optionGroupChildren,onOptionChange:n.onOptionChange},null,8,["id","selectId","focusedOptionId","options","activeOptionPath","templates","optionLabel","optionValue","optionDisabled","optionGroupLabel","optionGroupChildren","onOptionChange"]),s("span",eo,m(n.selectedMessageText),1)])],16)):C("",!0)]),_:1},8,["onEnter","onAfterEnter","onLeave","onAfterLeave"])]),_:1},8,["appendTo"])],2)}function oo(e,t){t===void 0&&(t={});var o=t.insertAt;if(!(!e||typeof document=="undefined")){var r=document.head||document.getElementsByTagName("head")[0],a=document.createElement("style");a.type="text/css",o==="top"&&r.firstChild?r.insertBefore(a,r.firstChild):r.appendChild(a),a.styleSheet?a.styleSheet.cssText=e:a.appendChild(document.createTextNode(e))}}var ro=`
.p-cascadeselect {
    display: -webkit-inline-box;
    display: -ms-inline-flexbox;
    display: inline-flex;
    cursor: pointer;
    position: relative;
    -webkit-user-select: none;
       -moz-user-select: none;
        -ms-user-select: none;
            user-select: none;
}
.p-cascadeselect-trigger {
    display: -webkit-box;
    display: -ms-flexbox;
    display: flex;
    -webkit-box-align: center;
        -ms-flex-align: center;
            align-items: center;
    -webkit-box-pack: center;
        -ms-flex-pack: center;
            justify-content: center;
    -ms-flex-negative: 0;
        flex-shrink: 0;
}
.p-cascadeselect-label {
    display: block;
    white-space: nowrap;
    overflow: hidden;
    -webkit-box-flex: 1;
        -ms-flex: 1 1 auto;
            flex: 1 1 auto;
    width: 1%;
    text-overflow: ellipsis;
    cursor: pointer;
}
.p-cascadeselect-label-empty {
    overflow: hidden;
    visibility: hidden;
}
.p-cascadeselect .p-cascadeselect-panel {
    min-width: 100%;
}
.p-cascadeselect-panel {
    position: absolute;
    top: 0;
    left: 0;
}
.p-cascadeselect-item {
    cursor: pointer;
    font-weight: normal;
    white-space: nowrap;
}
.p-cascadeselect-item-content {
    display: -webkit-box;
    display: -ms-flexbox;
    display: flex;
    -webkit-box-align: center;
        -ms-flex-align: center;
            align-items: center;
    overflow: hidden;
    position: relative;
}
.p-cascadeselect-group-icon {
    margin-left: auto;
}
.p-cascadeselect-items {
    margin: 0;
    padding: 0;
    list-style-type: none;
    min-width: 100%;
}
.p-fluid .p-cascadeselect {
    display: -webkit-box;
    display: -ms-flexbox;
    display: flex;
}
.p-fluid .p-cascadeselect .p-cascadeselect-label {
    width: 1%;
}
.p-cascadeselect-sublist {
    position: absolute;
    min-width: 100%;
    z-index: 1;
    display: none;
}
.p-cascadeselect-item-active {
    overflow: visible !important;
}
.p-cascadeselect-item-active > .p-cascadeselect-sublist {
    display: block;
    left: 100%;
    top: 0;
}
`;oo(ro);_e.render=to;const ao={style:{height:"60%","max-height":"60%","max-width":"80%","min-width":"80%"}},no=[{label:"qbe.filters.operators.equalsTo",value:"EQUALS TO"},{label:"qbe.filters.operators.notEqualsTo",value:"NOT EQUALS TO"},{label:"qbe.filters.operators.greaterThan",value:"GREATER THAN"},{label:"qbe.filters.operators.equalsOrGreaterThan",value:"EQUALS OR GREATER THAN"},{label:"qbe.filters.operators.lessThan",value:"LESS THAN"},{label:"qbe.filters.operators.equalsOrLessThan",value:"EQUALS OR LESS THAN"},{label:"qbe.filters.operators.startsWith",value:"STARTS WITH"},{label:"qbe.filters.operators.notStartsWith",value:"NOT STARTS WITH"},{label:"qbe.filters.operators.endsWith",value:"ENDS WITH"},{label:"qbe.filters.operators.notEndsWith",value:"NOT ENDS WITH"},{label:"qbe.filters.operators.contains",value:"CONTAINS"},{label:"qbe.filters.operators.notContains",value:"NOT CONTAINS"},{label:"qbe.filters.operators.between",value:"BETWEEN"},{label:"qbe.filters.operators.notBetween",value:"NOT BETWEEN"},{label:"qbe.filters.operators.in",value:"IN"},{label:"qbe.filters.operators.notIn",value:"NOT IN"},{label:"qbe.filters.operators.isNull",value:"IS NULL"},{label:"qbe.filters.operators.notNull",value:"NOT NULL"}],io={width:"3em"},lo=[{label:"qbe.filters.operators.spatialContains",value:"SPATIAL_CONTAINS"},{label:"qbe.filters.operators.spatialNN",value:"SPATIAL_NN"},{label:"qbe.filters.operators.spatialCoveredBy",value:"SPATIAL_COVERED_BY"},{label:"qbe.filters.operators.spatialCovers",value:"SPATIAL_COVERS"},{label:"qbe.filters.operators.spatialDisjoint",value:"SPATIAL_DISJOINT"},{label:"qbe.filters.operators.spatialEqualsTo",value:"SPATIAL_EQUALS_TO"},{label:"qbe.filters.operators.spatialFilter",value:"SPATIAL_FILTER"},{label:"qbe.filters.operators.spatialIntersects",value:"SPATIAL_INTERSECTS"},{label:"qbe.filters.operators.spatialOverlaps",value:"SPATIAL_OVERLAPS"},{label:"qbe.filters.operators.spatialTouches",value:"SPATIAL_TOUCHES"},{label:"qbe.filters.operators.spatialInside",value:"SPATIAL_INSIDE"}],so={message:{"align-items":"center",display:"flex","justify-content":"center","text-align":"center"}};var ge={dialog:ao,operatorValues:no,selectionColumnHeaderStyle:io,spatialOperatorValues:lo,styles:so};const co=$({name:"qbe-filter-values-table",components:{Column:H,DataTable:G},props:{filterValuesData:{type:Object},loading:{type:Boolean},loadedSelectedValues:{type:Array},filterOperator:{type:String,required:!0}},emits:["selected"],data(){return{QBEFilterDialogDescriptor:ge,columns:[],rows:[],filters:{},selectedValues:[]}},watch:{filterValuesData(){this.loadData()},filterOperator(){this.selectedValues=[]}},created(){this.loadData()},methods:{loadData(){var e;this.filterValuesData&&(this.columns=this.filterValuesData.metaData.fields.slice(1),this.rows=this.filterValuesData.rows,this.columns.forEach(t=>this.filters[t.dataIndex]={operator:dt.AND,constraints:[ht]}),this.selectedValues=[],(e=this.loadedSelectedValues)==null||e.forEach(t=>this.selectedValues.push({column_1:""+t})))},onSelect(){let e=[];["CONTAINS","NOT CONTAINS","IN","NOT IN"].includes(this.filterOperator)?e=this.selectedValues.map(t=>""+t.column_1):(e=[],Object.keys(this.selectedValues).forEach(t=>{e.push(""+this.selectedValues[t])})),this.$emit("selected",e)}}});function po(e,t,o,r,a,n){const l=k("Column"),u=k("InputText"),d=k("DataTable");return p(),y(d,{class:"p-datatable-sm kn-table p-m-2",paginator:!0,rows:10,value:e.rows,loading:e.loading,filters:e.filters,"onUpdate:filters":t[0]||(t[0]=g=>e.filters=g),selection:e.selectedValues,"onUpdate:selection":t[1]||(t[1]=g=>e.selectedValues=g),selectionMode:["CONTAINS","NOT CONTAINS","IN","NOT IN"].includes(e.filterOperator)?!1:"single",filterDisplay:"menu",responsiveLayout:"stack",breakpoint:"960px",onRowSelect:e.onSelect,onRowUnselect:e.onSelect,onRowSelectAll:e.onSelect,onRowUnselectAll:e.onSelect},{empty:c(()=>[s("div",null,m(e.$t("common.info.noDataFound")),1)]),default:c(()=>[i(l,{selectionMode:["CONTAINS","NOT CONTAINS","IN","NOT IN"].includes(e.filterOperator)?"multiple":"single",headerStyle:e.QBEFilterDialogDescriptor.selectionColumnHeaderStyle},null,8,["selectionMode","headerStyle"]),(p(!0),f(z,null,N(e.columns,g=>(p(),y(l,{key:g.header,field:g.dataIndex,header:g.header,sortable:!0},{filter:c(({filterModel:b})=>[i(u,{modelValue:b.value,"onUpdate:modelValue":E=>b.value=E,class:"p-column-filter"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["field","header"]))),128))]),_:1},8,["value","loading","filters","selection","selectionMode","onRowSelect","onRowUnselect","onRowSelectAll","onRowUnselectAll"])}var bo=V(co,[["render",po]]);const ko=$({name:"qbe-filter-card",components:{Calendar:Qe,CascadeSelect:_e,Chip:Fe,Chips:gt,Dropdown:Y,QBEFilterValuesTable:bo},props:{propFilter:{type:Object},id:{type:String},propEntities:{type:Array},subqueries:{type:Array,required:!0},field:{type:Object,required:!0},propParameters:{type:Array}},emits:["removeFilter"],data(){return{QBEFilterDialogDescriptor:ge,filter:null,targetValues:[{label:this.$t("qbe.filters.targets.manual"),value:"manual"},{label:this.$t("qbe.filters.targets.value"),value:"valueOfField"},{label:this.$t("qbe.filters.targets.entity"),value:"anotherEntity"}],selectedValues:[],filterValuesData:null,anotherEntityValue:"",entities:[],firstOperand:"",secondOperand:"",multiManualValues:[],targetDate:null,targetEndDate:null,parameters:[],loading:!1,filterOperatorOptions:[]}},watch:{propFilter(){this.loadFilter()},propEntities(){this.loadEntities()},propParameters(){this.loadParameters()}},created(){this.loadEntities(),this.loadFilter(),this.loadParameters()},methods:{loadFilter(){var t;this.filter=this.propFilter,((t=this.subqueries)==null?void 0:t.length)>0&&this.targetValues.push({label:this.$t("qbe.filters.targets.subquery"),value:"subquery"}),this.formatFilter(),this.filterOperatorOptions=this.QBEFilterDialogDescriptor.operatorValues;const e=this.getEntity();(e==null?void 0:e.iconCls)==="geographic_dimension"&&(this.filterOperatorOptions=this.filterOperatorOptions.concat(this.QBEFilterDialogDescriptor.spatialOperatorValues))},getEntity(){let e=null;for(let t=0;t<this.entities.length&&!e;t++)for(let o=0;o<this.entities[t].children.length;o++)if(this.entities[t].children[o].id===this.field.id){e=this.entities[t];break}return e},loadEntities(){this.entities=this.propEntities?[...this.propEntities]:[]},loadParameters(){this.parameters=this.propParameters,this.parameters.length>0&&this.targetValues.push({label:this.$t("common.parameter"),value:"parameter"})},async formatFilter(){var e;switch((e=this.filter)==null?void 0:e.rightType){case"manual":this.filter.rightOperandType="Static Content",["java.sql.Timestamp"].includes(this.field.dataType)?(this.targetDate=this.filter.rightOperandValue[0]?L(this.filter.rightOperandValue[0],"DD/MM/YYYY hh:mm").toDate():new Date,this.onManualTimestampChange(),["BETWEEN","NOT BETWEEN"].includes(this.filter.operator)&&(this.targetEndDate=this.filter.rightOperandValue[1]?L(this.filter.rightOperandValue[1],"DD/MM/YYYY hh:mm").toDate():new Date)):["java.sql.Date"].includes(this.field.dataType)?(this.targetDate=this.filter.rightOperandValue[0]?L(this.filter.rightOperandValue[0],"DD/MM/YYYY").toDate():new Date,this.onManualTimestampChange(),["BETWEEN","NOT BETWEEN"].includes(this.filter.operator)&&(this.targetEndDate=this.filter.rightOperandValue[1]?L(this.filter.rightOperandValue[1],"DD/MM/YYYY").toDate():new Date)):["BETWEEN","NOT BETWEEN"].includes(this.filter.operator)?(this.firstOperand=this.filter.rightOperandValue[0],this.secondOperand=this.filter.rightOperandValue[1]):["IN","NOT IN"].includes(this.filter.operator)&&(this.multiManualValues=[...this.filter.rightOperandValue]),this.filter.hasParam=!1,this.filter.paramName="";break;case"valueOfField":this.filter.rightOperandType="Static Content",this.selectedValues=this.filter.rightOperandValue.filter(t=>t!==""),await this.loadFilterValues(),this.filter.hasParam=!1,this.filter.paramName="";break;case"anotherEntity":this.filter.rightOperandType="Field Content",this.filter.hasParam=!1,this.filter.paramName="";break;case"subquery":this.filter.rightOperandType="Subquery",this.filter.hasParam=!1,this.filter.paramName="";break;case"parameter":this.filter.rightOperandType="Static Content";break}},onFilterOperatorChange(){!this.filter||(["STARTS WITH","NOT STARTS WITH","ENDS WITH","NOT ENDS WITH","CONTAINS","NOT CONTAINS","BETWEEN","NOT BETWEEN"].includes(this.filter.operator)&&(this.filter.rightType="manual"),this.filter.rightType==="manual"?(this.filter.rightOperandDescription="",this.multiManualValues=[],this.firstOperand="",this.secondOperand="",this.targetDate=null,this.targetEndDate=null):this.filter.rightType==="valueOfField"&&(this.selectedValues=[]),this.filter.operator!=="SPATIAL_NN"&&delete this.filter.operatorParameter,this.resetFilterRightOperandValues())},onManualValueChange(){this.filter&&(this.filter.rightOperandValue=[this.filter.rightOperandDescription])},onManualBetweenChange(){this.filter&&(this.filter.rightOperandValue=[this.firstOperand,this.secondOperand],this.filter.rightOperandDescription=this.firstOperand+" ---- "+this.secondOperand)},onManualMultivalueChanged(){this.filter&&(this.filter.rightOperandValue=[...this.multiManualValues],this.filter.rightOperandDescription=this.multiManualValues.join(" ---- "))},async onFilterTypeChange(){this.filter&&(this.resetFilterRightOperandValues(),this.selectedValues=[],this.filterValuesData=null,this.firstOperand="",this.secondOperand="",this.multiManualValues=[],this.formatFilter(),this.filter.rightType==="valueOfField"&&await this.loadFilterValues())},resetFilterRightOperandValues(){this.filter&&(this.filter.rightOperandDescription="",this.filter.rightOperandLongDescription="",this.filter.rightOperandValue=[""],this.filter.rightOperandAlias="")},async loadFilterValues(){var e;this.loading=!0,await this.$http.post(`/knowageqbeengine/servlet/AdapterHTTP?ACTION_NAME=GET_VALUES_FOR_QBE_FILTER_LOOKUP_ACTION&ENTITY_ID=${(e=this.filter)==null?void 0:e.leftOperandValue}&SBI_EXECUTION_ID=${this.id}`,{headers:{"Content-Type":"application/x-www-form-urlencoded; charset=utf-8"}}).then(t=>this.filterValuesData=t.data),this.loading=!1},setSelectedValues(e){this.selectedValues=e,this.filter&&(this.filter.rightOperandValue=e,this.filter.rightOperandDescription=e.join(" ---- "),this.filter.rightOperandLongDescription=e.join(" ---- "))},onEntityTypeChanged(){if(this.filter){const e=this.findSelectedField(this.filter.rightOperandDescription);this.filter.rightOperandValue=[e==null?void 0:e.id],this.filter.rightOperandLongDescription=this.filter.rightOperandDescription,this.filter.rightOperandAlias=e.text}},findSelectedField(e){let t=null;for(let o=0;o<this.entities.length&&!t;o++)for(let r=0;r<this.entities[o].children.length;r++)if(this.entities[o].children[r].attributes.longDescription===e){t=this.entities[o].children[r];break}return t},onSubqeryTargetChange(){if(!this.filter||!this.subqueries)return;const e=this.subqueries.findIndex(t=>{var o;return t.name===((o=this.filter)==null?void 0:o.rightOperandDescription)});if(e!==-1){const t=this.subqueries[e];this.filter.rightOperandValue=[t.id],this.filter.rightOperandLongDescription="Subquery "+t.name}},onManualTimestampChange(){const e=this.field.dataType==="java.sql.Date"?"DD/MM/YYYY":"DD/MM/YYYY hh:mm";this.filter&&(this.filter.rightOperandDescription=this.targetDate instanceof Date?L(this.targetDate).format(e):"",this.filter.rightOperandValue[0]=this.targetDate instanceof Date?L(this.targetDate).format(e):"")},onManualTimestampEndDateChange(){const e=this.field.dataType==="java.sql.Date"?"DD/MM/YYYY":"DD/MM/YYYY hh:mm";this.filter&&(this.filter.rightOperandValue[1]=this.targetDate instanceof Date?L(this.targetEndDate).format(e):"")},onParameterTargetChange(){this.filter&&(this.filter.hasParam=!0,this.filter.paramName=this.filter.rightOperandDescription,this.filter.rightOperandValue=["$P{"+this.filter.rightOperandDescription+"}"],this.filter.rightOperandLongDescription="Static Content $P{"+this.filter.rightOperandDescription+"}")},getFilterOperatorLabel(e){for(let t=0;t<this.filterOperatorOptions.length;t++)if(this.filterOperatorOptions[t].value===e)return this.$t(this.filterOperatorOptions[t].label);return""}}}),uo={key:0},mo={class:"p-grid p-m-2"},go={class:"p-col-4 p-d-flex p-flex-row p-ai-center"},ho={class:"kn-flex"},fo={class:"kn-material-input-label"},vo={class:"p-col-2 p-d-flex p-flex-row p-ai-center"},yo={class:"kn-flex"},wo={class:"kn-material-input-label"},xo={key:0},Co={class:"qbe-filter-option-value"},Mo={class:"p-ml-2"},Ao={class:"kn-material-input-label"},Do={key:0,class:"p-col-2 p-d-flex p-flex-row p-ai-center"},Eo={class:"kn-flex"},To={class:"kn-material-input-label"},So={key:1,class:"p-col-4 p-d-flex p-flex-row p-ai-center"},Oo={class:"kn-flex"},$o={class:"p-d-flex p-flex-row p-ai-center"},Vo={key:0,class:"p-d-flex p-flex-row p-ai-center p-mt-3"},Io={class:"p-float-label"},qo={class:"kn-material-input-label"},zo={class:"p-mx-2"},Fo={class:"p-float-label"},No={class:"kn-material-input-label"},Qo={key:1,class:"kn-width-full"},Lo={class:"kn-material-input-label"},Uo={key:3},Bo={class:"kn-flex p-d-flex p-flex-row p-m-1"},Po={key:0,class:"kn-flex p-d-flex p-flex-row p-m-1"},Ro={key:4,class:"qbe-filter-chip-container p-d-flex p-flex-row p-ai-center p-flex-wrap kn-flex"};function _o(e,t,o,r,a,n){const l=k("InputText"),u=k("Dropdown"),d=k("Chips"),g=k("Calendar"),b=k("Chip"),E=k("CascadeSelect"),w=k("QBEFilterValuesTable"),A=j("tooltip");return e.filter?(p(),f("div",uo,[s("div",mo,[s("div",go,[s("div",ho,[s("label",fo,m(e.$t("common.field")),1),i(l,{class:"kn-material-input",modelValue:e.filter.leftOperandDescription,"onUpdate:modelValue":t[0]||(t[0]=h=>e.filter.leftOperandDescription=h),disabled:!0},null,8,["modelValue"])])]),s("div",vo,[s("div",yo,[T((p(),f("label",wo,[D(m(e.$t("qbe.filters.condition")),1)])),[[A,e.$t("qbe.filters.conditionTooltip"),void 0,{top:!0}]]),i(u,{class:"kn-material-input",modelValue:e.filter.operator,"onUpdate:modelValue":t[1]||(t[1]=h=>e.filter.operator=h),options:e.filterOperatorOptions,optionValue:"value",onChange:e.onFilterOperatorChange},{value:c(h=>[h.value?(p(),f("div",xo,[s("span",Co,m(e.getFilterOperatorLabel(h.value)),1)])):C("",!0)]),option:c(h=>[s("div",null,[s("span",null,m(e.$t(h.option.label)),1)])]),_:1},8,["modelValue","options","onChange"])]),T(s("div",Mo,[s("label",Ao,m(e.$t("common.parameter")),1),i(l,{class:"kn-material-input",modelValue:e.filter.operatorParameter,"onUpdate:modelValue":t[2]||(t[2]=h=>e.filter.operatorParameter=h)},null,8,["modelValue"])],512),[[U,e.filter.operator==="SPATIAL_NN"]])]),e.filter.operator!=="IS NULL"&&e.filter.operator!=="NOT NULL"?(p(),f("div",Do,[s("div",Eo,[s("label",To,m(e.$t("qbe.filters.targetType")),1),i(u,{class:"kn-material-input",modelValue:e.filter.rightType,"onUpdate:modelValue":t[3]||(t[3]=h=>e.filter.rightType=h),options:["STARTS WITH","NOT STARTS WITH","ENDS WITH","NOT ENDS WITH","CONTAINS","NOT CONTAINS","BETWEEN","NOT BETWEEN"].includes(e.filter.operator)?[e.targetValues[0]]:e.targetValues,optionValue:"value",optionLabel:"label",onChange:e.onFilterTypeChange},null,8,["modelValue","options","onChange"])])])):C("",!0),e.filter.operator!=="IS NULL"&&e.filter.operator!=="NOT NULL"?(p(),f("div",So,[s("div",Oo,[T(s("label",{class:"kn-material-input-label"},m(e.$t("qbe.filters.target")),513),[[U,!(e.filter.rightType==="manual"&&["BETWEEN","NOT BETWEEN","IN","NOT IN"].includes(e.filter.operator))]]),s("div",$o,[e.filter.rightType==="manual"&&["BETWEEN","NOT BETWEEN"].includes(e.filter.operator)&&e.field.dataType!=="java.sql.Timestamp"&&e.field.dataType!=="java.sql.Date"?(p(),f("div",Vo,[s("div",Io,[i(l,{class:"kn-material-input",modelValue:e.firstOperand,"onUpdate:modelValue":t[4]||(t[4]=h=>e.firstOperand=h),onInput:e.onManualBetweenChange},null,8,["modelValue","onInput"]),s("label",qo,m(e.$t("qbe.filters.lowLimit")),1)]),s("span",zo,m(e.$t("qbe.filters.and")),1),s("div",Fo,[i(l,{class:"kn-material-input",modelValue:e.secondOperand,"onUpdate:modelValue":t[5]||(t[5]=h=>e.secondOperand=h),onInput:e.onManualBetweenChange},null,8,["modelValue","onInput"]),s("label",No,m(e.$t("qbe.filters.highLimit")),1)])])):e.filter.rightType==="manual"&&["IN","NOT IN"].includes(e.filter.operator)&&e.field.dataType!=="java.sql.Timestamp"&&e.field.dataType!=="java.sql.Date"?(p(),f("div",Qo,[s("label",Lo,m(e.$t("qbe.filters.enterValue")),1),i(d,{class:"kn-material-input",modelValue:e.multiManualValues,"onUpdate:modelValue":t[6]||(t[6]=h=>e.multiManualValues=h),onAdd:e.onManualMultivalueChanged,onRemove:e.onManualMultivalueChanged,addOnBlur:!0},null,8,["modelValue","onAdd","onRemove"])])):e.filter.rightType==="manual"&&e.field.dataType!=="java.sql.Timestamp"&&e.field.dataType!=="java.sql.Date"?(p(),y(l,{key:2,class:"kn-material-input",modelValue:e.filter.rightOperandDescription,"onUpdate:modelValue":t[7]||(t[7]=h=>e.filter.rightOperandDescription=h),onInput:e.onManualValueChange},null,8,["modelValue","onInput"])):e.filter.rightType==="manual"&&(e.field.dataType==="java.sql.Timestamp"||e.field.dataType==="java.sql.Date")?(p(),f("div",Uo,[s("div",Bo,[i(g,{class:"kn-flex p-mr-2",modelValue:e.targetDate,"onUpdate:modelValue":t[8]||(t[8]=h=>e.targetDate=h),onInput:e.onManualTimestampChange,onDateSelect:e.onManualTimestampChange},null,8,["modelValue","onInput","onDateSelect"]),e.field.dataType==="java.sql.Timestamp"?(p(),y(g,{key:0,class:"qbe-filter-time-input",modelValue:e.targetDate,"onUpdate:modelValue":t[9]||(t[9]=h=>e.targetDate=h),manualInput:!0,timeOnly:!0,hourFormat:"24",onInput:e.onManualTimestampChange,onDateSelect:e.onManualTimestampChange},null,8,["modelValue","onInput","onDateSelect"])):C("",!0)]),["BETWEEN","NOT BETWEEN"].includes(e.filter.operator)?(p(),f("div",Po,[i(g,{class:"kn-flex p-mr-2",modelValue:e.targetEndDate,"onUpdate:modelValue":t[10]||(t[10]=h=>e.targetEndDate=h),onInput:e.onManualTimestampChange,onDateSelect:e.onManualTimestampEndDateChange},null,8,["modelValue","onInput","onDateSelect"]),e.field.dataType==="java.sql.Timestamp"?(p(),y(g,{key:0,class:"qbe-filter-time-input",modelValue:e.targetEndDate,"onUpdate:modelValue":t[11]||(t[11]=h=>e.targetEndDate=h),manualInput:!0,timeOnly:!0,hourFormat:"24",onInput:e.onManualTimestampEndDateChange,onDateSelect:e.onManualTimestampChange},null,8,["modelValue","onInput","onDateSelect"])):C("",!0)])):C("",!0)])):e.filter.rightType==="valueOfField"?(p(),f("div",Ro,[(p(!0),f(z,null,N(e.selectedValues,(h,v)=>(p(),y(b,{key:v,class:"p-mr-1"},{default:c(()=>[D(m(h),1)]),_:2},1024))),128))])):C("",!0),e.filter.rightType==="anotherEntity"?(p(),y(E,{key:5,class:"kn-flex",modelValue:e.filter.rightOperandDescription,"onUpdate:modelValue":t[12]||(t[12]=h=>e.filter.rightOperandDescription=h),options:e.entities,optionLabel:"attributes.longDescription",optionValue:"attributes.longDescription",optionGroupLabel:"text",optionGroupChildren:["children"],onChange:e.onEntityTypeChanged},null,8,["modelValue","options","onChange"])):C("",!0),e.filter.rightType==="subquery"?(p(),y(u,{key:6,class:"kn-material-input kn-flex",modelValue:e.filter.rightOperandDescription,"onUpdate:modelValue":t[13]||(t[13]=h=>e.filter.rightOperandDescription=h),options:e.subqueries,optionValue:"name",optionLabel:"name",onChange:e.onSubqeryTargetChange},null,8,["modelValue","options","onChange"])):C("",!0),e.filter.rightType==="parameter"?(p(),y(u,{key:7,class:"kn-material-input kn-flex",modelValue:e.filter.rightOperandDescription,"onUpdate:modelValue":t[14]||(t[14]=h=>e.filter.rightOperandDescription=h),options:e.parameters,optionValue:"name",optionLabel:"name",onChange:e.onParameterTargetChange},null,8,["modelValue","options","onChange"])):C("",!0),e.filter.rightType==="valueOfField"?(p(),f("i",{key:8,class:"fa fa-check kn-cursor-pointer p-ml-2",onClick:t[15]||(t[15]=(...h)=>e.loadFilterValues&&e.loadFilterValues(...h))})):C("",!0),s("i",{class:"fa fa-eraser kn-cursor-pointer p-ml-2",onClick:t[16]||(t[16]=h=>e.$emit("removeFilter",e.filter))})])])])):C("",!0)]),T(i(w,{class:"p-m-2",filterValuesData:e.filterValuesData,loadedSelectedValues:e.selectedValues,loading:e.loading,filterOperator:e.filter.operator,onSelected:e.setSelectedValues},null,8,["filterValuesData","loadedSelectedValues","loading","filterOperator","onSelected"]),[[U,e.filter.rightType==="valueOfField"]])])):C("",!0)}var jo=V(ko,[["render",_o]]);const Ho=$({name:"qbe-temporal-filter-dialog",components:{Column:H,DataTable:G,Dialog:B},props:{visible:{type:Boolean},temporalFilters:{type:Array}},emits:["save","close"],data(){return{QBEFilterDialogDescriptor:ge,filters:[],selectedFilter:null}},watch:{visible(){this.selectedFilter=null},temporalFilters(){this.loadTemporalFilters()}},created(){this.loadTemporalFilters()},methods:{loadTemporalFilters(){this.filters=this.temporalFilters},closeDialog(){this.$emit("close")},save(){this.$emit("save",this.selectedFilter)}}}),Go={id:"noFunctionsFound"};function Yo(e,t,o,r,a,n){const l=k("Toolbar"),u=k("Column"),d=k("DataTable"),g=k("Button"),b=k("Dialog");return p(),y(b,{id:"qbe-filter-dialog",class:"p-fluid kn-dialog--toolbar--primary",style:O(e.QBEFilterDialogDescriptor.dialog.style),visible:e.visible,modal:!0,closable:!1,"base-z-index":4203},{header:c(()=>[i(l,{class:"kn-toolbar kn-toolbar--primary p-p-0 p-m-2 p-col-12"},{start:c(()=>[D(m(e.$t("qbe.filters.temporalFilter")),1)]),_:1})]),footer:c(()=>[i(g,{class:"kn-button kn-button--primary",onClick:e.closeDialog},{default:c(()=>[D(m(e.$t("common.cancel")),1)]),_:1},8,["onClick"]),i(g,{class:"kn-button kn-button--primary",onClick:e.save},{default:c(()=>[D(m(e.$t("common.save")),1)]),_:1},8,["onClick"])]),default:c(()=>[i(d,{class:"p-datatable-sm kn-table p-m-4",value:e.filters,selection:e.selectedFilter,"onUpdate:selection":t[0]||(t[0]=E=>e.selectedFilter=E),selectionMode:"single",responsiveLayout:"stack",breakpoint:"960px"},{empty:c(()=>[s("div",Go,m(e.$t("common.info.noDataFound")),1)]),default:c(()=>[i(u,{field:"name",header:e.$t("common.name"),sortable:!0},null,8,["header"])]),_:1},8,["value","selection"])]),_:1},8,["style","visible"])}var Xo=V(Ho,[["render",Yo]]);const Jo=$({name:"qbe-filter-parameters",components:{Column:H,DataTable:G},props:{visible:{type:Boolean},propParameters:{type:Array}},emits:["save","close","parametersUpdated"],data(){return{parameters:[]}},watch:{propParameters(){this.loadParameters()}},created(){this.loadParameters()},methods:{loadParameters(){var e;this.parameters=[],(e=this.propParameters)==null||e.forEach(t=>{var o;t.value=(o=t.value)!=null?o:t.defaultValue,this.parameters.push(t)})},onCellEditComplete(e){this.parameters[e.index]=e.newData,this.$emit("parametersUpdated",this.parameters)}}}),Ko={class:"p-d-flex p-flex-row p-ai-center"},Wo=s("i",{class:"pi pi-pencil p-ml-2"},null,-1),Zo={class:"p-d-flex p-flex-row p-ai-center"};function er(e,t,o,r,a,n){const l=k("Column"),u=k("InputText"),d=k("DataTable");return p(),y(d,{class:"p-datatable-sm kn-table p-m-4",value:e.parameters,editMode:"cell",responsiveLayout:"stack",breakpoint:"960px",onCellEditComplete:e.onCellEditComplete},{empty:c(()=>[s("div",null,m(e.$t("common.info.noDataFound")),1)]),default:c(()=>[i(l,{field:"name",header:e.$t("common.name"),sortable:!0},null,8,["header"]),i(l,{field:"value",header:e.$t("common.value"),sortable:!0},{editor:c(g=>[s("div",Ko,[i(u,{class:"kn-material-input p-inputtext-sm",modelValue:g.data[g.column.props.field],"onUpdate:modelValue":b=>g.data[g.column.props.field]=b},null,8,["modelValue","onUpdate:modelValue"]),Wo])]),body:c(g=>[s("div",Zo,[s("span",null,m(g.data[g.column.props.field]),1)])]),_:1},8,["header"])]),_:1},8,["value","onCellEditComplete"])}var tr=V(Jo,[["render",er]]);const or=$({name:"qbe-filter-dialog",components:{Dialog:B,KnFabButton:Ce,Message:Me,QBEFilterCard:jo,QBETemporalFilterDialog:Xo,QBEFilterParameters:tr},props:{visible:{type:Boolean},filterDialogData:{type:Object},id:{type:String},entities:{type:Array},propParameters:{type:Array,required:!0},propExpression:{type:Object}},emits:["save","close","parametersUpdated"],data(){return{QBEFilterDialogDescriptor:ge,filters:[],nextFilterIndex:"-1",temporalFilters:[],temporalFilterDialogVisible:!1,parameters:[],parameterTableVisible:!1,expression:{},updatedParameters:[]}},watch:{filterDialogData(){this.loadData()},propParameters:{handler(){this.loadParameters()},deep:!0},propExpression(){this.loadExpression()}},setup(){return{store:re()}},created(){this.loadData(),this.loadParameters(),this.loadExpression()},methods:{loadData(){var e;!this.filterDialogData||!this.filterDialogData.field||!this.filterDialogData.query||(this.filters=[],this.filterDialogData.query.filters.forEach(t=>{var o;t.leftOperandValue===((o=this.filterDialogData)==null?void 0:o.field.id)&&this.filters.push({...t})}),this.nextFilterIndex=R({length:16,type:"base64"}),this.filterDialogData.field.type==="inline.calculated.field"?this.setCalculatedFieldLongDescription(this.filterDialogData.field,this.filterDialogData.field.originalId):((e=this.filterDialogData.field.attributes)==null?void 0:e.type)==="inLineCalculatedField"&&this.setCalculatedFieldLongDescription(this.filterDialogData.field,this.filterDialogData.field.id))},setCalculatedFieldLongDescription(e,t){if(t){const r=t.substring(t.lastIndexOf(".")+1).split(":");e.longDescription=r[0]+" : "+r[1]}},loadParameters(){this.parameters=this.propParameters?[...this.propParameters]:[],this.updatedParameters=W(this.parameters)},loadExpression(){this.expression=this.propExpression},removeFilter(e){const t=this.filters.findIndex(o=>o.filterId===e.filterId);t!==-1&&this.filters.splice(t,1),ye(this.expression,"$F{"+e.filterId+"}")},addNewFilter(){var o,r,a,n,l,u,d,g,b;const e=this.filterDialogData?this.filterDialogData.field:{},t={filterId:"Filter"+this.nextFilterIndex,filterDescripion:"Filter"+this.nextFilterIndex,filterInd:this.nextFilterIndex,promptable:!1,leftOperandValue:((r=(o=this.filterDialogData)==null?void 0:o.field.attributes)==null?void 0:r.type)==="inLineCalculatedField"?(a=this.filterDialogData)==null?void 0:a.field.attributes.formState:e.id,leftOperandDescription:(n=e.longDescription)!=null?n:e.attributes.longDescription,leftOperandLongDescription:(l=e.longDescription)!=null?l:e.attributes.longDescription,leftOperandType:((u=this.filterDialogData)==null?void 0:u.field.type)==="inline.calculated.field"||((g=(d=this.filterDialogData)==null?void 0:d.field.attributes)==null?void 0:g.type)==="inLineCalculatedField"?"inline.calculated.field":"Field Content",leftOperandDefaultValue:null,leftOperandLastValue:null,leftOperandAlias:(b=e.alias)!=null?b:e.attributes.field,leftOperandDataType:"",operator:"EQUALS TO",rightOperandDescription:"",rightOperandLongDescription:"",rightOperandValue:[""],rightOperandType:"Static Content",rightType:"manual",rightOperandDefaultValue:[""],rightOperandLastValue:[""],rightOperandAlias:"",rightOperandDataType:"",booleanConnector:"AND",deleteButton:!1,color:"",entity:e.entity};e&&(this.filters.push(t),this.nextFilterIndex=R({length:16,type:"base64"})),this.push(t)},push(e){var t={type:"NODE_CONST",value:"$F{"+e.filterId+"}",childNodes:[],details:{leftOperandAlias:e.leftOperandAlias,operator:e.operator,entity:e.entity,rightOperandValue:e.rightOperandValue.join(", ")}};let o={};this.expression&&Object.keys(this.expression).length===0&&Object.getPrototypeOf(this.expression)===Object.prototype?(o={type:"NODE_OP",childNodes:[],value:e.booleanConnector||"AND"},o.childNodes.push(t),this.expression=JSON.parse(JSON.stringify(o))):this.expression.childNodes&&this.expression.childNodes.length<=1?(o=this.expression,o.childNodes.unshift(t)):(o={type:"NODE_OP",childNodes:[],value:e.booleanConnector||"AND"},o.childNodes.push(t),o.childNodes.push(JSON.parse(JSON.stringify(this.expression))),this.expression=JSON.parse(JSON.stringify(o)))},temporalFiltersEnabled(){var e,t,o,r;return this.store.$state.user.functionalities.includes("Timespan")&&(((t=(e=this.filterDialogData)==null?void 0:e.field.dataType)==null?void 0:t.toLowerCase())==="java.sql.date"||((r=(o=this.filterDialogData)==null?void 0:o.field.dataType)==null?void 0:r.toLowerCase())==="java.sql.timestamp")},async openTemporalFilterDialog(){await this.$http.get("/knowage/restful-services/1.0/timespan/listTimespan/?types=DAY_OF_WEEK&types=DAY_OF_WEEK&types=DAY_OF_WEEK").then(e=>this.temporalFilters=e.data.data),this.temporalFilterDialogVisible=!0},addTemporalFilter(e){var t,o,r,a,n,l,u,d,g,b,E,w,A,h,v,M,q,J;if(e)for(let Q=0;Q<e.definition.length;Q++){const K={filterId:"Filter"+this.nextFilterIndex,filterDescripion:"Filter"+this.nextFilterIndex,filterInd:this.nextFilterIndex,promptable:!1,leftOperandValue:((o=(t=this.filterDialogData)==null?void 0:t.field.attributes)==null?void 0:o.type)==="inLineCalculatedField"?(r=this.filterDialogData)==null?void 0:r.field.attributes.formState:(a=this.filterDialogData)==null?void 0:a.field.id,leftOperandDescription:(u=(n=this.filterDialogData)==null?void 0:n.field.longDescription)!=null?u:(l=this.filterDialogData)==null?void 0:l.field.attributes.longDescription,leftOperandLongDescription:(b=(d=this.filterDialogData)==null?void 0:d.field.longDescription)!=null?b:(g=this.filterDialogData)==null?void 0:g.field.attributes.longDescription,leftOperandType:((E=this.filterDialogData)==null?void 0:E.field.type)==="inline.calculated.field"||((A=(w=this.filterDialogData)==null?void 0:w.field.attributes)==null?void 0:A.type)==="inLineCalculatedField"?"inline.calculated.field":"Field Content",leftOperandDefaultValue:null,leftOperandLastValue:null,leftOperandAlias:(M=(h=this.filterDialogData)==null?void 0:h.field.alias)!=null?M:(v=this.filterDialogData)==null?void 0:v.field.attributes.field,leftOperandDataType:"",operator:"BETWEEN",rightType:"manual",rightOperandValue:[e.definition[Q].from,e.definition[Q].to],rightOperandDescription:this.createRightOperandDescription(e.definition[Q].from,e.definition[Q].to,(q=this.filterDialogData)==null?void 0:q.field.dataType),rightOperandLongDescription:this.createRightOperandDescription(e.definition[Q].from,e.definition[Q].to,(J=this.filterDialogData)==null?void 0:J.field.dataType),rightOperandType:"Static Content",rightOperandDefaultValue:[""],rightOperandLastValue:[""],rightOperandAlias:null,rightOperandDataType:"",booleanConnector:"OR",deleteButton:!1};this.filters.push(K),this.push(K),this.nextFilterIndex=R({length:16,type:"base64"})}this.temporalFilterDialogVisible=!1},createRightOperandDescription(e,t,o){return o==="java.sql.Timestamp"?e+" 00:00:00  ---- "+t+" 00:00:00 ":e+" ---- "+t},closeDialog(){this.$emit("close"),this.nextFilterIndex=R({length:16,type:"base64"}),this.updatedParameters=[],this.parameterTableVisible=!1,this.removeFiltersOnCancel()},removeFiltersOnCancel(){this.filters.forEach(e=>{var o;((o=this.filterDialogData)==null?void 0:o.query.filters.findIndex(r=>e.filterId===r.filterId))===-1&&ye(this.expression,"$F{"+e.filterId+"}")})},save(){var e;this.propParameters.length>0&&!this.parameterTableVisible&&this.filterUsesParameters()?this.parameterTableVisible=!0:(this.$emit("save",this.filters,(e=this.filterDialogData)==null?void 0:e.field,this.updatedParameters,this.expression),this.parameterTableVisible=!1)},onParametersUpdated(e){this.updatedParameters=e},filterUsesParameters(){let e=!1;for(let t=0;t<this.filters.length;t++)if(this.filters[t].rightType==="parameter"){e=!0;break}return e}}}),rr={key:1};function ar(e,t,o,r,a,n){const l=k("KnFabButton"),u=k("Toolbar"),d=k("Message"),g=k("QBEFilterCard"),b=k("QBEFilterParameters"),E=k("Button"),w=k("QBETemporalFilterDialog"),A=k("Dialog");return p(),y(A,{id:"qbe-filter-dialog",class:"p-fluid kn-dialog--toolbar--primary",style:O(e.QBEFilterDialogDescriptor.dialog.style),visible:e.visible,modal:!0,closable:!1},{header:c(()=>[i(u,{class:"kn-toolbar kn-toolbar--primary p-p-0 p-m-2 p-col-12"},{start:c(()=>[D(m(e.$t("common.filters")),1)]),end:c(()=>[T(s("i",{class:"fa fa-calendar kn-cursor-pointer p-mr-4",onClick:t[0]||(t[0]=(...h)=>e.openTemporalFilterDialog&&e.openTemporalFilterDialog(...h))},null,512),[[U,e.temporalFiltersEnabled()]]),i(l,{icon:"fas fa-plus",onClick:e.addNewFilter},null,8,["onClick"])]),_:1})]),footer:c(()=>[i(E,{class:"kn-button kn-button--primary",onClick:e.closeDialog},{default:c(()=>[D(m(e.$t("common.cancel")),1)]),_:1},8,["onClick"]),i(E,{class:"kn-button kn-button--primary",onClick:e.save},{default:c(()=>[D(m(e.parameterTableVisible?e.$t("qbe.filters.applyParameters"):e.$t("common.save")),1)]),_:1},8,["onClick"])]),default:c(()=>[e.filters.length===0&&!e.parameterTableVisible?(p(),y(d,{key:0,class:"p-m-4",severity:"info",closable:!1,style:O(e.QBEFilterDialogDescriptor.styles.message)},{default:c(()=>[D(m(e.$t("common.info.noDataFound")),1)]),_:1},8,["style"])):e.parameterTableVisible?e.parameterTableVisible?(p(),y(b,{key:2,propParameters:e.parameters,onParametersUpdated:e.onParametersUpdated},null,8,["propParameters","onParametersUpdated"])):C("",!0):(p(),f("div",rr,[(p(!0),f(z,null,N(e.filters,h=>{var v,M;return p(),y(g,{key:h.filterId,propFilter:h,id:e.id,propEntities:e.entities,subqueries:(v=e.filterDialogData)==null?void 0:v.query.subqueries,field:(M=e.filterDialogData)==null?void 0:M.field,propParameters:e.parameters,onRemoveFilter:e.removeFilter},null,8,["propFilter","id","propEntities","subqueries","field","propParameters","onRemoveFilter"])}),128))])),i(w,{visible:e.temporalFilterDialogVisible,temporalFilters:e.temporalFilters,onClose:t[1]||(t[1]=h=>e.temporalFilterDialogVisible=!1),onSave:e.addTemporalFilter},null,8,["visible","temporalFilters","onSave"])]),_:1},8,["style","visible"])}var nr=V(or,[["render",ar]]);const ir=["AND","OR"],lr={style:{height:"60%","max-height":"60%","max-width":"80%","min-width":"80%"}},sr=[{label:"qbe.filters.operators.equalsTo",value:"EQUALS TO"},{label:"qbe.filters.operators.greaterThan",value:"GREATER THAN"},{label:"qbe.filters.operators.equalsOrGreaterThan",value:"EQUALS OR GREATER THAN"},{label:"qbe.filters.operators.lessThan",value:"LESS THAN"},{label:"qbe.filters.operators.equalsOrLessThan",value:"EQUALS OR LESS THAN"}],dr={message:{"align-items":"center",display:"flex","justify-content":"center","text-align":"center"}};var je={booleanConnectors:ir,dialog:lr,operatorValues:sr,styles:dr};const cr=$({name:"qbe-filter-card",components:{Dropdown:Y},props:{propHaving:{type:Object},entities:{type:Array}},emits:["removeHaving"],data(){return{QBEHavingDialogDescriptor:je,having:null,targetValues:[{label:this.$t("qbe.filters.targets.manual"),value:""},{label:this.$t("qbe.filters.targets.entity"),value:"anotherEntity"}]}},watch:{propHaving(){this.loadHaving()}},created(){this.loadHaving()},methods:{loadHaving(){this.having=this.propHaving},onHavingTypeChange(){this.having&&(this.having.rightOperandDescription="",this.having.rightOperandLongDescription="",this.having.rightOperandAggregator="",this.having.rightOperandType=this.having.rightType==="anotherEntity"?"Field Content":"Static Content")},onManualValueChange(){this.having&&(this.having.rightOperandValue=[this.having.rightOperandDescription])},onEntityTypeChanged(){if(this.having){if(this.having.rightOperandType==="Field Content"&&this.entities){let e=null;const t=this.entities.findIndex(o=>{var r;return((r=this.having)==null?void 0:r.rightOperandDescription)===o.id});t!==-1&&(e=this.entities[t]),this.having.rightOperandAggregator=e.funct}this.having.rightOperandValue=[this.having.rightOperandDescription],this.having.rightOperandLongDescription=this.having.rightOperandDescription}}}}),pr={key:0},br={class:"p-grid p-m-2"},kr={class:"p-col-3"},ur={class:"kn-material-input-label"},mr={class:"p-col-2"},gr={class:"kn-material-input-label"},hr={key:0},fr={class:"qbe-filter-option-value"},vr={class:"p-col-2"},yr={class:"kn-material-input-label"},wr={class:"p-col-3"},xr={class:"kn-material-input-label"},Cr={class:"p-d-flex p-flex-row p-ai-center"},Mr={class:"p-col-2"},Ar={class:"kn-material-input-label"},Dr={class:"p-d-flex p-flex-row p-ai-center"};function Er(e,t,o,r,a,n){const l=k("InputText"),u=k("Dropdown"),d=j("tooltip");return e.having?(p(),f("div",pr,[s("div",br,[s("div",kr,[s("label",ur,m(e.$t("common.field")),1),i(l,{class:"kn-material-input",modelValue:e.having.leftOperandDescription,"onUpdate:modelValue":t[0]||(t[0]=g=>e.having.leftOperandDescription=g),disabled:!0},null,8,["modelValue"])]),s("div",mr,[T((p(),f("label",gr,[D(m(e.$t("qbe.filters.condition")),1)])),[[d,e.$t("qbe.filters.conditionTooltip"),void 0,{top:!0}]]),i(u,{class:"kn-material-input",modelValue:e.having.operator,"onUpdate:modelValue":t[1]||(t[1]=g=>e.having.operator=g),options:e.QBEHavingDialogDescriptor.operatorValues,optionValue:"value"},{value:c(g=>[g.value?(p(),f("div",hr,[s("span",fr,m(g.value.toLowerCase()),1)])):C("",!0)]),option:c(g=>[s("div",null,[s("span",null,m(e.$t(g.option.label)),1)])]),_:1},8,["modelValue","options"])]),s("div",vr,[s("label",yr,m(e.$t("qbe.filters.targetType")),1),i(u,{class:"kn-material-input",modelValue:e.having.rightType,"onUpdate:modelValue":t[2]||(t[2]=g=>e.having.rightType=g),options:e.targetValues,optionValue:"value",optionLabel:"label",onChange:e.onHavingTypeChange},null,8,["modelValue","options","onChange"])]),s("div",wr,[s("label",xr,m(e.$t("qbe.filters.target")),1),s("div",Cr,[e.having.rightType===""?(p(),y(l,{key:0,class:"kn-material-input",modelValue:e.having.rightOperandDescription,"onUpdate:modelValue":t[3]||(t[3]=g=>e.having.rightOperandDescription=g),onInput:e.onManualValueChange},null,8,["modelValue","onInput"])):e.having.rightType==="anotherEntity"?(p(),y(u,{key:1,class:"kn-material-input kn-flex",modelValue:e.having.rightOperandDescription,"onUpdate:modelValue":t[4]||(t[4]=g=>e.having.rightOperandDescription=g),options:e.entities,optionLabel:"field",optionValue:"id",onChange:e.onEntityTypeChanged},null,8,["modelValue","options","onChange"])):C("",!0)])]),s("div",Mr,[s("label",Ar,m(e.$t("qbe.filters.target")),1),s("div",Dr,[i(u,{class:"kn-material-input kn-flex",modelValue:e.having.booleanConnector,"onUpdate:modelValue":t[5]||(t[5]=g=>e.having.booleanConnector=g),options:e.QBEHavingDialogDescriptor.booleanConnectors},null,8,["modelValue","options"]),s("i",{class:"fa fa-eraser kn-cursor-pointer p-ml-2",onClick:t[6]||(t[6]=g=>e.$emit("removeHaving",e.having))})])])])])):C("",!0)}var Tr=V(cr,[["render",Er]]);const Sr=$({name:"qbe-having-dialog",components:{Dialog:B,KnFabButton:Ce,Message:Me,QBEHavingCard:Tr},props:{visible:{type:Boolean},havingDialogData:{type:Object},entities:{type:Array}},emits:["save","close"],data(){return{QBEHavingDialogDescriptor:je,havings:[],nextHavingIndex:"-1"}},watch:{havingDialogData(){this.loadData()}},created(){this.loadData()},methods:{loadData(){!this.havingDialogData||!this.havingDialogData.field||!this.havingDialogData.query||(this.havings=[],this.havingDialogData.query.havings.forEach(e=>{var t;e.leftOperandValue===((t=this.havingDialogData)==null?void 0:t.field.id)&&this.havings.push({...e})}),this.nextHavingIndex=R({length:16,type:"base64"}))},addNewHaving(){var t,o;const e=(t=this.havingDialogData)==null?void 0:t.field;e&&(this.havings.push({filterId:"having"+this.nextHavingIndex,filterDescripion:"having"+this.nextHavingIndex,filterInd:this.nextHavingIndex,promptable:!1,leftOperandAggregator:e.funct,leftOperandValue:e.id,leftOperandDescription:e.entity+": "+e.funct+" ("+e.alias+")",leftOperandLongDescription:e.entity+": "+e.funct+" ("+e.alias+")",leftOperandType:e.type==="inline.calculated.field"||((o=e.attributes)==null?void 0:o.type)==="inLineCalculatedField"?"inline.calculated.field":"Field Content",leftOperandDefaultValue:null,leftOperandLastValue:null,operator:"EQUALS TO",rightOperandAggregator:"",rightOperandValue:[],rightOperandDescription:"",rightOperandLongDescription:"",rightOperandType:"Static Content",rightType:"",rightOperandDefaultValue:[""],rightOperandLastValue:[""],booleanConnector:"AND",deleteButton:!1,color:"",entity:e.entity}),this.nextHavingIndex=R({length:16,type:"base64"}))},removeHaving(e){const t=this.havings.findIndex(o=>o.filterId===e.filterId);t!==-1&&this.havings.splice(t,1)},closeDialog(){this.$emit("close")},save(){var e;this.$emit("save",this.havings,(e=this.havingDialogData)==null?void 0:e.field)}}});function Or(e,t,o,r,a,n){const l=k("KnFabButton"),u=k("Toolbar"),d=k("Message"),g=k("QBEHavingCard"),b=k("Button"),E=k("Dialog");return p(),y(E,{id:"qbe-having-dialog",class:"p-fluid kn-dialog--toolbar--primary",style:O(e.QBEHavingDialogDescriptor.dialog.style),visible:e.visible,modal:!0,closable:!1},{header:c(()=>[i(u,{class:"kn-toolbar kn-toolbar--primary p-p-0 p-m-2 p-col-12"},{start:c(()=>[D(m(e.$t("qbe.having.title")),1)]),end:c(()=>[i(l,{icon:"fas fa-plus",onClick:e.addNewHaving},null,8,["onClick"])]),_:1})]),footer:c(()=>[i(b,{class:"kn-button kn-button--primary",onClick:e.closeDialog},{default:c(()=>[D(m(e.$t("common.cancel")),1)]),_:1},8,["onClick"]),i(b,{class:"kn-button kn-button--primary",onClick:e.save},{default:c(()=>[D(m(e.$t("common.save")),1)]),_:1},8,["onClick"])]),default:c(()=>[i(d,{class:"p-mx-4",severity:"info",closable:!1,style:O(e.QBEHavingDialogDescriptor.styles.message)},{default:c(()=>[D(m(e.$t("qbe.having.infoMessage")),1)]),_:1},8,["style"]),e.havings.length===0?(p(),y(d,{key:0,class:"p-mx-4 p-my-2",severity:"info",closable:!1,style:O(e.QBEHavingDialogDescriptor.styles.message)},{default:c(()=>[D(m(e.$t("qbe.having.noHavings")),1)]),_:1},8,["style"])):C("",!0),s("div",null,[(p(!0),f(z,null,N(e.havings,w=>(p(),y(g,{key:w.filterId,propHaving:w,entities:e.entities,onRemoveHaving:e.removeHaving},null,8,["propHaving","entities","onRemoveHaving"]))),128))])]),_:1},8,["style","visible"])}var $r=V(Sr,[["render",Or]]);const Vr=["NONE","SUM","MIN","MAX","AVG","COUNT","COUNT_DISTINCT"],Ir=["NONE","MIN","MAX","COUNT","COUNT_DISTINCT"],qr=[{field:"entity",header:"qbe.simpleTable.entity",style:""},{field:"field",header:"common.field",style:""},{field:"alias",header:"common.alias",style:""},{field:"group",header:"common.group",style:"width: 8%"},{field:"order",header:"common.order",style:""},{field:"funct",header:"qbe.simpleTable.aggregationShort",style:""},{field:"visible",header:"common.show",style:"width: 8%"},{field:"inUse",header:"common.inUse",style:"width: 8%"}],zr="width: 3rem",Fr=["NONE","ASC","DESC"],Nr={firstColumn:{width:"3%"},lastColumn:{width:"1%"}};var Qr={aggregationOptions:Vr,attributeAggregationOptions:Ir,columns:qr,headerStyle:zr,orderingOptions:Fr,style:Nr};const Lr=$({name:"qbe-simple-table",props:{query:{type:Object}},components:{Checkbox:me,Column:H,DataTable:G,Dropdown:Y,Menu:ft},emits:["columnVisibilityChanged","openFilterDialog","openHavingDialog","entityDropped","groupingChanged","openCalculatedFieldDialog","fieldDeleted"],data(){return{QBESimpleTableDescriptor:Qr,selectedQuery:{},rows:[],menuItems:[]}},computed:{queryFields(){return this.query?this.query.fields:[]}},watch:{queryFields(){this.loadData()}},created(){this.loadData()},methods:{loadData(){!this.query||(this.selectedQuery=this.query,this.rows=this.selectedQuery.fields)},getAttributeOptions(e){return e.fieldType==="attribute"?this.QBESimpleTableDescriptor.attributeAggregationOptions:this.QBESimpleTableDescriptor.aggregationOptions},getHeaderTooltip(e){switch(e.field){case"funct":return this.$t("qbe.simpleTable.aggregation");case"visible":return this.$t("qbe.simpleTable.showField");default:return this.$t(e.header)}},toggle(e,t,o){this.createMenuItems(t,o);const r=this.$refs.menu;r==null||r.toggle(e)},createMenuItems(e,t){this.menuItems=[],this.menuItems.push({icon:"pi pi-filter",label:this.$t("common.filters"),command:()=>this.openFiltersDialog(e)}),(e.funct&&e.funct!=="NONE"||e.type==="inline.calculated.field"&&e.fieldType==="measure")&&this.menuItems.push({icon:"pi pi-filter",label:this.$t("qbe.simpleTable.havings"),command:()=>this.openHavingsDialog(e)}),e.type==="inline.calculated.field"&&this.menuItems.push({icon:"fas fa-calculator",label:this.$t("qbe.detailView.modifyCalcField"),command:()=>this.openCalculatedFieldDialog(e,t)}),this.menuItems.push({icon:"pi pi-trash",label:this.$t("common.delete"),command:()=>this.deleteColumn(t)})},onRowReorder(e){this.rows=e.value,this.selectedQuery.fields=this.rows},openFiltersDialog(e){this.$emit("openFilterDialog",e)},openHavingsDialog(e){this.$emit("openHavingDialog",{field:e,query:this.selectedQuery})},openCalculatedFieldDialog(e,t){this.$emit("openCalculatedFieldDialog",e,t)},onDrop(e){const t=JSON.parse(e.dataTransfer.getData("text/plain"));this.$emit("entityDropped",t)},onGroupingChanged(e){e.funct="NONE",this.$emit("groupingChanged",e)},deleteColumn(e){this.$emit("fieldDeleted",{...this.rows[e]}),this.rows.splice(e,1)}}}),Ur={key:6,class:"kn-truncated"};function Br(e,t,o,r,a,n){const l=k("Column"),u=k("InputText"),d=k("Checkbox"),g=k("Dropdown"),b=k("Button"),E=k("Menu"),w=k("DataTable"),A=j("tooltip");return p(),y(w,{class:"p-datatable-sm kn-table kn-height-full",value:e.rows,responsiveLayout:"scroll",onRowReorder:e.onRowReorder,onDrop:t[1]||(t[1]=h=>e.onDrop(h)),onDragover:t[2]||(t[2]=X(()=>{},["prevent"])),onDragenter:t[3]||(t[3]=X(()=>{},["prevent"]))},{default:c(()=>[i(l,{rowReorder:!0,style:O(e.QBESimpleTableDescriptor.style.firstColumn)},null,8,["style"]),(p(!0),f(z,null,N(e.QBESimpleTableDescriptor.columns,h=>(p(),y(l,{key:h.header,field:h.field,style:O(h.style),sortable:!0},{header:c(()=>[T((p(),f("span",null,[D(m(e.$t(h.header)),1)])),[[A,e.getHeaderTooltip(h),void 0,{top:!0}]])]),body:c(v=>[h.field==="alias"?(p(),y(u,{key:0,class:"kn-material-input p-inputtext-sm qbe-simple-table-input",modelValue:v.data[v.column.props.field],"onUpdate:modelValue":M=>v.data[v.column.props.field]=M,onChange:M=>e.$emit("fieldAliasChanged",v.data)},null,8,["modelValue","onUpdate:modelValue","onChange"])):h.field==="group"?(p(),y(d,{key:1,modelValue:v.data[v.column.props.field],"onUpdate:modelValue":M=>v.data[v.column.props.field]=M,binary:!0,onChange:M=>e.onGroupingChanged(v.data)},null,8,["modelValue","onUpdate:modelValue","onChange"])):h.field==="order"?(p(),y(g,{key:2,class:"kn-material-input",modelValue:v.data[v.column.props.field],"onUpdate:modelValue":M=>v.data[v.column.props.field]=M,options:e.QBESimpleTableDescriptor.orderingOptions},null,8,["modelValue","onUpdate:modelValue","options"])):h.field==="funct"?(p(),y(g,{key:3,class:"kn-material-input",modelValue:v.data[v.column.props.field],"onUpdate:modelValue":M=>v.data[v.column.props.field]=M,options:e.getAttributeOptions(v.data),disabled:v.data.group},null,8,["modelValue","onUpdate:modelValue","options","disabled"])):h.field==="visible"?(p(),y(d,{key:4,class:"p-ml-3",modelValue:v.data[v.column.props.field],"onUpdate:modelValue":M=>v.data[v.column.props.field]=M,binary:!0,onChange:t[0]||(t[0]=M=>e.$emit("columnVisibilityChanged"))},null,8,["modelValue","onUpdate:modelValue"])):h.field==="inUse"?(p(),y(d,{key:5,class:"p-ml-2",modelValue:v.data[v.column.props.field],"onUpdate:modelValue":M=>v.data[v.column.props.field]=M,binary:!0},null,8,["modelValue","onUpdate:modelValue"])):T((p(),f("span",Ur,[D(m(v.data[v.column.props.field]),1)])),[[A,v.data[v.column.props.field],void 0,{top:!0}]])]),_:2},1032,["field","style"]))),128)),i(l,{style:O(e.QBESimpleTableDescriptor.style.lastColumn)},{body:c(h=>[i(b,{icon:"fas fa-ellipsis-v",class:"p-button-link",onClick:v=>e.toggle(v,h.data,h.index),"data-test":"menu-toggle"},null,8,["onClick"]),i(E,{ref:"menu",model:e.menuItems,popup:!0},null,8,["model"])]),_:1},8,["style"])]),_:1},8,["value","onRowReorder"])}var Pr=V(Lr,[["render",Br]]);const Rr=$({name:"olap-custom-view-save-dialog",components:{Dialog:B},props:{sqlData:Object,visible:Boolean},data(){return{sqlFormats:{}}},watch:{sqlData(){this.sqlFormats=this.sqlData}},created(){this.sqlFormats=this.sqlData},methods:{}}),_r=["innerHTML"];function jr(e,t,o,r,a,n){const l=k("Toolbar"),u=k("Button"),d=k("Dialog");return p(),y(d,{id:"qbe-filter-dialog",class:"p-fluid kn-dialog--toolbar--primary",visible:e.visible,modal:!0,closable:!1},{header:c(()=>[i(l,{class:"kn-toolbar kn-toolbar--primary p-p-0 p-m-2 p-col-12"},{start:c(()=>[s("span",null,m(e.$t("qbe.detailView.toolbarMenu.sql")),1)]),_:1})]),footer:c(()=>[i(u,{class:"kn-button kn-button--primary",onClick:t[0]||(t[0]=g=>e.$emit("close"))},{default:c(()=>[D(m(e.$t("common.ok")),1)]),_:1})]),default:c(()=>[s("div",{innerHTML:e.sqlFormats.sqlFormatted},null,8,_r)]),_:1},8,["visible"])}var Hr=V(Rr,[["render",jr]]);const Gr={columns:[{field:"relationName",header:"qbe.entities.relationDialog.relationName"},{field:"sourceFields",header:"qbe.entities.relationDialog.sourceFields"},{field:"targetEntityLabel",header:"qbe.entities.relationDialog.targetEntity"},{field:"targetFields",header:"qbe.entities.relationDialog.targetFields"},{field:"joinType",header:"qbe.entities.relationDialog.joinType"}],style:{"min-width":"60%"}},Yr={datasetParamTypes:[{name:"String",value:"String"},{name:"Number",value:"Number"}],newParam:{defaultValue:"",multiValue:!1,name:"",type:""}};var ke={entityRelation:Gr,paramDialog:Yr};const Xr=$({name:"olap-custom-view-save-dialog",components:{Dialog:B,DataTable:G,Column:H},props:{propEntity:Object,visible:Boolean},data(){return{relationDescriptor:ke}}});function Jr(e,t,o,r,a,n){const l=k("Toolbar"),u=k("Column"),d=k("DataTable"),g=k("Button"),b=k("Dialog");return p(),y(b,{id:"qbe-filter-dialog",class:"p-fluid kn-dialog--toolbar--primary",style:O(e.relationDescriptor.entityRelation.style),visible:e.visible,modal:!0,closable:!1},{header:c(()=>[i(l,{class:"kn-toolbar kn-toolbar--primary"},{start:c(()=>[D(m(e.propEntity.text),1)]),_:1})]),footer:c(()=>[i(g,{class:"kn-button kn-button--primary",onClick:t[0]||(t[0]=E=>e.$emit("close"))},{default:c(()=>[D(m(e.$t("common.ok")),1)]),_:1})]),default:c(()=>[i(d,{class:"p-datatable-sm kn-table p-m-2",value:e.propEntity.relation,responsiveLayout:"scroll",stripedRows:""},{empty:c(()=>[D(m(e.$t("qbe.entities.relationDialog.noRelations")),1)]),default:c(()=>[(p(!0),f(z,null,N(e.relationDescriptor.entityRelation.columns,E=>(p(),y(u,{class:"kn-truncated",key:E.field,field:E.field,header:e.$t(E.header),sortable:!0},null,8,["field","header"]))),128))]),_:1},8,["value"])]),_:1},8,["style","visible"])}var Kr=V(Xr,[["render",Jr]]);const Wr=$({name:"olap-custom-view-save-dialog",components:{KnFabButton:Ce,Dialog:B,Message:Me,Dropdown:Y,DataTable:G,Column:H,Checkbox:me},props:{propDataset:{type:Object,required:!0},visible:Boolean},emits:["close","save"],computed:{hasDuplicates(){var e=!1;return this.dataset.pars.map(t=>t.name).sort().sort((t,o)=>{t===o&&(e=!0)}),e}},data(){return{descriptor:ke,dataset:{},initialParsState:[],datasetParamTypes:ke.paramDialog.datasetParamTypes}},watch:{propDataset(){this.dataset=this.propDataset,this.initialParsState=JSON.parse(JSON.stringify(this.propDataset.pars))}},created(){this.dataset=this.propDataset,this.initialParsState=JSON.parse(JSON.stringify(this.propDataset.pars))},methods:{addNewParam(){this.dataset.isPersisted?this.$confirm.require({message:this.$t("managers.datasetManagement.disablePersistenceMsg"),header:this.$t("managers.datasetManagement.disablePersistence"),icon:"pi pi-exclamation-triangle",accept:()=>{this.dataset.isPersisted=!1,this.dataset.persistTableName=null,this.insertParameter()}}):this.insertParameter()},insertParameter(){this.dataset.pars||(this.dataset.pars=[]);const e={...ke.paramDialog.newParam};this.dataset.pars.push(e)},deleteParam(e){this.$confirm.require({message:this.$t("common.toast.deleteMessage"),header:this.$t("common.uppercaseDelete"),icon:"pi pi-exclamation-triangle",accept:()=>this.dataset.pars=this.dataset.pars.filter(t=>e.data.name!==t.name)})},removeAllParams(){this.$confirm.require({message:this.$t("managers.datasetManagement.deleteAllParamsMsg"),header:this.$t("managers.datasetManagement.deleteAllParams"),icon:"pi pi-exclamation-triangle",accept:()=>this.dataset.pars=[]})},cancelChanges(){this.dataset.pars=JSON.parse(JSON.stringify(this.initialParsState)),this.$emit("close")},onDefaultValueChange(e){e.defaultValueChanged=!0},saveParameters(){var e;(e=this.dataset.pars)==null||e.forEach(t=>{t.defaultValueChanged&&(delete t.value,delete t.defaultValueChanged)}),this.$emit("save")}}});function Zr(e,t,o,r,a,n){const l=k("KnFabButton"),u=k("Toolbar"),d=k("Message"),g=k("InputText"),b=k("Column"),E=k("Dropdown"),w=k("Checkbox"),A=k("Button"),h=k("DataTable"),v=k("Dialog");return p(),y(v,{id:"qbe-filter-dialog",style:O(e.descriptor.entityRelation.style),visible:e.visible,modal:!0,closable:!1},{header:c(()=>[i(u,{class:"kn-toolbar kn-toolbar--primary kn-width-full"},{start:c(()=>[D(m(e.$t("common.parameters")),1)]),end:c(()=>[i(l,{icon:"fas fa-plus",onClick:e.addNewParam},null,8,["onClick"])]),_:1})]),footer:c(()=>[i(A,{class:"kn-button kn-button--secondary",onClick:e.cancelChanges},{default:c(()=>[D(m(e.$t("common.cancel")),1)]),_:1},8,["onClick"]),i(A,{class:"kn-button kn-button--primary",disabled:e.hasDuplicates,onClick:e.saveParameters},{default:c(()=>[D(m(e.$t("common.save")),1)]),_:1},8,["disabled","onClick"])]),default:c(()=>[e.hasDuplicates?(p(),y(d,{key:0,class:"p-mx-2",severity:"info",closable:!1},{default:c(()=>[D(m(e.$t("qbe.detailView.parameterDuplicates")),1)]),_:1})):C("",!0),i(h,{class:"p-datatable-sm kn-table p-m-2",value:e.dataset.pars,responsiveLayout:"scroll"},{empty:c(()=>[D(m(e.$t("managers.datasetManagement.tableEmpty")),1)]),default:c(()=>[i(b,{field:"name",header:e.$t("kpi.alert.name"),sortable:!0},{body:c(({data:M})=>[i(g,{class:"kn-material-input",modelValue:M.name,"onUpdate:modelValue":q=>M.name=q},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["header"]),i(b,{field:"type",header:e.$t("kpi.alert.type"),sortable:!0},{body:c(({data:M})=>[i(E,{id:"scope",class:"kn-material-input",options:e.datasetParamTypes,optionLabel:"name",optionValue:"value",modelValue:M.type,"onUpdate:modelValue":q=>M.type=q},null,8,["options","modelValue","onUpdate:modelValue"])]),_:1},8,["header"]),i(b,{field:"defaultValue",header:e.$t("managers.driversManagement.useModes.defaultValue"),sortable:!0},{body:c(({data:M})=>[i(g,{class:"kn-material-input",modelValue:M.defaultValue,"onUpdate:modelValue":q=>M.defaultValue=q,onChange:q=>e.onDefaultValueChange(M)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1},8,["header"]),i(b,{field:"multiValue",header:e.$t("managers.profileAttributesManagement.form.multiValue"),sortable:!0},{body:c(({data:M})=>[i(w,{modelValue:M.multiValue,"onUpdate:modelValue":q=>M.multiValue=q,binary:!0},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["header"]),i(b,{onRowClick:M=>!1},{header:c(()=>[i(A,{icon:"fas fa-eraser",class:"p-button-link",onClick:e.removeAllParams},null,8,["onClick"])]),body:c(M=>[i(A,{icon:"fas fa-trash",class:"p-button-link",onClick:q=>e.deleteParam(M)},null,8,["onClick"])]),_:1})]),_:1},8,["value"])]),_:1},8,["style","visible"])}var ea=V(Wr,[["render",Zr]]);const ta={style:{"min-width":"60%"}},oa={advancedTab:[{fieldName:"persistTableName",validators:[{key:"required",validator:{type:"persist-field-required"}}]}],dataset:[{fieldName:"name",validators:[{key:"required"},{key:"regex",validator:{type:"extendedAlphanumericRegex"}}]},{fieldName:"label",validators:[{key:"required"},{key:"regex",validator:{type:"extendedAlphanumericRegex"}}]},{fieldName:"description",validators:[{key:"regex",validator:{type:"extendedAlphanumericRegex"}}]},{fieldName:"scopeCd",validators:[{key:"required"}]},{fieldName:"catTypeVn",validators:[{key:"required",validator:{type:"cat-type-required"}}]}]};var oe={dialog:ta,validations:oa};const ra=$({name:"olap-custom-view-save-dialog",components:{Card:ue,Dropdown:Y,KnValidationMessages:Le},props:{propDataset:Object,scopeTypes:Array,categoryTypes:Array},computed:{qbeAdvancedSaving(){return this.store.$state.user.functionalities.includes("QbeAdvancedSaving")}},data(){return{v$:Ae(),dataset:{},descriptor:oe}},setup(){return{store:re()}},created(){this.dataset=this.propDataset},watch:{selectedDataset(){this.dataset=this.propDataset}},validations(){const t={"cat-type-required":r=>this.dataset.scopeCd=="USER"||r};return{dataset:Ue("dataset",oe.validations.dataset,t)}},methods:{updateIdFromCd(e,t,o){const r=e.find(a=>a.VALUE_CD===o);r&&(this.dataset[t]=r.VALUE_ID)}}}),aa={class:"p-fluid p-formgrid p-grid"},na={class:"p-field p-mt-1 p-col-6"},ia={class:"p-float-label"},la={for:"label",class:"kn-material-input-label"},sa={class:"p-field p-mt-1 p-col-6"},da={class:"p-float-label"},ca={for:"name",class:"kn-material-input-label"},pa={class:"p-field p-mt-1 p-col-12"},ba={class:"p-float-label"},ka={for:"description",class:"kn-material-input-label"},ua={key:0,class:"p-field p-mt-1 p-col-6"},ma={class:"p-float-label"},ga={for:"scope",class:"kn-material-input-label"},ha={key:1,class:"p-field p-mt-1 p-col-6"},fa={class:"p-float-label"},va={key:0,for:"category",class:"kn-material-input-label"},ya={key:1,for:"category",class:"kn-material-input-label"};function wa(e,t,o,r,a,n){const l=k("InputText"),u=k("KnValidationMessages"),d=k("Dropdown"),g=k("Card");return p(),y(g,null,{content:c(()=>[s("form",aa,[s("div",na,[s("span",ia,[i(l,{id:"label",class:I(["kn-material-input",{"p-invalid":e.v$.dataset.label.$invalid&&e.v$.dataset.label.$dirty}]),type:"text",maxLength:"50",modelValue:e.v$.dataset.label.$model,"onUpdate:modelValue":t[0]||(t[0]=b=>e.v$.dataset.label.$model=b),onBlur:t[1]||(t[1]=b=>e.v$.dataset.label.$touch()),onChange:t[2]||(t[2]=b=>e.$emit("touched")),"data-test":"label-input"},null,8,["modelValue","class"]),s("label",la,m(e.$t("common.label"))+" * ",1)]),i(u,{class:"p-mt-1",vComp:e.v$.dataset.label,additionalTranslateParams:{fieldName:e.$t("common.label")}},null,8,["vComp","additionalTranslateParams"])]),s("div",sa,[s("span",da,[i(l,{id:"name",class:I(["kn-material-input",{"p-invalid":e.v$.dataset.name.$invalid&&e.v$.dataset.name.$dirty}]),type:"text",maxLength:"50",modelValue:e.v$.dataset.name.$model,"onUpdate:modelValue":t[3]||(t[3]=b=>e.v$.dataset.name.$model=b),onBlur:t[4]||(t[4]=b=>e.v$.dataset.name.$touch()),onChange:t[5]||(t[5]=b=>e.$emit("touched")),"data-test":"name-input"},null,8,["modelValue","class"]),s("label",ca,m(e.$t("common.name"))+" * ",1)]),i(u,{class:"p-mt-1",vComp:e.v$.dataset.name,additionalTranslateParams:{fieldName:e.$t("common.name")}},null,8,["vComp","additionalTranslateParams"])]),s("div",pa,[s("span",ba,[i(l,{id:"description",class:I(["kn-material-input",{"p-invalid":e.v$.dataset.description.$invalid&&e.v$.dataset.description.$dirty}]),type:"text",maxLength:"150",modelValue:e.v$.dataset.description.$model,"onUpdate:modelValue":t[6]||(t[6]=b=>e.v$.dataset.description.$model=b),onBlur:t[7]||(t[7]=b=>e.v$.dataset.description.$touch()),onChange:t[8]||(t[8]=b=>e.$emit("touched")),"data-test":"description-input"},null,8,["modelValue","class"]),s("label",ka,m(e.$t("common.description")),1)]),i(u,{class:"p-mt-1",vComp:e.v$.dataset.description,additionalTranslateParams:{fieldName:e.$t("common.description")}},null,8,["vComp","additionalTranslateParams"])]),e.qbeAdvancedSaving?(p(),f("div",ua,[s("span",ma,[i(d,{id:"scope",class:I(["kn-material-input",{"p-invalid":e.v$.dataset.scopeCd.$invalid&&e.v$.dataset.scopeCd.$dirty}]),options:e.scopeTypes,optionLabel:"VALUE_CD",optionValue:"VALUE_CD",modelValue:e.v$.dataset.scopeCd.$model,"onUpdate:modelValue":t[9]||(t[9]=b=>e.v$.dataset.scopeCd.$model=b),onBeforeShow:t[10]||(t[10]=b=>e.v$.dataset.scopeCd.$touch()),onChange:t[11]||(t[11]=b=>(e.updateIdFromCd(this.scopeTypes,"scopeId",b.value),e.$emit("touched"))),"data-test":"scope-input"},null,8,["options","modelValue","class"]),s("label",ga,m(e.$t("managers.datasetManagement.scope"))+" * ",1)]),i(u,{vComp:e.v$.dataset.scopeCd,additionalTranslateParams:{fieldName:e.$t("managers.datasetManagement.scope")}},null,8,["vComp","additionalTranslateParams"])])):C("",!0),e.qbeAdvancedSaving?(p(),f("div",ha,[s("span",fa,[i(d,{id:"category",class:I(["kn-material-input",{"p-invalid":e.v$.dataset.catTypeVn.$invalid&&e.v$.dataset.catTypeVn.$dirty}]),options:e.categoryTypes,optionLabel:"VALUE_CD",optionValue:"VALUE_CD",modelValue:e.v$.dataset.catTypeVn.$model,"onUpdate:modelValue":t[12]||(t[12]=b=>e.v$.dataset.catTypeVn.$model=b),onBeforeShow:t[13]||(t[13]=b=>e.v$.dataset.catTypeVn.$touch()),onChange:t[14]||(t[14]=b=>(e.updateIdFromCd(this.categoryTypes,"catTypeId",b.value),e.$emit("touched"))),"data-test":"category-input"},null,8,["options","modelValue","class"]),this.dataset.scopeCd=="USER"?(p(),f("label",va,m(e.$t("common.category")),1)):(p(),f("label",ya,m(e.$t("common.category"))+" * ",1))]),i(u,{vComp:e.v$.dataset.catTypeVn,additionalTranslateParams:{fieldName:e.$t("managers.datasetManagement.scope")}},null,8,["vComp","additionalTranslateParams"])])):C("",!0)])]),_:1})}var xa=V(ra,[["render",wa]]);const Ca={advancedTab:[{fieldName:"pivotColName",validators:[{key:"required",validator:{type:"transformable-field-required"}}]},{fieldName:"pivotColValue",validators:[{key:"required",validator:{type:"transformable-field-required"}}]},{fieldName:"pivotRowName",validators:[{key:"required",validator:{type:"transformable-field-required"}}]},{fieldName:"persistTableName",validators:[{key:"required",validator:{type:"persist-field-required"}}]}]};var Ma={validations:Ca};const Aa=$({components:{Card:ue,Calendar:Qe,MultiSelect:vt,Dropdown:Y},props:{selectedDataset:{type:Object},schedulingData:{type:Object}},computed:{validDates(){let e=!0;const t=this.dataset.startDate,o=new Date,r=this.dataset.endDate;return r&&r.valueOf()<o.valueOf()&&(e=!1),r&&r.valueOf()<t.valueOf()&&(e=!1),this.$emit("cronValid",e),e}},emits:["touched","cronValid"],data(){return{moment:L,knCronDescriptor:yt,advancedTabDescriptor:Ma,dataset:{},scheduling:{},nextSchedulation:null,startTemp:null,endTemp:null,minutes:Array.from(Array(60).keys()).map(String),hours:Array.from(Array(24).keys()).map(String),days:Array.from({length:31},(e,t)=>t+1).map(String),months:[{value:"1",label:this.$t("cron.january")},{value:"2",label:this.$t("cron.february")},{value:"3",label:this.$t("cron.march")},{value:"4",label:this.$t("cron.april")},{value:"5",label:this.$t("cron.may")},{value:"6",label:this.$t("cron.june")},{value:"7",label:this.$t("cron.july")},{value:"8",label:this.$t("cron.august")},{value:"9",label:this.$t("cron.september")},{value:"10",label:this.$t("cron.october")},{value:"11",label:this.$t("cron.november")},{value:"12",label:this.$t("cron.december")}],weekdays:[{value:"1",label:this.$t("cron.monday")},{value:"2",label:this.$t("cron.tuesday")},{value:"3",label:this.$t("cron.wednesday")},{value:"4",label:this.$t("cron.thursday")},{value:"5",label:this.$t("cron.friday")},{value:"6",label:this.$t("cron.saturday")},{value:"7",label:this.$t("cron.sunday")}]}},created(){this.loadData(),this.deparseScheduling()},watch:{selectedDataset(){this.loadData(),this.deparseScheduling()}},methods:{loadData(){this.dataset=this.selectedDataset,this.scheduling=this.schedulingData,this.nextSchedulation=this.selectedDataset.schedulingCronLine,this.startTemp=this.selectedDataset.startDate?new Date(this.selectedDataset.startDate):null,this.endTemp=this.selectedDataset.endDate?new Date(this.selectedDataset.endDate):null},deparseScheduling(){var e="";if(this.dataset.isScheduled&&this.dataset.schedulingCronLine){this.dataset.startDate=new Date(this.dataset.startDate),this.dataset.endDate?this.dataset.endDate=new Date(this.dataset.endDate):this.dataset.endDate=null;var t=this.dataset.schedulingCronLine.split(" "),o=t[1]!="*"?t[1]:null,r=t[2]!="*"?t[2]:null,a=t[3]!="*"?t[3]:null,n=t[4]!="*"?t[4]:null,l=t[5]!="*"&&t[5]!="?"?t[5]:null;for(let u=1;u<t.length;u++)e+=t[u]+" ";this.dataset.schedulingCronLine=e,this.setSchedulingValues(o,"minutesSelected","minute"),this.setSchedulingValues(r,"hoursSelected","hour"),this.setSchedulingValues(a,"daysSelected","day"),this.setSchedulingValues(n,"monthsSelected","month"),this.setSchedulingValues(l,"weekdaysSelected","week")}},setSchedulingValues(e,t,o){var r=new Array;if(e!=null){var a=e.split(",");for(let n=0;n<a.length;n++)r.push(a[n]);this.scheduling[t]=r,this.scheduling.repeatInterval=o}else this.scheduling[t]=[]},formatCronForSave(){if(this.dataset.isScheduled){this.dataset.startDate==null&&(this.dataset.startDate=new Date);var e=this.scheduling.repeatInterval,t=this.stringifySchedulingValues(this.scheduling.minutesSelected&&this.scheduling.minutesSelected.length!=0,"minutesSelected"),o=this.stringifySchedulingValues(e!="minute"&&this.scheduling.hoursSelected&&this.scheduling.hoursSelected.length!=0,"hoursSelected"),r=this.stringifySchedulingValues((e==="day"||e==="month")&&this.scheduling.daysSelected&&this.scheduling.daysSelected.length!=0,"daysSelected"),a=this.stringifySchedulingValues(e==="month"&&this.scheduling.monthsSelected.length!=0,"monthsSelected"),n=this.stringifySchedulingValues(e==="week"&&this.scheduling.weekdaysSelected.length!=0,"weekdaysSelected");r=="*"&&n!="*"?r="?":n="?",this.nextSchedulation=t+" "+o+" "+r+" "+a+" "+n}},stringifySchedulingValues(e,t){var o="";if(e){for(var r=0;r<this.scheduling[t].length;r++)o+=""+this.scheduling[t][r],r<this.scheduling[t].length-1&&(o+=",");return o}else return o="*",o},setDate(e,t){var o=L(e);t==="startDate"?this.dataset.startDate=o.format("YYYY-MM-DD[T]HH:mm:ss[Z]"):this.dataset.endDate=o.format("YYYY-MM-DD[T]HH:mm:ss[Z]")}}}),Da={class:"date-picker-container p-ml-2 p-mb-5"},Ea={class:"p-field p-grid"},Ta={for:"startDate",class:"kn-material-input-label p-col-12 p-md-1 p-mb-md-0"},Sa={key:0,class:"p-error p-grid p-mt-1"},Oa={class:"p-col-12"},$a={class:"p-field p-grid"},Va={for:"endDate",class:"kn-material-input-label p-col-12 p-md-1 p-mb-md-0"},Ia={key:0,class:"p-error p-grid p-mt-1"},qa={class:"p-col-12"},za={class:"p-d-flex p-grid p-mt-5"},Fa={class:"p-mx-2"},Na={for:"repeatInterval",class:"kn-material-input-label p-m-2"},Qa={key:0,class:"p-field"},La={for:"weekdays",class:"kn-material-input-label"},Ua={key:1,class:"p-field"},Ba={for:"months",class:"kn-material-input-label"},Pa={key:2,class:"p-field"},Ra={for:"days",class:"kn-material-input-label"},_a={key:3,class:"p-field"},ja={for:"hours",class:"kn-material-input-label"},Ha={key:4,class:"p-field p-ml-2"},Ga={for:"minutes",class:"kn-material-input-label"};function Ya(e,t,o,r,a,n){const l=k("Calendar"),u=k("Dropdown"),d=k("MultiSelect"),g=k("Card");return p(),y(g,{class:"p-m-2"},{content:c(()=>[s("div",Da,[s("div",Ea,[s("label",Ta,m(e.$t("cron.startDate"))+": ",1),s("span",null,[i(l,{id:"startDate",class:I(["kn-material-input",{"p-invalid":!e.validDates}]),modelValue:e.startTemp,"onUpdate:modelValue":t[0]||(t[0]=b=>e.startTemp=b),style:{width:"20rem"},showIcon:!0,manualInput:!0,onDateSelect:t[1]||(t[1]=b=>e.setDate(b,"startDate"))},null,8,["modelValue","class"]),e.validDates?C("",!0):(p(),f("div",Sa,[s("small",Oa,m(e.$t("kpi.kpiScheduler.dateError")),1)]))])]),s("div",$a,[s("label",Va,m(e.$t("cron.endDate"))+": ",1),s("span",null,[i(l,{id:"endDate",class:I(["kn-material-input",{"p-invalid":!e.validDates}]),modelValue:e.endTemp,"onUpdate:modelValue":t[2]||(t[2]=b=>e.endTemp=b),style:{width:"20rem"},showIcon:!0,manualInput:!0,showButtonBar:!0,onDateSelect:t[3]||(t[3]=b=>e.setDate(b,"endDate"))},null,8,["modelValue","class"]),e.validDates?C("",!0):(p(),f("div",Ia,[s("small",qa,m(e.$t("kpi.kpiScheduler.dateError")),1)]))])])]),s("div",za,[s("div",Fa,[s("label",Na,m(e.$t("managers.functionalitiesManagement.execution"))+": ",1),s("span",null,[i(u,{id:"repeatInterval",class:"kn-material-input",style:O(e.knCronDescriptor.style.intervalInput),modelValue:e.scheduling.repeatInterval,"onUpdate:modelValue":t[4]||(t[4]=b=>e.scheduling.repeatInterval=b),optionLabel:"name",optionValue:"value",options:e.knCronDescriptor.intervals,onChange:e.updateCronInterval},null,8,["style","modelValue","options","onChange"])])]),e.scheduling.repeatInterval==="week"?(p(),f("div",Qa,[s("label",La,m(e.$t("cron.inWeekday")),1),i(d,{id:"weekdays",class:"kn-material-input p-mx-2",style:{"max-width":"8rem"},modelValue:e.scheduling.weekdaysSelected,"onUpdate:modelValue":t[5]||(t[5]=b=>e.scheduling.weekdaysSelected=b),options:e.weekdays,optionLabel:"label",optionValue:"value",placeholder:e.$t("common.default"),onChange:e.formatCronForSave},null,8,["modelValue","options","placeholder","onChange"])])):C("",!0),e.scheduling.repeatInterval==="month"?(p(),f("div",Ua,[s("label",Ba,m(e.$t("cron.inMonth")),1),i(d,{id:"months",class:"kn-material-input p-mx-2",style:{"max-width":"8rem"},modelValue:e.scheduling.monthsSelected,"onUpdate:modelValue":t[6]||(t[6]=b=>e.scheduling.monthsSelected=b),options:e.months,optionLabel:"label",optionValue:"value",placeholder:e.$t("common.default"),onChange:e.formatCronForSave},null,8,["modelValue","options","placeholder","onChange"])])):C("",!0),e.scheduling.repeatInterval==="day"||e.scheduling.repeatInterval==="month"?(p(),f("div",Pa,[s("label",Ra,m(e.$t("cron.inDay")),1),i(d,{id:"days",class:"kn-material-input p-mx-2",style:{"max-width":"8rem"},modelValue:e.scheduling.daysSelected,"onUpdate:modelValue":t[7]||(t[7]=b=>e.scheduling.daysSelected=b),options:e.days,placeholder:e.$t("common.default"),onChange:e.formatCronForSave},null,8,["modelValue","options","placeholder","onChange"])])):C("",!0),e.scheduling.repeatInterval&&e.scheduling.repeatInterval!="minute"?(p(),f("div",_a,[s("label",ja,m(e.$t("cron.inHour")),1),i(d,{id:"hours",class:"kn-material-input p-mx-2",style:{"max-width":"8rem"},modelValue:e.scheduling.hoursSelected,"onUpdate:modelValue":t[8]||(t[8]=b=>e.scheduling.hoursSelected=b),options:e.hours,placeholder:e.$t("common.default"),onChange:e.formatCronForSave},null,8,["modelValue","options","placeholder","onChange"])])):C("",!0),e.scheduling.repeatInterval?(p(),f("div",Ha,[s("label",Ga,m(e.$t("cron.inMinute")),1),i(d,{id:"minutes",class:"kn-material-input p-mx-2",style:{"max-width":"8rem"},modelValue:e.scheduling.minutesSelected,"onUpdate:modelValue":t[9]||(t[9]=b=>e.scheduling.minutesSelected=b),options:e.minutes,placeholder:e.$t("common.default"),onChange:e.formatCronForSave},null,8,["modelValue","options","placeholder","onChange"])])):C("",!0)])]),_:1})}var Xa=V(Aa,[["render",Ya]]);const Ja=$({name:"olap-custom-view-save-dialog",components:{Card:ue,KnValidationMessages:Le,InputSwitch:Ne,DatasetScheduler:Xa},props:{propDataset:Object,schedulingData:Object},computed:{disablePersist(){return!!(this.dataset.pars&&this.dataset.pars.length>0)}},data(){return{v$:Ae(),dataset:{},descriptor:oe}},created(){this.dataset=this.propDataset},watch:{selectedDataset(){this.dataset=this.propDataset}},validations(){const t={"persist-field-required":r=>!this.dataset.isPersisted||r};return{dataset:Ue("dataset",oe.validations.advancedTab,t)}},methods:{updateIdFromCd(e,t,o){const r=e.find(a=>a.VALUE_CD===o);r&&(this.dataset[t]=r.VALUE_ID)}}}),Ka={key:0},Wa={class:"p-fluid p-formgrid p-grid"},Za={class:"p-field p-col-6"},en={class:"p-float-label"},tn={for:"persistTableName",class:"kn-material-input-label"};function on(e,t,o,r,a,n){const l=k("InputSwitch"),u=k("Toolbar"),d=k("InputText"),g=k("KnValidationMessages"),b=k("DatasetScheduler"),E=k("Card");return p(),f(z,null,[i(u,{class:"kn-toolbar kn-toolbar--secondary"},{start:c(()=>[i(l,{modelValue:e.dataset.isPersistedHDFS,"onUpdate:modelValue":t[0]||(t[0]=w=>e.dataset.isPersistedHDFS=w),class:"p-mr-2",onChange:t[1]||(t[1]=w=>e.$emit("touched"))},null,8,["modelValue"]),s("span",null,m(e.$t("managers.datasetManagement.isPersistedHDFS")),1)]),_:1}),e.dataset.dsTypeCd!="Flat"?(p(),f("div",Ka,[i(u,{class:"kn-toolbar kn-toolbar--secondary p-mt-3"},{start:c(()=>[i(l,{modelValue:e.dataset.isPersisted,"onUpdate:modelValue":t[2]||(t[2]=w=>e.dataset.isPersisted=w),disabled:e.disablePersist,class:"p-mr-2",onChange:t[3]||(t[3]=w=>e.$emit("touched"))},null,8,["modelValue","disabled"]),s("span",null,m(e.$t("managers.datasetManagement.isPersisted")),1)]),_:1}),e.dataset.isPersisted?(p(),y(E,{key:0},{content:c(()=>[s("form",Wa,[s("div",Za,[s("span",en,[i(d,{id:"persistTableName",class:I(["kn-material-input",{"p-invalid":e.v$.dataset.persistTableName.$invalid&&e.v$.dataset.persistTableName.$dirty}]),type:"text",modelValue:e.dataset.persistTableName,"onUpdate:modelValue":t[4]||(t[4]=w=>e.dataset.persistTableName=w),onBlur:t[5]||(t[5]=w=>e.v$.dataset.persistTableName.$touch()),onChange:t[6]||(t[6]=w=>e.$emit("touched"))},null,8,["modelValue","class"]),s("label",tn,m(e.$t("managers.datasetManagement.persistTableName"))+" *",1)]),i(g,{class:"p-mt-1",vComp:e.v$.dataset.persistTableName,additionalTranslateParams:{fieldName:e.$t("managers.datasetManagement.persistTableName")}},null,8,["vComp","additionalTranslateParams"])])]),e.dataset.isPersisted?(p(),y(u,{key:0,class:"kn-toolbar kn-toolbar--default p-mt-3"},{start:c(()=>[i(l,{modelValue:e.dataset.isScheduled,"onUpdate:modelValue":t[7]||(t[7]=w=>e.dataset.isScheduled=w),class:"p-mr-2",onChange:t[8]||(t[8]=w=>e.$emit("touched"))},null,8,["modelValue"]),s("span",null,m(e.$t("managers.datasetManagement.isScheduled")),1)]),_:1})):C("",!0),e.dataset.isPersisted&&e.dataset.isScheduled?(p(),y(b,{key:1,selectedDataset:e.dataset,schedulingData:e.schedulingData},null,8,["selectedDataset","schedulingData"])):C("",!0)]),_:1})):C("",!0)])):C("",!0)],64)}var rn=V(Ja,[["render",on]]);const an=[{name:"ATTRIBUTE",value:"ATTRIBUTE"},{name:"SPATIAL ATTRIBUTE",value:"SPATIAL_ATTRIBUTE"},{name:"MEASURE",value:"MEASURE"}],nn={maxwidth:{"border-bottom":"none",width:"100%"}},ln=[{disabled:!1,name:"java.lang.String",value:"String"},{disabled:!1,name:"java.sql.Date",value:"Date"},{disabled:!1,name:"java.time.LocalDateTime",value:"Local Date"},{disabled:!0,name:"net.minidev.json.JSONArray",value:"JSON"},{disabled:!0,name:"java.util.LinkedHashMap",value:"Hash Map"},{disabled:!0,name:"java.lang.Boolean",value:"Boolean"},{disabled:!0,name:"java.lang.Double",value:"Double"},{disabled:!1,name:"java.lang.Integer",value:"Integer"},{disabled:!0,name:"java.lang.Long",value:"Long"},{disabled:!1,name:"java.util.Date",value:"Date"},{disabled:!1,name:"oracle.sql.TIMESTAMP",value:"Date"},{disabled:!1,name:"java.sql.Timestamp",value:"Timestamp"},{disabled:!1,name:"java.math.BigDecimal",value:"Float"},{disabled:!1,name:"java.lang.Float",value:"Float"}];var ve={fieldsMetadataTypes:an,style:nn,valueTypes:ln};const sn=$({components:{Card:ue,Column:H,DataTable:G,Dropdown:Y,Checkbox:me},props:{propMetadata:{type:Array}},emits:["touched"],data(){return{linkTabDescriptor:ve,fieldMetadataTypes:ve.fieldsMetadataTypes,valueTypes:ve.valueTypes,fieldsMetadata:[]}},setup(){return{store:re()}},created(){this.fieldsMetadata=this.propMetadata},watch:{propMetadata:{handler(){this.fieldsMetadata=this.propMetadata},deep:!0}},methods:{warnForDuplicateSpatialFields(){var e=0;for(let t=0;t<this.fieldsMetadata.length;t++)if(this.fieldsMetadata[t].fieldType=="SPATIAL_ATTRIBUTE"&&(e++,e>1)){this.store.setError({title:this.$t("common.error.saving"),msg:this.$t("managers.datasetManagement.duplicateSpatialAttribute")});return}}}});function dn(e,t,o,r,a,n){const l=k("Toolbar"),u=k("Column"),d=k("Dropdown"),g=k("Checkbox"),b=k("DataTable"),E=k("Card");return p(),y(E,{class:"p-m-2"},{header:c(()=>[i(l,{class:"kn-toolbar kn-toolbar--secondary"},{start:c(()=>[D(m(e.$t("managers.datasetManagement.fieldsMetadata")),1)]),_:1})]),content:c(()=>[i(b,{class:"p-datatable-sm kn-table kn-table-small-input",autoLayout:!0,value:e.fieldsMetadata,responsiveLayout:"stack",breakpoint:"960px"},{default:c(()=>[i(u,{field:"fieldAlias",header:e.$t("managers.datasetManagement.fieldAlias"),sortable:!0},{body:c(({data:w})=>[D(m(w.fieldAlias),1)]),_:1},8,["header"]),i(u,{field:"Type",header:e.$t("importExport.catalogFunction.column.type"),sortable:!0},{body:c(({data:w})=>[i(d,{class:"kn-material-input",style:O(e.linkTabDescriptor.style.maxwidth),modelValue:w.Type,"onUpdate:modelValue":A=>w.Type=A,options:e.valueTypes,optionDisabled:"disabled",optionLabel:"value",optionValue:"name",onChange:e.warnForDuplicateSpatialFields,disabled:!0},null,8,["style","modelValue","onUpdate:modelValue","options","onChange"])]),_:1},8,["header"]),i(u,{field:"fieldType",header:e.$t("managers.datasetManagement.fieldType"),sortable:!0},{body:c(({data:w})=>[i(d,{class:"kn-material-input",style:O(e.linkTabDescriptor.style.maxwidth),modelValue:w.fieldType,"onUpdate:modelValue":A=>w.fieldType=A,options:e.fieldMetadataTypes,optionLabel:"value",optionValue:"value",onChange:t[0]||(t[0]=A=>e.warnForDuplicateSpatialFields("fieldType"))},null,8,["style","modelValue","onUpdate:modelValue","options"])]),_:1},8,["header"]),i(u,{hidden:"true",field:"personal",header:e.$t("managers.datasetManagement.personal"),sortable:!0},{body:c(({data:w})=>[i(g,{id:"personal",modelValue:w.personal,"onUpdate:modelValue":A=>w.personal=A,binary:!0,onChange:t[1]||(t[1]=A=>e.warnForDuplicateSpatialFields("personal"))},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["header"]),i(u,{hidden:"true",field:"decrypt",header:e.$t("managers.datasetManagement.decrypt"),sortable:!0},{body:c(({data:w})=>[i(g,{id:"decrypt",modelValue:w.decrypt,"onUpdate:modelValue":A=>w.decrypt=A,binary:!0,onChange:t[2]||(t[2]=A=>e.warnForDuplicateSpatialFields("decrypt"))},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["header"]),i(u,{hidden:"true",field:"subjectId",header:e.$t("managers.datasetManagement.subjectId"),sortable:!0},{body:c(({data:w})=>[i(g,{id:"subjectId",modelValue:w.subjectId,"onUpdate:modelValue":A=>w.subjectId=A,binary:!0,onChange:t[3]||(t[3]=A=>e.warnForDuplicateSpatialFields("subjectId"))},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["header"])]),_:1},8,["value"])]),_:1})}var cn=V(sn,[["render",dn]]);const pn=$({name:"olap-custom-view-save-dialog",components:{TabView:ct,TabPanel:pt,Dialog:B,DetailTab:xa,PersistenceTab:rn,MetadataCard:cn},props:{propDataset:{type:Object,required:!0},propMetadata:{type:Array,required:!0},visible:Boolean},computed:{buttonDisabled(){return this.v$.$invalid}},data(){return{descriptor:oe,v$:Ae(),scopeTypes:[],selectedDataset:{},selectedDatasetId:null,categoryTypes:[],fieldsMetadata:[],scheduling:{repeatInterval:null}}},setup(){return{store:re()}},created(){this.getDomainData(),this.selectedDataset=this.propDataset},watch:{propDataset:{handler(){this.selectedDataset=this.propDataset,this.setEndUserScope()},deep:!0}},methods:{getDomainByType(e){return this.$http.get(`/knowage/restful-services/domains/listValueDescriptionByType?DOMAIN_TYPE=${e}`)},async getDomainData(){await this.getDomainByType("DS_SCOPE").then(e=>this.scopeTypes=e.data),await this.getDomainByType("DATASET_CATEGORY").then(e=>this.categoryTypes=e.data)},async saveDataset(){let e={...this.selectedDataset};e.pars||(e.pars=[]),e.pythonEnvironment&&(e.pythonEnvironment=JSON.stringify(e.pythonEnvironment)),e.meta?e.meta=await this.manageDatasetFieldMetadata(this.propMetadata):e.meta=[],e.isScheduled&&(e.schedulingCronLine=await this.formatCronForSave()),await this.$http.post("/knowage/restful-services/1.0/datasets/",e,{headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json;charset=UTF-8"}}).then(t=>{this.store.setInfo({title:this.$t("common.toast.createTitle"),msg:this.$t("common.toast.success")}),this.selectedDataset.meta=t.data.meta,this.selectedDataset.id?this.$emit("updated"):(this.selectedDataset.id=t.data.id,this.$emit("created",t)),this.$emit("datasetSaved"),this.$emit("close")}).catch()},async manageDatasetFieldMetadata(e){var t=e.map(o=>({name:o.column,displayedName:o.fieldAlias,type:o.Type,fieldType:o.fieldType,decrypt:o.decrypt,personal:o.personal,subjectId:o.subjectId}));return t},async manageDatasetFieldMetadata1(e){if(e.columns!=null&&e.columns!=null){for(var t=new Array,o=new Array,r=0;r<e.columns.length;r++){var a=e.columns[r];o.push(a.column)}for(o=this.removeDuplicates(o),r=0;r<o.length;r++){var n={displayedName:"",name:"",fieldType:"",type:"",personal:!1,decrypt:!1,subjectId:!1},l=o[r];if(l.indexOf(":")!=-1){var u=l.split(":");n.displayedName=u[1]}else n.displayedName=l;n.name=l;for(var d=0;d<e.columns.length;d++)a=e.columns[d],a.column==l&&(a.pname.toUpperCase()=="type".toUpperCase()?n.type=a.pvalue:a.pname.toUpperCase()=="fieldType".toUpperCase()?n.fieldType=a.pvalue:a.pname.toUpperCase()=="personal".toUpperCase()?n.personal=a.pvalue:a.pname.toUpperCase()=="decrypt".toUpperCase()?n.decrypt=a.pvalue:a.pname.toUpperCase()=="subjectId".toUpperCase()&&(n.subjectId=a.pvalue));t.push(n)}return t}},removeDuplicates(e){for(var t={},o=e.length-1;o>=0;o--)e[o]in t?e.splice(o,1):t[e[o]]=!0;return e},async formatCronForSave(){if(this.selectedDataset.isScheduled){this.selectedDataset.startDate==null&&(this.selectedDataset.startDate=new Date);var e=this.scheduling.repeatInterval,t="",o=0,r=this.stringifySchedulingValues(this.scheduling.minutesSelected&&this.scheduling.minutesSelected.length!=0,"minutesSelected"),a=this.stringifySchedulingValues(e!="minute"&&this.scheduling.hoursSelected&&this.scheduling.hoursSelected.length!=0,"hoursSelected"),n=this.stringifySchedulingValues((e==="day"||e==="month")&&this.scheduling.daysSelected&&this.scheduling.daysSelected.length!=0,"daysSelected"),l=this.stringifySchedulingValues(e==="month"&&this.scheduling.monthsSelected&&this.scheduling.monthsSelected.length!=0,"monthsSelected"),u=this.stringifySchedulingValues(e==="week"&&this.scheduling.weekdaysSelected&&this.scheduling.weekdaysSelected.length!=0,"weekdaysSelected");return n=="*"&&u!="*"?n="?":u="?",t=r+" "+a+" "+n+" "+l+" "+u,o+" "+t}},stringifySchedulingValues(e,t){var o="";if(e){for(var r=0;r<this.scheduling[t].length;r++)o+=""+this.scheduling[t][r],r<this.scheduling[t].length-1&&(o+=",");return o}else return o="*",o},setEndUserScope(){if(this.selectedDataset&&!this.selectedDataset.id&&!this.store.$state.user.functionalities.includes("QbeAdvancedSaving")){let e=this.scopeTypes.find(t=>t.VALUE_CD==="USER");this.selectedDataset.scopeCd=e.VALUE_CD,this.selectedDataset.scopeId=e.VALUE_ID}}}});function bn(e,t,o,r,a,n){const l=k("Toolbar"),u=k("DetailTab"),d=k("TabPanel"),g=k("MetadataCard"),b=k("PersistenceTab"),E=k("TabView"),w=k("Button"),A=k("Dialog");return p(),y(A,{id:"qbe-saving-dialog",class:"p-fluid kn-dialog--toolbar--primary",style:O(e.descriptor.dialog.style),visible:e.visible,modal:!0,closable:!1},{header:c(()=>[i(l,{class:"kn-toolbar kn-toolbar--primary"},{start:c(()=>[D(m(e.$t("qbe.savingDialog.title")),1)]),_:1})]),footer:c(()=>[i(w,{class:"kn-button kn-button--secondary",onClick:t[2]||(t[2]=h=>e.$emit("close"))},{default:c(()=>[D(m(e.$t("common.cancel")),1)]),_:1}),i(w,{class:"kn-button kn-button--primary",disabled:e.buttonDisabled,onClick:e.saveDataset},{default:c(()=>[D(m(e.$t("common.save")),1)]),_:1},8,["disabled","onClick"])]),default:c(()=>[i(E,{class:"tabview-custom",activeIndex:e.activeTab,"onUpdate:activeIndex":t[1]||(t[1]=h=>e.activeTab=h),"data-test":"tab-view"},{default:c(()=>[i(d,null,{header:c(()=>[s("span",null,m(e.$t("managers.mondrianSchemasManagement.detail.title")),1)]),default:c(()=>[i(u,{propDataset:e.propDataset,scopeTypes:e.scopeTypes,categoryTypes:e.categoryTypes},null,8,["propDataset","scopeTypes","categoryTypes"])]),_:1}),i(d,null,{header:c(()=>[s("span",null,m(e.$t("kpi.measureDefinition.metadata")),1)]),default:c(()=>[i(g,{propMetadata:e.propMetadata,onTouched:t[0]||(t[0]=h=>e.$emit("touched"))},null,8,["propMetadata"])]),_:1}),i(d,null,{header:c(()=>[s("span",null,m(e.$t("qbe.savingDialog.persistence")),1)]),default:c(()=>[i(b,{propDataset:e.propDataset,schedulingData:e.scheduling},null,8,["propDataset","schedulingData"])]),_:1})]),_:1},8,["activeIndex"])]),_:1},8,["style","visible"])}var kn=V(pn,[["render",bn]]);const un={column:{"flex-basis":"100px","flex-grow":1}};var mn={style:un};const gn=$({name:"qbe-simple-table",props:{previewData:{type:Object,required:!0},query:{type:Object,required:!0},pagination:{type:Object}},components:{Column:H,DataTable:G,Menu:Be,Dialog:B},emits:["removeFieldFromQuery","orderChanged","fieldHidden","fieldGrouped","fieldAggregated","aliasChanged","entityDropped","reordered","pageChanged","openFilterDialog"],data(){return{qbeSimpleTableDescriptor:mn,aliasDialogVisible:!1,alias:"",menuButtons:[],lazyParams:{},selectedField:{},first:0}},computed:{filteredVisibleFields(){var e=this.query.fields.filter(t=>t.visible===!0&&t.inUse===!0);return e}},watch:{previewData(){this.loadPagination()}},created(){this.loadPagination()},methods:{showMenu(e,t){this.createMenuItems(t),this.$refs.smartTableMenu.toggle(e)},createMenuItems(e){this.menuButtons=[];let t=e.visible?"fas fa-check":"fas fa-times",o=e.group?"fas fa-check":"fas fa-times";this.menuButtons.push({key:"1",label:this.$t("qbe.detailView.smartViewMenu.showField"),icon:t,command:()=>this.hideField(e)},{key:"2",label:this.$t("qbe.detailView.smartViewMenu.group"),icon:o,visible:e.iconCls=="attribute"||e.iconCls=="calculation"&&e.attributes.formState.nature.toLowerCase()=="attribute",command:()=>this.groupField(e)},{key:"3",label:this.$t("qbe.detailView.smartViewMenu.aggregation.title")+`: ${e.funct}`,visible:e.iconCls=="measure"||e.iconCls=="calculation"&&e.attributes.formState.nature.toLowerCase()=="measure",items:[{label:this.$t("qbe.detailView.smartViewMenu.aggregation.sum"),command:()=>this.applyAggregation(e,"SUM")},{label:this.$t("qbe.detailView.smartViewMenu.aggregation.min"),command:()=>this.applyAggregation(e,"MIN")},{label:this.$t("qbe.detailView.smartViewMenu.aggregation.max"),command:()=>this.applyAggregation(e,"MAX")},{label:this.$t("qbe.detailView.smartViewMenu.aggregation.avg"),command:()=>this.applyAggregation(e,"AVG")},{label:this.$t("qbe.detailView.smartViewMenu.aggregation.count"),command:()=>this.applyAggregation(e,"COUNT")},{label:this.$t("qbe.detailView.smartViewMenu.aggregation.distinct"),command:()=>this.applyAggregation(e,"COUNT_DISTINCT")}]},{key:"4",label:this.$t("qbe.detailView.smartViewMenu.rename"),icon:"fas fa-tag",command:()=>this.showChangeAliasDialog(e)})},changeOrder(e){e.order==="ASC"?e.order="DESC":e.order="ASC",this.$emit("orderChanged")},hideField(e){e.visible=!e.visible,this.$emit("fieldHidden")},groupField(e){e.group=!e.group,this.$emit("fieldGrouped")},applyAggregation(e,t){e.funct=t,this.$emit("fieldAggregated")},showChangeAliasDialog(e){this.selectedField=e,this.alias=JSON.parse(JSON.stringify(e.alias)),this.aliasDialogVisible=!0},changeAlias(){this.selectedField.alias=this.alias,this.aliasDialogVisible=!1,this.$emit("aliasChanged",this.selectedField)},onDrop(e){var t=JSON.parse(e.dataTransfer.getData("text/plain"));this.$emit("entityDropped",t)},loadPagination(){var e;this.lazyParams=this.pagination,this.first=(e=this.pagination)==null?void 0:e.start},onPage(e){this.lazyParams={paginationStart:e.first,paginationLimit:e.rows,paginationEnd:e.first+e.rows,size:this.lazyParams.size},this.$emit("pageChanged",this.lazyParams)},fieldHasFilters(e){for(let t=0;t<this.query.filters.length;t++)if(this.query.filters[t].leftOperandValue===e.id)return!0;return!1},openFiltersDialog(e){this.$emit("openFilterDialog",e)},getFormattedNumber(e,t,o){return bt(e,t,o)},getFormattedDate(e,t,o){return ze(e,t,o)}}}),hn={id:"noFunctionsFound"},fn={class:"customHeader"},vn=["title"],yn={class:"qbeHeaderContainer"},wn=["onClick","data-test"],xn={class:"p-mx-2 kn-truncated"},Cn=["onClick"],Mn=["onClick"],An=["onClick","data-test"],Dn={key:0},En={key:1},Tn={key:2},Sn={key:3},On={key:4},$n={key:5},Vn={class:"p-float-label p-m-4"},In={for:"alias",class:"kn-material-input-label"};function qn(e,t,o,r,a,n){const l=k("Column"),u=k("DataTable"),d=k("Toolbar"),g=k("InputText"),b=k("Button"),E=k("Dialog"),w=k("Menu"),A=j("tooltip");return p(),f(z,null,[e.previewData!=null?(p(),y(u,{key:0,class:"qbe-smart-table",first:e.first,value:e.previewData.rows,scrollable:!0,scrollHeight:"flex",scrollDirection:"both",resizableColumns:!0,reorderableColumns:!0,rowHover:!0,columnResizeMode:"expand",paginator:!0,lazy:!0,rows:25,totalRecords:e.lazyParams.size,currentPageReportTemplate:e.$t("common.table.footer.paginated",{first:"{first}",last:"{last}",totalRecords:"{totalRecords}"}),onPage:t[0]||(t[0]=h=>e.onPage(h)),onColumnReorder:t[1]||(t[1]=h=>e.$emit("reordered",h)),onDrop:t[2]||(t[2]=X(h=>e.onDrop(h),["stop"])),onDragover:t[3]||(t[3]=X(()=>{},["prevent"])),onDragenter:t[4]||(t[4]=X(()=>{},["prevent"])),stripedRows:"",showGridlines:""},{empty:c(()=>[s("div",hn,m(e.$t("common.info.noDataFound")),1)]),default:c(()=>[(p(!0),f(z,null,N(e.filteredVisibleFields,(h,v)=>(p(),y(l,{class:"kn-truncated",hidden:!h.visible,field:`column_${v+1}`,key:v,style:O(e.qbeSimpleTableDescriptor.style.column)},{header:c(()=>[s("div",fn,[s("div",{class:"qbeCustomTopColor",style:O(`background-color: ${h.color}`),title:h.entity},null,12,vn),s("div",yn,[T(s("i",{class:"fas fa-sort p-ml-2",onClick:M=>e.changeOrder(h),"data-test":"change-order-"+h.alias},null,8,wn),[[A,e.$t("qbe.detailView.smartViewMenu.sorting"),void 0,{bottom:!0}]]),T((p(),f("span",xn,[D(m(h.alias),1)])),[[A,h.alias,void 0,{bottom:!0}]]),T(s("i",{class:"fas fa-cog p-ml-auto",onClick:M=>e.showMenu(M,h)},null,8,Cn),[[A,e.$t("qbe.detailView.smartViewMenu.colset"),void 0,{bottom:!0}]]),T(s("i",{class:I(["fas fa-filter p-mx-2",{"qbe-active-filter-icon":e.fieldHasFilters(h)}]),onClick:M=>e.openFiltersDialog(h)},null,10,Mn),[[A,e.$t("qbe.detailView.smartViewMenu.colfil"),void 0,{bottom:!0}]]),T(s("i",{class:"fas fa-times p-mr-2",onClick:M=>e.$emit("removeFieldFromQuery",h.uniqueID),"data-test":"delete-column-"+h.alias},null,8,An),[[A,e.$t("qbe.detailView.smartViewMenu.coldel"),void 0,{bottom:!0}]])])])]),body:c(M=>{var q,J,Q,K,ae,ne,ie,le,se,Z,de,ce;return[typeof M.data[`column_${v+1}`]=="number"&&M.data[`column_${v+1}`]?(p(),f("span",Dn,m(e.getFormattedNumber(M.data[`column_${v+1}`])),1)):C("",!0),((Q=(J=(q=e.previewData)==null?void 0:q.metaData)==null?void 0:J.fields[v+1])==null?void 0:Q.type)==="date"&&h.type!="inline.calculated.field"?(p(),f("span",En,m(e.getFormattedDate(M.data[`column_${v+1}`],e.previewData.metaData.fields[v+1].metawebDateFormat,"DD/MM/YYYY")),1)):((ne=(ae=(K=e.previewData)==null?void 0:K.metaData)==null?void 0:ae.fields[v+1])==null?void 0:ne.type)==="date"&&h.type=="inline.calculated.field"?(p(),f("span",Tn,m(e.getFormattedDate(M.data[`column_${v+1}`],h.id.format,"DD/MM/YYYY")),1)):((se=(le=(ie=e.previewData)==null?void 0:ie.metaData)==null?void 0:le.fields[v+1])==null?void 0:se.type)==="timestamp"&&h.type!="inline.calculated.field"?(p(),f("span",Sn,m(e.getFormattedDate(M.data[`column_${v+1}`],e.previewData.metaData.fields[v+1].metawebDateFormat,"DD/MM/YYYY HH:mm:ss.SSS")),1)):((ce=(de=(Z=e.previewData)==null?void 0:Z.metaData)==null?void 0:de.fields[v+1])==null?void 0:ce.type)==="timestamp"&&h.type=="inline.calculated.field"?(p(),f("span",On,m(e.getFormattedDate(M.data[`column_${v+1}`],h.id.format,"DD/MM/YYYY HH:mm:ss.SSS")),1)):T((p(),f("span",$n,[D(m(M.data[`column_${v+1}`]),1)])),[[A,M.data[`column_${v+1}`],void 0,{bottom:!0}]])]}),_:2},1032,["hidden","field","style"]))),128))]),_:1},8,["first","value","totalRecords","currentPageReportTemplate"])):(p(),f("div",{key:1,class:"kn-height-full kn-width-full",onDrop:t[5]||(t[5]=h=>e.onDrop(h)),onDragover:t[6]||(t[6]=X(()=>{},["prevent"])),onDragenter:t[7]||(t[7]=X(()=>{},["prevent"]))},m(e.$t("common.info.noDataFound")),33)),e.aliasDialogVisible?(p(),y(E,{key:2,class:"qbe-smart-table-alias-dialog",visible:e.aliasDialogVisible,modal:!0,closable:!1,baseZIndex:1,autoZIndex:!0},{header:c(()=>[i(d,{class:"kn-toolbar kn-toolbar--primary p-col-12"},{start:c(()=>[D(m(e.$t("common.alias")),1)]),_:1})]),footer:c(()=>[i(b,{class:"kn-button kn-button--secondary",onClick:t[9]||(t[9]=h=>e.aliasDialogVisible=!1)},{default:c(()=>[D(m(e.$t("common.cancel")),1)]),_:1}),i(b,{class:"kn-button kn-button--primary",onClick:e.changeAlias},{default:c(()=>[D(m(e.$t("common.save")),1)]),_:1},8,["onClick"])]),default:c(()=>[s("span",Vn,[i(g,{id:"alias",class:"kn-material-input",type:"text",maxLength:"50",modelValue:e.alias,"onUpdate:modelValue":t[8]||(t[8]=h=>e.alias=h)},null,8,["modelValue"]),s("label",In,m(e.$t("common.alias")),1)])]),_:1},8,["visible"])):C("",!0),i(w,{id:"smartTableMenu",ref:"smartTableMenu",model:e.menuButtons},null,8,["model"])],64)}var zn=V(gn,[["render",qn]]);const Fn=$({name:"expandable-entity",components:{},props:{availableEntities:{type:Array},query:{type:Object,required:!0}},emits:["close","showRelationDialog","openFilterDialog","entityChildClicked"],data(){return{entities:[],colors:["#D7263D","#F46036","#2E294E","#1B998B","#C5D86D","#3F51B5","#8BC34A","#009688","#F44336"]}},watch:{availableEntities(){this.entities=this.availableEntities,this.setupEntities()}},created(){this.entities=this.availableEntities,this.setupEntities()},methods:{expandEntity(e){e.expanded=!e.expanded},setupEntities(){var t;let e=0;(t=this.entities)==null||t.forEach(o=>{this.colors[e]||(e=0);var r=this.colors[e];e++,o.color=r,o.children&&o.children.forEach(a=>{a.color=r})})},getIconCls(e){switch(e){case"measure":return"fas fa-ruler";case"cube":return"fas fa-cube";case"calculation":return"fas fa-calculator";case"dimension":return"fas fa-ruler-horizontal";case"geographic dimension":return"fas fa-map-marked-alt";case"attribute":return"fas fa-font";case"generic":return"fas fa-layer-group";case"geographic_dimension":return"fas fa-globe";default:return"fas fa-cube"}},onDragStart(e,t){e.dataTransfer.setData("text",JSON.stringify(t)),e.dataTransfer.dropEffect="move",e.dataTransfer.effectAllowed="move"},openFiltersDialog(e){this.$emit("openFilterDialog",e)},fieldHasFilters(e){var t;for(let o=0;o<((t=this.query.filters)==null?void 0:t.length);o++)if(this.query.filters[o].leftOperandValue===e.id)return!0;return!1}}}),Nn=["onDragstart","data-test"],Qn=["onClick","data-test"],Ln=["onClick","onDragstart"],Un=["data-test"];function Bn(e,t,o,r,a,n){const l=k("Button"),u=j("tooltip");return p(!0),f(z,null,N(e.entities,(d,g)=>(p(),f("div",{class:"expandable-entities",key:g},[s("h4",{class:"entity-item-container",style:O({"border-left":`10px solid ${d.color}`}),draggable:"true",onDragstart:b=>e.onDragStart(b,d),"data-test":"entity-container-"+d.id},[T(s("i",{class:I([e.getIconCls(d.attributes.iconCls),"p-mx-2"])},null,2),[[u,e.$t(`qbe.entities.types.${d.attributes.iconCls}`),void 0,{top:!0}]]),s("span",{class:"kn-flex",onClick:b=>e.expandEntity(d),"data-test":"expand-"+d.id},m(d.text),9,Qn),T(i(l,{icon:"fas fa-info",class:"p-button-text p-button-rounded p-button-plain",onClick:b=>e.$emit("showRelationDialog",d)},null,8,["onClick"]),[[u,e.$t("qbe.entities.relations"),void 0,{top:!0}]]),d.expanded?(p(),y(l,{key:0,icon:"pi pi-chevron-up",class:"p-button-text p-button-rounded p-button-plain",onClick:b=>d.expanded=!1},null,8,["onClick"])):(p(),y(l,{key:1,icon:"pi pi-chevron-down",class:"p-button-text p-button-rounded p-button-plain",onClick:b=>d.expanded=!0},null,8,["onClick"]))],44,Nn),T(s("ul",null,[(p(!0),f(z,null,N(d.children,(b,E)=>(p(),f("li",{style:O({"border-left":`5px solid ${b.color}`}),key:E,draggable:"true",onClick:w=>e.$emit("entityChildClicked",b),onDragstart:w=>e.onDragStart(w,b)},[T(s("i",{class:I([e.getIconCls(b.attributes.iconCls),"p-mx-2"])},null,2),[[u,e.$t(`qbe.entities.types.${b.attributes.iconCls}`),void 0,{top:!0}]]),s("span",{"data-test":"entity-"+d.id},m(b.text),9,Un),i(l,{icon:"fas fa-filter",class:I([{"qbe-active-filter-icon":e.fieldHasFilters(b)},"p-button-text p-button-rounded p-button-plain p-ml-auto"]),onClick:X(w=>e.openFiltersDialog(b),["stop"]),"data-test":"child-"+b.id},null,8,["class","onClick","data-test"])],44,Ln))),128))],512),[[U,d.expanded]])]))),128)}var Pn=V(Fn,[["render",Bn]]);const Rn=$({name:"expandable-entity",components:{},props:{availableEntities:{type:Array}},emits:["close"],data(){return{entities:[],colors:["#D7263D","#F46036","#2E294E","#1B998B","#C5D86D","#3F51B5","#8BC34A","#009688","#F44336"]}},watch:{availableEntities(){this.entities=this.availableEntities}},created(){this.entities=this.availableEntities},methods:{expandEntity(e){e.expanded=!e.expanded},getIconCls(e){switch(e){case"measure":return"fas fa-ruler";case"cube":return"fas fa-cube";case"calculation":return"fas fa-calculator";case"dimension":return"fas fa-ruler-horizontal";case"geographic dimension":return"fas fa-map-marked-alt";case"attribute":return"fas fa-font";case"generic":return"fas fa-layer-group";default:return"fas fa-cube"}},onDragStart(e,t){e.dataTransfer.setData("text",JSON.stringify(t)),e.dataTransfer.dropEffect="move",e.dataTransfer.effectAllowed="move"}}}),_n=["onDragstart"],jn={class:"fas fa-cube p-mx-2"},Hn=["onClick"],Gn=["onDragstart"];function Yn(e,t,o,r,a,n){const l=k("Button"),u=j("tooltip");return p(!0),f(z,null,N(e.entities,(d,g)=>(p(),f("div",{class:"expandable-entities",key:g},[s("h4",{draggable:"true",onDragstart:b=>e.onDragStart(b,d)},[T(s("i",jn,null,512),[[u,e.$t("qbe.entities.types.cube"),void 0,{top:!0}]]),s("span",{class:"kn-flex",onClick:b=>e.expandEntity(d)},m(d.name),9,Hn),i(l,{icon:"fas fa-edit",class:"p-button-text p-button-rounded p-button-plain p-ml-auto",onClick:b=>e.$emit("editSubquery",d)},null,8,["onClick"]),i(l,{icon:"fas fa-trash",class:"p-button-text p-button-rounded p-button-plain",onClick:b=>e.$emit("deleteSubquery",g,d)},null,8,["onClick"]),d.expanded?(p(),y(l,{key:0,icon:"pi pi-chevron-up",class:"p-button-text p-button-rounded p-button-plain",onClick:b=>d.expanded=!1},null,8,["onClick"])):(p(),y(l,{key:1,icon:"pi pi-chevron-down",class:"p-button-text p-button-rounded p-button-plain",onClick:b=>d.expanded=!0},null,8,["onClick"]))],40,_n),T(s("ul",null,[(p(!0),f(z,null,N(d.fields,(b,E)=>(p(),f("li",{key:E,draggable:"true",onDragstart:w=>e.onDragStart(w,b)},[T(s("i",{class:I([e.getIconCls(b.iconCls),"p-mx-2"])},null,2),[[u,e.$t(`qbe.entities.types.${b.iconCls}`),void 0,{top:!0}]]),s("span",null,m(b.alias),1)],40,Gn))),128))],512),[[U,d.expanded]])]))),128)}var Xn=V(Rn,[["render",Yn]]);const Jn={style:{height:"60%","max-height":"60%","max-width":"40%","min-width":"40%"}},Kn=["INNER","LEFT","RIGHT"];var Wn={dialog:Jn,joinTypes:Kn};const Zn=$({name:"qbe-join-definition-dialog",components:{Checkbox:me,Dialog:B,Dropdown:Y},props:{visible:{type:Boolean},qbe:{type:Object},selectedQuery:{type:Object},propEntities:{type:Array},id:{type:String}},emits:["close"],data(){return{QBEJoinDefinitionDialogDescriptor:Wn,entityNames:[],usedEntities:[],relations:[],filteredRelations:[],searchWord:"",query:{},entities:[]}},watch:{async visible(e){e&&(this.loadQuery(),await this.loadEntityNames(),this.loadData())},selectedQuery(){this.loadQuery()},propEntities(){this.loadEntities(),this.loadData()}},async created(){this.loadQuery(),await this.loadEntityNames(),this.loadEntities(),this.loadData()},methods:{loadData(){var e;this.qbe&&this.query&&this.entities&&(this.usedEntities=[],(e=this.entities)==null||e.forEach(t=>{this.entityNames.includes(t.id)&&this.usedEntities.push(t)}),this.getRelations())},loadQuery(){this.query=this.selectedQuery},loadEntities(){this.entities=this.propEntities},getRelations(){var e;this.relations=[],(e=this.usedEntities)==null||e.forEach(t=>{var o;(o=t.relation)==null||o.forEach(r=>{this.usedEntities.findIndex(n=>n.id===r.targetEntity)!==-1&&this.relations.push({...r})})}),this.filteredRelations=[...this.relations]},async loadEntityNames(){var e,t,o;if(this.id&&this.query){const r={catalogue:(e=this.qbe)==null?void 0:e.qbeJSONQuery.catalogue.queries,meta:this.formatQbeMeta(),pars:(t=this.qbe)==null?void 0:t.pars,qbeJSONQuery:{},schedulingCronLine:"0 * * * * ?"};await this.$http.post(`/knowageqbeengine/restful-services/qbequery/queryEntities/?SBI_EXECUTION_ID=${this.id}&currentQueryId=${(o=this.query)==null?void 0:o.id}`,r).then(a=>this.entityNames=a.data).catch(()=>{})}},formatQbeMeta(){var t,o;const e=[];return(o=(t=this.qbe)==null?void 0:t.qbeJSONQuery.catalogue.queries)==null||o.forEach(r=>{var a;(a=r.fields)==null||a.forEach(n=>{e.push({dataType:n.dataType,displayedName:n.alias,fieldType:n.fieldType.toUpperCase(),format:n.format,name:n.alias,type:n.type})})}),e},searchItems(){setTimeout(()=>{this.searchWord.trim().length?this.filteredRelations=this.relations.filter(e=>e.attributes.entity.toLowerCase().includes(this.searchWord.trim().toLocaleLowerCase())||e.attributes.sourceEntity.toLowerCase().includes(this.searchWord.trim().toLocaleLowerCase())):this.filteredRelations=[...this.relations]},250)},moveDown(e){const t=this.relations[e];this.relations[e]=this.relations[e+1],this.relations[e+1]=t,this.filteredRelations=[...this.relations]},moveUp(e){const t=this.relations[e];this.relations[e]=this.relations[e-1],this.relations[e-1]=t,this.filteredRelations=[...this.relations]},closeDialog(){this.$emit("close"),this.relations=[],this.filteredRelations=[]},save(){this.query.graph=[...this.relations],this.relations.forEach(e=>{var t;(t=this.entities)==null||t.forEach(o=>{for(let r=0;r<o.relation.length;r++)o.relation[r].id===e.id&&(o.relation[r]={...e})})}),this.relations=[],this.filteredRelations=[],this.$emit("close")}}}),ei={class:"p-d-flex p-ai-center p-m-4"},ti=s("i",{class:"pi pi-search kn-cursor-pointer"},null,-1),oi={class:"p-m-4"},ri={class:"p-text-bold"},ai={class:"p-text-bold kn-truncated"},ni={class:"p-d-flex p-flex-row p-ml-auto"},ii=["onClick"],li=["onClick"];function si(e,t,o,r,a,n){const l=k("Toolbar"),u=k("InputText"),d=k("Dropdown"),g=k("Checkbox"),b=k("Button"),E=k("Dialog"),w=j("tooltip");return p(),y(E,{id:"qbe-join-definition-dialog",class:"p-fluid kn-dialog--toolbar--primary",style:O(e.QBEJoinDefinitionDialogDescriptor.dialog.style),visible:e.visible,modal:!0,closable:!1},{header:c(()=>[i(l,{class:"kn-toolbar kn-toolbar--primary p-p-0 p-m-2 p-col-12"},{start:c(()=>[D(m(e.$t("qbe.joinDefinitions.dialogTitle")),1)]),_:1})]),footer:c(()=>[i(b,{class:"kn-button kn-button--primary",onClick:e.closeDialog},{default:c(()=>[D(m(e.$t("common.cancel")),1)]),_:1},8,["onClick"]),i(b,{class:"kn-button kn-button--primary",onClick:e.save},{default:c(()=>[D(m(e.$t("common.save")),1)]),_:1},8,["onClick"])]),default:c(()=>[s("div",null,[s("div",ei,[ti,i(u,{class:"kn-material-input p-ml-2",modelValue:e.searchWord,"onUpdate:modelValue":t[0]||(t[0]=A=>e.searchWord=A),placeholder:e.$t("common.search"),onInput:e.searchItems},null,8,["modelValue","placeholder","onInput"])]),s("div",oi,[(p(!0),f(z,null,N(e.filteredRelations,(A,h)=>(p(),f("div",{key:A.id,class:"p-d-flex p-flex-row p-ai-center p-m-3"},[s("label",ri,m(h+1),1),i(d,{class:"kn-material-input p-mx-4",modelValue:A.joinType,"onUpdate:modelValue":v=>A.joinType=v,options:e.QBEJoinDefinitionDialogDescriptor.joinTypes},null,8,["modelValue","onUpdate:modelValue","options"]),T((p(),f("label",ai,[D(m(A.attributes.sourceEntity+" --- "+A.attributes.entity),1)])),[[w,A.attributes.sourceEntity+" --- "+A.attributes.entity,void 0,{top:!0}]]),s("div",ni,[T(s("i",{class:"fa fa-arrow-up kn-cursor-pointer",onClick:v=>e.moveUp(h)},null,8,ii),[[U,h!==0&&e.searchWord.trim()===""]]),T(s("i",{class:"fa fa-arrow-down kn-cursor-pointer p-ml-2",onClick:v=>e.moveDown(h)},null,8,li),[[U,h!==e.filteredRelations.length-1&&e.searchWord.trim()===""]]),i(g,{class:"p-ml-3",modelValue:A.isConsidered,"onUpdate:modelValue":v=>A.isConsidered=v,binary:!0},null,8,["modelValue","onUpdate:modelValue"])])]))),128))])])]),_:1},8,["style","visible"])}var di=V(Zn,[["render",si]]);const ci="80vh";var pi={scrollHeight:ci};const bi=["LLLL","llll","LLL","lll","DD/MM/YYYY HH:mm:SS","DD/MM/YYYY HH:mm","LL","ll","L","l"],ki=[{label:"Attribute",name:"ATTRIBUTE"},{label:"Measure",name:"MEASURE"}],ui={backdrop:{"background-color":"rgba(33, 33, 33, 1)",height:"100%",left:0,opacity:.48,position:"absolute",top:0,width:"100%","z-index":50},entitiesLists:{"border-right":"1px solid #ccc",display:"flex","flex-basis":"25%","flex-direction":"column",height:"100%"}},mi=[{label:"String",name:"STRING"},{label:"Number",name:"NUMBER"},{label:"Date",name:"DATE"}];var xe={admissibleDateFormats:bi,columnTypes:ki,style:ui,types:mi};const gi=$({name:"qbe-preview-dialog",components:{Column:H,DataTable:G},props:{id:{type:String},queryPreviewData:{type:Object},pagination:{type:Object},entities:{type:Array},selectedQuery:{type:Object,required:!0}},emits:["close","pageChanged"],data(){return{QBEPreviewDialogDescriptor:pi,QBEDescriptor:xe,columns:[],rows:[],lazyParams:{},first:0,loading:!1}},watch:{queryPreviewData(){this.loadData()},pagination(){this.loadPagination()}},created(){this.loadData(),this.loadPagination()},methods:{loadData(){this.queryPreviewData&&(this.setPreviewColumns(this.queryPreviewData),this.rows=this.queryPreviewData.rows)},setPreviewColumns(e){var t,o,r,a;this.columns=[];for(let n=1;n<((o=(t=e.metaData)==null?void 0:t.fields)==null?void 0:o.length);n++){const l=(r=e.metaData)==null?void 0:r.fields[n];if(["timestamp","date"].includes(l.type)){const u=this.findField(l);u&&(l.metawebDateFormat=u.format),l.metawebDateFormat||this.setCalculatedFieldDateFormat(l,n-1)}this.columns.push((a=e.metaData)==null?void 0:a.fields[n])}},setCalculatedFieldDateFormat(e,t){var o;!this.selectedQuery||!this.selectedQuery.fields||this.selectedQuery.fields[t]&&(e.metawebDateFormat=(o=this.selectedQuery.fields[t].id.format)!=null?o:"L")},findField(e){if(!this.entities)return;let t=null;for(let o=0;o<this.entities.length;o++){const r=this.entities[o];for(let a=0;a<r.children.length;a++)if(r.children[a].attributes.field===e.header){t=r.children[a];break}}return t},loadPagination(){var e;this.lazyParams=this.pagination,this.first=(e=this.pagination)==null?void 0:e.start},onPage(e){this.lazyParams={paginationStart:e.first,paginationLimit:e.rows,paginationEnd:e.first+e.rows,size:this.lazyParams.size},this.$emit("pageChanged",this.lazyParams)},close(){this.$emit("close"),this.first=0,this.lazyParams={}},getFormattedDate(e,t){const o=t.type==="timestamp"?"DD/MM/YYYY HH:mm:ss.SSS":"DD/MM/YYYY";let r;return xe.admissibleDateFormats.includes(t.metawebDateFormat)&&(r=t.metawebDateFormat),ze(e,r,o)}}}),hi={id:"qbe-preview-dialog",class:"p-fluid kn-dialog--toolbar--primary"};function fi(e,t,o,r,a,n){const l=k("Toolbar"),u=k("Column"),d=k("DataTable");return p(),f("div",hi,[i(l,{class:"kn-toolbar kn-toolbar--secondary p-p-0 p-m-0 p-col-12"},{start:c(()=>[D(m(e.$t("common.preview")),1)]),end:c(()=>[s("i",{class:"fa fa-times kn-cursor-pointer",onClick:t[0]||(t[0]=(...g)=>e.close&&e.close(...g))})]),_:1}),i(d,{id:"qbe-preview-datatable",class:"p-datatable-sm kn-table",first:e.first,"onUpdate:first":t[1]||(t[1]=g=>e.first=g),value:e.rows,paginator:!0,lazy:!0,rows:20,totalRecords:e.lazyParams.size,paginatorTemplate:"CurrentPageReport FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink",currentPageReportTemplate:e.$t("common.table.footer.paginated",{first:"{first}",last:"{last}",totalRecords:"{totalRecords}"}),responsiveLayout:"stack",breakpoint:"960px",scrollable:!0,scrollHeight:e.QBEPreviewDialogDescriptor.scrollHeight,onPage:t[2]||(t[2]=g=>e.onPage(g))},{empty:c(()=>[s("div",null,m(e.$t("common.info.noDataFound")),1)]),default:c(()=>[(p(!0),f(z,null,N(e.columns,g=>(p(),y(u,{class:"kn-truncated",field:g.dataIndex,header:g.header,key:g.field,sortable:!0},{body:c(b=>[D(m(g.metawebDateFormat?e.getFormattedDate(b.data[g.dataIndex],g):b.data[g.dataIndex]),1)]),_:2},1032,["field","header"]))),128))]),_:1},8,["first","value","totalRecords","currentPageReportTemplate","scrollHeight"])])}var vi=V(gi,[["render",fi]]);const yi=[{category:"AGGREGATION",formula:"sum(expr1, expr2, \u2026, exprN)",help:"dataPreparation.sum",label:"SUM",name:"SUM"},{category:"AGGREGATION",formula:"min(expr)",help:"dataPreparation.min",label:"MIN",name:"MIN"},{category:"AGGREGATION",formula:"max(expr)",help:"dataPreparation.max",label:"MAX",name:"MAX"},{category:"AGGREGATION",formula:"COUNT(column_name)",help:"dataPreparation.count",label:"COUNT",name:"COUNT"},{category:"AGGREGATION",formula:"avg(expr)",help:"dataPreparation.avg",label:"AVG",name:"AVG"},{category:"String",formula:"concat(col1, col2, ..., colN)",help:"dataPreparation.concat",label:"concat",name:"concat"},{category:"String",formula:"length(expr)",help:"dataPreparation.lenght",label:"Lenght",name:"Lenght"},{category:"String",formula:"lower(str)",help:"dataPreparation.lower",label:"Lower",name:"Lower"},{category:"String",formula:"upper(str)",help:"dataPreparation.upper",label:"upper",name:"upper"},{category:"String",formula:"trim(str)",help:"dataPreparation.trim",label:"trim",name:"trim"},{category:"String",formula:"substring(str, pos[, len])",help:"dataPreparation.substring",label:"substring",name:"substring"},{category:"SQL",formula:"CASE WHEN expr1 THEN expr2 [WHEN expr3 THEN expr4]* [ELSE expr5] END",help:"dataPreparation.case",label:"case",name:"case"},{category:"TIME",formula:"current_date()",help:"dataPreparation.current_date",label:"CURRENT_DATE",name:"CURRENT_DATE"},{category:"TIME",formula:"current_time()",help:"dataPreparation.current_time",label:"CURRENT_TIME",name:"CURRENT_TIME"},{category:"TIME",formula:"second(datetime_expression)",help:"dataPreparation.second",label:"second",name:"second"},{category:"TIME",formula:"hour(datetime_expression)",help:"dataPreparation.hour",label:"hour",name:"hour"},{category:"TIME",formula:"year(date_expression)",help:"dataPreparation.year",label:"year",name:"year"},{category:"TIME",formula:"month(date_expression)",help:"dataPreparation.month",label:"month",name:"month"},{category:"TIME",formula:"day(date_expression)",help:"dataPreparation.day",label:"day",name:"day"},{category:"TIME",formula:"get_quarter(date_expression)",help:"dataPreparation.get_quarter",label:"get_quarter",name:"get_quarter"},{category:"TIME",formula:"get_week(date_expression)",help:"dataPreparation.get_week",label:"get_week",name:"get_week"},{category:"TIME",formula:"get_day_of_the_week(date_expression)",help:"dataPreparation.get_day_of_the_week",label:"get_day_of_the_week",name:"get_day_of_the_week"},{category:"TIME",formula:"add_days(date_expression,number_of_days)",help:"dataPreparation.add_days",label:"add_days",name:"add_days"},{category:"TIME",formula:"add_hours(date_expression,number_of_hours)",help:"dataPreparation.add_hours",label:"add_hours",name:"add_hours"},{category:"TIME",formula:"add_months(date_expression,number_of_months)",help:"dataPreparation.add_months",label:"add_months",name:"add_months"},{category:"TIME",formula:"add_years(date_expression,number_of_years)",help:"dataPreparation.add_years",label:"add_years",name:"add_years"},{category:"TIME",formula:"subtract_days(date_expression,number_of_days)",help:"dataPreparation.subtract_days",label:"subtract_days",name:"subtract_days"},{category:"TIME",formula:"subtract_hours(date_expression,number_of_hours)",help:"dataPreparation.subtract_hours",label:"subtract_hours",name:"subtract_hours"},{category:"TIME",formula:"subtract_months(date_expression,number_of_months)",help:"dataPreparation.subtract_months",label:"subtract_months",name:"subtract_months"},{category:"TIME",formula:"subtract_years(date_expression,number_of_years)",help:"dataPreparation.subtract_years",label:"subtract_years",name:"subtract_years"},{category:"TIME",formula:"datediff_in_days(starting_date,ending_date)",help:"dataPreparation.datediff_in_days",label:"datediff_in_days",name:"datediff_in_days"},{category:"TIME",formula:"datediff_in_hours(starting_date,ending_date)",help:"dataPreparation.datediff_in_hours",label:"datediff_in_hours",name:"datediff_in_hours"},{category:"TIME",formula:"datediff_in_minutes(starting_date,ending_date)  ",help:"dataPreparation.datediff_in_minutes",label:"datediff_in_minutes",name:"datediff_in_minutes"},{category:"SPATIAL",formula:"distance(geom1, geom2, tol, unit)",help:"dataPreparation.distance",label:"distance",name:"distance"},{category:"SPATIAL",formula:"centroid(geom1, tol)",help:"dataPreparation.centroid",label:"Centroid",name:"Centroid"},{category:"SPATIAL",formula:"length_spa(geom, tol, unit)",help:"dataPreparation.length_spa",label:"length_spa",name:"length_spa"},{category:"SPATIAL",formula:"relate(geom1, mask, geom2, tol))",help:"dataPreparation.relate",label:"Relate",name:"Relate"},{category:"SPATIAL",formula:"intersection(geom1,  geom2, tol))",help:"dataPreparation.intersection",label:"Intersection",name:"Intersection"}],wi=[{code:"string",label:"string"},{code:"numeric",label:"numeric"},{code:"date",label:"date"}],xi={label:"category"},Ci="dataPreparation.formula",Mi="dataPreparation.hint",Ai=[{fieldName:"colName",validators:[{key:"required"},{key:"maximumCharacters",validator:{params:{max:100},type:"maxLength"}},{key:"regex",validator:{type:"extendedAlphanumericRegex"}}]},{fieldName:"formula",validators:[{key:"required"},{key:"maximumCharacters",validator:{params:{max:1e3},type:"maxLength"}}]}];var qe={availableFunctions:yi,availableOutputTypes:wi,category:xi,formula:Ci,hint:Mi,validations:Ai};const Di=$({name:"qbe",components:{Dialog:B,Chip:Fe,InputSwitch:Ne,ScrollPanel:kt,Menu:Be,QBEFilterDialog:nr,QBESavingDialog:kn,QBESqlDialog:Hr,QBESimpleTable:Pr,QBERelationDialog:Kr,QBEParamDialog:ea,ExpandableEntity:Pn,SubqueryEntity:Xn,QBEHavingDialog:$r,QBEAdvancedFilterDialog:Pt,QBEJoinDefinitionDialog:di,KnParameterSidebar:wt,QBEPreviewDialog:vi,QBESmartTable:zn,ProgressSpinner:ut,KnCalculatedField:xt,Dropdown:Y},props:{visible:{type:Boolean},dataset:{type:Object},returnQueryMode:{type:Boolean},getQueryFromDatasetProp:{type:Boolean}},emits:["close","querySaved"],data(){return{moment:L,qbeDescriptor:xe,calcFieldDescriptor:qe,qbe:null,customizedDatasetFunctions:{},entities:{},queryPreviewData:{},selectedQuery:{},mainQuery:{},loading:!1,showEntitiesLists:!0,smartView:!0,hiddenColumnsExist:!1,filterDialogVisible:!1,sqlDialogVisible:!1,paramDialogVisible:!1,relationDialogVisible:!1,savingDialogVisible:!1,filterDialogData:{},showDerivedList:!0,discardRepetitions:!1,sqlData:{},menuButtons:[],relationEntity:{},havingDialogVisible:!1,havingDialogData:{},advancedFilterDialogVisible:!1,joinDefinitionDialogVisible:!1,parameterSidebarVisible:!1,user:null,userRole:null,qbePreviewDialogVisible:!1,pagination:{start:0,limit:25},uniqueID:null,filtersData:{},qbeLoaded:!1,calcFieldDialogVisible:!1,calcFieldColumns:[],selectedCalcField:null,calcFieldFunctions:[],calcFieldFunctionsToShow:[],qbeMetadata:[],colors:["#D7263D","#F46036","#2E294E","#1B998B","#C5D86D","#3F51B5","#8BC34A","#009688","#F44336"]}},computed:{isParameterSidebarVisible(){var t,o,r,a;let e=!1;for(let n=0;n<((o=(t=this.filtersData)==null?void 0:t.filterStatus)==null?void 0:o.length);n++)if(this.filtersData.filterStatus[n].showOnPanel==="true"){e=!0;break}return e||((a=(r=this.qbe)==null?void 0:r.pars)==null?void 0:a.length)!==0}},watch:{async dataset(){await this.loadPage()}},setup(){return{store:re()}},async created(){this.uniqueID=R({length:16,type:"base64"}),this.user=this.store.$state.user,this.userRole=this.user.sessionRole&&this.user.sessionRole!==this.$t("role.defaultRolePlaceholder")?this.user.sessionRole:null,this.userRole?await this.loadPage():this.parameterSidebarVisible=!0},methods:{async loadPage(){var e,t,o,r,a,n,l,u,d;this.loading=!0,this.dataset&&!this.dataset.dataSourceId&&!this.dataset.federation_id?await this.loadDataset():this.qbe=this.getQBEFromModel(),this.loadQuery(),this.qbeMetadata=this.extractFieldsMetadata((e=this.qbe)==null?void 0:e.meta.columns),this.generateFieldsAndMetadataId(),(t=this.dataset)!=null&&t.federation_id||await this.loadDatasetDrivers(),((r=(o=this.qbe)==null?void 0:o.pars)==null?void 0:r.length)===0&&(((a=this.filtersData)==null?void 0:a.isReadyForExecution)||((n=this.dataset)==null?void 0:n.federation_id))?await this.loadQBE():(((u=(l=this.qbe)==null?void 0:l.pars)==null?void 0:u.length)!==0||!((d=this.filtersData)!=null&&d.isReadyForExecution))&&(this.parameterSidebarVisible=!0),this.loading=!1},async loadDataset(){var e;!this.dataset||(await this.$http.get(`/knowage/restful-services/1.0/datasets/${this.dataset.label}`).then(t=>{this.qbe=t.data[0],this.qbe&&this.qbe.qbeJSONQuery&&(this.qbe.qbeJSONQuery=JSON.parse(this.qbe.qbeJSONQuery))}),this.qbe&&this.getQueryFromDatasetProp&&(this.qbe=W(this.dataset),this.qbe&&this.qbe.qbeJSONQuery&&typeof this.qbe.qbeJSONQuery=="string"&&(this.qbe.qbeJSONQuery=JSON.parse(this.qbe.qbeJSONQuery))),this.qbe&&this.dataset&&(this.qbe.pars=(e=this.dataset.pars)!=null?e:[]))},getQBEFromModel(){var e;return this.dataset?(this.smartView=this.dataset.smartView,{dsTypeCd:"Qbe",qbeDatamarts:this.dataset.name,qbeDataSource:this.dataset.dataSourceLabel,qbeJSONQuery:this.getQueryFromDatasetProp?this.dataset.qbeJSONQuery:{catalogue:{queries:[{id:"q1",name:"Main",fields:[],distinct:!1,filters:[],calendar:{},expression:{},isNestedExpression:!1,havings:[],graph:[],relationRoles:[],subqueries:[]}]}},meta:[],pars:(e=this.dataset.pars)!=null?e:[],scopeId:null,scopeCd:"",label:"",name:""}):{}},loadQuery(){var e,t,o,r,a,n;this.mainQuery=(o=(t=(e=this.qbe)==null?void 0:e.qbeJSONQuery)==null?void 0:t.catalogue)==null?void 0:o.queries[0],this.selectedQuery=(n=(a=(r=this.qbe)==null?void 0:r.qbeJSONQuery)==null?void 0:a.catalogue)==null?void 0:n.queries[0]},extractFieldsMetadata(e){if(e&&e.length>0){var t={};for(var o in e){var r=t[e[o].column];r||(r={},t[e[o].column]=r,r.column=e[o].column),r[e[o].pname]=e[o].pvalue}var a=new Array;for(o in t)a.push(t[o]);return a}else return[]},generateFieldsAndMetadataId(){this.selectedQuery.fields.forEach(e=>{e.uniqueID=R({length:4,type:"base64"}),this.qbeMetadata.find(t=>{e.alias===t.column&&(t.uniqueID=e.uniqueID)})})},async loadDatasetDrivers(){if(!this.qbe)return;const e=this.qbe.label?this.qbe.label:this.qbe.qbeDatamarts,t=this.qbe.label?`3.0/datasets/${e}/filters`:`1.0/businessmodel/${this.qbe.qbeDatamarts}/filters`;await this.$http.post("/knowage/restful-services/"+t,{role:this.userRole}).then(o=>{this.filtersData=o.data,this.filtersData.filterStatus&&(this.filtersData.filterStatus=this.filtersData.filterStatus.filter(r=>r.id))}).catch(()=>{}),Dt(this.filtersData)},async loadQBE(){var e;this.loadCalcFieldFunctions(),await this.initializeQBE(),await this.loadCustomizedDatasetFunctions(),await this.loadEntities(),(e=this.dataset)!=null&&e.dataSourceLabel||await this.executeQBEQuery(!1)},loadCalcFieldFunctions(){this.calcFieldFunctions=qe.availableFunctions},async initializeQBE(){var n,l,u,d,g,b;const e=(n=this.dataset)!=null&&n.dataSourceLabel?this.dataset.dataSourceLabel:(l=this.qbe)==null?void 0:l.qbeDataSource,t=(u=this.dataset)!=null&&u.dataSourceLabel?this.dataset.name:(d=this.qbe)==null?void 0:d.qbeDatamarts,o=this.getFormattedParameters(this.filtersData),r=encodeURI(JSON.stringify(o)),a=(g=this.dataset)!=null&&g.federation_id?`start-federation?federationId=${this.dataset.federation_id}&datasourceForCache=cache&drivers=%7B%7D`:`start-qbe?datamart=${t}&user_id=${(b=this.user)==null?void 0:b.userUniqueIdentifier}&SBI_EXECUTION_ID=${this.uniqueID}&DATA_SOURCE_LABEL=${e}&drivers=${r}`;this.dataset&&await this.$http.get("/knowageqbeengine/restful-services/"+a).then(()=>{this.qbeLoaded=!0}).catch(()=>{})},getFormattedParameters(e){let t={};return e.filterStatus&&Object.keys(e.filterStatus).forEach(o=>{var a;const r=e.filterStatus[o];r.multivalue?t[r.urlName]=[{value:(a=r.parameterValue)==null?void 0:a.map(n=>n.value),description:r.parameterDescription}]:t[r.urlName]=[{value:r.parameterValue[0].value,description:r.parameterValue[0].description}]}),t},async loadCustomizedDatasetFunctions(){var t,o;if(this.dataset&&this.dataset.federation_id)return;const e=(t=this.dataset)!=null&&t.dataSourceId?this.dataset.dataSourceId:(o=this.qbe)==null?void 0:o.qbeDataSourceId;await this.$http.get(`/knowage/restful-services/2.0/configs/KNOWAGE.CUSTOMIZED_DATABASE_FUNCTIONS/${e}`).then(r=>{this.customizedDatasetFunctions=r.data,r.data.data&&r.data.data.length>0&&r.data.data.map(n=>({category:"CUSTOM",formula:n.value,label:n.label,name:n.name,help:"dataPreparation.custom"})).forEach(n=>{this.calcFieldFunctions.push(n)})}),this.hideSpatialFunct()},hideSpatialFunct(){const e=t=>t.isSpatial;if(this.selectedQuery.fields.some(e))this.calcFieldFunctionsToShow=W(this.calcFieldFunctions);else{let t=W(this.calcFieldFunctions);this.calcFieldFunctionsToShow=t.filter(o=>o.category!=="SPATIAL")}},async loadEntities(){var t,o;const e=(t=this.dataset)!=null&&t.dataSourceId?this.dataset.name:(o=this.qbe)==null?void 0:o.qbeDatamarts;await this.$http.get(`/knowageqbeengine/servlet/AdapterHTTP?ACTION_NAME=GET_TREE_ACTION&SBI_EXECUTION_ID=${this.uniqueID}&datamartName=${e}`).then(async r=>{this.addExpandedProperty(r.data.entities),await this.addSpatialProperty(r.data.entities),this.entities=r.data}).catch(r=>console.log("ERROR: ",r))},addExpandedProperty(e){e.forEach(t=>{t.expanded=!1})},async addSpatialProperty(e){await e.forEach(t=>{t.iconCls=="geographic_dimension"&&t.children.forEach(o=>{o.isSpatial=!0})})},async executeQBEQuery(e){var o,r,a;if(this.loading=!0,!this.qbe)return;const t={catalogue:(r=(o=this.qbe)==null?void 0:o.qbeJSONQuery)==null?void 0:r.catalogue.queries,meta:this.formatQbeMeta(),pars:(a=this.qbe)==null?void 0:a.pars,qbeJSONQuery:{},schedulingCronLine:"0 * * * * ?"};await this.$http.post(`/knowageqbeengine/restful-services/qbequery/executeQuery/?SBI_EXECUTION_ID=${this.uniqueID}&currentQueryId=${this.selectedQuery.id}&start=${this.pagination.start}&limit=${this.pagination.limit}`,t).then(n=>{this.queryPreviewData=n.data,this.pagination.size=n.data.results,e&&(this.qbePreviewDialogVisible=!0)}).catch(()=>{e&&(this.qbePreviewDialogVisible=!1)}),this.loading=!1},formatQbeMeta(){var t,o,r;const e=[];return(r=(o=(t=this.qbe)==null?void 0:t.qbeJSONQuery)==null?void 0:o.catalogue.queries)==null||r.forEach(a=>{var n;(n=a.fields)==null||n.forEach(l=>{e.push({dataType:l.dataType,displayedName:l.alias,fieldType:l.fieldType.toUpperCase(),format:l.format,name:l.alias,type:l.type})})}),e},onDropComplete(e){if(!e.connector){if(e.children)for(var t in e.children)this.addEntityToMainQuery(e.children[t]);else this.addEntityToMainQuery(e);this.updateSmartView()}},addEntityToMainQuery(e,t){let o=this.selectedQuery.fields,r=this.selectedQuery;for(var a=0;a<o.length;a++)o!=null&&!this.smartView&&o.length>0&&(r.fields[a].group=o[a].group,r.fields[a].funct=o[a].funct,r.fields[a].visible=o[a].visible,r.fields[a].distinct=o[a].distinct,r.fields[a].iconCls=o[a].visible,r.fields[a].inUse=o[a].inUse),r.fields[a].alias=o[a].alias;if(!t){var n=Ot(r,e),l=$t(n);r.fields.push(n),this.qbeMetadata.push(l)}this.hideSpatialFunct()},deleteAllFieldsFromQuery(){this.selectedQuery.fields=[],this.selectedQuery.havings=[],this.qbeMetadata=[],this.updateSmartView()},deleteFieldFromQuery(e){let t=this.selectedQuery.fields.findIndex(o=>o.uniqueID===e);this.onFieldDeleted({...this.selectedQuery.fields[t]}),this.selectedQuery.fields.splice(t,1),this.updateSmartView()},onFieldDeleted(e){this.deleteFieldMetadata(e.uniqueID);for(let t=this.selectedQuery.havings.length-1;t>=0;t--)this.selectedQuery.havings[t].leftOperandValue===e.id&&this.selectedQuery.havings.splice(t,1);setTimeout(()=>{this.hideSpatialFunct()},0)},deleteFieldMetadata(e){let t=this.qbeMetadata.findIndex(o=>o.uniqueID===e);this.qbeMetadata.splice(t,1)},createNewCalcField(){this.createCalcFieldColumns(),this.selectedCalcField={alias:"",expression:"",format:void 0,nature:"ATTRIBUTE",type:"STRING"},this.calcFieldDialogVisible=!0},editCalcField(e){this.createCalcFieldColumns(),this.selectedCalcField=this.formatCalcFieldForComponent(e),this.calcFieldDialogVisible=!0},formatCalcFieldForComponent(e){return{uniqueID:e.uniqueID,alias:e.id.alias,type:e.id.type,expression:e.id.expressionSimple,nature:e.id.nature,format:e.id.format}},createCalcFieldColumns(){this.calcFieldColumns=[],this.selectedQuery.fields.forEach(e=>{e.type!="inline.calculated.field"&&this.calcFieldColumns.push({fieldAlias:`$F{${e.alias}}`,fieldLabel:e.alias})})},onCalcFieldSave(e){var t={};this.selectedCalcField.alias=e.colName,this.selectedCalcField.expression=e.formula,this.selectedCalcField.uniqueID?this.updateExistingCalculatedField(this.selectedCalcField):(t=Nt(this.selectedCalcField,this.selectedQuery.fields),t.uniqueID=R({length:4,type:"base64"}),this.selectedQuery.fields.push(t),this.addEntityToMainQuery(t,!0),this.addCalculatedFieldMetadata(t)),this.calcFieldDialogVisible=!1},addCalculatedFieldMetadata(e){var t={uniqueID:e.uniqueID,column:e.alias,fieldAlias:e.field,fieldType:e.id.nature.toUpperCase(),decrypt:!1,personal:!1,subjectid:!1};switch(e.id.type){case"STRING":t.Type="java.lang.String";break;case"NUMBER":t.Type="java.lang.Long";break;case"DATE":t.Type="java.sql.Date";break}this.qbeMetadata.push(t)},updateExistingCalculatedField(e){let t=this.selectedQuery.fields.findIndex(o=>o.uniqueID==e.uniqueID);this.selectedQuery.fields[t]=Qt(this.selectedQuery.fields[t],this.selectedCalcField,this.selectedQuery.fields),this.updateCalculatedFieldMetadata(this.selectedQuery.fields[t])},updateCalculatedFieldMetadata(e){let t=this.qbeMetadata.findIndex(o=>o.uniqueID==e.uniqueID);switch(this.qbeMetadata[t].alias=e.alias,this.qbeMetadata[t].column=e.alias,this.qbeMetadata[t].fieldAlias=e.field,this.qbeMetadata[t].fieldType=e.id.nature.toUpperCase(),this.qbeMetadata[t].format=e.format,e.id.type){case"STRING":this.qbeMetadata[t].Type="java.lang.String";break;case"NUMBER":this.qbeMetadata[t].Type="java.lang.Long";break;case"DATE":this.qbeMetadata[t].Type="java.sql.Date";break}},showMenu(e){this.createMenuItems(),this.$refs.optionsMenu.toggle(e)},createMenuItems(){this.menuButtons=[];let e=this.discardRepetitions?"fas fa-check":"fas fa-times";this.menuButtons.push({key:"1",label:this.$t("qbe.detailView.toolbarMenu.sql"),command:()=>this.showSQLQuery()},{key:"2",icon:e,label:this.$t("qbe.detailView.toolbarMenu.repetitions"),command:()=>this.toggleDiscardRepetitions()},{key:"3",label:this.$t("common.parameters"),command:()=>this.showParamDialog()},{key:"4",label:this.$t("components.knCalculatedField.title"),visible:!this.smartView&&this.selectedQuery.fields.length>0,command:()=>this.createNewCalcField()},{key:"5",label:this.$t("qbe.advancedFilters.advancedFilterVisualisation"),command:()=>this.showAdvancedFilters()},{key:"6",label:this.$t("qbe.joinDefinitions.title"),command:()=>this.showJoinDefinitions()},{key:"7",label:this.$t("qbe.detailView.toolbarMenu.exportTo"),items:[{label:"CSV",command:()=>this.exportQueryResults("csv")},{label:"XLSX",command:()=>this.exportQueryResults("xlsx")}]})},async showSQLQuery(){var o,r,a,n;var e={};e.catalogue=JSON.stringify((a=(r=(o=this.qbe)==null?void 0:o.qbeJSONQuery)==null?void 0:r.catalogue)==null?void 0:a.queries),e.currentQueryId="q1",e.ambiguousFieldsPaths=[],e.ambiguousRoles=[],e.pars=(n=this.qbe)==null?void 0:n.pars;let t={};t.headers={"Content-Type":"application/x-www-form-urlencoded"},t.transformRequest=function(l){var u=[];for(var d in l)u.push(encodeURIComponent(d)+"="+encodeURIComponent(l[d]));return u.join("&")},await this.$http.post(`/knowageqbeengine/servlet/AdapterHTTP?ACTION_NAME=SET_CATALOGUE_ACTION&SBI_EXECUTION_ID=${this.uniqueID}`,e,t).then(()=>{this.getSQL()}).catch(l=>{this.store.setError({title:this.$t("common.toast.error"),msg:l.errors[0].message})})},async getSQL(){var e={};e.replaceParametersWithQuestion=!0,e.queryId=this.selectedQuery.id;let t={};t.headers={"Content-Type":"application/x-www-form-urlencoded"},t.transformRequest=function(o){var r=[];for(var a in o)r.push(encodeURIComponent(a)+"="+encodeURIComponent(o[a]));return r.join("&")},await this.$http.post(`/knowageqbeengine/servlet/AdapterHTTP?ACTION_NAME=GET_SQL_QUERY_ACTION&SBI_EXECUTION_ID=${this.uniqueID}`,e,t).then(o=>{this.sqlData=o.data,this.sqlDialogVisible=!0}).catch(o=>{this.store.setError({title:this.$t("common.toast.error"),msg:o.errors[0].message})})},toggleDiscardRepetitions(){this.discardRepetitions=!this.discardRepetitions,this.qbe&&(this.qbe.qbeJSONQuery.catalogue.queries[0].distinct=this.discardRepetitions),this.smartView&&this.executeQBEQuery(!1)},showParamDialog(){this.paramDialogVisible=!0},showAdvancedFilters(){this.advancedFilterDialogVisible=!0},showJoinDefinitions(){this.joinDefinitionDialogVisible=!0},async exportQueryResults(e){var r,a,n;var t="";e=="csv"?t="report.csv":t="report.xlsx";const o={catalogue:(a=(r=this.qbe)==null?void 0:r.qbeJSONQuery)==null?void 0:a.catalogue.queries,meta:this.formatQbeMeta(),pars:(n=this.qbe)==null?void 0:n.pars,qbeJSONQuery:{},schedulingCronLine:"0 * * * * ?"};await this.$http.post(`/knowageqbeengine/restful-services/qbequery/export/?SBI_EXECUTION_ID=${this.uniqueID}&currentQueryId=${this.selectedQuery.id}&outputType=${e}`,o,{headers:{Accept:"application/json, text/plain, */*"},responseType:"blob"}).then(l=>{mt(l.data,t,l.headers["content-type"])}).catch(()=>{})},async updatePagination(e){this.pagination.start=e.paginationStart,this.pagination.limit=e.paginationLimit,await this.executeQBEQuery(!1)},toggleEntitiesLists(){this.showEntitiesLists=!this.showEntitiesLists},collapseDerivedList(){this.showDerivedList=!this.showDerivedList},checkIfHiddenColumnsExist(){if(this.qbe){this.hiddenColumnsExist=!1;for(let e=0;e<this.selectedQuery.fields.length;e++)if(!this.selectedQuery.fields[e].visible){this.hiddenColumnsExist=!0;break}}},showHiddenColumns(){this.selectedQuery.fields.forEach(e=>e.visible=!0),this.smartView&&this.updateSmartView(),this.hiddenColumnsExist=!1},openFilterDialog(e){this.filterDialogData={field:e,query:this.selectedQuery},this.filterDialogVisible=!0},openHavingDialog(e){this.havingDialogData=e,this.havingDialogVisible=!0},onFiltersSave(e,t,o,r){Ct(e,t,o,r,this.qbe,this.selectedQuery,this.smartView,this.executeQBEQuery),this.filterDialogVisible=!1},onAdvancedFiltersSave(e){this.selectedQuery.expression=e,this.advancedFilterDialogVisible=!1,this.updateSmartView()},showRelationDialog(e){this.relationEntity=e,this.relationDialogVisible=!0},onHavingsSave(e,t){Tt(e,this.qbe,this.selectedQuery,t),this.havingDialogVisible=!1},onGroupingChanged(e){e.group&&this.selectedQuery&&(this.selectedQuery.havings=this.selectedQuery.havings.filter(t=>t.letOperandValue!==e.id))},onJoinDefinitionDialogClose(){this.joinDefinitionDialogVisible=!1,this.smartView&&this.executeQBEQuery(!1)},deleteAllFilters(){this.qbe&&(this.selectedQuery.filters=[],this.selectedQuery.havings=[],this.selectedQuery.expression={},this.smartView&&this.executeQBEQuery(!1))},selectSubquery(e){this.selectedQuery=e,this.updateSmartView()},selectMainQuery(){this.selectedQuery.fields.length<1?this.store.setInfo({title:this.$t("common.toast.error"),msg:"Sub entities must have one and one only field"}):this.selectedQuery=this.mainQuery,this.updateSmartView()},deleteSubquery(e,t){t.id===this.selectedQuery.id&&(this.selectedQuery=this.mainQuery),this.mainQuery.subqueries.splice(e,1),this.updateSmartView()},createSubquery(){let e={id:"q"+this.createQueryName(),name:"subentity-q"+this.createQueryName(),fields:[],distinct:!1,filters:[],calendar:{},expression:{},isNestedExpression:!1,havings:[],graph:[],relationRoles:[],subqueries:[]};this.mainQuery.subqueries.push(e),this.selectedQuery=e,this.queryPreviewData=null},createQueryName(){var r;var e=0,t=((r=this.mainQuery.subqueries)==null?void 0:r.length)-1;if(t!=-1&&this.mainQuery.subqueries){var o=this.mainQuery.subqueries[t].id;e=parseInt(o.substr(1))}else e=1;return e+1},async onExecute(e){var t,o;this.qbe&&(this.qbe.pars=[...e],this.dataset&&!this.dataset.dataSourceId&&!this.dataset.federation_id?await this.loadDataset():this.qbe=this.getQBEFromModel(),await this.loadQBE(),this.loadQuery(),this.qbeMetadata=this.extractFieldsMetadata((o=(t=this.qbe)==null?void 0:t.meta)==null?void 0:o.columns),this.generateFieldsAndMetadataId(),this.parameterSidebarVisible=!1)},async openPreviewDialog(){this.pagination.limit=20,await this.executeQBEQuery(!0)},updateSmartView(){this.smartView&&this.selectedQuery.fields.length>0?this.executeQBEQuery(!1):this.resetQueryPreviewAndPagination()},resetQueryPreviewAndPagination(){this.pagination={start:0,limit:25,size:0},this.queryPreviewData={}},smartViewFieldHidden(){this.checkIfHiddenColumnsExist(),this.updateSmartView()},smartViewReorder(e){var t=this.selectedQuery.fields[e.dragIndex];this.selectedQuery.fields[e.dragIndex]=this.selectedQuery.fields[e.dropIndex],this.selectedQuery.fields[e.dropIndex]=t,this.updateSmartView()},closePreview(){this.qbePreviewDialogVisible=!1,this.pagination={start:0,limit:25}},onFieldAliasChange(e){this.qbeMetadata.findIndex(t=>{t.uniqueID===e.uniqueID&&(t.fieldAlias=e.alias)}),this.updateSmartView()},onParametersSave(){var e,t;this.paramDialogVisible=!1;for(let o=this.selectedQuery.filters.length-1;o>=0;o--)if(this.selectedQuery.filters[o].rightType==="parameter"){const r=(e=this.qbe)==null?void 0:e.pars.findIndex(a=>a.name===this.selectedQuery.filters[o].paramName);r===-1&&(ye(this.selectedQuery.expression,"$F{"+this.selectedQuery.filters[o].filterId+"}"),this.selectedQuery.filters.splice(r,1))}((t=this.selectedQuery.expression.childNodes)==null?void 0:t.length)===0&&(this.selectedQuery.expression={}),this.updateSmartView()},async onRoleChange(e){var t;this.userRole=e,this.filtersData={},this.dataset&&!this.dataset.dataSourceId&&!this.dataset.federation_id?await this.loadDataset():this.qbe=this.getQBEFromModel(),this.loadQuery(),(t=this.dataset)!=null&&t.federation_id||await this.loadDatasetDrivers()},openSavingDialog(){var e;this.returnQueryMode?this.$emit("querySaved",(e=this.qbe)==null?void 0:e.qbeJSONQuery):this.savingDialogVisible=!0}}}),Ei={key:0},Ti={key:1,class:"kn-relative p-d-flex p-flex-row kn-height-full kn-width-full"},Si={class:"p-d-flex p-flex-column kn-flex kn-overflow-hidden"},Oi={class:"kn-flex kn-overflow-hidden"},$i={class:"kn-flex kn-overflow-hidden"},Vi={key:2,class:"qbe-detail-view p-m-1"},Ii={key:2},qi={key:2,class:"fa-stack p-mx-2"},zi=s("i",{class:"fas fa-ban fa-stack-2x"},null,-1),Fi={class:"kn-relative kn-flex p-mt-2"},Ni={class:"kn-height-full kn-width-full kn-absolute"},Qi={class:"p-float-label"},Li={for:"type",class:"kn-material-input-label"},Ui={key:0,class:"p-field p-col-3"},Bi={class:"p-float-label"},Pi={for:"type",class:"kn-material-input-label"},Ri={class:"p-float-label"},_i={for:"columnType",class:"kn-material-input-label"};function ji(e,t,o,r,a,n){const l=k("Button"),u=k("Toolbar"),d=k("ProgressSpinner"),g=k("Chip"),b=k("ExpandableEntity"),E=k("ScrollPanel"),w=k("SubqueryEntity"),A=k("InputSwitch"),h=k("QBESimpleTable"),v=k("QBESmartTable"),M=k("KnParameterSidebar"),q=k("QBEPreviewDialog"),J=k("QBEFilterDialog"),Q=k("QBESqlDialog"),K=k("QBERelationDialog"),ae=k("QBEParamDialog"),ne=k("QBEHavingDialog"),ie=k("QBEAdvancedFilterDialog"),le=k("QBESavingDialog"),se=k("QBEJoinDefinitionDialog"),Z=k("Dropdown"),de=k("KnCalculatedField"),ce=k("Menu"),He=k("Dialog"),_=j("tooltip");return p(),y(He,{class:"full-screen-dialog",visible:!0,modal:!1,closable:!1,position:"right",baseZIndex:1,autoZIndex:!0},{header:c(()=>[i(u,{class:"kn-toolbar kn-toolbar--primary p-col-12"},{start:c(()=>[e.qbe?(p(),f("span",Ei,m(e.qbe.label?e.qbe.label:e.qbe.qbeDatamarts),1)):C("",!0)]),end:c(()=>[e.isParameterSidebarVisible?T((p(),y(l,{key:0,icon:"pi pi-filter",class:"p-button-text p-button-rounded p-button-plain",onClick:t[0]||(t[0]=pe=>e.parameterSidebarVisible=!e.parameterSidebarVisible)},null,512)),[[_,e.$t("common.filter"),void 0,{bottom:!0}]]):C("",!0),T(i(l,{icon:"pi pi-save",class:"p-button-text p-button-rounded p-button-plain",onClick:e.openSavingDialog},null,8,["onClick"]),[[_,e.$t("common.save"),void 0,{bottom:!0}]]),T(i(l,{icon:"pi pi-times",class:"p-button-text p-button-rounded p-button-plain",onClick:t[1]||(t[1]=pe=>e.$emit("close"))},null,512),[[_,e.$t("common.close"),void 0,{bottom:!0}]])]),_:1})]),default:c(()=>{var pe,De,Ee,Te,Se,Oe,$e;return[e.loading?(p(),y(d,{key:0,class:"kn-progress-spinner"})):C("",!0),e.qbePreviewDialogVisible?C("",!0):(p(),f("div",Ti,[e.parameterSidebarVisible?(p(),f("div",{key:0,style:O(e.qbeDescriptor.style.backdrop),onClick:t[2]||(t[2]=x=>e.parameterSidebarVisible=!1)},null,4)):C("",!0),e.showEntitiesLists&&e.qbeLoaded?(p(),f("div",{key:1,style:O(e.qbeDescriptor.style.entitiesLists)},[s("div",Si,[i(u,{class:"kn-toolbar kn-toolbar--secondary kn-flex-0"},{start:c(()=>[s("span",null,m(e.$t("qbe.entities.title")),1)]),end:c(()=>[i(g,{style:{"background-color":"white"}},{default:c(()=>{var x,te;return[D(m((te=(x=e.entities)==null?void 0:x.entities)==null?void 0:te.length),1)]}),_:1})]),_:1}),s("div",Oi,[i(E,{class:"kn-height-full qbe-scroll-panel"},{default:c(()=>[i(b,{availableEntities:e.entities.entities,query:e.mainQuery,onShowRelationDialog:e.showRelationDialog,onEntityClicked:t[3]||(t[3]=x=>e.onDropComplete(x,!1)),onEntityChildClicked:t[4]||(t[4]=x=>e.onDropComplete(x,!1)),onOpenFilterDialog:e.openFilterDialog},null,8,["availableEntities","query","onShowRelationDialog","onOpenFilterDialog"])]),_:1})])]),s("div",{class:I(["p-d-flex p-flex-column kn-overflow-hidden",{"derived-entities-toggle":e.showDerivedList}])},[i(u,{class:"kn-toolbar kn-toolbar--secondary kn-flex-0"},{start:c(()=>[s("span",null,m(e.$t("qbe.entities.derived")),1)]),end:c(()=>[e.showEntitiesLists?T((p(),y(l,{key:0,icon:"fas fa-plus-circle",class:"p-button-text p-button-rounded p-button-plain",onClick:e.createSubquery},null,8,["onClick"])),[[_,e.$t("common.add"),void 0,{top:!0}]]):C("",!0),i(g,{style:{"background-color":"white"}},{default:c(()=>{var x,te;return[D(m((te=(x=e.mainQuery)==null?void 0:x.subqueries)==null?void 0:te.length),1)]}),_:1}),e.showDerivedList?(p(),y(l,{key:1,icon:"pi pi-chevron-down",class:"p-button-text p-button-rounded p-button-plain",onClick:e.collapseDerivedList},null,8,["onClick"])):(p(),y(l,{key:2,icon:"pi pi-chevron-up",class:"p-button-text p-button-rounded p-button-plain",onClick:e.collapseDerivedList},null,8,["onClick"]))]),_:1}),T(s("div",$i,[i(E,{class:"kn-height-full qbe-scroll-panel"},{default:c(()=>{var x;return[i(w,{availableEntities:(x=e.mainQuery)==null?void 0:x.subqueries,onEditSubquery:e.selectSubquery,onDeleteSubquery:e.deleteSubquery},null,8,["availableEntities","onEditSubquery","onDeleteSubquery"])]}),_:1})],512),[[U,e.showDerivedList]])],2)],4)):C("",!0),e.qbe&&e.qbeLoaded?(p(),f("div",Vi,[i(u,{class:"kn-toolbar kn-toolbar--primary kn-width-full"},{start:c(()=>{var x;return[e.showEntitiesLists?T((p(),y(l,{key:0,icon:"pi pi-chevron-left",class:"p-button-text p-button-rounded p-button-plain",onClick:e.toggleEntitiesLists},null,8,["onClick"])),[[_,e.$t("qbe.detailView.hideList"),void 0,{bottom:!0}]]):T((p(),y(l,{key:1,icon:"pi pi-chevron-right",class:"p-button-text p-button-rounded p-button-plain",onClick:e.toggleEntitiesLists},null,8,["onClick"])),[[_,e.$t("qbe.detailView.showList"),void 0,{bottom:!0}]]),e.selectedQuery.id!=="q1"?(p(),f("span",Ii,[i(l,{label:"MAIN",class:"p-button-text p-button-plain kn-uppercase",onClick:e.selectMainQuery},null,8,["onClick"]),i(l,{icon:"pi pi-chevron-right",class:"p-button-text p-button-plain"}),i(l,{label:(x=e.selectedQuery)==null?void 0:x.name,class:"p-button-text p-button-plain kn-uppercase"},null,8,["label"])])):C("",!0)]}),end:c(()=>[e.selectedQuery.fields.length>0?T((p(),f("i",{key:0,class:"fas fa-eraser kn-cursor-pointer p-mx-2",onClick:t[5]||(t[5]=(...x)=>e.deleteAllFieldsFromQuery&&e.deleteAllFieldsFromQuery(...x))},null,512)),[[_,e.$t("qbe.viewToolbar.deleteAllSelectedFields"),void 0,{top:!0}]]):C("",!0),e.hiddenColumnsExist?T((p(),f("i",{key:1,class:"pi pi-eye kn-cursor-pointer p-mx-2",onClick:t[6]||(t[6]=(...x)=>e.showHiddenColumns&&e.showHiddenColumns(...x))},null,512)),[[_,e.$t("qbe.viewToolbar.showHiddenColumns"),void 0,{top:!0}]]):C("",!0),e.selectedQuery.filters.length>0?(p(),f("span",qi,[zi,T(s("i",{class:"fas fa-filter fa-stack-1x kn-cursor-pointer",onClick:t[7]||(t[7]=(...x)=>e.deleteAllFilters&&e.deleteAllFilters(...x))},null,512),[[_,e.$t("qbe.viewToolbar.deleteAllFilters"),void 0,{top:!0}]])])):C("",!0),i(A,{class:"p-mr-2",modelValue:e.smartView,"onUpdate:modelValue":t[8]||(t[8]=x=>e.smartView=x),onChange:e.updateSmartView},null,8,["modelValue","onChange"]),s("span",null,m(e.$t("qbe.viewToolbar.smartView")),1),T(s("i",{class:"fas fa-play p-m-2 kn-cursor-pointer",onClick:t[9]||(t[9]=(...x)=>e.openPreviewDialog&&e.openPreviewDialog(...x))},null,512),[[U,!e.smartView]]),i(l,{icon:"fas fa-ellipsis-v kn-cursor-pointer",class:"p-button-text p-button-rounded p-button-plain",onClick:e.showMenu},null,8,["onClick"])]),_:1}),s("div",Fi,[s("div",Ni,[e.smartView?(p(),y(v,{key:1,query:e.selectedQuery,previewData:e.queryPreviewData,pagination:e.pagination,onRemoveFieldFromQuery:e.deleteFieldFromQuery,onOrderChanged:e.updateSmartView,onFieldHidden:e.smartViewFieldHidden,onFieldGrouped:e.updateSmartView,onFieldAggregated:e.updateSmartView,onAliasChanged:e.onFieldAliasChange,onReordered:e.smartViewReorder,onEntityDropped:t[11]||(t[11]=x=>e.onDropComplete(x,!1)),onPageChanged:t[12]||(t[12]=x=>e.updatePagination(x)),onOpenFilterDialog:e.openFilterDialog},null,8,["query","previewData","pagination","onRemoveFieldFromQuery","onOrderChanged","onFieldHidden","onFieldGrouped","onFieldAggregated","onAliasChanged","onReordered","onOpenFilterDialog"])):(p(),y(h,{key:0,query:e.selectedQuery,onColumnVisibilityChanged:e.checkIfHiddenColumnsExist,onOpenFilterDialog:e.openFilterDialog,onOpenHavingDialog:e.openHavingDialog,onEntityDropped:t[10]||(t[10]=x=>e.onDropComplete(x,!1)),onGroupingChanged:e.onGroupingChanged,onOpenCalculatedFieldDialog:e.editCalcField,onFieldDeleted:e.onFieldDeleted,onFieldAliasChanged:e.onFieldAliasChange},null,8,["query","onColumnVisibilityChanged","onOpenFilterDialog","onOpenHavingDialog","onGroupingChanged","onOpenCalculatedFieldDialog","onFieldDeleted","onFieldAliasChanged"]))])])])):C("",!0),e.parameterSidebarVisible?(p(),y(M,{key:3,filtersData:e.filtersData,propDocument:e.dataset,userRole:e.userRole,propMode:"qbeView",propQBEParameters:(pe=e.qbe)==null?void 0:pe.pars,onExecute:e.onExecute,onRoleChanged:e.onRoleChange},null,8,["filtersData","propDocument","userRole","propQBEParameters","onExecute","onRoleChanged"])):C("",!0)])),T(i(q,{id:e.uniqueID,queryPreviewData:e.queryPreviewData,pagination:e.pagination,entities:(De=e.entities)==null?void 0:De.entities,selectedQuery:e.selectedQuery,onClose:e.closePreview,onPageChanged:t[13]||(t[13]=x=>e.updatePagination(x))},null,8,["id","queryPreviewData","pagination","entities","selectedQuery","onClose"]),[[U,!e.loading&&e.qbePreviewDialogVisible]]),i(J,{visible:e.filterDialogVisible,filterDialogData:e.filterDialogData,id:e.uniqueID,entities:(Ee=e.entities)==null?void 0:Ee.entities,propParameters:(Te=e.qbe)==null?void 0:Te.pars,propExpression:(Se=e.selectedQuery)==null?void 0:Se.expression,onClose:t[14]||(t[14]=x=>e.filterDialogVisible=!1),onSave:e.onFiltersSave},null,8,["visible","filterDialogData","id","entities","propParameters","propExpression","onSave"]),i(Q,{visible:e.sqlDialogVisible,sqlData:e.sqlData,onClose:t[15]||(t[15]=x=>e.sqlDialogVisible=!1)},null,8,["visible","sqlData"]),i(K,{visible:e.relationDialogVisible,propEntity:e.relationEntity,onClose:t[16]||(t[16]=x=>e.relationDialogVisible=!1)},null,8,["visible","propEntity"]),e.paramDialogVisible?(p(),y(ae,{key:2,visible:e.paramDialogVisible,propDataset:e.qbe,onClose:t[17]||(t[17]=x=>e.paramDialogVisible=!1),onSave:e.onParametersSave},null,8,["visible","propDataset","onSave"])):C("",!0),i(ne,{visible:e.havingDialogVisible,havingDialogData:e.havingDialogData,entities:(Oe=e.selectedQuery)==null?void 0:Oe.fields,onClose:t[18]||(t[18]=x=>e.havingDialogVisible=!1),onSave:e.onHavingsSave},null,8,["visible","havingDialogData","entities","onSave"]),i(ie,{visible:e.advancedFilterDialogVisible,query:e.selectedQuery,onClose:t[19]||(t[19]=x=>e.advancedFilterDialogVisible=!1),onSave:e.onAdvancedFiltersSave},null,8,["visible","query","onSave"]),i(le,{visible:e.savingDialogVisible,propDataset:e.qbe,propMetadata:e.qbeMetadata,onClose:t[20]||(t[20]=x=>e.savingDialogVisible=!1),onDatasetSaved:t[21]||(t[21]=x=>e.$emit("datasetSaved"))},null,8,["visible","propDataset","propMetadata"]),e.joinDefinitionDialogVisible?(p(),y(se,{key:3,visible:e.joinDefinitionDialogVisible,qbe:e.qbe,propEntities:($e=e.entities)==null?void 0:$e.entities,id:e.uniqueID,selectedQuery:e.selectedQuery,onClose:e.onJoinDefinitionDialogClose},null,8,["visible","qbe","propEntities","id","selectedQuery","onClose"])):C("",!0),e.calcFieldDialogVisible?(p(),y(de,{key:4,template:e.selectedCalcField,"onUpdate:template":t[25]||(t[25]=x=>e.selectedCalcField=x),visibility:e.calcFieldDialogVisible,"onUpdate:visibility":t[26]||(t[26]=x=>e.calcFieldDialogVisible=x),fields:e.calcFieldColumns,descriptor:e.calcFieldDescriptor,propCalcFieldFunctions:e.calcFieldFunctionsToShow,readOnly:!1,valid:!0,source:"QBE",onSave:e.onCalcFieldSave,onCancel:t[27]||(t[27]=x=>e.calcFieldDialogVisible=!1)},{additionalInputs:c(()=>[s("div",{class:I(["p-field",[e.selectedCalcField.type==="DATE"?"p-col-3":"p-col-4"]])},[s("span",Qi,[i(Z,{id:"type",class:"kn-material-input",modelValue:e.selectedCalcField.type,"onUpdate:modelValue":t[22]||(t[22]=x=>e.selectedCalcField.type=x),options:e.qbeDescriptor.types,optionLabel:"label",optionValue:"name"},null,8,["modelValue","options"]),s("label",Li,m(e.$t("components.knCalculatedField.type")),1)])],2),e.selectedCalcField.type==="DATE"?(p(),f("div",Ui,[s("span",Bi,[i(Z,{id:"type",class:"kn-material-input",modelValue:e.selectedCalcField.format,"onUpdate:modelValue":t[23]||(t[23]=x=>e.selectedCalcField.format=x),options:e.qbeDescriptor.admissibleDateFormats},{value:c(()=>[s("span",null,m(e.selectedCalcField.format?e.moment().format(e.selectedCalcField.format):""),1)]),option:c(x=>[s("span",null,m(e.moment().format(x.option)),1)]),_:1},8,["modelValue","options"]),s("label",Pi,m(e.$t("managers.datasetManagement.ckanDateFormat")),1)])])):C("",!0),s("div",{class:I(["p-field",[e.selectedCalcField.type==="DATE"?"p-col-3":"p-col-4"]])},[s("span",Ri,[i(Z,{id:"columnType",class:"kn-material-input",modelValue:e.selectedCalcField.nature,"onUpdate:modelValue":t[24]||(t[24]=x=>e.selectedCalcField.nature=x),options:e.qbeDescriptor.columnTypes,optionLabel:"label",optionValue:"name"},null,8,["modelValue","options"]),s("label",_i,m(e.$t("managers.functionsCatalog.columnType")),1)])],2)]),_:1},8,["template","visibility","fields","descriptor","propCalcFieldFunctions","onSave"])):C("",!0),i(ce,{id:"optionsMenu",ref:"optionsMenu",model:e.menuButtons},null,8,["model"])]}),_:1})}var il=V(Di,[["render",ji]]);export{Xa as D,il as Q,Ma as a,ve as l};
//# sourceMappingURL=QBE-95a8c4bc.js.map
