import{d as w,a5 as F,s as V,_ as y,r as n,o as l,c as h,f as r,w as p,g as x,t as i,h as k,A as c,a,B as E,p as N,b as I,a4 as U,X as T}from"./index-1e676509.js";import{K as z}from"./KnHint-6d455703.js";import{K as B,u as _,c as P}from"./KnValidatonMessages-ebe48c72.js";import{s as R}from"./inputswitch.esm-80317a38.js";import{s as H}from"./radiobutton.esm-c3e6fa9b.js";const K=[{field:"attributeName",header:"Name"},{field:"attributeDescription",header:"Description"}],j=[{name:"String",value:"STRING"},{name:"Number",value:"NUMBER"},{name:"Date",value:"DATE"}],q={headers:{"Content-Type":"application/json"}},X=["attributeName","attributeDescription"],O={column:{style:{width:"40%"}},iconColumn:{style:{"text-align":"end"}}},Q={style:{width:"60vw"}};var d={columns:K,attributeTypeValues:j,headers:q,globalFilterFields:X,table:O,form:Q};const G={attribute:[{fieldName:"attributeName",validators:[{key:"required"},{key:"maximumCharacters",validator:{params:{max:100},type:"maxLength"}},{key:"regex",validator:{type:"extendedAlphanumericRegex"}}]},{fieldName:"attributeDescription",validators:[{key:"required"},{key:"maximumCharacters",validator:{params:{max:250},type:"maxLength"}},{key:"regex",validator:{type:"extendedAlphanumericRegex"}}]},{fieldName:"value",validators:[{key:"required"}]},{fieldName:"lov",validators:[]},{fieldName:"lovId",validators:[{key:"required",validator:{type:"custom-required"}}]},{fieldName:"multivalue",validators:[]},{fieldName:"allowUser",validators:[]},{fieldName:"syntax",validators:[]}]};var J={validations:G};const Y=w({name:"profile-attributes-detail",components:{Dropdown:F,InputSwitch:R,RadioButton:H,KnValidationMessages:B},props:{selectedAttribute:{type:Object,required:!0}},computed:{formValid(){return this.v$.$invalid}},watch:{selectedAttribute:{handler:function(t){this.v$.$reset(),this.loadAttribute(t)}}},emits:["refreshRecordSet","closesForm","dataChanged"],data(){return{v$:_(),apiUrl:"/knowage/restful-services/2.0/",attribute:{},lovs:{},loading:!1,hideForm:!1,isDirty:!1,disableLov:!0,enableLov:!0,LovSelectHidden:!0,syntaxSelectHidden:!0,profileAttributesManagementDescriptor:d,columns:d.columns,attributeTypeValues:d.attributeTypeValues}},validations(){const t={"custom-required":e=>this.enableLov||e};return{attribute:P("attribute",J.validations.attribute,t)}},setup(){return{store:V()}},async created(){await this.loadLovs(),this.selectedAttribute&&this.loadAttribute(this.selectedAttribute)},methods:{onLoveBlur(){this.v$.attribute.lovId.$touch()},async loadLovs(){this.loading=!0,await this.$http.get(this.apiUrl+"lovs/get/all").then(t=>{this.lovs=t.data}).finally(()=>this.loading=!1)},resetForm(){Object.keys(this.attribute).forEach(t=>delete this.attribute[t])},showForm(){this.hideLovDropdown(!1),this.syntaxSelectHidden=!0,this.resetForm(),this.hideForm=!1},async save(){let t;this.attribute.value==="NUMBER"&&(this.attribute.value="NUM"),this.attribute.attributeId!=null?t=await this.$http.put(this.apiUrl+"attributes/"+this.attribute.attributeId,this.attribute,d.headers):t=await this.$http.post(this.apiUrl+"attributes/",this.attribute,d.headers),t.status==200&&(t.data.errors?console.log(t.data.errors):this.store.setInfo({title:this.$t("managers.profileAttributesManagement.info.saveTitle"),msg:this.$t("managers.profileAttributesManagement.info.saveMessage")})),this.$emit("refreshRecordSet"),this.resetForm()},closeForm(){this.$emit("closesForm")},onAttributeSelect(t){this.populateForm(t.data)},checkSyntax(){this.attribute.multivalue===!0?this.showSyntaxButtons(this.attribute):(this.attribute.syntax=null,this.syntaxSelectHidden=!0)},populateForm(t){this.hideLovDropdown(!1),this.hideForm=!1,this.attribute={...t},typeof t.value=="object"&&t.value!==null&&(this.attribute.value=t.value.type.toUpperCase()),this.showSyntaxButtons(t),t.lovId!==null?(this.disableLovs(),this.showLovDropdown(!1)):this.enableLovs()},showSyntaxButtons(t){t.lovId!==null&&t.multivalue===!0?this.syntaxSelectHidden=!1:this.syntaxSelectHidden=!0},hideLovDropdown(t=!0){this.attribute.lovId=null,this.enableLovs(),this.LovSelectHidden=!0,t&&this.$emit("dataChanged")},showLovDropdown(t=!0){this.disableLovs(),this.LovSelectHidden=!1,t&&this.$emit("dataChanged")},disableLovs(){this.enableLov=!1,this.disableLov=!0},enableLovs(){this.enableLov=!0,this.disableLov=!1},onDataChange(t){t.$touch(),this.$emit("dataChanged")},onLoveDropdownChange(){this.checkSyntax(),this.$emit("dataChanged")},loadAttribute(t){if(t.attributeId===null){this.resetForm();return}this.populateForm(t)},setDirty(t){t.$touch(),this.$emit("dataChanged")}}}),L=t=>(N("data-v-4034e9f4"),t=t(),I(),t),Z={class:"p-grid p-m-0 p-fluid"},W={class:"p-col-12"},tt={ref:"profile-attributes-form"},et={class:"p-field"},at={class:"p-inputgroup"},ot={class:"p-float-label"},rt={for:"attributeName"},nt={class:"p-field"},it={class:"p-inputgroup"},lt={class:"p-float-label"},dt={for:"attributeDescription"},st={class:"p-field"},pt={class:"p-inputgroup"},ct={class:"p-float-label"},bt={for:"dataType"},ut={class:"p-inputgroup p-col-6 p-sm-12 p-md-6"},ft={class:"p-field-radiobutton p-col-6 p-sm-12 p-md-6"},mt={for:"disableLov"},vt={class:"p-field-radiobutton p-col-6 p-sm-12 p-md-6"},kt={for:"enableLov"},gt=["hidden"],ht={class:"p-inputgroup"},wt={class:"p-float-label"},yt={for:"attributeDescription"},xt={class:"p-inputgroup p-col-6 p-sm-12 p-md-6"},At={class:"p-field-radiobutton p-col-6 p-sm-12 p-md-6"},$t=L(()=>a("i",{class:"p-ml-2 pi pi-bars"},null,-1)),Mt={for:"multiValue"},Ct={class:"p-field-radiobutton p-col-6 p-sm-12 p-md-6"},Dt=L(()=>a("i",{class:"p-ml-2 pi pi-eye"},null,-1)),Vt={for:"multiValue"},Lt=["hidden"],St={class:"p-grid p-ai-start vertical-container"},Ft={class:"p-col"},Et={class:"p-m-2",for:"simple"},Nt={key:0,class:"p-mt-2"},It={class:"p-col"},Ut={class:"p-m-2",for:"complex"},Tt={key:0,class:"p-m-2"};function zt(t,e,A,$,M,C){const b=n("Button"),m=n("Toolbar"),s=n("ProgressBar"),v=n("InputText"),u=n("KnValidationMessages"),g=n("Dropdown"),f=n("RadioButton"),D=n("InputSwitch"),S=n("Card");return l(),h(E,null,[r(m,{class:"kn-toolbar kn-toolbar--secondary"},{start:p(()=>[x(i(t.attribute.attributeName),1)]),end:p(()=>[r(b,{icon:"pi pi-save",class:"p-button-text p-button-rounded p-button-plain",onClick:t.save,disabled:t.formValid},null,8,["onClick","disabled"]),r(b,{class:"p-button-text p-button-rounded p-button-plain",icon:"pi pi-times",onClick:t.closeForm},null,8,["onClick"])]),_:1}),t.loading?(l(),k(s,{key:0,mode:"indeterminate",class:"kn-progress-bar","data-test":"progress-bar"})):c("",!0),a("div",Z,[a("div",W,[r(S,null,{content:p(()=>[a("form",tt,[a("div",et,[a("div",at,[a("span",ot,[r(v,{id:"attributeName",maxLength:"100",type:"text",modelValue:t.v$.attribute.attributeName.$model,"onUpdate:modelValue":e[0]||(e[0]=o=>t.v$.attribute.attributeName.$model=o),modelModifiers:{trim:!0},onChange:e[1]||(e[1]=o=>t.onDataChange(t.v$.attribute.attributeName)),class:"p-inputtext p-component kn-material-input"},null,8,["modelValue"]),a("label",rt,i(t.$t("managers.profileAttributesManagement.form.name"))+" *",1)])]),r(u,{vComp:t.v$.attribute.attributeName,additionalTranslateParams:{fieldName:t.$t("managers.profileAttributesManagement.form.name")}},null,8,["vComp","additionalTranslateParams"])]),a("div",nt,[a("div",it,[a("span",lt,[r(v,{id:"attributeDescription",maxLength:"250",type:"text",modelValue:t.v$.attribute.attributeDescription.$model,"onUpdate:modelValue":e[2]||(e[2]=o=>t.v$.attribute.attributeDescription.$model=o),modelModifiers:{trim:!0},onBlur:e[3]||(e[3]=o=>t.onDataChange(t.v$.attribute.attributeDescription)),class:"p-inputtext p-component kn-material-input"},null,8,["modelValue"]),a("label",dt,i(t.$t("managers.profileAttributesManagement.form.description"))+" *",1)])]),r(u,{vComp:t.v$.attribute.attributeDescription,additionalTranslateParams:{fieldName:t.$t("managers.profileAttributesManagement.form.description")}},null,8,["vComp","additionalTranslateParams"])]),a("div",st,[a("div",pt,[a("span",ct,[r(g,{id:"dataType",modelValue:t.v$.attribute.value.$model,"onUpdate:modelValue":e[4]||(e[4]=o=>t.v$.attribute.value.$model=o),onBeforeShow:e[5]||(e[5]=o=>t.setDirty(t.v$.attribute.value)),options:t.attributeTypeValues,optionLabel:"name",optionValue:"value",class:"p-dropdown p-component p-inputwrapper p-inputwrapper-filled kn-material-input",onChange:e[6]||(e[6]=o=>t.onDataChange(t.v$.attribute.value))},null,8,["modelValue","options"]),a("label",bt,i(t.$t("managers.profileAttributesManagement.form.dataType"))+" *",1)])]),r(u,{vComp:t.v$.attribute.value,additionalTranslateParams:{fieldName:t.$t("managers.profileAttributesManagement.form.dataType")}},null,8,["vComp","additionalTranslateParams"])]),a("div",ut,[a("div",ft,[r(f,{id:"disableLov",name:"disableLov",modelValue:t.disableLov,"onUpdate:modelValue":e[7]||(e[7]=o=>t.disableLov=o),value:!1,onChange:t.hideLovDropdown},null,8,["modelValue","onChange"]),a("label",mt,i(t.$t("managers.profileAttributesManagement.form.manualInput")),1)]),a("div",vt,[r(f,{id:"lov",name:"enableLov",value:!1,modelValue:t.enableLov,"onUpdate:modelValue":e[8]||(e[8]=o=>t.enableLov=o),onChange:t.showLovDropdown},null,8,["modelValue","onChange"]),a("label",kt,i(t.$t("managers.profileAttributesManagement.form.lov")),1)])]),a("div",{class:"p-field",hidden:t.LovSelectHidden},[a("div",ht,[a("span",wt,[r(g,{modelValue:t.v$.attribute.lovId.$model,"onUpdate:modelValue":e[9]||(e[9]=o=>t.v$.attribute.lovId.$model=o),options:t.lovs,optionLabel:"name",optionValue:"id",onChange:t.onLoveDropdownChange,onBeforeShow:e[10]||(e[10]=o=>t.setDirty(t.v$.attribute.lovId)),filter:!0,placeholder:t.$t("managers.profileAttributesManagement.form.lovPlaceholder"),showClear:!0,class:"p-dropdown p-component p-inputwrapper p-inputwrapper-filled kn-material-input"},null,8,["modelValue","options","onChange","placeholder"]),a("label",yt,i(t.$t("managers.profileAttributesManagement.form.lov"))+" *",1)])]),r(u,{vComp:t.v$.attribute.lovId,additionalTranslateParams:{fieldName:t.$t("managers.profileAttributesManagement.form.lov")}},null,8,["vComp","additionalTranslateParams"])],8,gt),a("div",xt,[a("div",At,[r(D,{modelValue:t.v$.attribute.multivalue.$model,"onUpdate:modelValue":e[11]||(e[11]=o=>t.v$.attribute.multivalue.$model=o),onInput:t.checkSyntax(),onChange:e[12]||(e[12]=o=>t.onDataChange(t.v$.attribute.multivalue))},null,8,["modelValue","onInput"]),$t,a("label",Mt,i(t.$t("managers.profileAttributesManagement.form.multiValue")),1)]),a("div",Ct,[r(D,{modelValue:t.v$.attribute.allowUser.$model,"onUpdate:modelValue":e[13]||(e[13]=o=>t.v$.attribute.allowUser.$model=o),onChange:e[14]||(e[14]=o=>t.onDataChange(t.v$.attribute.allowUser))},null,8,["modelValue"]),Dt,a("label",Vt,i(t.$t("managers.profileAttributesManagement.form.allowUser")),1)])]),a("div",{class:"p-col-6 p-sm-12 p-md-6",hidden:t.syntaxSelectHidden},[a("div",St,[a("div",Ft,[r(f,{id:"simple",name:"syntax",value:!1,modelValue:t.v$.attribute.syntax.$model,"onUpdate:modelValue":e[15]||(e[15]=o=>t.v$.attribute.syntax.$model=o),onChange:e[16]||(e[16]=o=>t.onDataChange(t.v$.attribute.syntax))},null,8,["modelValue"]),a("label",Et,i(t.$t("managers.profileAttributesManagement.form.syntax.simple")),1),t.v$.attribute.syntax.$model===!1?(l(),h("div",Nt,"* Simple = ('Italy','USA','Serbia', ...)")):c("",!0)]),a("div",It,[r(f,{id:"complex",name:"syntax",value:!0,modelValue:t.v$.attribute.syntax.$model,"onUpdate:modelValue":e[17]||(e[17]=o=>t.v$.attribute.syntax.$model=o),onChange:e[18]||(e[18]=o=>t.onDataChange(t.v$.attribute.syntax))},null,8,["modelValue"]),a("label",Ut,i(t.$t("managers.profileAttributesManagement.form.syntax.complex")),1),t.v$.attribute.syntax.$model===!0?(l(),h("div",Tt,"* Complex = {;{Italy;USA;Serbia; ...}}")):c("",!0)])])],8,Lt)],512)]),_:1})])])],64)}var Bt=y(Y,[["render",zt],["__scopeId","data-v-4034e9f4"]]);const _t=w({name:"profile-attributes-list-box",components:{Listbox:U},emits:["selectedAttribute","deleteAttribute"],props:{attributes:Object,loading:Boolean},watch:{attributes:{handler:function(t){this.listAttributes=t}},loading:{handler:function(t){this.load=t}}},data(){return{load:!1,listAttributes:[],selectedAttribute:null,profileAttributesManagementDescriptor:d}},methods:{deleteAttribute(t){this.$emit("deleteAttribute",t)},onAttributeSelect(t){this.$emit("selectedAttribute",t.value)}}}),Pt={class:"kn-list-item","data-test":"list-item"},Rt={class:"kn-list-item-text"},Ht={class:"kn-list-item-text-secondary"};function Kt(t,e,A,$,M,C){const b=n("Button"),m=n("Listbox");return t.load?c("",!0):(l(),k(m,{key:0,class:"kn-list--column",options:t.attributes,filter:!0,filterPlaceholder:t.$t("common.search"),optionLabel:"userId",filterMatchMode:"contains",filterFields:t.profileAttributesManagementDescriptor.globalFilterFields,emptyFilterMessage:t.$t("managers.widgetGallery.noResults"),onChange:t.onAttributeSelect,"data-test":"attributes-list"},{empty:p(()=>[x(i(t.$t("common.info.noDataFound")),1)]),option:p(s=>[a("div",Pt,[a("div",Rt,[a("span",null,i(s.option.attributeName),1),a("span",Ht,i(s.option.attributeDescription),1)]),r(b,{icon:"far fa-trash-alt",class:"p-button-text p-button-rounded p-button-plain",onClick:v=>t.deleteAttribute(s.option.attributeId),"data-test":"delete-button"},null,8,["onClick"])])]),_:1},8,["options","filterPlaceholder","filterFields","emptyFilterMessage","onChange"]))}var jt=y(_t,[["render",Kt]]);const qt=w({name:"profile-attributes",components:{AttributesListBox:jt,KnFabButton:T,KnHint:z,ProfileAttributesDetail:Bt},data(){return{apiUrl:"/knowage/restful-services/2.0/",attributes:[],attribute:{},tempAttribute:{},profileAttributesManagementDescriptor:d,columns:d.columns,loading:!1,hideForm:!0,dirty:!1}},setup(){return{store:V()}},async created(){await this.loadAllAttributes()},methods:{async loadAllAttributes(){this.loading=!0,this.hideForm=!0,this.dirty=!1,await this.$http.get(this.apiUrl+"attributes").then(t=>{this.attributes=t.data}).finally(()=>this.loading=!1)},onAttributeSelect(t){this.dirty?this.$confirm.require({message:this.$t("common.toast.unsavedChangesMessage"),header:this.$t("common.toast.unsavedChangesHeader"),icon:"pi pi-exclamation-triangle",accept:()=>{this.dirty=!1,t?this.prepareFormData(t):this.hideForm=!0}}):t?this.prepareFormData(t):this.hideForm=!0},prepareFormData(t){this.hideForm&&(this.hideForm=!1),this.attribute={...t}},onAttributeDelete(t){this.deleteAttribute(t)},showForm(){this.hideForm=!1,this.attribute={attributeId:null,attributeName:"",attributeDescription:"",allowUser:null,multivalue:null,syntax:null,lovId:null,value:{}}},closeForm(){this.onAttributeSelect()},async deleteAttribute(t){this.$confirm.require({message:this.$t("common.toast.deleteMessage"),header:this.$t("common.toast.deleteConfirmTitle"),icon:"pi pi-exclamation-triangle",accept:async()=>{this.loading=!0,this.axios.delete(this.apiUrl+"attributes/"+t,{headers:{"X-Disable-Errors":"true"}}).then(e=>{e.data.errors?this.store.setError({title:this.$t("managers.profileAttributesManagement.info.deleteTitle"),msg:this.$t("managers.profileAttributesManagement.error.profileAttributeDeletion")}):(this.store.setInfo({title:this.$t("managers.profileAttributesManagement.info.deleteTitle"),msg:this.$t("managers.profileAttributesManagement.info.deleteMessage")}),this.loadAllAttributes())}).catch(()=>{this.store.setError({title:this.$t("managers.profileAttributesManagement.info.deleteTitle"),msg:this.$t("managers.profileAttributesManagement.error.profileAttributeDeletion")})}).catch(e=>{this.store.setError({title:this.$t("managers.profileAttributesManagement.info.deleteTitle"),msg:e.message})}).finally(()=>{this.loading=!1})}})}}}),Xt={class:"kn-page kn-width-full-with-menu"},Ot={class:"kn-page-content p-grid p-m-0"},Qt={class:"kn-list--column p-col-4 p-sm-4 p-md-3 p-p-0"},Gt={class:"p-col-8 p-sm-8 p-md-9 p-p-0 p-m-0"};function Jt(t,e,A,$,M,C){const b=n("KnFabButton"),m=n("Toolbar"),s=n("ProgressBar"),v=n("AttributesListBox"),u=n("KnHint"),g=n("ProfileAttributesDetail");return l(),h("div",Xt,[a("div",Ot,[a("div",Qt,[r(m,{class:"kn-toolbar kn-toolbar--primary"},{start:p(()=>[x(i(t.$t("managers.profileAttributesManagement.title")),1)]),end:p(()=>[r(b,{icon:"fas fa-plus",onClick:e[0]||(e[0]=f=>t.showForm()),"data-test":"open-form-button"})]),_:1}),t.loading?(l(),k(s,{key:0,mode:"indeterminate",class:"kn-progress-bar","data-test":"progress-bar"})):c("",!0),r(v,{attributes:t.attributes,loading:t.loading,onDeleteAttribute:t.onAttributeDelete,onSelectedAttribute:t.onAttributeSelect,"data-test":"profile-attributes-listbox"},null,8,["attributes","loading","onDeleteAttribute","onSelectedAttribute"])]),a("div",Gt,[t.hideForm?(l(),k(u,{key:0,title:"managers.profileAttributesManagement.title",hint:"managers.profileAttributesManagement.hint"},null,8,["title","hint"])):c("",!0),t.hideForm?c("",!0):(l(),k(g,{key:1,selectedAttribute:t.attribute,onRefreshRecordSet:t.loadAllAttributes,onClosesForm:t.closeForm,onDataChanged:e[1]||(e[1]=f=>t.dirty=!0)},null,8,["selectedAttribute","onRefreshRecordSet","onClosesForm"]))])])])}var ae=y(qt,[["render",Jt]]);export{ae as default};
//# sourceMappingURL=ProfileAttributesManagement-57fb275c.js.map
