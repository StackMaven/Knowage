import{d as y,l as V,n as I,_ as C,r as a,y as te,o as l,h as g,w as i,g as A,t as b,a as o,f as n,c as f,C as $,D as z,z as N,B as E,V as R,A as x,a5 as D,G as U,ad as T,W as X,ah as oe,i as B,q as j,k as ae,v as Q,u as P,s as Y,x as L,X as re,Y as ne}from"./index-1e676509.js";import{s as K,a as J}from"./accordiontab.esm-2c1b3232.js";import{s as ie}from"./chips.esm-693c3c01.js";import{s as le}from"./editor.esm-7f249187.js";import{s as de}from"./textarea.esm-32051d54.js";import{s as G}from"./calendar.esm-60a451ba.js";import{f as _}from"./filterHelper-a723991a.js";const ce="960px",se=[{field:"label",header:"managers.functionsCatalog.label",style:{}},{field:"name",header:"managers.functionsCatalog.name",style:{}},{field:"type",header:"common.type",style:{}},{field:"language",header:"common.language",style:{}},{field:"owner",header:"common.owner",style:{}}],be="stack",pe=15,ke={iconColumn:{style:{"text-align":"end"}}};var ue={breakpoint:ce,columns:se,responsiveLayout:be,rows:pe,table:ke};const me=y({name:"functions-catalog-datatable",components:{Column:V,DataTable:I},props:{user:{type:Object},propLoading:{type:Boolean},items:{type:Array}},emits:["selected","preview","deleted"],data(){return{functionsCatalogDatatableDescriptor:ue,functions:[],filteredFunctions:[],searchWord:"",loading:!1}},watch:{propLoading(){this.setLoading()},items(){this.loadFunctions()}},computed:{canManageFunctionalities(){var t,r;return((r=(t=this.user)==null?void 0:t.functionalities)==null?void 0:r.findIndex(k=>k==="FunctionsCatalogManagement"))!==-1}},async created(){this.setLoading(),this.loadFunctions()},methods:{setLoading(){this.loading=this.propLoading},loadFunctions(){this.functions=[...this.items],this.filteredFunctions=[...this.functions],this.searchWord=""},previewFunction(e){this.$emit("preview",e)},canDelete(e){var t;return this.canManageFunctionalities||(e==null?void 0:e.owner)===((t=this.user)==null?void 0:t.userId)},deleteFunctionConfirm(e){this.$confirm.require({message:this.$t("common.toast.deleteMessage"),header:this.$t("common.toast.deleteTitle"),icon:"pi pi-exclamation-triangle",accept:()=>this.$emit("deleted",e)})},searchFunctions(){setTimeout(()=>{this.searchWord.trim().length?this.filteredFunctions=this.functions.filter(e=>e.label.toLowerCase().includes(this.searchWord.toLowerCase())||e.name.toLowerCase().includes(this.searchWord.toLowerCase())||e.type.toLowerCase().includes(this.searchWord.toLowerCase())||e.language.toLowerCase().includes(this.searchWord.toLowerCase())||e.owner.toLowerCase().includes(this.searchWord.toLowerCase())||e.tags&&e.tags.includes(this.searchWord.toLowerCase())):this.filteredFunctions=[...this.functions]},250)}}}),ge={id:"noFunctionsFound"},ve={class:"table-header p-d-flex"},he={class:"p-input-icon-left p-mr-3 p-col-12"},fe=o("i",{class:"pi pi-search"},null,-1);function we(e,t,r,k,v,h){const c=a("InputText"),p=a("Column"),u=a("Button"),d=a("DataTable"),s=te("tooltip");return l(),g(d,{id:"functions-datatable",value:e.filteredFunctions,paginator:!0,rows:e.functionsCatalogDatatableDescriptor.rows,loading:e.loading,class:"p-datatable-sm kn-table kn-page-content",dataKey:"id",responsiveLayout:e.functionsCatalogDatatableDescriptor.responsiveLayout,breakpoint:e.functionsCatalogDatatableDescriptor.breakpoint,onRowClick:t[1]||(t[1]=m=>e.$emit("selected",m.data))},{loading:i(()=>[A(b(e.$t("common.info.dataLoading")),1)]),empty:i(()=>[o("div",ge,b(e.$t("managers.functionsCatalog.noFunctionsFound")),1)]),header:i(()=>[o("div",ve,[o("span",he,[fe,n(c,{class:"kn-material-input",modelValue:e.searchWord,"onUpdate:modelValue":t[0]||(t[0]=m=>e.searchWord=m),type:"text",placeholder:e.$t("common.search"),onInput:e.searchFunctions},null,8,["modelValue","placeholder","onInput"])])])]),default:i(()=>[(l(!0),f(E,null,$(e.functionsCatalogDatatableDescriptor.columns,m=>(l(),g(p,{class:"kn-truncated",style:z(m.style),header:e.$t(m.header),key:m.field,sortField:m.field,sortable:!0},{body:i(M=>[N((l(),f("span",null,[A(b(M.data[m.field]),1)])),[[s,M.data[m.field],void 0,{top:!0}]])]),_:2},1032,["style","header","sortField"]))),128)),n(p,{style:z(e.functionsCatalogDatatableDescriptor.table.iconColumn.style)},{body:i(m=>[N(n(u,{icon:"fa fa-play-circle",class:"p-button-link",onClick:R(M=>e.previewFunction(m.data),["stop"])},null,8,["onClick"]),[[s,e.$t("managers.functionsCatalog.executePreview"),void 0,{top:!0}]]),e.canDelete(m.data)?N((l(),g(u,{key:0,icon:"pi pi-trash",class:"p-button-link",onClick:R(M=>e.deleteFunctionConfirm(m.data.id),["stop"]),"data-test":"delete-button-"+m.data.id},null,8,["onClick","data-test"])),[[s,e.$t("common.delete"),void 0,{top:!0}]]):x("",!0)]),_:1},8,["style"])]),_:1},8,["value","rows","loading","responsiveLayout","breakpoint"])}var xe=C(me,[["render",we]]);const ye={style:{height:"100vh",padding:"1rem"}},Ce={message:{"align-items":"center",display:"flex","justify-content":"center","text-align":"center"}},Me={style:{padding:"0",width:"60vw"}};var q={dialog:ye,styles:Ce,warningDialog:Me};const Ae={style:{height:"260px"}};var Ee={editor:Ae};const ze=y({name:"function-catalog-general-tab",components:{Accordion:K,AccordionTab:J,Chips:ie,Dropdown:D,Editor:le,Textarea:de},props:{propFunction:{type:Object},readonly:{type:Boolean},functionTypes:{type:Array},propKeywords:{type:Array}},data(){return{functionsCatalogGeneralTabDescriptor:Ee,selectedFunction:{},descriptionDirty:!1,showDescriptionSource:!1,showBenchmarksSource:!1}},created(){this.loadFunction()},methods:{loadFunction(){this.selectedFunction=this.propFunction,this.selectedFunction.tags&&this.selectedFunction.tags[0]===""&&(this.selectedFunction.tags=[])}}}),Fe={key:0,class:"p-fluid p-ai-end p-formgrid p-grid p-m-2"},$e={class:"p-field p-col-6 p-mb-6"},De={class:"p-float-label"},Te={for:"name",class:"kn-material-input-label"},_e={class:"hint"},Ve={class:"p-field p-col-6 p-mb-6"},Ie={class:"p-float-label"},Ue={for:"label ",class:"kn-material-input-label"},Se={class:"hint"},Ne={class:"p-field p-col-6 p-mb-6"},Be={class:"p-float-label"},Le={for:"owner ",class:"kn-material-input-label"},Oe={class:"p-field p-col-6 p-mb-6"},Re={for:"type",class:"kn-material-input-label"},Xe={class:"p-field p-col-12 p-mb-12"},je={for:"keywords",class:"kn-material-input-label"},Qe={class:"p-field p-col-12 p-mb-12"},Pe={for:"description",class:"kn-material-input-label"},Ye={key:0,class:"p-error p-grid p-m-2"},Ke={class:"p-field p-col-12 p-mb-12"},Je={for:"benchmarks",class:"kn-material-input-label"};function Ge(e,t,r,k,v,h){const c=a("InputText"),p=a("Dropdown"),u=a("Chips"),d=a("Textarea"),s=a("Editor"),m=a("Button"),M=a("AccordionTab"),F=a("Accordion");return e.selectedFunction?(l(),f("form",Fe,[o("div",$e,[o("span",De,[n(c,{id:"name",class:"kn-material-input",modelValue:e.selectedFunction.name,"onUpdate:modelValue":t[0]||(t[0]=w=>e.selectedFunction.name=w),modelModifiers:{trim:!0},disabled:e.readonly},null,8,["modelValue","disabled"]),o("label",Te,b(e.$t("managers.functionsCatalog.functionName")),1),o("small",_e,b(e.$t("managers.functionsCatalog.functionNameHint")),1)])]),o("div",Ve,[o("span",Ie,[n(c,{id:"label ",class:"kn-material-input",modelValue:e.selectedFunction.label,"onUpdate:modelValue":t[1]||(t[1]=w=>e.selectedFunction.label=w),modelModifiers:{trim:!0},disabled:e.readonly},null,8,["modelValue","disabled"]),o("label",Ue,b(e.$t("common.label")),1),o("small",Se,b(e.$t("managers.functionsCatalog.functionLabelHint")),1)])]),o("div",Ne,[o("span",Be,[n(c,{id:"owner ",class:"kn-material-input",modelValue:e.selectedFunction.owner,"onUpdate:modelValue":t[2]||(t[2]=w=>e.selectedFunction.owner=w),modelModifiers:{trim:!0},disabled:!0},null,8,["modelValue"]),o("label",Le,b(e.$t("common.owner")),1)])]),o("div",Oe,[o("span",null,[o("label",Re,b(e.$t("common.type")),1),n(p,{id:"type",class:"kn-material-input",modelValue:e.selectedFunction.type,"onUpdate:modelValue":t[3]||(t[3]=w=>e.selectedFunction.type=w),options:e.functionTypes,optionLabel:"valueCd",optionValue:"valueCd",disabled:e.readonly},null,8,["modelValue","options","disabled"])])]),o("div",Xe,[o("span",null,[o("label",je,b(e.$t("managers.functionsCatalog.keywords")),1),n(u,{id:"keywords",class:"p-inputtext-sm",multiple:!0,modelValue:e.selectedFunction.tags,"onUpdate:modelValue":t[4]||(t[4]=w=>e.selectedFunction.tags=w),disabled:e.readonly,placeholder:e.$t("managers.functionsCatalog.keywords")},null,8,["modelValue","disabled","placeholder"])])]),o("div",Qe,[n(F,null,{default:i(()=>[n(M,{header:e.$t("common.description")+" *"},{default:i(()=>[o("label",Pe,b(e.$t("common.description"))+" *",1),e.showDescriptionSource?(l(),g(d,{key:0,modelValue:e.selectedFunction.description,"onUpdate:modelValue":t[5]||(t[5]=w=>e.selectedFunction.description=w),style:z(e.functionsCatalogGeneralTabDescriptor.editor.style),class:U({"p-invalid":e.selectedFunction.description.length===0&&e.descriptionDirty}),readonly:e.readonly,onClick:t[6]||(t[6]=w=>e.descriptionDirty=!0),onInput:t[7]||(t[7]=w=>e.descriptionDirty=!0)},null,8,["modelValue","style","class","readonly"])):(l(),g(s,{key:1,id:"description",editorStyle:e.functionsCatalogGeneralTabDescriptor.editor.style,modelValue:e.selectedFunction.description,"onUpdate:modelValue":t[8]||(t[8]=w=>e.selectedFunction.description=w),class:U({"p-invalid":e.selectedFunction.description.length===0&&e.descriptionDirty}),readonly:e.readonly,onClick:t[9]||(t[9]=w=>e.descriptionDirty=!0),onInput:t[10]||(t[10]=w=>e.descriptionDirty=!0)},null,8,["editorStyle","modelValue","class","readonly"])),n(m,{class:"editor-switch-button",icon:"pi pi-bars",label:e.showDescriptionSource?"wysiwyg":e.$t("common.source"),onClick:t[11]||(t[11]=w=>e.showDescriptionSource=!e.showDescriptionSource)},null,8,["label"])]),_:1},8,["header"])]),_:1}),e.selectedFunction.description.length===0&&e.descriptionDirty?(l(),f("div",Ye,b(e.$t("common.validation.required",{fieldName:e.$t("common.description")})),1)):x("",!0)]),o("div",Ke,[n(F,null,{default:i(()=>[n(M,{header:e.$t("managers.functionsCatalog.benchmarks")},{default:i(()=>[o("label",Je,b(e.$t("managers.functionsCatalog.benchmarks")),1),e.showBenchmarksSource?(l(),g(d,{key:0,modelValue:e.selectedFunction.benchmark,"onUpdate:modelValue":t[12]||(t[12]=w=>e.selectedFunction.benchmark=w),style:z(e.functionsCatalogGeneralTabDescriptor.editor.style),readonly:e.readonly},null,8,["modelValue","style","readonly"])):(l(),g(s,{key:1,id:"benchmarks",editorStyle:e.functionsCatalogGeneralTabDescriptor.editor.style,modelValue:e.selectedFunction.benchmark,"onUpdate:modelValue":t[13]||(t[13]=w=>e.selectedFunction.benchmark=w),readonly:e.readonly},null,8,["editorStyle","modelValue","readonly"])),n(m,{class:"editor-switch-button",icon:"pi pi-bars",label:e.showBenchmarksSource?"wysiwyg":e.$t("common.source"),onClick:t[14]||(t[14]=w=>e.showBenchmarksSource=!e.showBenchmarksSource)},null,8,["label"])]),_:1},8,["header"])]),_:1})])])):x("",!0)}var qe=C(ze,[["render",Ge],["__scopeId","data-v-741c2641"]]);const Ze=[{value:"STRING"},{value:"DATE"},{value:"NUMBER"}],We=[{value:"STRING"},{value:"DATE"},{value:"NUMBER"}];var Z={columnTypes:Ze,variableTypes:We};const He=y({name:"function-catalog-input-column",components:{Dropdown:D},props:{column:{type:Object},readonly:{type:Boolean}},emits:["deleted"],data(){return{functionsCatalogInputTabDescriptor:Z,inputColumn:{}}},watch:{column(){this.loadColumn()}},created(){this.loadColumn()},methods:{loadColumn(){this.inputColumn=this.column},deleteColumnConfirm(){this.$confirm.require({message:this.$t("common.toast.deleteMessage"),header:this.$t("common.toast.deleteTitle"),icon:"pi pi-exclamation-triangle",accept:()=>this.$emit("deleted")})}}}),et={key:0,class:"p-d-flex p-flex-row p-ai-center","data-test":"input-columns-container"},tt={class:"column-name-input kn-flex"},ot={class:"p-float-label"},at={for:"columnName",class:"kn-material-input-label"},rt={class:"p-field kn-flex p-m-2"},nt={for:"columnType",class:"kn-material-input-label"},it={class:"p-field p-mt-5"};function lt(e,t,r,k,v,h){const c=a("InputText"),p=a("Dropdown"),u=a("Button");return e.inputColumn?(l(),f("div",et,[o("div",tt,[o("span",ot,[n(c,{class:"kn-material-input",modelValue:e.inputColumn.name,"onUpdate:modelValue":t[0]||(t[0]=d=>e.inputColumn.name=d),modelModifiers:{trim:!0},disabled:e.readonly,"data-test":"column-name-input"},null,8,["modelValue","disabled"]),o("label",at,b(e.$t("managers.functionsCatalog.columnName")),1)])]),o("div",rt,[o("span",null,[o("label",nt,b(e.$t("managers.functionsCatalog.columnType")),1),n(p,{class:"kn-material-input",modelValue:e.inputColumn.type,"onUpdate:modelValue":t[1]||(t[1]=d=>e.inputColumn.type=d),options:e.functionsCatalogInputTabDescriptor.columnTypes,optionLabel:"value",optionValue:"value",disabled:e.readonly},null,8,["modelValue","options","disabled"])])]),o("div",it,[e.readonly?x("",!0):(l(),g(u,{key:0,icon:"pi pi-trash",class:"p-button-link",onClick:e.deleteColumnConfirm},null,8,["onClick"]))])])):x("",!0)}var dt=C(He,[["render",lt],["__scopeId","data-v-5c1c519e"]]);const ct=y({name:"function-catalog-input-columns-card",components:{Card:T,FunctionCatalogInputColumn:dt},props:{columns:{type:Array},readonly:{type:Boolean}},data(){return{inputColumns:[]}},created(){this.loadInputColumns()},methods:{loadInputColumns(){this.inputColumns=this.columns},addInputColumn(){this.inputColumns.push({name:"",type:""})},deleteInputColumn(e){this.inputColumns.splice(e,1)}}}),st={key:0,class:"p-d-flex p-flex-row p-jc-center"};function bt(e,t,r,k,v,h){const c=a("Button"),p=a("Toolbar"),u=a("FunctionCatalogInputColumn"),d=a("Card");return l(),g(d,null,{header:i(()=>[n(p,{class:"kn-toolbar kn-toolbar--secondary p-p-0 p-m-0 p-col-12"},{start:i(()=>[A(b(e.$t("managers.functionsCatalog.inputColumns")),1)]),end:i(()=>[e.readonly?x("",!0):(l(),g(c,{key:0,class:"kn-button p-button-text",label:e.$t("managers.functionsCatalog.addColumn"),onClick:e.addInputColumn},null,8,["label","onClick"]))]),_:1})]),content:i(()=>[e.inputColumns.length===0?(l(),f("div",st,b(e.$t("managers.functionsCatalog.noInputColumnsRequired")),1)):(l(!0),f(E,{key:1},$(e.inputColumns,(s,m)=>(l(),g(u,{key:m,column:s,readonly:e.readonly,onDeleted:M=>e.deleteInputColumn(m)},null,8,["column","readonly","onDeleted"]))),128))]),_:1})}var pt=C(ct,[["render",bt]]);const kt=y({name:"function-catalog-input-column",components:{Calendar:G,Dropdown:D},props:{variable:{type:Object},readonly:{type:Boolean}},emits:["deleted"],data(){return{functionsCatalogInputTabDescriptor:Z,inputVariable:{}}},watch:{variable(){this.loadVariable()}},created(){this.loadVariable()},methods:{loadVariable(){this.inputVariable=this.variable,this.inputVariable.type==="DATE"&&(this.inputVariable.value=this.getFormatedDate(this.inputVariable.value))},onTypeChange(){this.inputVariable.value=""},deleteVariableConfirm(){this.$confirm.require({message:this.$t("common.toast.deleteMessage"),header:this.$t("common.toast.deleteTitle"),icon:"pi pi-exclamation-triangle",accept:()=>this.$emit("deleted")})},getFormatedDate(e){return X(e,"MM/DD/YYYY")}}}),ut={key:0,class:"p-d-flex p-flex-row p-ai-center","data-test":"input-variables-container"},mt={class:"variable-name-input kn-flex"},gt={class:"p-float-label"},vt={class:"kn-material-input-label"},ht={class:"p-field kn-flex p-m-2"},ft={class:"kn-material-input-label"},wt={class:"p-field kn-flex"},xt={class:"kn-material-input-label"},yt={class:"p-field p-mt-5"};function Ct(e,t,r,k,v,h){const c=a("InputText"),p=a("Dropdown"),u=a("Calendar"),d=a("Button");return e.inputVariable?(l(),f("div",ut,[o("div",mt,[o("span",gt,[n(c,{class:"kn-material-input",modelValue:e.inputVariable.name,"onUpdate:modelValue":t[0]||(t[0]=s=>e.inputVariable.name=s),modelModifiers:{trim:!0},disabled:e.readonly,"data-test":"variable-name-input"},null,8,["modelValue","disabled"]),o("label",vt,b(e.$t("managers.functionsCatalog.variableName")),1)])]),o("div",ht,[o("span",null,[o("label",ft,b(e.$t("managers.functionsCatalog.variableType")),1),n(p,{class:"kn-material-input",modelValue:e.inputVariable.type,"onUpdate:modelValue":t[1]||(t[1]=s=>e.inputVariable.type=s),options:e.functionsCatalogInputTabDescriptor.variableTypes,optionLabel:"value",optionValue:"value",disabled:e.readonly,onChange:e.onTypeChange},null,8,["modelValue","options","disabled","onChange"])])]),o("div",wt,[o("label",xt,b(e.$t("managers.functionsCatalog.variableDefaultValue")),1),e.inputVariable.type!=="DATE"?(l(),g(c,{key:0,type:e.inputVariable.type==="NUMBER"?"number":"text",class:"kn-material-input",modelValue:e.inputVariable.value,"onUpdate:modelValue":t[2]||(t[2]=s=>e.inputVariable.value=s),modelModifiers:{trim:!0},disabled:e.readonly,"data-test":"variable-defult-value-input"},null,8,["type","modelValue","disabled"])):(l(),g(u,{key:1,modelValue:e.inputVariable.value,"onUpdate:modelValue":t[3]||(t[3]=s=>e.inputVariable.value=s),showButtonBar:!0,disabled:e.readonly},null,8,["modelValue","disabled"]))]),o("div",yt,[e.readonly?x("",!0):(l(),g(d,{key:0,icon:"pi pi-trash",class:"p-button-link",onClick:e.deleteVariableConfirm},null,8,["onClick"]))])])):x("",!0)}var Mt=C(kt,[["render",Ct],["__scopeId","data-v-1e6be59b"]]);const At=y({name:"function-catalog-input-columns-card",components:{Card:T,FunctionsCatalogInputVariable:Mt},props:{variables:{type:Array},readonly:{type:Boolean}},data(){return{inputVariables:[]}},created(){this.loadInputVariables()},methods:{loadInputVariables(){this.inputVariables=this.variables},addInputVariable(){this.inputVariables.push({name:"",type:"",value:""})},deleteInputVariable(e){this.inputVariables.splice(e,1)}}}),Et={key:0,class:"p-d-flex p-flex-row p-jc-center"};function zt(e,t,r,k,v,h){const c=a("Button"),p=a("Toolbar"),u=a("FunctionsCatalogInputVariable"),d=a("Card");return l(),g(d,null,{header:i(()=>[n(p,{class:"kn-toolbar kn-toolbar--secondary p-p-0 p-m-0 p-col-12"},{start:i(()=>[A(b(e.$t("managers.functionsCatalog.inputVariables")),1)]),end:i(()=>[e.readonly?x("",!0):(l(),g(c,{key:0,class:"kn-button p-button-text",label:e.$t("managers.functionsCatalog.addInputVariable"),onClick:e.addInputVariable},null,8,["label","onClick"]))]),_:1})]),content:i(()=>[e.inputVariables.length===0?(l(),f("div",Et,b(e.$t("managers.functionsCatalog.noInputVariablesRequired")),1)):(l(!0),f(E,{key:1},$(e.inputVariables,(s,m)=>(l(),g(u,{key:m,variable:s,readonly:e.readonly,onDeleted:M=>e.deleteInputVariable(m)},null,8,["variable","readonly","onDeleted"]))),128))]),_:1})}var Ft=C(At,[["render",zt]]);const $t=y({name:"function-catalog-input-tab",components:{FunctionsCatalogInputColumnsCard:pt,FunctionsCatalogInputVariablesCard:Ft},props:{propFunction:{type:Object},readonly:{type:Boolean}},data(){return{selectedFunction:{}}},created(){this.loadFunction()},methods:{loadFunction(){this.selectedFunction=this.propFunction}}});function Dt(e,t,r,k,v,h){const c=a("FunctionsCatalogInputColumnsCard"),p=a("FunctionsCatalogInputVariablesCard");return l(),f(E,null,[n(c,{class:"p-mt-4",columns:e.selectedFunction.inputColumns,readonly:e.readonly},null,8,["columns","readonly"]),n(p,{class:"p-mt-4",variables:e.selectedFunction.inputVariables,readonly:e.readonly},null,8,["variables","readonly"])],64)}var Tt=C($t,[["render",Dt]]);const _t=[{value:"Python"}];var Vt={languages:_t};const It=y({name:"function-catalog-script-tab",components:{Dropdown:D,VCodeMirror:oe},props:{propFunction:{type:Object},readonly:{type:Boolean},activeTab:{type:Number}},data(){return{functionsCatalogScriptTabDescriptor:Vt,selectedFunction:{},code:"",trainModelCode:"",useModelCode:"",codeMirror:{},options:{mode:"",lineWrapping:!0,theme:"eclipse",lineNumbers:!0,autoRefresh:!0}}},watch:{activeTab(e){e===2&&this.codeMirror&&setTimeout(()=>this.codeMirror.refresh(),100)}},created(){this.loadFunction(),this.setupCodeMirror()},methods:{loadFunction(){var e,t,r;this.selectedFunction=this.propFunction,this.selectedFunction&&(this.code=(e=this.selectedFunction.onlineScript)!=null?e:"",this.trainModelCode=(t=this.selectedFunction.trainModelCode)!=null?t:"",this.useModelCode=(r=this.selectedFunction.useModelCode)!=null?r:"",this.options.mode=this.selectedFunction.language.toLowerCase())},setupCodeMirror(){const e=setInterval(()=>{!this.$refs.codeMirror||(this.codeMirror=this.$refs.codeMirror.cminstance,this.codeMirror.setOption("readOnly",this.readonly),setTimeout(()=>{this.codeMirror.refresh()},0),clearInterval(e))},200)},onKeyUp(){this.selectedFunction.onlineScript=this.code},onKeyUpTrainModel(){this.selectedFunction.trainModelCode=this.trainModelCode},onKeyUpUseModel(){this.selectedFunction.useModelCode=this.useModelCode}}}),Ut={class:"p-field kn-flex p-m-2"},St={class:"kn-material-input-label"},Nt={key:0,class:"p-mt-4"},Bt={class:"kn-material-input-label"},Lt={key:1},Ot={class:"p-mt-4"},Rt={class:"kn-material-input-label"},Xt={class:"p-mt-4"},jt={class:"kn-material-input-label"};function Qt(e,t,r,k,v,h){const c=a("Dropdown"),p=a("VCodeMirror");return l(),f(E,null,[o("div",Ut,[o("span",null,[o("label",St,b(e.$t("common.language")),1),n(c,{class:"kn-material-input",modelValue:e.selectedFunction.language,"onUpdate:modelValue":t[0]||(t[0]=u=>e.selectedFunction.language=u),options:e.functionsCatalogScriptTabDescriptor.languages,optionLabel:"value",optionValue:"value",disabled:e.readonly},null,8,["modelValue","options","disabled"])])]),e.selectedFunction.language?(l(),f("div",Nt,[o("div",null,[o("label",Bt,b(e.$t("common.script")),1),n(p,{ref:"codeMirror",class:"p-mt-2",value:e.code,"onUpdate:value":t[1]||(t[1]=u=>e.code=u),autoHeight:!0,options:e.options,onKeyup:e.onKeyUp},null,8,["value","options","onKeyup"])])])):x("",!0),e.selectedFunction.language&&e.selectedFunction.family==="offline"?(l(),f("div",Lt,[o("div",Ot,[o("label",Rt,b(e.$t("managers.functionsCatalog.trainModel")),1),n(p,{ref:"codeMirror",class:"p-mt-2",value:e.trainModelCode,"onUpdate:value":t[2]||(t[2]=u=>e.trainModelCode=u),autoHeight:!0,options:e.options,onKeyup:e.onKeyUpTrainModel},null,8,["value","options","onKeyup"])]),o("div",Xt,[o("label",jt,b(e.$t("managers.functionsCatalog.useModel")),1),n(p,{ref:"codeMirror",class:"p-mt-2",value:e.useModelCode,"onUpdate:value":t[3]||(t[3]=u=>e.useModelCode=u),autoHeight:!0,options:e.options,onKeyup:e.onKeyUpUseModel},null,8,["value","options","onKeyup"])])])):x("",!0)],64)}var Pt=C(It,[["render",Qt]]);const Yt=[{value:"MEASURE"},{value:"ATTRIBUTE"}],Kt=[{value:"STRING"},{value:"DATE"},{value:"NUMBER"}];var Jt={columnFieldTypes:Yt,columnTypes:Kt};const Gt=y({name:"function-catalog-input-column",components:{Dropdown:D},props:{column:{type:Object},readonly:{type:Boolean}},emits:["deleted"],data(){return{functionsCatalogOutputTabDescriptor:Jt,outputColumn:{}}},watch:{column(){this.loadColumn()}},created(){this.loadColumn()},methods:{loadColumn(){this.outputColumn=this.column},onFieldTypeChange(){this.outputColumn.type=""},getColumnTypes(){return this.outputColumn.type==="ATTRIBUTE"?this.functionsCatalogOutputTabDescriptor.columnTypes:{value:"NUMBER"}},deleteColumnConfirm(){this.$confirm.require({message:this.$t("common.toast.deleteMessage"),header:this.$t("common.toast.deleteTitle"),icon:"pi pi-exclamation-triangle",accept:()=>this.$emit("deleted")})}}}),qt={key:0,class:"p-d-flex p-flex-row p-ai-center"},Zt={class:"column-name-input kn-flex"},Wt={class:"p-float-label"},Ht={for:"columnName",class:"kn-material-input-label"},eo={class:"p-field kn-flex p-m-2"},to={for:"columnType",class:"kn-material-input-label"},oo={class:"p-field kn-flex p-m-2"},ao={for:"columnType",class:"kn-material-input-label"},ro={class:"p-field p-mt-5"};function no(e,t,r,k,v,h){const c=a("InputText"),p=a("Dropdown"),u=a("Button");return e.outputColumn?(l(),f("div",qt,[o("div",Zt,[o("span",Wt,[n(c,{class:"kn-material-input",modelValue:e.outputColumn.name,"onUpdate:modelValue":t[0]||(t[0]=d=>e.outputColumn.name=d),modelModifiers:{trim:!0},disabled:e.readonly},null,8,["modelValue","disabled"]),o("label",Ht,b(e.$t("managers.functionsCatalog.columnName")),1)])]),o("div",eo,[o("span",null,[o("label",to,b(e.$t("managers.functionsCatalog.columnFieldType")),1),n(p,{class:"kn-material-input",modelValue:e.outputColumn.fieldType,"onUpdate:modelValue":t[1]||(t[1]=d=>e.outputColumn.fieldType=d),options:e.functionsCatalogOutputTabDescriptor.columnFieldTypes,optionLabel:"value",optionValue:"value",disabled:e.readonly,onChange:e.onFieldTypeChange},null,8,["modelValue","options","disabled","onChange"])])]),o("div",oo,[o("span",null,[o("label",ao,b(e.$t("managers.functionsCatalog.columnType")),1),n(p,{class:"kn-material-input",modelValue:e.outputColumn.type,"onUpdate:modelValue":t[2]||(t[2]=d=>e.outputColumn.type=d),options:e.outputColumn.fieldType==="ATTRIBUTE"?e.functionsCatalogOutputTabDescriptor.columnTypes:[{value:"NUMBER"}],optionLabel:"value",optionValue:"value",disabled:e.readonly},null,8,["modelValue","options","disabled"])])]),o("div",ro,[e.readonly?x("",!0):(l(),g(u,{key:0,icon:"pi pi-trash",class:"p-button-link",onClick:e.deleteColumnConfirm},null,8,["onClick"]))])])):x("",!0)}var io=C(Gt,[["render",no],["__scopeId","data-v-bdc67eb6"]]);const lo=y({name:"function-catalog-output-columns-card",components:{Card:T,FunctionsCatalogOutputColumn:io},props:{columns:{type:Array},readonly:{type:Boolean}},data(){return{outputColumns:[]}},created(){this.loadOutputColumns()},methods:{loadOutputColumns(){this.outputColumns=this.columns},addOutputColumn(){this.outputColumns.push({name:"",fieldType:"",type:""})},deleteOutputColumn(e){this.outputColumns.splice(e,1)}}}),co={key:0,class:"p-d-flex p-flex-row p-jc-center"};function so(e,t,r,k,v,h){const c=a("Button"),p=a("Toolbar"),u=a("FunctionsCatalogOutputColumn"),d=a("Card");return l(),g(d,null,{header:i(()=>[n(p,{class:"kn-toolbar kn-toolbar--secondary p-p-0 p-m-0 p-col-12"},{start:i(()=>[A(b(e.$t("managers.functionsCatalog.outputColumns")),1)]),end:i(()=>[e.readonly?x("",!0):(l(),g(c,{key:0,class:"kn-button p-button-text",label:e.$t("managers.functionsCatalog.addColumn"),onClick:e.addOutputColumn},null,8,["label","onClick"]))]),_:1})]),content:i(()=>[e.outputColumns.length===0?(l(),f("div",co,b(e.$t("managers.functionsCatalog.noOutputColumnsRequired")),1)):(l(!0),f(E,{key:1},$(e.outputColumns,(s,m)=>(l(),g(u,{key:m,column:s,readonly:e.readonly,onDeleted:M=>e.deleteOutputColumn(m)},null,8,["column","readonly","onDeleted"]))),128))]),_:1})}var bo=C(lo,[["render",so]]);const po=y({name:"function-catalog-output-tab",components:{FunctionsCatalogOutputColumnsCard:bo},props:{propFunction:{type:Object},readonly:{type:Boolean}},data(){return{selectedFunction:{}}},created(){this.loadFunction()},methods:{loadFunction(){this.selectedFunction=this.propFunction}}});function ko(e,t,r,k,v,h){const c=a("FunctionsCatalogOutputColumnsCard");return l(),g(c,{columns:e.selectedFunction.outputColumns,readonly:e.readonly},null,8,["columns","readonly"])}var uo=C(po,[["render",ko]]);const mo=y({name:"functions-catalog-warning-dialog",components:{Dialog:B,Message:j},emits:["close"],props:{visible:{type:Boolean},title:{type:String},missingFields:{type:Array}},data(){return{functionsCatalogDetailDescriptor:q}}}),go={class:"p-m-2"};function vo(e,t,r,k,v,h){const c=a("Message"),p=a("Button"),u=a("Dialog");return l(),g(u,{header:e.title,visible:e.visible,modal:!0,contentStyle:e.functionsCatalogDetailDescriptor.warningDialog.style,class:"p-fluid kn-dialog--toolbar--primary",closable:!1},{footer:i(()=>[n(p,{class:"kn-button kn-button--primary",onClick:t[0]||(t[0]=d=>e.$emit("close"))},{default:i(()=>[A(b(e.$t("common.close")),1)]),_:1})]),default:i(()=>[o("div",go,[n(c,{class:"p-m-2",severity:"warn",closable:!1,style:z(e.functionsCatalogDetailDescriptor.styles.message)},{default:i(()=>[(l(!0),f(E,null,$(e.missingFields,(d,s)=>(l(),f("p",{class:"p-m-2",key:s},b(d),1))),128))]),_:1},8,["style"])])]),_:1},8,["header","visible","contentStyle"])}var ho=C(mo,[["render",vo]]);const fo=y({name:"functions-catalog-detail",components:{Badge:ae,Dialog:B,FunctionsCatalogGeneralTab:qe,FunctionsCatalogInputTab:Tt,FunctionsCatalogScriptTab:Pt,FunctionsCatalogOutputTab:uo,FunctionsCatalogWarningDialog:ho,TabView:Q,TabPanel:P},props:{visible:{type:Boolean},propFunction:{type:Object},functionTypes:{type:Array}},emits:["created","close"],data(){return{functionsCatalogDetailDescriptor:q,selectedFunction:{},filteredFunctionTypes:[],missingFields:[],warningTitle:"",operation:"create",warningVisible:!1,activeTab:0,loading:!1}},watch:{propFunction(){this.loadFunction()},functionTypes(){this.loadFunctionTypes()}},computed:{canManageFunctionalities(){var t,r;return((r=(t=this.store.$state.user)==null?void 0:t.functionalities)==null?void 0:r.findIndex(k=>k==="FunctionsCatalogManagement"))!==-1},readonly(){var e;return!this.canManageFunctionalities&&((e=this.selectedFunction)==null?void 0:e.owner)!==this.store.$state.user.userId},invalidGeneral(){return!this.validateFunctionInfo(!1)},invalidInput(){return!this.validateInputColumns(!1)||!this.validateInputVariables(!1)},invalidCode(){return!this.validateCode(!1)},invalidOutput(){return!this.validateOutputColumns(!1)}},setup(){return{store:Y()}},created(){this.loadFunction(),this.loadFunctionTypes()},methods:{loadFunction(){this.selectedFunction=this.propFunction?{...this.propFunction,inputColumns:[...this.propFunction.inputColumns],inputVariables:[...this.propFunction.inputVariables],outputColumns:[...this.propFunction.outputColumns]}:this.getFunctionDefaultValues()},loadFunctionTypes(){var e;this.filteredFunctionTypes=(e=this.functionTypes)==null?void 0:e.filter(t=>t.valueCd!=="All")},closeFunctionDetail(){this.selectedFunction=this.getFunctionDefaultValues(),this.$emit("close"),this.activeTab=0},getFunctionDefaultValues(){return{name:"",description:"",benchmark:"",type:"",label:"",owner:this.store.$state.user.userId,language:"Python",inputColumns:[],inputVariables:[],outputColumns:[],onlineScript:"",offlineScriptTrain:"",offlineScriptUse:"",family:"online"}},validateArguments(){let e=!0;return this.missingFields=[],this.validateFunctionInfo(!0)||(e=!1),this.validateInputColumns(!0)||(e=!1),this.validateInputVariables(!0)||(e=!1),this.validateCode(!0)||(e=!1),this.validateOutputColumns(!0)||(e=!1),e},validateInputColumns(e){let t=!0;for(let r=0;r<this.selectedFunction.inputColumns.length;r++)delete this.selectedFunction.inputColumns[r].dsColumn,this.selectedFunction.inputColumns[r].name||(t=this.addMissingFields(e,this.$t("managers.functionsCatalog.missingFields.inputColumnName",{number:r+1}))),this.selectedFunction.inputColumns[r].type||(t=this.addMissingFields(e,this.$t("managers.functionsCatalog.missingFields.inputColumnType",{number:r+1})));return t},validateInputVariables(e){let t=!0;for(let r=0;r<this.selectedFunction.inputVariables.length;r++)this.selectedFunction.inputVariables[r].name||(t=this.addMissingFields(e,this.$t("managers.functionsCatalog.missingFields.inputVariableName",{number:r+1}))),this.selectedFunction.inputVariables[r].type||(t=this.addMissingFields(e,this.$t("managers.functionsCatalog.missingFields.inputVariableType",{number:r+1})));return t},validateOutputColumns(e){let t=!0;this.selectedFunction.outputColumns.length===0&&(t=this.addMissingFields(e,this.$t("managers.functionsCatalog.missingFields.outputColumnMissing")));for(let r=0;r<this.selectedFunction.outputColumns.length;r++)this.selectedFunction.outputColumns[r].name||(t=this.addMissingFields(e,this.$t("managers.functionsCatalog.missingFields.outputColumnName",{number:r+1}))),this.selectedFunction.outputColumns[r].fieldType||(t=this.addMissingFields(e,this.$t("managers.functionsCatalog.missingFields.outputColumnFieldType",{number:r+1}))),this.selectedFunction.outputColumns[r].type||(t=this.addMissingFields(e,this.$t("managers.functionsCatalog.missingFields.outputColumnType",{number:r+1})));return t},validateFunctionInfo(e){let t=!0;return this.selectedFunction.description||(t=this.addMissingFields(e,this.$t("managers.functionsCatalog.missingFields.functionDescription"))),t},validateCode(e){let t=!0;return this.selectedFunction.family==="online"&&this.selectedFunction.onlineScript===""?t=this.addMissingFields(e,this.$t("managers.functionsCatalog.missingFields.onlineScript")):this.selectedFunction.family==="offline"&&(this.selectedFunction.offlineScriptTrain||(t=this.addMissingFields(e,this.$t("managers.functionsCatalog.missingFields.offlineTrainingScript"))),this.selectedFunction.offlineScriptUse||(t=this.addMissingFields(e,this.$t("managers.functionsCatalog.missingFields.offlineUseScript")))),t},addMissingFields(e,t){return e&&this.missingFields.push(t),!1},async onSave(){if(this.loading=!0,!this.validateArguments()){this.warningTitle=this.$t("managers.functionsCatalog.warningTitle"),this.warningVisible=!0;return}let e="/knowage-api/api/1.0/functioncatalog/new";this.selectedFunction.id?(this.operation="update",e="/knowage-api/api/1.0/functioncatalog"):this.operation="create",await this.sendRequest(e).then(t=>{t.data.errors?(this.warningVisible=!0,this.missingFields.push(t.data.errrors[0].message)):(this.store.setInfo({title:this.$t("common.toast."+this.operation+"Title"),msg:this.$t("common.toast.success")}),this.$emit("created"))}).catch(t=>{this.warningTitle=this.$t("common.toast."+this.operation+"Title"),this.warningVisible=!0,this.missingFields.push(t.message)}),this.loading=!1},sendRequest(e){return this.operation==="create"?this.$http.post(e,this.selectedFunction):this.$http.patch(e,this.selectedFunction)}}});function wo(e,t,r,k,v,h){const c=a("Button"),p=a("Toolbar"),u=a("ProgressBar"),d=a("Badge"),s=a("FunctionsCatalogGeneralTab"),m=a("TabPanel"),M=a("FunctionsCatalogInputTab"),F=a("FunctionsCatalogScriptTab"),w=a("FunctionsCatalogOutputTab"),S=a("TabView"),H=a("FunctionsCatalogWarningDialog"),ee=a("Dialog");return l(),g(ee,{id:"function-catalog-detail-dialog",class:"full-screen-dialog p-fluid kn-dialog--toolbar--primary",contentStyle:e.functionsCatalogDetailDescriptor.dialog.style,visible:e.visible,modal:!1,closable:!1,position:"right",baseZIndex:1,autoZIndex:!1},{header:i(()=>[n(p,{class:"kn-toolbar kn-toolbar--primary p-p-0 p-m-0 p-col-12"},{start:i(()=>[A(b(e.selectedFunction.name),1)]),end:i(()=>[n(c,{class:"kn-button p-button-text p-m-2",label:e.$t("common.close"),onClick:e.closeFunctionDetail},null,8,["label","onClick"]),n(c,{class:"kn-button p-button-text",label:e.$t("common.save"),disabled:e.readonly,onClick:e.onSave},null,8,["label","disabled","onClick"])]),_:1}),e.loading?(l(),g(u,{key:0,mode:"indeterminate",class:"kn-progress-bar"})):x("",!0)]),default:i(()=>[n(S,{activeIndex:e.activeTab,"onUpdate:activeIndex":t[0]||(t[0]=O=>e.activeTab=O)},{default:i(()=>[n(m,null,{header:i(()=>[o("span",null,b(e.$t("common.general")),1),e.invalidGeneral?(l(),g(d,{key:0,class:"p-ml-2",severity:"danger"})):x("",!0)]),default:i(()=>[n(s,{propFunction:e.selectedFunction,readonly:e.readonly,functionTypes:e.filteredFunctionTypes},null,8,["propFunction","readonly","functionTypes"])]),_:1}),n(m,null,{header:i(()=>[o("span",null,b(e.$t("common.input")),1),e.invalidInput?(l(),g(d,{key:0,class:"p-ml-2",severity:"danger"})):x("",!0)]),default:i(()=>[n(M,{propFunction:e.selectedFunction,readonly:e.readonly},null,8,["propFunction","readonly"])]),_:1}),n(m,null,{header:i(()=>[o("span",null,b(e.$t("common.script")),1),e.invalidCode?(l(),g(d,{key:0,class:"p-ml-2",severity:"danger"})):x("",!0)]),default:i(()=>[n(F,{activeTab:e.activeTab,propFunction:e.selectedFunction,readonly:e.readonly},null,8,["activeTab","propFunction","readonly"])]),_:1}),n(m,null,{header:i(()=>[o("span",null,b(e.$t("common.output")),1),e.invalidOutput?(l(),g(d,{key:0,class:"p-ml-2",severity:"danger"})):x("",!0)]),default:i(()=>[n(w,{propFunction:e.selectedFunction,readonly:e.readonly},null,8,["propFunction","readonly"])]),_:1})]),_:1},8,["activeIndex"]),n(H,{visible:e.warningVisible,title:e.warningTitle,missingFields:e.missingFields,onClose:t[1]||(t[1]=O=>e.warningVisible=!1)},null,8,["visible","title","missingFields"])]),_:1},8,["contentStyle","visible"])}var xo=C(fo,[["render",wo]]);const yo={"all.png":"all","url(../../knowage/themes/commons/img/functions_catalog_images/degree.png)":"degree","url(../../knowage/themes/commons/img/functions_catalog_images/eye.png)":"eye","url(../../knowage/themes/commons/img/functions_catalog_images/memory.png)":"memory","url(../../knowage/themes/commons/img/functions_catalog_images/text.png)":"text"};var Co={filterImagesMap:yo};const Mo=y({name:"functions-catalog-filter-card",components:{Card:T},props:{propFilter:{type:Object}},emits:["selected"],data(){return{functionsCatalogFilterCardDescriptor:Co,filter:{}}},watch:{propFilter:{handler(){this.loadFilter()},deep:!0}},created(){this.loadFilter()},methods:{loadFilter(){this.filter={...this.propFilter},this.filter.valueDescription=this.functionsCatalogFilterCardDescriptor.filterImagesMap[this.filter.valueDescription]}}}),Ao={class:"filter-value"},Eo={class:"filter-domain-name"};function zo(e,t,r,k,v,h){const c=a("Card");return l(),g(c,{class:"filter-card"},{content:i(()=>[o("div",{class:U(["p-d-flex p-flex-column p-ai-center filter-container p-p-0",{"functions-filter-card-active":e.filter.active}]),style:z({"background-image":"url(./images/functionCatalog/"+e.filter.valueDescription+".png)"}),onClick:t[0]||(t[0]=p=>e.$emit("selected",e.filter))},[o("span",Ao,b(e.filter.valueCd),1),o("span",Eo,b(e.filter.domainName),1)],6)]),_:1})}var Fo=C(Mo,[["render",zo]]);const $o=y({name:"functions-catalog-filter-cards",components:{FunctionsCatalogFilterCard:Fo},props:{propFilters:{type:Array}},data(){return{filters:[],selectedFilter:null}},watch:{propFilters(){this.loadFilters()}},created(){this.loadFilters()},methods:{loadFilters(){var e;this.filters=[],(e=this.propFilters)==null||e.forEach(t=>{t.valueCd==="All"&&(t.active=!0,this.selectedFilter=t,this.$emit("selected",this.selectedFilter)),this.filters.push(t)})},onSelected(e){this.selectedFilter&&(this.selectedFilter.active=!1),this.selectedFilter=e,this.selectedFilter.active=!0,this.$emit("selected",this.selectedFilter)}}}),Do={class:"p-d-flex p-flex-row"};function To(e,t,r,k,v,h){const c=a("FunctionsCatalogFilterCard");return l(),f("div",Do,[(l(!0),f(E,null,$(e.filters,p=>(l(),g(c,{class:"kn-flex p-m-2",key:p.valueId,propFilter:p,onSelected:e.onSelected},null,8,["propFilter","onSelected"]))),128))])}var _o=C($o,[["render",To]]);const Vo={style:{height:"70vh",width:"80vw"}},Io={message:{"align-items":"center",display:"flex","justify-content":"center","text-align":"center"}},Uo={style:{padding:"0",width:"60vw"}};var W={dialog:Vo,styles:Io,warningDialog:Uo};const So="960px",No=[{field:"label",header:"common.dataset",style:{}},{field:"dsType",header:"common.type",style:{}}],Bo=["label","dsType"],Lo="stack",Oo="40vh";var Ro={breakpoint:So,columns:No,globalFilterFields:Bo,responsiveLayout:Lo,scrollHeight:Oo};const Xo=y({name:"function-catalog-dateset-table",components:{Card:T,Column:V,DataTable:I},props:{datasets:{type:Array}},emits:["selected"],data(){return{functionsCatalogDatasetTableDescriptor:Ro,selectedDataset:null,filters:{global:[_],label:{operator:L.AND,constraints:[_]},dsType:{operator:L.AND,constraints:[_]}}}},async created(){},methods:{}}),jo={id:"noFunctionsFound"},Qo={class:"table-header p-d-flex"},Po={class:"p-input-icon-left p-mr-3 p-col-12"},Yo=o("i",{class:"pi pi-search"},null,-1);function Ko(e,t,r,k,v,h){const c=a("InputText"),p=a("Column"),u=a("DataTable"),d=a("Card");return l(),g(d,{id:"dataset-card"},{content:i(()=>[n(u,{id:"dataset-datatable",value:e.datasets,paginator:!0,rows:15,class:"p-datatable-sm kn-table kn-small-paginator",dataKey:"id",selection:e.selectedDataset,"onUpdate:selection":t[1]||(t[1]=s=>e.selectedDataset=s),selectionMode:"single",filters:e.filters,"onUpdate:filters":t[2]||(t[2]=s=>e.filters=s),filterDisplay:"menu",globalFilterFields:e.functionsCatalogDatasetTableDescriptor.globalFilterFields,responsiveLayout:e.functionsCatalogDatasetTableDescriptor.responsiveLayout,breakpoint:e.functionsCatalogDatasetTableDescriptor.breakpoint,pageLinkSize:"2",scrollable:"true",scrollHeight:e.functionsCatalogDatasetTableDescriptor.scrollHeight,onRowClick:t[3]||(t[3]=s=>e.$emit("selected",s.data))},{empty:i(()=>[o("div",jo,b(e.$t("common.info.noDataFound")),1)]),header:i(()=>[o("div",Qo,[o("span",Po,[Yo,n(c,{class:"kn-material-input",modelValue:e.filters.global.value,"onUpdate:modelValue":t[0]||(t[0]=s=>e.filters.global.value=s),type:"text",placeholder:e.$t("common.search"),"data-test":"filterInput"},null,8,["modelValue","placeholder"])])])]),default:i(()=>[(l(!0),f(E,null,$(e.functionsCatalogDatasetTableDescriptor.columns,s=>(l(),g(p,{class:"kn-truncated",style:z(s.style),field:s.field,header:e.$t(s.header),key:s.field,sortable:!0},{filter:i(({filterModel:m})=>[n(c,{type:"text",modelValue:m.value,"onUpdate:modelValue":M=>m.value=M,class:"p-column-filter"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["style","field","header"]))),128))]),_:1},8,["value","selection","filters","globalFilterFields","responsiveLayout","breakpoint","scrollHeight"])]),_:1})}var Jo=C(Xo,[["render",Ko]]);const Go="960px",qo="name",Zo={border:"none"},Wo="stack";var Ho={breakpoint:Go,dataKey:qo,dropdownStyle:Zo,responsiveLayout:Wo};const ea=y({name:"function-catalog-dateset-form-columns-table",components:{Column:V,DataTable:I,Dropdown:D},props:{columns:{type:Array},datasetColumns:{type:Array}},data(){return{functionsCatalogDatasetFormColumnsTableDescriptor:Ho,inputColumns:[]}},watch:{columns(){this.loadInputColumns()}},created(){this.loadInputColumns()},methods:{loadInputColumns(){this.inputColumns=this.columns},getIconClass(e){switch(e){case"NUMBER":return"fa fa-hashtag";case"STRING":return"fa fa-quote-right";case"DATE":return"fa fa-calendar";default:return""}},onCellEditComplete(e){this.inputColumns[e.index]=e.newData}}}),ta={class:"p-d-flex p-flex-row p-ai-center"},oa=o("i",{class:"pi pi-pencil edit-icon kn-flex"},null,-1),aa={class:"p-mr-2"},ra=o("i",{class:"pi pi-pencil edit-icon"},null,-1);function na(e,t,r,k,v,h){const c=a("Column"),p=a("Dropdown"),u=a("DataTable");return l(),g(u,{class:"p-datatable-sm kn-table p-m-2",value:e.inputColumns,editMode:"cell",dataKey:e.functionsCatalogDatasetFormColumnsTableDescriptor.dataKey,responsiveLayout:e.functionsCatalogDatasetFormColumnsTableDescriptor.responsiveLayout,breakpoint:e.functionsCatalogDatasetFormColumnsTableDescriptor.breakpoint,onCellEditComplete:e.onCellEditComplete},{default:i(()=>[n(c,{class:"kn-truncated",field:"name",header:e.$t("managers.functionsCatalog.inputColumnName")},null,8,["header"]),n(c,{class:"kn-truncated",field:"type",header:e.$t("common.type")},{body:i(d=>[o("i",{class:U(e.getIconClass(d.data.type))},null,2),A(" "+b(d.data.type),1)]),_:1},8,["header"]),n(c,{header:e.$t("managers.functionsCatalog.datasetColumn")},{editor:i(d=>[o("div",ta,[n(p,{style:z(e.functionsCatalogDatasetFormColumnsTableDescriptor.dropdownStyle),class:"p-mr-2 kn-flex",modelValue:d.data.dsColumn,"onUpdate:modelValue":s=>d.data.dsColumn=s,options:e.datasetColumns},null,8,["style","modelValue","onUpdate:modelValue","options"]),oa])]),body:i(d=>[o("span",aa,b(d.data.dsColumn),1),ra]),_:1},8,["header"])]),_:1},8,["value","dataKey","responsiveLayout","breakpoint","onCellEditComplete"])}var ia=C(ea,[["render",na]]);const la="960px",da="name",ca="cell",sa={border:"none"},ba="stack";var pa={breakpoint:la,dataKey:da,editMode:ca,inputStyle:sa,responsiveLayout:ba};const ka=y({name:"function-catalog-dateset-form-variables-table",components:{Calendar:G,Column:V,DataTable:I},props:{variables:{type:Array}},data(){return{functionsCatalogDatasetFormVariablesTableDescriptor:pa,inputVariables:[]}},watch:{propinputColumns(){this.loadinputColumns()}},created(){this.loadinputColumns()},methods:{loadinputColumns(){this.inputVariables=this.variables},getIconClass(e){switch(e){case"NUMBER":return"fa fa-hashtag";case"STRING":return"fa fa-quote-right";case"DATE":return"fa fa-calendar";default:return""}},getFormatedDate(e){return X(e,"MM/DD/YYYY")},onCellEditComplete(e){this.inputVariables[e.index]=e.newData}}}),ua={class:"p-d-flex p-flex-row p-ai-center"},ma=o("i",{class:"pi pi-pencil edit-icon kn-flex"},null,-1),ga={class:"p-mr-2"},va=o("i",{class:"pi pi-pencil edit-icon"},null,-1);function ha(e,t,r,k,v,h){const c=a("Column"),p=a("InputText"),u=a("Calendar"),d=a("DataTable");return l(),g(d,{class:"p-datatable-sm kn-table p-m-2",value:e.inputVariables,editMode:"cell",dataKey:e.functionsCatalogDatasetFormVariablesTableDescriptor.dataKey,responsiveLayout:e.functionsCatalogDatasetFormVariablesTableDescriptor.responsiveLayout,breakpoint:e.functionsCatalogDatasetFormVariablesTableDescriptor.breakpoint,onCellEditComplete:e.onCellEditComplete},{default:i(()=>[n(c,{class:"kn-truncated",field:"name",header:e.$t("managers.functionsCatalog.variableName")},null,8,["header"]),n(c,{class:"kn-truncated",field:"type",header:e.$t("common.type")},{body:i(s=>[o("i",{class:U(e.getIconClass(s.data.type))},null,2),A(" "+b(s.data.type),1)]),_:1},8,["header"]),n(c,{header:e.$t("common.value")},{editor:i(s=>[o("div",ua,[s.data.type!=="DATE"?(l(),g(p,{key:0,style:z(e.functionsCatalogDatasetFormVariablesTableDescriptor.inputStyle),class:"p-mr-2 kn-flex",modelValue:s.data.value,"onUpdate:modelValue":m=>s.data.value=m,type:s.data.type==="NUMBER"?"number":"text"},null,8,["style","modelValue","onUpdate:modelValue","type"])):(l(),g(u,{key:1,modelValue:s.data.value,"onUpdate:modelValue":m=>s.data.value=m,class:"kn-flex"},null,8,["modelValue","onUpdate:modelValue"])),ma])]),body:i(s=>[o("span",ga,b(s.data.type==="DATE"&&s.data.value?e.getFormatedDate(s.data.value):s.data.value),1),va]),_:1},8,["header"])]),_:1},8,["value","dataKey","responsiveLayout","breakpoint","onCellEditComplete"])}var fa=C(ka,[["render",ha]]);const wa="960px",xa=[{field:"name",header:"common.library",style:{}},{field:"version",header:"common.version",style:{}}],ya=["name"],Ca="stack",Ma=15;var Aa={breakpoint:wa,columns:xa,globalFilterFields:ya,responsiveLayout:Ca,rows:Ma};const Ea=y({name:"function-catalog-dataset-environment-table",components:{Column:V,DataTable:I},props:{libraries:{type:Array}},data(){return{functionsCatalogDatasetEnvironmentTableDescriptor:Aa,filters:{global:[_]},environmentLibraries:[]}},watch:{libraries(){this.loadLibraries()}},created(){this.loadLibraries()},methods:{loadLibraries(){this.environmentLibraries=this.libraries}}}),za={id:"noFunctionsFound"},Fa={class:"table-header p-d-flex"},$a={class:"p-input-icon-left p-mr-3 p-col-12"},Da=o("i",{class:"pi pi-search"},null,-1);function Ta(e,t,r,k,v,h){const c=a("InputText"),p=a("Column"),u=a("DataTable");return l(),g(u,{id:"environment-datatable",value:e.environmentLibraries,paginator:!0,rows:e.functionsCatalogDatasetEnvironmentTableDescriptor.rows,class:"p-datatable-sm kn-table",dataKey:"name",filters:e.filters,"onUpdate:filters":t[1]||(t[1]=d=>e.filters=d),globalFilterFields:e.functionsCatalogDatasetEnvironmentTableDescriptor.globalFilterFields,responsiveLayout:e.functionsCatalogDatasetEnvironmentTableDescriptor.responsiveLayout,breakpoint:e.functionsCatalogDatasetEnvironmentTableDescriptor.breakpoint,onRowClick:t[2]||(t[2]=d=>e.$emit("selected",d.data))},{empty:i(()=>[o("div",za,b(e.$t("common.info.noDataFound")),1)]),header:i(()=>[o("div",Fa,[o("span",$a,[Da,n(c,{class:"kn-material-input",modelValue:e.filters.global.value,"onUpdate:modelValue":t[0]||(t[0]=d=>e.filters.global.value=d),type:"text",placeholder:e.$t("common.search"),"data-test":"filterInput"},null,8,["modelValue","placeholder"])])])]),default:i(()=>[(l(!0),f(E,null,$(e.functionsCatalogDatasetEnvironmentTableDescriptor.columns,d=>(l(),g(p,{class:"kn-truncated",style:z(d.style),field:d.field,header:e.$t(d.header),key:d.field,sortable:!0},null,8,["style","field","header"]))),128))]),_:1},8,["value","rows","filters","globalFilterFields","responsiveLayout","breakpoint"])}var _a=C(Ea,[["render",Ta]]);const Va=y({name:"function-catalog-parameters-form",components:{Card:T},props:{propParameters:{type:Array}},data(){return{parameters:[]}},watch:{propParameters(){this.loadParameters()}},created(){this.loadParameters()},methods:{loadParameters(){var e;this.parameters=[],(e=this.propParameters)==null||e.forEach(t=>{t.value=t.defaultValue,this.parameters.push(t)})}}}),Ia={class:"p-float-label"},Ua={class:"kn-material-input-label"};function Sa(e,t,r,k,v,h){const c=a("Toolbar"),p=a("InputText"),u=a("Card");return l(),g(u,{class:"p-m-2"},{header:i(()=>[n(c,{class:"kn-toolbar kn-toolbar--secondary p-p-0 p-m-0 p-col-12"},{start:i(()=>[A(b(e.$t("common.parameters")),1)]),_:1})]),content:i(()=>[(l(!0),f(E,null,$(e.parameters,(d,s)=>(l(),f("div",{key:s,class:"p-mt-3"},[o("span",Ia,[n(p,{class:"kn-material-input",modelValue:d.value,"onUpdate:modelValue":m=>d.value=m,modelModifiers:{trim:!0},"data-test":"parameter-input"},null,8,["modelValue","onUpdate:modelValue"]),o("label",Ua,b(d.name),1)])]))),128))]),_:1})}var Na=C(Va,[["render",Sa]]);const Ba=y({name:"function-catalog-dateset-form",components:{Accordion:K,AccordionTab:J,Card:T,Dropdown:D,FunctionsCatalogDatasetFormColumnsTable:ia,FunctionsCatalogDatasetFormVariablesTable:fa,FunctionsCatalogDatasetEnvironmentTable:_a,FunctionsCatalogParametersForm:Na},props:{selectedDataset:{type:Object},propFunction:{type:Object},pythonEnvironments:{type:Array},rEnvironments:{type:Array},libraries:{type:Array}},emits:["environmentSelected"],data(){return{selectedFunction:{},dataset:{},datasetColumns:[],selectedEnvironment:null}},watch:{selectedDataset(){this.loadDataset()}},created(){this.loadDataset(),this.loadFunction()},methods:{loadDataset(){this.dataset=this.selectedDataset,this.dataset&&this.dataset.meta&&this.getDatasetColumns(),this.clearInputColumnDatasetColumn()},loadFunction(){this.selectedFunction=this.propFunction},getDatasetColumns(){this.datasetColumns=[];for(let e=2;e<this.dataset.meta.columns.length;e++)this.dataset.meta.columns[e].pname==="fieldAlias"&&this.datasetColumns.push(this.dataset.meta.columns[e].pvalue)},clearInputColumnDatasetColumn(){var e;(e=this.selectedFunction.inputColumns)==null||e.forEach(t=>t.dsColumn="")}}}),La={class:"p-d-flex p-flex-row"},Oa={class:"kn-material-input-label"},Ra=["innerHTML"],Xa={class:"kn-material-input-label"},ja=["innerHTML"],Qa={key:1,class:"p-m-2"},Pa={class:"kn-material-input-label"},Ya={key:2,class:"p-mx-2 p-mt-3"},Ka={class:"kn-material-input-label"},Ja={class:"p-mx-2 p-mt-3"},Ga={class:"kn-material-input-label"},qa={key:3,class:"p-mx-2 p-mt-3"};function Za(e,t,r,k,v,h){const c=a("AccordionTab"),p=a("Accordion"),u=a("FunctionsCatalogDatasetFormColumnsTable"),d=a("FunctionsCatalogDatasetFormVariablesTable"),s=a("Dropdown"),m=a("FunctionsCatalogDatasetEnvironmentTable"),M=a("Card"),F=a("FunctionsCatalogParametersForm");return l(),f("div",La,[n(M,{id:"form-container",class:"p-m-2"},{content:i(()=>[n(p,{class:"p-m-2",activeIndex:0},{default:i(()=>[n(c,{header:e.$t("common.description")},{default:i(()=>[o("div",null,[o("label",Oa,b(e.$t("common.description")),1),o("p",{innerHTML:e.selectedFunction.description},null,8,Ra)])]),_:1},8,["header"])]),_:1}),e.selectedFunction.benchmarks?(l(),g(p,{key:0,class:"p-m-2"},{default:i(()=>[n(c,{header:e.$t("managers.functionsCatalog.benchmarks")},{default:i(()=>[o("div",null,[o("label",Xa,b(e.$t("managers.functionsCatalog.benchmarks")),1),o("p",{innerHTML:e.selectedFunction.benchmarks},null,8,ja)])]),_:1},8,["header"])]),_:1})):x("",!0),e.selectedFunction.inputColumns.length>0?(l(),f("div",Qa,[o("label",Pa,b(e.$t("managers.functionsCatalog.columnsSettings")),1),n(u,{columns:e.selectedFunction.inputColumns,datasetColumns:e.datasetColumns},null,8,["columns","datasetColumns"])])):x("",!0),e.selectedFunction.inputVariables.length>0?(l(),f("div",Ya,[o("label",Ka,b(e.$t("managers.functionsCatalog.variablesSettings")),1),n(d,{variables:e.selectedFunction.inputVariables},null,8,["variables"])])):x("",!0),o("div",Ja,[o("label",Ga,b(e.$t("common.environment")),1),n(s,{class:"kn-material-input",modelValue:e.selectedEnvironment,"onUpdate:modelValue":t[0]||(t[0]=w=>e.selectedEnvironment=w),options:e.selectedFunction.language=="Python"?e.pythonEnvironments:e.rEnvironments,optionLabel:"label",optionValue:"label",onChange:t[1]||(t[1]=w=>e.$emit("environmentSelected",e.selectedEnvironment))},null,8,["modelValue","options"])]),e.selectedEnvironment?(l(),f("div",qa,[n(m,{libraries:e.libraries},null,8,["libraries"])])):x("",!0)]),_:1}),e.selectedDataset.pars.length>0?(l(),g(F,{key:0,id:"parameters-form",class:"p-m-2",propParameters:e.selectedDataset.pars},null,8,["propParameters"])):x("",!0)])}var Wa=C(Ba,[["render",Za],["__scopeId","data-v-6a253e45"]]);const Ha=y({name:"function-catalog-configurator-tab",components:{FunctionsCatalogDatasetTable:Jo,FunctionsCatalogDatasetForm:Wa},props:{datasets:{type:Array},propFunction:{type:Object}},emits:["selected","loading","selectedEnvironment","selectedDataset"],data(){return{selectedDataset:null,pythonEnvironments:[],rEnvironments:[],libraries:[]}},async created(){await this.loadEnvironments()},methods:{async loadSelectedDataset(e){this.$emit("loading",!0),await this.$http.get(`/knowage/restful-services/2.0/datasets/${e.label}`).then(t=>{t.data&&(this.selectedDataset=t.data[0],this.$emit("selectedDataset",this.selectedDataset))}),this.$emit("loading",!1)},async loadEnvironments(){this.$emit("loading",!0),await this.loadEnvironment("PYTHON_CONFIGURATION").then(e=>this.pythonEnvironments=e.data),await this.loadEnvironment("R_CONFIGURATION").then(e=>this.rEnvironments=e.data),this.$emit("loading",!1)},loadEnvironment(e){return this.$http.get(`/knowage/restful-services/2.0/configs/category/${e}`)},async onEnvironmentSelected(e){this.$emit("selectedEnvironment",e),this.$emit("loading",!0),e&&e.split(".")[0]==="python"&&await this.loadEnvironmentLibraries(`2.0/backendservices/widgets/python/libraries/${e}`).then(t=>this.libraries=JSON.parse(t.data.result)),this.$emit("loading",!1)},async loadEnvironmentLibraries(e){return this.$http.get(`/knowage/restful-services/${e}`)}}}),er={class:"p-d-flex p-flex-row"},tr={class:"p-col-4 p-sm-4 p-md-3 p-m-0 p-p-0"},or={class:"p-col-8 p-sm-8 p-md-9 p-m-2 p-p-0"},ar={key:1,id:"no-dataset-selected-info",class:"p-d-flex p-flex-row p-jc-center"};function rr(e,t,r,k,v,h){const c=a("FunctionsCatalogDatasetTable"),p=a("FunctionsCatalogDatasetForm");return l(),f("div",er,[o("div",tr,[n(c,{datasets:e.datasets,onSelected:e.loadSelectedDataset},null,8,["datasets","onSelected"])]),o("div",or,[e.selectedDataset?(l(),g(p,{key:0,selectedDataset:e.selectedDataset,propFunction:e.propFunction,pythonEnvironments:e.pythonEnvironments,rEnvironments:e.rEnvironments,onEnvironmentSelected:e.onEnvironmentSelected,libraries:e.libraries},null,8,["selectedDataset","propFunction","pythonEnvironments","rEnvironments","onEnvironmentSelected","libraries"])):(l(),f("div",ar,b(e.$t("managers.functionsCatalog.noDatasetSelected")),1))])])}var nr=C(Ha,[["render",rr],["__scopeId","data-v-30893a65"]]);const ir="960px",lr="stack",dr=15;var cr={breakpoint:ir,responsiveLayout:lr,rows:dr};const sr=y({name:"function-catalog-preview-table",components:{Column:V,DataTable:I},props:{previewColumns:{type:Array},previewRows:{type:Array}},data(){return{functionsCatalogPreviewTableDescriptor:cr,columns:[],rows:[],filters:{global:[_]},globalFilterFields:[]}},watch:{previewColumns(){this.loadColumns()},previewRows(){this.loadRows()}},created(){this.loadColumns(),this.loadRows()},methods:{loadColumns(){var e;this.columns=[],(e=this.previewColumns)==null||e.forEach(t=>{this.columns.push(t),this.globalFilterFields.push(t.field),this.filters[t.field]={operator:L.AND,constraints:[_]}})},loadRows(){this.rows=this.previewRows}}}),br={id:"noFunctionsFound"},pr={class:"table-header p-d-flex"},kr={class:"p-input-icon-left p-mr-3 p-col-12"},ur=o("i",{class:"pi pi-search"},null,-1);function mr(e,t,r,k,v,h){const c=a("InputText"),p=a("Column"),u=a("DataTable");return l(),g(u,{id:"preview-datatable",value:e.rows,paginator:!0,rows:e.functionsCatalogPreviewTableDescriptor.rows,class:"p-datatable-sm kn-table",filters:e.filters,"onUpdate:filters":t[1]||(t[1]=d=>e.filters=d),filterDisplay:"menu",globalFilterFields:e.globalFilterFields,responsiveLayout:e.functionsCatalogPreviewTableDescriptor.responsiveLayout,breakpoint:e.functionsCatalogPreviewTableDescriptor.breakpoint},{empty:i(()=>[o("div",br,b(e.$t("common.info.noDataFound")),1)]),header:i(()=>[o("div",pr,[o("span",kr,[ur,n(c,{class:"kn-material-input",modelValue:e.filters.global.value,"onUpdate:modelValue":t[0]||(t[0]=d=>e.filters.global.value=d),type:"text",placeholder:e.$t("common.search"),"data-test":"filterInput"},null,8,["modelValue","placeholder"])])])]),default:i(()=>[(l(!0),f(E,null,$(e.columns,d=>(l(),g(p,{class:"kn-truncated",field:d.field,header:d.header,key:d.field,sortable:!0},{filter:i(({filterModel:s})=>[n(c,{type:"text",modelValue:s.value,"onUpdate:modelValue":m=>s.value=m,class:"p-column-filter"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["field","header"]))),128))]),_:1},8,["value","rows","filters","globalFilterFields","responsiveLayout","breakpoint"])}var gr=C(sr,[["render",mr]]);const vr=y({name:"functions-catalog-preview-warning-dialog",components:{Dialog:B,Message:j},props:{visible:{type:Boolean},warningTitle:{type:String},warningMessage:{type:String}},emits:["close"],data(){return{functionsCatalogPreviewDialogDescriptor:W}},created(){},methods:{}}),hr={class:"p-m-2"};function fr(e,t,r,k,v,h){const c=a("Message"),p=a("Button"),u=a("Dialog");return l(),g(u,{header:e.warningTitle,visible:e.visible,modal:!0,contentStyle:e.functionsCatalogPreviewDialogDescriptor.warningDialog.style,class:"p-fluid kn-dialog--toolbar--primary",closable:!1},{footer:i(()=>[n(p,{class:"kn-button kn-button--primary",onClick:t[0]||(t[0]=d=>e.$emit("close"))},{default:i(()=>[A(b(e.$t("common.close")),1)]),_:1})]),default:i(()=>[o("div",hr,[n(c,{class:"p-m-2",severity:"warn",closable:!1,style:z(e.functionsCatalogPreviewDialogDescriptor.styles.message)},{default:i(()=>[A(b(e.warningMessage),1)]),_:1},8,["style"])])]),_:1},8,["header","visible","contentStyle"])}var wr=C(vr,[["render",fr]]);const xr=y({name:"function-catalog-preview-dialog",components:{Dialog:B,FunctionsCatalogConfiguratorTab:nr,FunctionsCatalogPreviewTable:gr,FunctionsCatalogPreviewWarningDialog:wr,TabView:Q,TabPanel:P},props:{propFunction:{type:Object,required:!0},datasets:{type:Array},pythonConfigurations:{type:Array},visible:{type:Boolean}},data(){return{functionsCatalogPreviewDialogDescriptor:W,environment:null,selectedDataset:null,previewColumns:[],previewRows:[],active:0,warningVisible:!1,warningTitle:null,warningMessage:null,loading:!1}},computed:{previewInvalid(){return!this.checkColumnsConfiguration()||!this.checkVariablesConfiguration()||!this.environment}},created(){},methods:{setLoading(e){this.loading=e},setEnvironment(e){this.environment=e},setDataset(e){this.selectedDataset=e},changeTab(){this.active===0?this.goToPreview():this.active=0},async goToPreview(){let e=!0;this.warningMessage=null,this.checkColumnsConfiguration()?this.checkVariablesConfiguration()?this.environment||(e=this.setWarningMessage(this.$t("managers.functionsCatalog.environmentError"))):e=this.setWarningMessage(this.$t("managers.functionsCatalog.inputVariablesError")):e=this.setWarningMessage(this.$t("managers.functionsCatalog.datasetColumnsError")),await this.openPreview(e)},async openPreview(e){e?(await this.createPreview(),this.active=1):(this.warningTitle=this.$t("managers.functionsCatalog.warningTitle"),this.warningVisible=!0)},setWarningMessage(e){return this.warningMessage=e,!1},checkColumnsConfiguration(){for(let e=0;e<this.propFunction.inputColumns.length;e++)if(!this.propFunction.inputColumns[e].dsColumn)return!1;return!0},checkVariablesConfiguration(){for(let e=0;e<this.propFunction.inputVariables.length;e++)if(!this.propFunction.inputVariables[e].value)return!1;return!0},async createPreview(){var t;this.loading=!0;const e={aggregations:this.buildPreviewAggregations(),parameters:this.buildPreviewParameters(),selections:{},indexes:[]};await this.$http.post(`/knowage/restful-services/2.0/datasets/${(t=this.selectedDataset)==null?void 0:t.label}/data`,e,{headers:{"X-Disable-Errors":"true"}}).then(r=>{this.setPreviewColumns(r.data),this.previewRows=r.data.rows}).catch(r=>{this.warningVisible=!0,this.warningTitle=this.$t("managers.functionsCatalog.dataServiceErrorTitle"),this.warningMessage=r.message==="100"?this.$t("managers.functionsCatalog.dataServiceErrorMessage"):r.message}),this.loading=!1},setPreviewColumns(e){this.previewColumns=[];for(let t=1;t<e.metaData.fields.length;t++)this.previewColumns.push({header:e.metaData.fields[t].header,field:e.metaData.fields[t].name})},buildPreviewAggregations(){var r;const e=[],t=[];return this.formatDatasetMetaColumns(e,t),this.formatFunctionConfig(e,t),{measures:e,categories:t,dataset:(r=this.selectedDataset)==null?void 0:r.label}},formatDatasetMetaColumns(e,t){var v;const r=this.getFormattedColumnsMap((v=this.selectedDataset)==null?void 0:v.meta.columns),k=Object.keys(r);for(let h=0;h<k.length;h++){const c=k[h],p=r[k[h]],u={id:c,alias:p.fieldAlias,columnName:c,funct:"NONE"};this.addObjectToMeasuresOrCategories(p.fieldType,u,e,t,c)}},getFormattedColumnsMap(e){const t={};for(let r=0;r<e.length;r++)t[e[r].column]||(t[e[r].column]={}),t[e[r].column][e[r].pname]=e[r].pvalue;return t},formatFunctionConfig(e,t){const r={inputColumns:this.propFunction.inputColumns,inputVariables:this.propFunction.inputVariables,outputColumns:this.propFunction.outputColumns,environment:this.environment};for(let k=0;k<this.propFunction.outputColumns.length;k++){const v=this.propFunction.outputColumns[k].name,h={id:v,alias:v,catalogFunctionId:this.propFunction.id,catalogFunctionConfig:r,columnName:v,funct:"NONE"};this.addObjectToMeasuresOrCategories(this.propFunction.outputColumns[k].fieldType,h,e,t,v)}},addObjectToMeasuresOrCategories(e,t,r,k,v){e==="MEASURE"?(t.orderColumn=v,r.push(t)):(t.orderType="",k.push(t))},buildPreviewParameters(){const e={};if(this.selectedDataset)for(let t=0;t<this.selectedDataset.pars.length;t++)e[this.selectedDataset.pars[t].name]=this.selectedDataset.pars[t].value;return e},closeDialog(){this.active=0,this.selectedDataset=null,this.previewColumns=[],this.previewRows=[],this.environment=null,this.$emit("close")}}});function yr(e,t,r,k,v,h){const c=a("Toolbar"),p=a("ProgressBar"),u=a("FunctionsCatalogConfiguratorTab"),d=a("TabPanel"),s=a("FunctionsCatalogPreviewTable"),m=a("TabView"),M=a("FunctionsCatalogPreviewWarningDialog"),F=a("Button"),w=a("Dialog");return l(),g(w,{class:"p-fluid kn-dialog--toolbar--primary",contentStyle:e.functionsCatalogPreviewDialogDescriptor.dialog.style,visible:e.visible,modal:!0,closable:!1},{header:i(()=>[n(c,{class:"kn-toolbar kn-toolbar--primary p-p-0 p-m-0 p-col-12"},{start:i(()=>[A(b(e.$t("managers.functionsCatalog.previewTitle")),1)]),_:1})]),footer:i(()=>[n(F,{class:"kn-button kn-button--primary",onClick:e.closeDialog},{default:i(()=>[A(b(e.$t("common.cancel")),1)]),_:1},8,["onClick"]),n(F,{class:"kn-button kn-button--primary",icon:e.active===0?"pi pi-chevron-right":"pi pi-chevron-left",iconPos:e.active===0?"right":"left",label:e.active===0?e.$t("common.next"):e.$t("common.back"),onClick:e.changeTab},null,8,["icon","iconPos","label","onClick"])]),default:i(()=>[e.loading?(l(),g(p,{key:0,mode:"indeterminate",class:"kn-progress-bar"})):x("",!0),n(m,{activeIndex:e.active,"onUpdate:activeIndex":t[0]||(t[0]=S=>e.active=S)},{default:i(()=>[n(d,null,{header:i(()=>[o("span",null,b(e.$t("managers.functionsCatalog.configurator")),1)]),default:i(()=>[n(u,{datasets:e.datasets,propFunction:e.propFunction,onLoading:e.setLoading,onSelectedEnvironment:e.setEnvironment,onSelectedDataset:e.setDataset},null,8,["datasets","propFunction","onLoading","onSelectedEnvironment","onSelectedDataset"])]),_:1}),n(d,{disabled:e.previewInvalid},{header:i(()=>[o("span",null,b(e.$t("common.preview")),1)]),default:i(()=>[n(s,{previewColumns:e.previewColumns,previewRows:e.previewRows},null,8,["previewColumns","previewRows"])]),_:1},8,["disabled"])]),_:1},8,["activeIndex"]),n(M,{visible:e.warningVisible,warningTitle:e.warningTitle,warningMessage:e.warningMessage,onClose:t[1]||(t[1]=S=>e.warningVisible=!1)},null,8,["visible","warningTitle","warningMessage"])]),_:1},8,["contentStyle","visible"])}var Cr=C(xr,[["render",yr]]);const Mr=y({name:"functions-catalog",components:{FunctionsCatalogDatatable:xe,FunctionsCatalogDetail:xo,FunctionsCatalogFilterCards:_o,FunctionsCatalogPreviewDialog:Cr,KnFabButton:re},data(){return{user:null,functions:[],selectedFunction:null,filters:[],selectedFilter:null,datasets:[],detailDialogVisible:!1,previewDialogVisible:!1,loading:!1}},setup(){return{store:Y()}},async created(){this.loadUser(),await this.loadPage()},methods:{async loadUser(){this.user=this.store.$state.user},async loadPage(){this.loading=!0,await this.loadFunctions(""),await this.loadFilters(),this.loading=!1},async loadFunctions(e){const t=e?"/knowage/restful-services/2.0/functions-catalog/"+e:"/knowage-api/api/1.0/functioncatalog/completelist";await this.$http.get(t).then(r=>{this.functions=e?r.data.functions.map(k=>(k.tags=[...k.keywords],k.offlineScriptTrain={...k.offlineScriptTrainModel},k.offlineScriptUse={...k.offlineScriptUseModel},k.benchmark={...k.benchmarks},["keywords","offlineScriptTrainModel","offlineScriptUseModel","benchmarks"].forEach(h=>delete k[h]),k)):r.data})},async loadFilters(){await this.$http.get("/knowage/restful-services/2.0/domains/listByCode/FUNCTION_TYPE").then(e=>this.filters=e.data)},showForm(e){this.selectedFunction=e,this.detailDialogVisible=!0},async deleteFunction(e){this.loading=!0;let t=!1;await this.$http.delete(`/knowage-api/api/1.0/functioncatalog/${e}`).then(()=>{t=!0,this.store.setInfo({title:this.$t("common.toast.deleteTitle"),msg:this.$t("common.toast.deleteSuccess")})}).catch(()=>{this.store.setError({title:this.$t("common.toast.errorTitle"),msg:this.$t("managers.functionsCatalog.deleteError")})}).finally(()=>this.loading=!1),t&&await this.loadPage()},async onSelectedFilter(e){var r;if(((r=this.selectedFilter)==null?void 0:r.valueCd)===e.valueCd)return;this.selectedFilter=e;const t=this.selectedFilter.valueCd!=="All"?this.selectedFilter.valueCd:"";this.loading=!0,await this.loadFunctions(t),this.loading=!1},onDetailClose(){this.detailDialogVisible=!1,this.selectedFunction=null},async onCreated(){this.detailDialogVisible=!1,await this.loadPage()},async onPreview(e){this.selectedFunction=e,await this.loadPreviewData(),this.previewDialogVisible=!0},onPreviewClose(){this.previewDialogVisible=!1,this.selectedFunction=null},async loadPreviewData(){this.loading=!0,await this.loadDatasets(),this.loading=!1},async loadDatasets(){await this.$http.get("/knowage/restful-services/3.0/datasets/").then(e=>this.datasets=e.data.root)}}}),Ar={class:"kn-page"},Er={class:"p-d-flex p-flex-column kn-flex functions-main-content"};function zr(e,t,r,k,v,h){const c=a("KnFabButton"),p=a("Toolbar"),u=a("ProgressBar"),d=a("FunctionsCatalogFilterCards"),s=a("FunctionsCatalogDatatable"),m=a("FunctionsCatalogDetail"),M=a("FunctionsCatalogPreviewDialog");return l(),f("div",Ar,[n(p,{class:"kn-toolbar kn-toolbar--primary"},{start:i(()=>[A(b(e.$t("managers.functionsCatalog.title")),1)]),end:i(()=>[n(c,{icon:"fas fa-plus",onClick:t[0]||(t[0]=F=>e.showForm(null))})]),_:1}),o("div",Er,[e.loading?(l(),g(u,{key:0,mode:"indeterminate",class:"kn-progress-bar","data-test":"progress-bar"})):x("",!0),n(d,{class:"p-m-3",propFilters:e.filters,onSelected:e.onSelectedFilter},null,8,["propFilters","onSelected"]),n(s,{class:"p-m-3",user:e.user,propLoading:e.loading,items:e.functions,onSelected:e.showForm,onPreview:e.onPreview,onDeleted:e.deleteFunction},null,8,["user","propLoading","items","onSelected","onPreview","onDeleted"])]),o("div",null,[N(n(m,{visible:e.detailDialogVisible,propFunction:e.selectedFunction,functionTypes:e.filters,onClose:e.onDetailClose,onCreated:e.onCreated},null,8,["visible","propFunction","functionTypes","onClose","onCreated"]),[[ne,e.detailDialogVisible]]),n(M,{visible:e.previewDialogVisible,propFunction:e.selectedFunction,datasets:e.datasets,onClose:e.onPreviewClose},null,8,["visible","propFunction","datasets","onClose"])])])}var Ur=C(Mr,[["render",zr],["__scopeId","data-v-63c82e0c"]]);export{Ur as default};
//# sourceMappingURL=FunctionsCatalog-dc928d74.js.map
