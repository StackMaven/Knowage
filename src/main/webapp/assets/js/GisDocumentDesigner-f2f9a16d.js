import{d as I,n as x,l as P,i as j,a7 as F,_ as E,r,y as _,o as l,c as u,f as n,w as o,g as d,t as i,h,B as C,C as S,z as B,D as $,a as s,A as v,a5 as N,G as U,v as O,u as G,aK as K,k as X,s as Q}from"./index-1e676509.js";import{f as z}from"./filterHelper-a723991a.js";import{s as Y}from"./checkbox.esm-fa6c8259.js";const Z={allLayers:[],analitycalFilter:[],dataSetId:null,datasetJoinColumns:[],datasetLabel:"",datasetMeasures:[],documentDesc:"",documentLabel:"",dsJoins:[],filters:[],indicators:[],layerJoinColumns:[],selectedDataset:[],selectedDriver:[],selectedLayer:[],visibilityData:{crossNavigation:!1,crossNavigationMultiselect:!0,visibilityControls:{showBaseLayer:!0,showDistanceCalculator:!0,showDownloadButton:!0,showLayer:!0,showLegendButton:!0,showMapConfig:!0,showRightConfigMenu:!0,showSelectMode:!0}}},H={absoluteScroll:{height:"100%",left:0,"overflow-x":"hidden","overflow-y":"auto",position:"absolute",top:0,width:"100%"},dialogSize:{width:"80%"},trashColumn:{"text-align":"end",width:"15%"}};var A={newGisTemplate:Z,style:H};const W=[{field:"label",header:"common.id"},{field:"name",header:"common.name"},{field:"descr",header:"common.description"},{field:"dsTypeCd",header:"common.type"}],ee=["name"],te=[{field:"label",header:"workspace.gis.dnl.driverParameter"},{field:"url",header:"managers.layersManagement.layerURL"}],ae=[{field:"layerId",header:"common.id"},{field:"layerName",header:"common.name"},{field:"descr",header:"common.description"},{field:"type",header:"common.type"}],oe=["layerName"];var T={datasetColumns:W,datasetFilterFields:ee,driverColumns:te,layerColumns:ae,layerFilterFields:oe};const ne=I({components:{DataTable:x,Column:P,Dialog:j},emits:["datasetDeleted","datasetChanged"],props:{documentDataProp:{type:Object,required:!1},isDatasetChosen:Object},computed:{},data(){return{descriptor:T,styleDescriptor:A,columns:T.datasetColumns,globalFilterFields:T.datasetFilterFields,filters:{global:[z]},loading:!1,datasetDialogVisible:!1,availableDatasets:[],selectedDataset:{},documentData:{}}},created(){this.documentData=this.documentDataProp},methods:{showDatasetDialog(){this.$confirm.require({header:this.$t("common.toast.warning"),message:this.$t("workspace.gis.dnl.changeDsMessage"),icon:"pi pi-exclamation-triangle",accept:()=>{this.openDatasetDialog()}})},openDatasetDialog(){this.selectedDataset=F(this.documentData.selectedDataset[0]),this.datasetDialogVisible=!0,this.getAllDatasets()},async getAllDatasets(){this.loading=!0,await this.$http.get("/knowage/restful-services/1.0/datasets/mydatanoparams").then(e=>this.availableDatasets=e.data.root),this.loading=!1},closeDialog(){this.filters.global.value=null,this.datasetDialogVisible=!1},deleteSelectedDataset(){this.documentData.selectedDataset=[],this.documentData.datasetLabel="",this.$emit("datasetDeleted")},saveDatasetSelection(){this.documentData.selectedDataset[0]=F(this.selectedDataset),this.$emit("datasetChanged",this.selectedDataset),this.datasetDialogVisible=!1}}}),le={class:"kn-truncated"},ie={class:"table-header p-d-flex p-ai-center"},re={id:"search-container",class:"p-input-icon-left p-mr-3"},se=s("i",{class:"pi pi-search"},null,-1),de={class:"kn-truncated"},ce={class:"p-d-flex p-flex-row p-jc-end"};function pe(e,t,D,L,V,J){const c=r("Button"),k=r("Toolbar"),f=r("Column"),p=r("DataTable"),y=r("Card"),w=r("InputText"),g=r("Dialog"),b=_("tooltip");return l(),u(C,null,[n(y,{class:"p-mb-3"},{header:o(()=>[n(k,{class:"kn-toolbar kn-toolbar--secondary p-p-0 p-m-0 p-col-12"},{start:o(()=>[d(i(e.$t("common.dataset")),1)]),end:o(()=>[e.documentData.selectedDataset.length===0?(l(),h(c,{key:0,class:"p-button-link",label:e.$t("workspace.gis.dnl.addDataset"),onClick:e.showDatasetDialog},null,8,["label","onClick"])):(l(),h(c,{key:1,class:"p-button-link",label:e.$t("workspace.gis.dnl.changeDataset"),onClick:e.showDatasetDialog},null,8,["label","onClick"]))]),_:1})]),content:o(()=>[n(p,{class:"p-datatable-sm kn-table georef-step1-table",value:e.documentData.selectedDataset,dataKey:"id",responsiveLayout:"scroll",breakpoint:"600px"},{empty:o(()=>[d(i(e.$t("workspace.gis.dnl.emptyInfo")),1)]),default:o(()=>[(l(!0),u(C,null,S(e.columns,a=>(l(),h(f,{field:a.field,header:e.$t(a.header),key:a.field},{body:o(({data:m})=>[B((l(),u("span",le,[d(i(m[a.field]),1)])),[[b,m[a.field],void 0,{top:!0}]])]),_:2},1032,["field","header"]))),128)),n(f,{style:$(e.styleDescriptor.style.trashColumn),onRowClick:a=>!1},{body:o(()=>[n(c,{icon:"pi pi-trash",class:"p-button-link",onClick:e.deleteSelectedDataset},null,8,["onClick"])]),_:1},8,["style"])]),_:1},8,["value"])]),_:1}),e.datasetDialogVisible?(l(),h(g,{key:0,class:"p-fluid kn-dialog--toolbar--primary",style:$(e.styleDescriptor.style.dialogSize),visible:e.datasetDialogVisible,modal:!0,closable:!1},{header:o(()=>[n(k,{class:"kn-toolbar kn-toolbar--primary p-p-0 p-m-0 p-col-12"},{start:o(()=>[d(i(e.$t("workspace.gis.dnl.datasetList")),1)]),_:1})]),footer:o(()=>[s("div",ce,[n(c,{class:"kn-button kn-button--secondary",onClick:e.closeDialog},{default:o(()=>[d(i(e.$t("common.cancel")),1)]),_:1},8,["onClick"]),n(c,{class:"kn-button kn-button--primary",onClick:e.saveDatasetSelection},{default:o(()=>[d(i(e.$t("common.save")),1)]),_:1},8,["onClick"])])]),default:o(()=>[n(p,{class:"p-datatable-sm kn-table kn-width-full",value:e.availableDatasets,dataKey:"id",selection:e.selectedDataset,"onUpdate:selection":t[1]||(t[1]=a=>e.selectedDataset=a),selectionMode:"single",scrollable:!0,scrollHeight:"40vh",filters:e.filters,"onUpdate:filters":t[2]||(t[2]=a=>e.filters=a),globalFilterFields:e.globalFilterFields,loading:e.loading,responsiveLayout:"scroll"},{header:o(()=>[s("div",ie,[s("span",re,[se,n(w,{class:"kn-material-input",modelValue:e.filters.global.value,"onUpdate:modelValue":t[0]||(t[0]=a=>e.filters.global.value=a),placeholder:e.$t("common.search")},null,8,["modelValue","placeholder"])])])]),empty:o(()=>[d(i(e.$t("workspace.gis.dnl.dialogEmptyInfo")),1)]),default:o(()=>[(l(!0),u(C,null,S(e.columns,a=>(l(),h(f,{field:a.field,header:e.$t(a.header),key:a.field},{body:o(({data:m})=>[B((l(),u("span",de,[d(i(m[a.field]),1)])),[[b,m[a.field],void 0,{top:!0}]])]),_:2},1032,["field","header"]))),128))]),_:1},8,["value","selection","filters","globalFilterFields","loading"])]),_:1},8,["style","visible"])):v("",!0)],64)}var ue=E(ne,[["render",pe]]);const be=I({components:{DataTable:x,Column:P,Dialog:j},emits:["layerChanged"],props:{documentDataProp:{type:Object,required:!1},isDatasetChosen:Boolean},computed:{},data(){return{descriptor:T,styleDescriptor:A,columns:T.layerColumns,globalFilterFields:T.layerFilterFields,mainFilters:{global:[z]},singleFilters:{global:[z]},multipleFilters:{global:[z]},layerDialogVisible:!1,selectedLayer:{},selectedLayersList:[],documentData:{}}},created(){this.documentData=this.documentDataProp},methods:{showLayerDialogConfirm(){this.isDatasetChosen&&this.documentData.dsJoins.length>0?this.$confirm.require({header:this.$t("common.toast.warning"),message:this.$t("workspace.gis.dnl.changeLayerMessage"),icon:"pi pi-exclamation-triangle",accept:()=>{this.showLayerDialog()}}):this.showLayerDialog()},showLayerDialog(){this.isDatasetChosen?this.selectedLayer=F(this.documentData.selectedLayer[0]):this.selectedLayer=F(this.documentData.selectedLayer),this.layerDialogVisible=!0},closeDialog(){this.selectedLayer={},this.selectedLayersList=[],this.layerDialogVisible=!1},saveLayerSelection(){this.isDatasetChosen?this.documentData.selectedLayer=F([this.selectedLayer]):this.documentData.selectedLayer=F(this.selectedLayersList),this.documentData.dsJoins=[],this.$emit("layerChanged",this.isDatasetChosen?[this.selectedLayer]:this.selectedLayersList),this.layerDialogVisible=!1},deleteSelectedLayer(e){this.documentData.selectedLayer.splice(e.index,1)}}}),me={key:0,id:"search-container",class:"p-input-icon-left p-mr-3"},ke=s("i",{class:"pi pi-search"},null,-1),he={class:"kn-truncated"},ge={id:"search-container",class:"p-input-icon-left p-mr-3"},fe=s("i",{class:"pi pi-search"},null,-1),ve={class:"kn-truncated"},ye={id:"search-container",class:"p-input-icon-left p-mr-3"},De=s("i",{class:"pi pi-search"},null,-1),we={class:"kn-truncated"},Ce={class:"p-d-flex p-flex-row p-jc-end"};function $e(e,t,D,L,V,J){const c=r("Button"),k=r("Toolbar"),f=r("InputText"),p=r("Column"),y=r("DataTable"),w=r("Card"),g=r("Dialog"),b=_("tooltip");return l(),u(C,null,[n(w,null,{header:o(()=>[n(k,{class:"kn-toolbar kn-toolbar--secondary p-p-0 p-m-0 p-col-12"},{start:o(()=>[d(i(e.$t("managers.layersManagement.layerTitle")),1)]),end:o(()=>[e.documentData.selectedLayer.length===0?(l(),h(c,{key:0,class:"p-button-link",label:e.$t("workspace.gis.dnl.addLayer"),onClick:e.showLayerDialogConfirm},null,8,["label","onClick"])):(l(),h(c,{key:1,class:"p-button-link",label:e.$t("workspace.gis.dnl.changeLayer"),onClick:e.showLayerDialogConfirm},null,8,["label","onClick"]))]),_:1})]),content:o(()=>[n(y,{class:"georef-step1-table p-datatable-sm kn-table",value:e.documentData.selectedLayer,dataKey:"layerId",responsiveLayout:"scroll",breakpoint:"600px",filters:e.mainFilters,"onUpdate:filters":t[1]||(t[1]=a=>e.mainFilters=a),globalFilterFields:e.globalFilterFields},{empty:o(()=>[d(i(e.$t("workspace.gis.dnl.layersTableEmpty")),1)]),header:o(()=>[e.isDatasetChosen?v("",!0):(l(),u("span",me,[ke,n(f,{class:"kn-material-input",modelValue:e.mainFilters.global.value,"onUpdate:modelValue":t[0]||(t[0]=a=>e.mainFilters.global.value=a),placeholder:e.$t("common.search")},null,8,["modelValue","placeholder"])]))]),default:o(()=>[(l(!0),u(C,null,S(e.columns,a=>(l(),h(p,{field:a.field,header:e.$t(a.header),key:a.field,sortable:!0},{body:o(({data:m})=>[B((l(),u("span",he,[d(i(m[a.field]),1)])),[[b,m[a.field],void 0,{top:!0}]])]),_:2},1032,["field","header"]))),128)),e.isDatasetChosen?v("",!0):(l(),h(p,{key:0,style:$(e.styleDescriptor.style.trashColumn),onRowClick:a=>!1},{body:o(a=>[n(c,{icon:"pi pi-trash",class:"p-button-link",onClick:m=>e.deleteSelectedLayer(a)},null,8,["onClick"])]),_:1},8,["style"]))]),_:1},8,["value","filters","globalFilterFields"])]),_:1}),e.layerDialogVisible?(l(),h(g,{key:0,class:"p-fluid kn-dialog--toolbar--primary",style:$(e.styleDescriptor.style.dialogSize),visible:e.layerDialogVisible,modal:!0,closable:!1},{header:o(()=>[n(k,{class:"kn-toolbar kn-toolbar--primary p-p-0 p-m-0 p-col-12"},{start:o(()=>[d(i(e.$t("workspace.gis.dnl.layerList")),1)]),_:1})]),footer:o(()=>[s("div",Ce,[n(c,{class:"kn-button kn-button--secondary",onClick:e.closeDialog},{default:o(()=>[d(i(e.$t("common.cancel")),1)]),_:1},8,["onClick"]),n(c,{class:"kn-button kn-button--primary",onClick:e.saveLayerSelection},{default:o(()=>[d(i(e.$t("common.save")),1)]),_:1},8,["onClick"])])]),default:o(()=>[e.isDatasetChosen?(l(),h(y,{key:0,class:"p-datatable-sm kn-table",value:e.documentData.allLayers,selection:e.selectedLayer,"onUpdate:selection":t[3]||(t[3]=a=>e.selectedLayer=a),dataKey:"layerId",responsiveLayout:"scroll",filters:e.singleFilters,"onUpdate:filters":t[4]||(t[4]=a=>e.singleFilters=a),globalFilterFields:e.globalFilterFields,selectionMode:"single"},{empty:o(()=>[d(i(e.$t("workspace.gis.dnl.layersDialogEmpty")),1)]),header:o(()=>[s("span",ge,[fe,n(f,{class:"kn-material-input",modelValue:e.singleFilters.global.value,"onUpdate:modelValue":t[2]||(t[2]=a=>e.singleFilters.global.value=a),placeholder:e.$t("common.search")},null,8,["modelValue","placeholder"])])]),default:o(()=>[(l(!0),u(C,null,S(e.columns,a=>(l(),h(p,{field:a.field,header:e.$t(a.header),key:a.field},{body:o(({data:m})=>[B((l(),u("span",ve,[d(i(m[a.field]),1)])),[[b,m[a.field],void 0,{top:!0}]])]),_:2},1032,["field","header"]))),128))]),_:1},8,["value","selection","filters","globalFilterFields"])):(l(),h(y,{key:1,class:"p-datatable-sm kn-table",value:e.documentData.allLayers,selection:e.selectedLayersList,"onUpdate:selection":t[6]||(t[6]=a=>e.selectedLayersList=a),dataKey:"layerId",responsiveLayout:"scroll",filters:e.multipleFilters,"onUpdate:filters":t[7]||(t[7]=a=>e.multipleFilters=a),globalFilterFields:e.globalFilterFields},{empty:o(()=>[d(i(e.$t("workspace.gis.dnl.layersDialogEmpty")),1)]),header:o(()=>[s("span",ye,[De,n(f,{class:"kn-material-input",modelValue:e.multipleFilters.global.value,"onUpdate:modelValue":t[5]||(t[5]=a=>e.multipleFilters.global.value=a),placeholder:e.$t("common.search")},null,8,["modelValue","placeholder"])])]),default:o(()=>[n(p,{selectionMode:"multiple"}),(l(!0),u(C,null,S(e.columns,a=>(l(),h(p,{field:a.field,header:e.$t(a.header),key:a.field},{body:o(({data:m})=>[B((l(),u("span",we,[d(i(m[a.field]),1)])),[[b,m[a.field],void 0,{top:!0}]])]),_:2},1032,["field","header"]))),128))]),_:1},8,["value","selection","filters","globalFilterFields"]))]),_:1},8,["style","visible"])):v("",!0)],64)}var Le=E(be,[["render",$e]]);const Me=I({components:{DataTable:x,Column:P,Dialog:j},emits:["driverChanged"],props:{documentDataProp:{type:Object,required:!1},isDatasetChosen:Boolean},computed:{},data(){return{descriptor:T,styleDescriptor:A,columns:T.driverColumns,globalFilterFields:T.layerFilterFields,mainFilters:{global:[z]},singleFilters:{global:[z]},multipleFilters:{global:[z]},driverDialogVisible:!1,selectedDriver:{},selectedDriversList:[],documentData:{}}},created(){this.documentData=this.documentDataProp,this.selectedDriversList=F(this.documentDataProp.selectedDriver)},methods:{closeDialog(){this.selectedDriver={},this.selectedDriversList=F(this.documentDataProp.selectedDriver),this.driverDialogVisible=!1},saveLayerSelection(){this.$emit("driverChanged",this.selectedDriversList),this.driverDialogVisible=!1},deleteselectedDriver(e){this.documentData.selectedDriver.splice(e.index,1)}}}),Ve={id:"search-container",class:"p-input-icon-left p-mr-3"},Fe=s("i",{class:"pi pi-search"},null,-1),Te={class:"kn-truncated"},Ae={id:"search-container",class:"p-input-icon-left p-mr-3"},Ie=s("i",{class:"pi pi-search"},null,-1),Ee={class:"kn-truncated"},Je={class:"p-d-flex p-flex-row p-jc-end"};function Se(e,t,D,L,V,J){const c=r("Button"),k=r("Toolbar"),f=r("InputText"),p=r("Column"),y=r("DataTable"),w=r("Card"),g=r("Dialog"),b=_("tooltip");return l(),u(C,null,[n(w,{class:"p-mt-3"},{header:o(()=>[n(k,{class:"kn-toolbar kn-toolbar--secondary p-p-0 p-m-0 p-col-12"},{start:o(()=>[d(i(e.$t("workspace.gis.dnl.layerFilters")),1)]),end:o(()=>[n(c,{class:"p-button-link",label:e.$t("workspace.gis.dnl.addFilters"),onClick:t[0]||(t[0]=a=>e.driverDialogVisible=!0)},null,8,["label"])]),_:1})]),content:o(()=>[n(y,{class:"georef-step1-table p-datatable-sm kn-table",value:e.documentData.selectedDriver,dataKey:"id",responsiveLayout:"scroll",breakpoint:"600px",filters:e.mainFilters,"onUpdate:filters":t[2]||(t[2]=a=>e.mainFilters=a),globalFilterFields:e.globalFilterFields},{empty:o(()=>[d(i(e.$t("workspace.gis.dnl.driversTableEmpty")),1)]),header:o(()=>[s("span",Ve,[Fe,n(f,{class:"kn-material-input",modelValue:e.mainFilters.global.value,"onUpdate:modelValue":t[1]||(t[1]=a=>e.mainFilters.global.value=a),placeholder:e.$t("common.search")},null,8,["modelValue","placeholder"])])]),default:o(()=>[(l(!0),u(C,null,S(e.columns,a=>(l(),h(p,{field:a.field,header:e.$t(a.header),key:a.field,sortable:!0},{body:o(({data:m})=>[B((l(),u("span",Te,[d(i(m[a.field]),1)])),[[b,m[a.field],void 0,{top:!0}]])]),_:2},1032,["field","header"]))),128)),e.isDatasetChosen?v("",!0):(l(),h(p,{key:0,style:$(e.styleDescriptor.style.trashColumn),onRowClick:a=>!1},{body:o(a=>[n(c,{icon:"pi pi-trash",class:"p-button-link",onClick:m=>e.deleteselectedDriver(a)},null,8,["onClick"])]),_:1},8,["style"]))]),_:1},8,["value","filters","globalFilterFields"])]),_:1}),e.driverDialogVisible?(l(),h(g,{key:0,class:"p-fluid kn-dialog--toolbar--primary",style:$(e.styleDescriptor.style.dialogSize),visible:e.driverDialogVisible,modal:!0,closable:!1},{header:o(()=>[n(k,{class:"kn-toolbar kn-toolbar--primary p-p-0 p-m-0 p-col-12"},{start:o(()=>[d(i(e.$t("workspace.gis.dnl.layerList")),1)]),_:1})]),footer:o(()=>[s("div",Je,[n(c,{class:"kn-button kn-button--secondary",onClick:e.closeDialog},{default:o(()=>[d(i(e.$t("common.cancel")),1)]),_:1},8,["onClick"]),n(c,{class:"kn-button kn-button--primary",onClick:e.saveLayerSelection},{default:o(()=>[d(i(e.$t("common.save")),1)]),_:1},8,["onClick"])])]),default:o(()=>[n(y,{class:"p-datatable-sm kn-table",value:e.documentData.allDrivers,selection:e.selectedDriversList,"onUpdate:selection":t[4]||(t[4]=a=>e.selectedDriversList=a),dataKey:"id",responsiveLayout:"scroll",filters:e.multipleFilters,"onUpdate:filters":t[5]||(t[5]=a=>e.multipleFilters=a),globalFilterFields:e.globalFilterFields},{empty:o(()=>[d(i(e.$t("workspace.gis.dnl.layersDialogEmpty")),1)]),header:o(()=>[s("span",Ae,[Ie,n(f,{class:"kn-material-input",modelValue:e.multipleFilters.global.value,"onUpdate:modelValue":t[3]||(t[3]=a=>e.multipleFilters.global.value=a),placeholder:e.$t("common.search")},null,8,["modelValue","placeholder"])])]),default:o(()=>[n(p,{selectionMode:"multiple"}),(l(!0),u(C,null,S(e.columns,a=>(l(),h(p,{field:a.field,header:e.$t(a.header),key:a.field},{body:o(({data:m})=>[B((l(),u("span",Ee,[d(i(m[a.field]),1)])),[[b,m[a.field],void 0,{top:!0}]])]),_:2},1032,["field","header"]))),128))]),_:1},8,["value","selection","filters","globalFilterFields"])]),_:1},8,["style","visible"])):v("",!0)],64)}var Be=E(Me,[["render",Se]]);const ze=I({components:{DatasetCard:ue,LayersCard:Le,LayerFilters:Be},emits:[],props:{documentDataProp:{type:Object,required:!0},allLayers:Array,isDatasetChosen:Boolean},computed:{},data(){return{}},created(){},methods:{}});function Ue(e,t,D,L,V,J){const c=r("DatasetCard"),k=r("LayersCard"),f=r("LayerFilters");return l(),u(C,null,[e.$route.path.includes("new")?(l(),h(c,{key:0,documentDataProp:e.documentDataProp,isDatasetChosen:e.isDatasetChosen,onDatasetChanged:t[0]||(t[0]=p=>e.$emit("datasetChanged",p)),onDatasetDeleted:t[1]||(t[1]=p=>e.$emit("datasetDeleted"))},null,8,["documentDataProp","isDatasetChosen"])):v("",!0),n(k,{documentDataProp:e.documentDataProp,isDatasetChosen:e.isDatasetChosen,onLayerChanged:t[2]||(t[2]=p=>e.$emit("layerChanged",p))},null,8,["documentDataProp","isDatasetChosen"]),e.documentDataProp.allDrivers&&e.documentDataProp.allDrivers.length>0&&!e.isDatasetChosen?(l(),h(f,{key:1,documentDataProp:e.documentDataProp,onDriverChanged:t[3]||(t[3]=p=>e.$emit("driverChanged",p))},null,8,["documentDataProp"])):v("",!0)],64)}var xe=E(ze,[["render",Ue]]);const Pe=I({components:{DataTable:x,Column:P,Dropdown:N},emits:["joinsValidationChanged"],props:{documentDataProp:{type:Object,required:!1}},computed:{joinsInvalid(){return!!(this.documentDataProp.dsJoins.length==0&&this.documentDataProp.datasetLabel!=""||this.joinsContainEmptyFields)},joinsContainEmptyFields(){let e=!1;return this.documentDataProp.dsJoins.forEach(t=>{!t.datasetColumn||!t.layerColumn?e=!0:e=!1}),e}},data(){return{styleDescriptor:A,documentData:{}}},created(){this.documentData=this.documentDataProp,this.$emit("joinsValidationChanged","joinsInvalid",this.joinsInvalid)},watch:{documentDataProp(){this.documentData=this.documentDataProp},joinsInvalid(){this.$emit("joinsValidationChanged","joinsInvalid",this.joinsInvalid)}},methods:{addJoinRow(){this.documentData.dsJoins.push({datasetColumn:null,layerColumn:null})},deleteJoinRow(e){this.documentData.dsJoins.splice(e.index,1)}}}),je={id:"informations-content",class:"kn-flex kn-relative kn-height-full"},_e={key:0,for:"dsJoinCol",class:"p-error"},Ne={key:0,for:"dsJoinCol",class:"p-error"};function Re(e,t,D,L,V,J){const c=r("Button"),k=r("Toolbar"),f=r("Dropdown"),p=r("Column"),y=r("DataTable"),w=r("Card");return l(),u(C,null,[n(k,{class:"kn-toolbar kn-toolbar--secondary p-p-0 p-m-0 p-col-12"},{start:o(()=>[d(i(e.$t("workspace.gis.datasetJoinTitle")),1)]),end:o(()=>[n(c,{class:"p-button-link",label:e.$t("workspace.gis.dsj.addButton"),onClick:e.addJoinRow},null,8,["label","onClick"])]),_:1}),s("div",je,[s("div",{style:$(e.styleDescriptor.style.absoluteScroll)},[n(w,null,{content:o(()=>[n(y,{class:"p-datatable-sm kn-table georef-step1-table",value:e.documentDataProp.dsJoins,dataKey:"id",responsiveLayout:"scroll",breakpoint:"600px"},{empty:o(()=>[d(i(e.$t("workspace.gis.dnl.emptyInfo")),1)]),default:o(()=>[n(p,{field:"datasetColumn",header:e.$t("workspace.gis.dsj.dsJoinCol"),sortable:!0},{body:o(g=>[n(f,{id:"dsJoinCol",class:U(["kn-material-input kn-width-full",{"p-invalid":g.data.datasetColumn==null}]),modelValue:g.data.datasetColumn,"onUpdate:modelValue":b=>g.data.datasetColumn=b,options:e.documentDataProp.datasetJoinColumns,optionLabel:"id",optionValue:"id"},null,8,["modelValue","onUpdate:modelValue","options","class"]),g.data.datasetColumn==null?(l(),u("small",_e,i(e.$t("workspace.gis.fieldRequired"))+" *",1)):v("",!0)]),_:1},8,["header"]),n(p,{field:"layerColumn",header:e.$t("workspace.gis.dsj.lyrJoinCol"),sortable:!0},{body:o(g=>[n(f,{class:U(["kn-material-input kn-width-full",{"p-invalid":g.data.layerColumn==null}]),modelValue:g.data.layerColumn,"onUpdate:modelValue":b=>g.data.layerColumn=b,options:e.documentDataProp.layerJoinColumns,optionLabel:"property",optionValue:"property"},null,8,["modelValue","onUpdate:modelValue","options","class"]),g.data.layerColumn==null?(l(),u("small",Ne,i(e.$t("workspace.gis.fieldRequired"))+" *",1)):v("",!0)]),_:1},8,["header"]),n(p,{style:$(e.styleDescriptor.style.trashColumn)},{body:o(g=>[n(c,{icon:"pi pi-trash",class:"p-button-link",onClick:b=>e.deleteJoinRow(g)},null,8,["onClick"])]),_:1},8,["style"])]),_:1},8,["value"])]),_:1})],4)])],64)}var qe=E(Pe,[["render",Re]]);const Oe=I({components:{DataTable:x,Column:P,Dropdown:N},emits:["indicatorsValidationChanged"],props:{documentDataProp:{type:Object,required:!1}},computed:{indicatorsInvalid(){return!!(this.documentDataProp.indicators.length==0&&this.documentDataProp.datasetLabel!=""||this.indicatorsContainEmptyFields)},indicatorsContainEmptyFields(){let e=!1;return this.documentDataProp.indicators.forEach(t=>{!t.name||!t.label||t.label===""?e=!0:e=!1}),e}},data(){return{styleDescriptor:A,documentData:{}}},created(){this.documentData=this.documentDataProp,this.$emit("indicatorsValidationChanged","indicatorsInvalid",this.indicatorsInvalid)},watch:{documentDataProp(){this.documentData=this.documentDataProp},indicatorsInvalid(){this.$emit("indicatorsValidationChanged","indicatorsInvalid",this.indicatorsInvalid)}},methods:{addIndicatorRow(){this.documentData.indicators.push({name:null,label:null})},deleteIndicatorRow(e){this.documentData.indicators.splice(e.index,1)}}}),Ge={id:"informations-content",class:"kn-flex kn-relative kn-height-full"},Ke={key:0,for:"measure",class:"p-error"},Xe={key:0,for:"label",class:"p-error"};function Qe(e,t,D,L,V,J){const c=r("Button"),k=r("Toolbar"),f=r("Dropdown"),p=r("Column"),y=r("InputText"),w=r("DataTable"),g=r("Card");return l(),u(C,null,[n(k,{class:"kn-toolbar kn-toolbar--secondary p-p-0 p-m-0 p-col-12"},{start:o(()=>[d(i(e.$t("workspace.gis.indicators")),1)]),end:o(()=>[n(c,{class:"p-button-link",label:e.$t("workspace.gis.dsj.addButton"),onClick:e.addIndicatorRow},null,8,["label","onClick"])]),_:1}),s("div",Ge,[s("div",{style:$(e.styleDescriptor.style.absoluteScroll)},[n(g,null,{content:o(()=>[n(w,{class:"p-datatable-sm kn-table georef-step1-table",value:e.documentDataProp.indicators,responsiveLayout:"scroll",breakpoint:"600px"},{empty:o(()=>[d(i(e.$t("workspace.gis.dnl.emptyInfo")),1)]),default:o(()=>[n(p,{field:"name",header:e.$t("qbe.entities.types.measure"),sortable:!0},{body:o(b=>[n(f,{id:"measure",class:U(["kn-material-input kn-width-full",{"p-invalid":b.data.name==null}]),modelValue:b.data.name,"onUpdate:modelValue":a=>b.data.name=a,options:e.documentDataProp.datasetMeasures,optionLabel:"id",optionValue:"id"},null,8,["modelValue","onUpdate:modelValue","options","class"]),b.data.name==null?(l(),u("small",Ke,i(e.$t("workspace.gis.fieldRequired"))+" *",1)):v("",!0)]),_:1},8,["header"]),n(p,{field:"label",header:e.$t("common.label"),sortable:!0},{body:o(b=>[n(y,{id:"label",class:U(["kn-material-input kn-width-full",{"p-invalid":b.data.label==null||b.data.label==""}]),modelValue:b.data.label,"onUpdate:modelValue":a=>b.data.label=a},null,8,["modelValue","onUpdate:modelValue","class"]),b.data.label==null||b.data.label==""?(l(),u("small",Xe,i(e.$t("workspace.gis.fieldRequired"))+" *",1)):v("",!0)]),_:1},8,["header"]),n(p,{style:$(e.styleDescriptor.style.trashColumn)},{body:o(b=>[n(c,{icon:"pi pi-trash",class:"p-button-link",onClick:a=>e.deleteIndicatorRow(b)},null,8,["onClick"])]),_:1},8,["style"])]),_:1},8,["value"])]),_:1})],4)])],64)}var Ye=E(Oe,[["render",Qe]]);const Ze=I({components:{Checkbox:Y,Column:P,DataTable:x,Dropdown:N},emits:["filtersValidationChanged"],props:{documentDataProp:{type:Object,required:!1}},computed:{crossDisabled(){return!this.visibilityControls.showRightConfigMenu||!this.documentDataProp.visibilityData.crossNavigation},filtersInvalid(){return!!this.filtersContainEmptyFields},filtersContainEmptyFields(){let e=!1;return this.documentDataProp.filters.forEach(t=>{!t.name||!t.label||t.label===""?e=!0:e=!1}),e}},data(){return{styleDescriptor:A,documentData:{},visibilityControls:{},crossNavigationMultiselect:null}},created(){this.documentData=this.documentDataProp,this.visibilityControls=this.documentDataProp.visibilityData.visibilityControls,this.crossNavigationMultiselect=this.documentDataProp.visibilityData.crossNavigationMultiselect,this.$emit("filtersValidationChanged","filtersInvalid",this.filtersInvalid)},watch:{documentDataProp(){this.documentData=this.documentDataProp},filtersInvalid(){this.$emit("filtersValidationChanged","filtersInvalid",this.filtersInvalid)}},methods:{addFilterRow(){this.documentData.filters.push({name:null,label:null})},deleteFilterRow(e){this.documentData.filters.splice(e.index,1)}}}),He={class:"p-grid p-m-2"},We={class:"p-col-12 p-md-6 p-lg-3"},et={for:"showRightConfigMenu"},tt={class:"p-col-12 p-md-6 p-lg-3"},at={for:"showLegendButton"},ot={class:"p-col-12 p-md-6 p-lg-3"},nt={for:"showDistanceCalculator"},lt={class:"p-col-12 p-md-6 p-lg-3"},it={for:"showDownloadButton"},rt={class:"p-col-12 p-md-6 p-lg-3"},st={for:"showSelectMode"},dt={class:"p-col-12 p-md-6 p-lg-3"},ct={for:"showLayer"},pt={class:"p-col-12 p-md-6 p-lg-3"},ut={for:"showBaseLayer"},bt={class:"p-col-12 p-md-6 p-lg-3"},mt={for:"showMapConfig"},kt={class:"p-col-12 p-md-6 p-lg-3"},ht={for:"crossNavigationMultiselect"},gt={key:1,id:"informations-content",class:"kn-flex kn-relative kn-height-full"},ft={key:0,for:"dsJoinCol",class:"p-error"},vt={key:0,for:"label",class:"p-error"};function yt(e,t,D,L,V,J){const c=r("Toolbar"),k=r("Checkbox"),f=r("Card"),p=r("Button"),y=r("Dropdown"),w=r("Column"),g=r("InputText"),b=r("DataTable");return l(),u(C,null,[n(f,{class:"p-mb-3"},{header:o(()=>[n(c,{class:"kn-toolbar kn-toolbar--secondary p-p-0 p-m-0 p-col-12"},{start:o(()=>[d(i(e.$t("common.menu")),1)]),_:1})]),content:o(()=>[s("div",He,[s("div",We,[n(k,{id:"showRightConfigMenu",class:"p-mr-2",modelValue:e.visibilityControls.showRightConfigMenu,"onUpdate:modelValue":t[0]||(t[0]=a=>e.visibilityControls.showRightConfigMenu=a),binary:!0},null,8,["modelValue"]),s("label",et,i(e.$t("workspace.gis.menu.showRightConfigMenu")),1)]),s("div",tt,[n(k,{id:"showLegendButton",class:"p-mr-2",modelValue:e.visibilityControls.showLegendButton,"onUpdate:modelValue":t[1]||(t[1]=a=>e.visibilityControls.showLegendButton=a),binary:!0},null,8,["modelValue"]),s("label",at,i(e.$t("workspace.gis.menu.showLegendButton")),1)]),s("div",ot,[n(k,{id:"showDistanceCalculator",class:"p-mr-2",modelValue:e.visibilityControls.showDistanceCalculator,"onUpdate:modelValue":t[2]||(t[2]=a=>e.visibilityControls.showDistanceCalculator=a),binary:!0},null,8,["modelValue"]),s("label",nt,i(e.$t("workspace.gis.menu.showDistanceCalculator")),1)]),s("div",lt,[n(k,{id:"showDownloadButton",class:"p-mr-2",modelValue:e.visibilityControls.showDownloadButton,"onUpdate:modelValue":t[3]||(t[3]=a=>e.visibilityControls.showDownloadButton=a),binary:!0},null,8,["modelValue"]),s("label",it,i(e.$t("workspace.gis.menu.showDownloadButton")),1)]),s("div",rt,[n(k,{id:"showSelectMode",class:"p-mr-2",modelValue:e.visibilityControls.showSelectMode,"onUpdate:modelValue":t[4]||(t[4]=a=>e.visibilityControls.showSelectMode=a),disabled:!e.visibilityControls.showRightConfigMenu,binary:!0},null,8,["modelValue","disabled"]),s("label",st,i(e.$t("workspace.gis.menu.showSelectMode")),1)]),s("div",dt,[n(k,{id:"showLayer",class:"p-mr-2",modelValue:e.visibilityControls.showLayer,"onUpdate:modelValue":t[5]||(t[5]=a=>e.visibilityControls.showLayer=a),disabled:!e.visibilityControls.showRightConfigMenu,binary:!0},null,8,["modelValue","disabled"]),s("label",ct,i(e.$t("workspace.gis.menu.showLayer")),1)]),s("div",pt,[n(k,{id:"showBaseLayer",class:"p-mr-2",modelValue:e.visibilityControls.showBaseLayer,"onUpdate:modelValue":t[6]||(t[6]=a=>e.visibilityControls.showBaseLayer=a),disabled:!e.visibilityControls.showRightConfigMenu,binary:!0},null,8,["modelValue","disabled"]),s("label",ut,i(e.$t("workspace.gis.menu.showBaseLayer")),1)]),s("div",bt,[n(k,{id:"showMapConfig",class:"p-mr-2",modelValue:e.visibilityControls.showMapConfig,"onUpdate:modelValue":t[7]||(t[7]=a=>e.visibilityControls.showMapConfig=a),disabled:!e.visibilityControls.showRightConfigMenu,binary:!0},null,8,["modelValue","disabled"]),s("label",mt,i(e.$t("workspace.gis.menu.showMapConfig")),1)]),s("div",kt,[n(k,{id:"crossNavigationMultiselect",class:"p-mr-2",modelValue:e.crossNavigationMultiselect,"onUpdate:modelValue":t[8]||(t[8]=a=>e.crossNavigationMultiselect=a),disabled:e.crossDisabled,binary:!0},null,8,["modelValue","disabled"]),s("label",ht,i(e.$t("workspace.gis.menu.crossNavigationMultiselect")),1)])])]),_:1}),e.documentData.selectedDataset.length>0?(l(),h(c,{key:0,class:"kn-toolbar kn-toolbar--secondary p-p-0 p-m-0 p-col-12"},{start:o(()=>[d(i(e.$t("common.filters")),1)]),end:o(()=>[n(p,{class:"p-button-link",label:e.$t("workspace.gis.dsj.addButton"),onClick:e.addFilterRow},null,8,["label","onClick"])]),_:1})):v("",!0),e.documentData.selectedDataset.length>0?(l(),u("div",gt,[s("div",{style:$(e.styleDescriptor.style.absoluteScroll)},[n(f,null,{content:o(()=>[n(b,{class:"p-datatable-sm kn-table georef-step1-table",value:e.documentDataProp.filters,dataKey:"id",responsiveLayout:"scroll",breakpoint:"600px"},{empty:o(()=>[d(i(e.$t("workspace.gis.dnl.emptyInfo")),1)]),default:o(()=>[n(w,{field:"name",header:e.$t("workspace.gis.dsj.dsJoinCol"),sortable:!0},{body:o(a=>[n(y,{id:"dsJoinCol",class:U(["kn-material-input kn-width-full",{"p-invalid":a.data.name==null}]),modelValue:a.data.name,"onUpdate:modelValue":m=>a.data.name=m,options:e.documentDataProp.datasetJoinColumns,optionLabel:"id",optionValue:"id"},null,8,["modelValue","onUpdate:modelValue","options","class"]),a.data.name==null?(l(),u("small",ft,i(e.$t("workspace.gis.fieldRequired"))+" *",1)):v("",!0)]),_:1},8,["header"]),n(w,{field:"label",header:e.$t("workspace.gis.dsj.lyrJoinCol"),sortable:!0},{body:o(a=>[n(g,{id:"label",class:U(["kn-material-input kn-width-full",{"p-invalid":a.data.label==null||a.data.label==""}]),modelValue:a.data.label,"onUpdate:modelValue":m=>a.data.label=m},null,8,["modelValue","onUpdate:modelValue","class"]),a.data.label==null||a.data.label==""?(l(),u("small",vt,i(e.$t("workspace.gis.fieldRequired"))+" *",1)):v("",!0)]),_:1},8,["header"]),n(w,{style:$(e.styleDescriptor.style.trashColumn)},{body:o(a=>[n(p,{icon:"pi pi-trash",class:"p-button-link",onClick:m=>e.deleteFilterRow(a)},null,8,["onClick"])]),_:1},8,["style"])]),_:1},8,["value"])]),_:1})],4)])):v("",!0)],64)}var Dt=E(Ze,[["render",yt]]);const wt=I({name:"gis-document-designer",components:{Dialog:j,TabView:O,TabPanel:G,DatasetLayerTab:xe,DatasetJoinTab:qe,IndicatorsTab:Ye,MenuTab:Dt,KnOverlaySpinnerPanel:K,Badge:X},emits:[],props:{},computed:{isDatasetChosen(){return this.documentData.datasetLabel!=""},saveDialogDisabled(){return!!(this.documentData.selectedLayer<=0||this.validations.joinsInvalid||this.validations.indicatorsInvalid||this.validations.filtersInvalid)},saveButtonDisabled(){return this.documentData.documentLabel==null||this.documentData.documentLabel==""}},data(){return{descriptor:A,loading:!1,saveDialogVisible:!1,selectedDocument:{},documentTemplate:{},documentData:{},validations:{joinsInvalid:!1,indicatorsInvalid:!1,filtersInvalid:!1},canOpenMap:!0}},setup(){return{store:Q()}},created(){this.loadPage()},methods:{closeGis(){this.$router.push(`${this.$router.options.history.state.back}`)},async loadPage(){this.loading=!0,this.disableMapPreview(),await this.createDocumentData(),this.loading=!1},disableMapPreview(){this.$route.path.includes("new")&&(this.canOpenMap=!1)},async createDocumentData(){this.documentData=F(A.newGisTemplate),await this.getAllLayers(),this.$route.path.includes("edit")&&(await this.getSelectedDocument(),await this.getDocumentDrivers(),await this.findActiveTemplate(),await this.initializeDataset(),this.initializeSelectedDrivers(),this.initializeSelectedLayer())},async getAllLayers(){await this.$http.get("/knowage/restful-services/layers").then(e=>this.documentData.allLayers=e.data.root)},async getSelectedDocument(){await this.$http.get(`/knowage/restful-services/2.0/documents/${this.$route.query.documentId}`).then(async e=>{this.selectedDocument=e.data,this.documentData.documentLabel=e.data.label,this.documentData.documentDesc=e.data.description,this.documentData.dataSetId=e.data.dataSetId})},async findActiveTemplate(){await this.$http.get(`/knowage/restful-services/2.0/documentdetails/${this.$route.query.documentId}/templates`,{headers:{Accept:"application/json, text/plain, */*","X-Disable-Errors":"true"}}).then(async e=>{if(e.data.length>0){let t=null;e.data.find(D=>D.active===!0?t=D.id:""),await this.getActiveTemplateData(t)}})},async getDocumentDrivers(){this.selectedDocument.drivers.length>0&&await this.$http.get(`/knowage/restful-services/1.0/documents/${this.documentData.documentLabel}/parameters`,{headers:{Accept:"application/json, text/plain, */*","X-Disable-Errors":"true"}}).then(async e=>{this.documentData.allDrivers=e.data.results})},initializeSelectedDrivers(){this.selectedDocument.drivers.length>0&&this.documentTemplate.analitycalFilter&&this.documentData.allDrivers.forEach(e=>{this.documentTemplate.analitycalFilter.forEach(t=>{e.url===t&&this.documentData.selectedDriver.push(e)})})},async getActiveTemplateData(e){await this.$http.get(`/knowage/restful-services/2.0/documentdetails/${this.$route.query.documentId}/templates/selected/${e}`,{headers:{Accept:"application/json, text/plain, */*","X-Disable-Errors":"true"}}).then(async t=>{this.documentTemplate=t.data,this.documentData.indicators=t.data.indicators,this.documentData.filters=t.data.filters,this.documentData.visibilityData={crossNavigation:t.data.crossNavigation,crossNavigationMultiselect:t.data.crossNavigationMultiselect,visibilityControls:t.data.visibilityControls}})},initializeSelectedLayer(){this.documentTemplate.targetLayerConf&&this.documentData.allLayers.forEach(e=>{this.documentTemplate.targetLayerConf.forEach(t=>{e.name===t.label&&this.documentData.selectedLayer.push(e)})}),this.initializeSelectedJoinColumns()},async initializeSelectedJoinColumns(){if(this.documentTemplate.datasetJoinColumns&&this.documentTemplate.layerJoinColumns){var e=this.documentTemplate.datasetJoinColumns.split(","),t=this.documentTemplate.layerJoinColumns.split(","),D=this.documentData.selectedLayer[0].layerId;this.documentData.dsJoins=e.map((L,V)=>({datasetColumn:L,layerColumn:t[V]})),this.loadLayerColumns(D)}},async loadLayerColumns(e){await this.$http.get(`/knowage/restful-services/layers/getFilter?id=${e}`).then(t=>{this.documentData.layerJoinColumns=t.data})},async initializeDataset(){this.documentData.dataSetId&&await this.$http.get(`/knowage/restful-services/1.0/datasets/dataset/id/${this.documentData.dataSetId}`).then(e=>{this.documentData.selectedDataset=[e.data[0]],this.documentData.datasetLabel=e.data[0].label,this.loadDatasetColumns()})},async loadDatasetColumns(){await this.$http.get(`/knowage/restful-services/1.0/datasets/${this.documentData.datasetLabel}/fields`).then(e=>{this.documentData.datasetJoinColumns=e.data.results.filter(t=>t.nature==="attribute"),this.documentData.datasetMeasures=e.data.results.filter(t=>t.nature==="measure")})},validationChanged(e,t){this.validations[e]=t},resetAllFields(){this.documentData.datasetJoinColumns=[],this.documentData.datasetMeasures=[],this.documentData.dsJoins=[],this.documentData.filters=[],this.documentData.indicators=[],this.documentData.selectedLayer=[],this.documentData.layerJoinColumns=[]},onDatasetChange(e){this.documentData.dataSetId=e.id,this.resetAllFields(),this.initializeDataset()},onDatasetDelete(){this.documentData.datasetLabel="",this.documentData.dataSetId=null,this.resetAllFields()},onLayerChange(e){this.documentData.selectedLayer=e,this.isDatasetChosen&&this.loadLayerColumns(e[0].layerId)},onDriverChange(e){this.documentData.selectedDriver=e},saveOrUpdateGis(){this.$route.path.includes("edit")?this.buildGisTemplate():this.saveDialogVisible=!0},buildGisTemplate(){let e={};e.targetLayerConf=[],this.documentData.selectedLayer.forEach(t=>{e.targetLayerConf.push({label:t.name})}),!this.documentData.datasetLabel&&this.documentData.selectedDriver&&(e.analitycalFilter=[],this.documentData.selectedDriver.length>0&&this.documentData.selectedDriver.forEach(t=>{e.analitycalFilter.push(t.url)})),e.datasetJoinColumns="",e.layerJoinColumns="",this.documentData.dsJoins.forEach((t,D)=>{D!=0&&(e.datasetJoinColumns+=","),e.datasetJoinColumns+=t.datasetColumn}),this.documentData.dsJoins.forEach((t,D)=>{D!=0&&(e.layerJoinColumns+=","),e.layerJoinColumns+=t.layerColumn}),e.indicators=this.documentData.indicators,e.filters=this.documentData.filters,e.crossNavigation=this.documentData.visibilityData.crossNavigation,e.crossNavigationMultiselect=this.documentData.visibilityData.crossNavigationMultiselect,e.visibilityControls=this.documentData.visibilityData.visibilityControls,this.saveGisDocument(e)},async saveGisDocument(e){if(this.$route.path.includes("edit")){let t={};t.DATASET_LABEL=this.documentData.datasetLabel,t.DOCUMENT_LABEL=this.documentData.documentLabel,t.TEMPLATE=e,await this.$http.post("/knowage/restful-services/1.0/documents/saveGeoReportTemplate",t).then(async()=>{this.saveDialogVisible=!1,this.canOpenMap=!0,this.store.setInfo({title:this.$t("common.toast.updateTitle"),msg:this.$t("common.toast.updateSuccess")}),this.routeToDocument()})}else{let t={},D=new Date,L="geomap_"+D.getTime()%1e7;t.action="DOC_SAVE",t.customData={templateContent:e},t.document={name:this.documentData.documentLabel,description:this.documentData.documentDesc,label:L,type:"MAP"},this.documentData.datasetLabel?t.sourceData={label:this.documentData.datasetLabel}:t.sourceData=null,await this.$http.post("/knowage/restful-services/2.0/saveDocument/",t).then(async()=>{this.saveDialogVisible=!1,this.canOpenMap=!0,this.documentData.documentLabel=L,this.store.setInfo({title:this.$t("common.toast.createTitle"),msg:this.$t("common.toast.success")})})}},async routeToDocument(){await this.$http.get(`/knowage/restful-services/2.0/documentdetails/${this.$route.query.documentId}/templates`).then(e=>{e.data.find(t=>t.active===!0?this.$router.push(`/gis/edit?documentId=${this.$route.query.documentId}`):"")})},openMapConfirm(){this.$confirm.require({header:this.$t("common.toast.warning"),message:this.$t("workspace.gis.dnl.openMapWarning"),icon:"pi pi-exclamation-triangle",accept:()=>{this.openMap()}})},openMap(){this.$router.push(`/document-browser/map/${this.documentData.documentLabel}`)}}}),Ct={class:"kn-page"},$t={class:"gis-tabview-container p-d-flex p-flex-column kn-flex"},Lt={key:0},Mt={key:1},Vt={class:"p-field p-col-12 p-my-1"},Ft={class:"p-float-label"},Tt={for:"label",class:"kn-material-input-label"},At={key:0,for:"label",class:"p-error"},It={class:"p-field p-col-12"},Et={class:"p-float-label"},Jt={for:"desc",class:"kn-material-input-label"},St={class:"p-d-flex p-flex-row p-jc-end"};function Bt(e,t,D,L,V,J){const c=r("Button"),k=r("Toolbar"),f=r("KnOverlaySpinnerPanel"),p=r("DatasetLayerTab"),y=r("TabPanel"),w=r("Badge"),g=r("DatasetJoinTab"),b=r("IndicatorsTab"),a=r("MenuTab"),m=r("TabView"),R=r("InputText"),q=r("Dialog");return l(),u("div",Ct,[n(k,{class:"kn-toolbar kn-toolbar--primary"},{start:o(()=>[d(i(e.$t("workspace.gis.title")),1)]),end:o(()=>[n(c,{class:"p-button-text p-button-rounded p-button-plain",label:e.$t("workspace.gis.editMap"),disabled:!e.canOpenMap,onClick:e.openMapConfirm},null,8,["label","disabled","onClick"]),n(c,{icon:"pi pi-save",class:"p-button-text p-button-rounded p-button-plain",disabled:e.saveDialogDisabled,onClick:e.saveOrUpdateGis},null,8,["disabled","onClick"]),n(c,{icon:"pi pi-times",class:"p-button-text p-button-rounded p-button-plain",onClick:e.closeGis},null,8,["onClick"])]),_:1}),s("div",$t,[n(f,{visibility:e.loading},null,8,["visibility"]),e.loading?v("",!0):(l(),h(m,{key:0,class:"p-d-flex p-flex-column kn-flex"},{default:o(()=>[n(y,null,{header:o(()=>[e.$route.path.includes("new")?(l(),u("span",Lt,i(e.$t("workspace.gis.datasetLayerTitle")),1)):(l(),u("span",Mt,i(e.$t("managers.layersManagement.layerTitle")),1))]),default:o(()=>[n(p,{documentDataProp:e.documentData,isDatasetChosen:e.isDatasetChosen,onDatasetChanged:t[0]||(t[0]=M=>e.onDatasetChange(M)),onLayerChanged:t[1]||(t[1]=M=>e.onLayerChange(M)),onDriverChanged:t[2]||(t[2]=M=>e.onDriverChange(M)),onDatasetDeleted:e.onDatasetDelete},null,8,["documentDataProp","isDatasetChosen","onDatasetDeleted"])]),_:1}),n(y,{disabled:!e.documentData.selectedDataset.length>0||!e.documentData.selectedLayer.length>0},{header:o(()=>[s("span",null,i(e.$t("workspace.gis.datasetJoinTitle")),1),e.validations.joinsInvalid?(l(),h(w,{key:0,value:"",class:"p-ml-2",severity:"danger"})):v("",!0)]),default:o(()=>[n(g,{documentDataProp:e.documentData,onJoinsValidationChanged:e.validationChanged},null,8,["documentDataProp","onJoinsValidationChanged"])]),_:1},8,["disabled"]),n(y,{disabled:!e.documentData.selectedDataset.length>0},{header:o(()=>[s("span",null,i(e.$t("workspace.gis.indicators")),1),e.validations.indicatorsInvalid?(l(),h(w,{key:0,value:"",class:"p-ml-2",severity:"danger"})):v("",!0)]),default:o(()=>[n(b,{documentDataProp:e.documentData,onIndicatorsValidationChanged:e.validationChanged},null,8,["documentDataProp","onIndicatorsValidationChanged"])]),_:1},8,["disabled"]),n(y,null,{header:o(()=>[s("span",null,i(e.$t("workspace.gis.filtersMenu")),1),e.validations.filtersInvalid?(l(),h(w,{key:0,value:"",class:"p-ml-2",severity:"danger"})):v("",!0)]),default:o(()=>[n(a,{documentDataProp:e.documentData,onFiltersValidationChanged:e.validationChanged},null,8,["documentDataProp","onFiltersValidationChanged"])]),_:1})]),_:1}))]),e.saveDialogVisible?(l(),h(q,{key:0,class:"p-fluid kn-dialog--toolbar--primary",style:$(e.descriptor.style.dialogSize),visible:e.saveDialogVisible,modal:!0,closable:!1},{header:o(()=>[n(k,{class:"kn-toolbar kn-toolbar--primary p-p-0 p-m-0 p-col-12"},{start:o(()=>[d(i(e.$t("workspace.gis.save")),1)]),_:1})]),footer:o(()=>[s("div",St,[n(c,{class:"kn-button kn-button--secondary",onClick:t[5]||(t[5]=M=>e.saveDialogVisible=!1)},{default:o(()=>[d(i(e.$t("common.cancel")),1)]),_:1}),n(c,{class:"kn-button kn-button--primary",disabled:e.saveButtonDisabled,onClick:e.buildGisTemplate},{default:o(()=>[d(i(e.$t("common.save")),1)]),_:1},8,["disabled","onClick"])])]),default:o(()=>[s("div",Vt,[s("span",Ft,[n(R,{id:"label",class:U(["kn-material-input",{"p-invalid":e.documentData.documentLabel==null||e.documentData.documentLabel==""}]),modelValue:e.documentData.documentLabel,"onUpdate:modelValue":t[3]||(t[3]=M=>e.documentData.documentLabel=M)},null,8,["modelValue","class"]),s("label",Tt,i(e.$t("common.label"))+" * ",1)]),e.documentData.documentLabel==null||e.documentData.documentLabel==""?(l(),u("small",At,"Field required *")):v("",!0)]),s("div",It,[s("span",Et,[n(R,{id:"desc",class:"kn-material-input kn-width-full",modelValue:e.documentData.documentDesc,"onUpdate:modelValue":t[4]||(t[4]=M=>e.documentData.documentDesc=M)},null,8,["modelValue"]),s("label",Jt,i(e.$t("common.description")),1)])])]),_:1},8,["style","visible"])):v("",!0)])}var Pt=E(wt,[["render",Bt]]);export{Pt as default};
//# sourceMappingURL=GisDocumentDesigner-f2f9a16d.js.map
